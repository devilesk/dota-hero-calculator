define(["require","exports","module","jquery","./herocalc_core"],function(t,e,a){"use strict";var i=t("jquery"),o=t("./herocalc_core").HEROCALCULATOR;o.prototype.itemtooltipdata={},o.prototype.ability_vars={$health:"Health",$mana:"Mana",$armor:"Armor",$damage:"Damage",$str:"Strength",$int:"Intelligence",$agi:"Agility",$all:"All Attributes",$attack:"Attack Speed",$hp_regen:"HP Regeneration",$mana_regen:"Mana Regeneration",$move_speed:"Movement Speed",$evasion:"Evasion",$spell_resist:"Spell Resistance",$selected_attribute:"Selected Attribute",$selected_attrib:"Selected Attribute",$cast_range:"Cast Range",$attack_range:"Attack Range"},o.prototype.abilityTooltipData={},o.prototype.abilityDamageTypes={DAMAGE_TYPE_MAGICAL:"Magical",DAMAGE_TYPE_PURE:"Pure",DAMAGE_TYPE_PHYSICAL:"Physical",DAMAGE_TYPE_COMPOSITE:"Composite",DAMAGE_TYPE_HP_REMOVAL:"HP Removal"},o.prototype.getTooltipItemDescription=function(t){for(var e=t.description,a=0;a<t.attributes.length;a++)if(null!=t.attributes[a].name){for(var i=t.attributes[a].name,o=t.attributes[a].value[0],r=1;r<t.attributes[a].value.length;r++)o+=" / "+t.attributes[a].value[r];var l=new RegExp("%"+i+"%","gi");e=e.replace(l,o)}var l=new RegExp("%%","gi");return e=e.replace(l,"%"),l=new RegExp("\n","gi"),e=e.replace(/\\n/g,"<br>")},o.prototype.getTooltipItemAttributes=function(t){for(var e="",a=0;a<t.attributes.length;a++)if(null!=t.attributes[a].tooltip){for(var i=t.attributes[a].tooltip,r=t.attributes[a].value[0],l=1;l<t.attributes[a].value.length;l++)r+=" / "+t.attributes[a].value[l];var n=i.indexOf("%");0==n&&(r+="%",i=i.slice(1));var p=i.indexOf("$");e=-1!=p?e+i.slice(0,p)+" "+r+" "+o.prototype.ability_vars[i.slice(p)]+"<br>":e+i+" "+r+"<br>"}return e.trim("<br>")},o.prototype.getTooltipItemCooldown=function(t){for(var e="",a=0;a<t.cooldown.length;a++)e=e+" "+t.cooldown[a];return e},o.prototype.getTooltipItemManaCost=function(t){for(var e="",a=0;a<t.manacost.length;a++)t.manacost[a]>0&&(e=e+" "+t.manacost[a]);return e},o.prototype.getItemTooltipData=function(t){if(void 0!=o.prototype.itemData["item_"+t]){if(void 0==o.prototype.itemtooltipdata[t]){var e=o.prototype.itemData["item_"+t],a=i("<div>");a.append(i("<span>").html(e.displayname).addClass("item_field item_name")),a.append(i("<span>").html(e.itemcost).addClass("item_field item_cost")),a.append(i("<hr>")),null!=e.description&&a.append(i("<div>").html(o.prototype.getTooltipItemDescription(e)).addClass("item_field item_description"));var r=o.prototype.getTooltipItemAttributes(e);""!=r&&a.append(i("<div>").html(r).addClass("item_field item_attributes"));var l=o.prototype.getTooltipItemCooldown(e),n=o.prototype.getTooltipItemManaCost(e);if(""!=l||""!=n){var p=i("<div>").addClass("item_cdmana");""!=l&&p.append(i("<span>").html(l).addClass("item_field item_cooldown")),""!=n&&p.append(i("<span>").html(n).addClass("item_field item_manacost")),a.append(p)}return null!=e.lore&&a.append(i("<div>").html(e.lore).addClass("item_field item_lore")),o.prototype.itemtooltipdata[t]=a.html(),a.html()}return o.prototype.itemtooltipdata[t]}},o.prototype.getTooltipAbilityDescription=function(t){for(var e=t.description,a=0;a<t.attributes.length;a++)if(null!=t.attributes[a].name){for(var i=t.attributes[a].name,o=t.attributes[a].value[0],r=1;r<t.attributes[a].value.length;r++)o+=" / "+t.attributes[a].value[r];l=new RegExp("%"+i+"%","gi"),e=e.replace(l,o)}var l=new RegExp("%%","gi");return e=e.replace(l,"%"),l=new RegExp("\n","gi"),e=e.replace(/\\n/g,"<br>")},o.prototype.getTooltipAbilityAttributes=function(t){var e="";if(t.damage.length>0&&t.damage.reduce(function(t,e){return t+e},0)>0){for(var a="DAMAGE: ",i=t.damage[0],o=1;o<t.damage.length;o++)i+=" / "+t.damage[o];e=e+a+" "+i+"<br>"}for(var r=0;r<t.attributes.length;r++)if(null!=t.attributes[r].tooltip){var a=t.attributes[r].tooltip;a=a.replace(/\\n/g,"");for(var i=t.attributes[r].value[0],o=1;o<t.attributes[r].value.length;o++)i+=" / "+t.attributes[r].value[o];var l=a.indexOf("%");if(0==l){if(-1==i.toString().indexOf("/"))i=i.toString().trim()+"%";else{var n=i.split("/"),p=n.map(function(t){return t.trim()});i=p.join("% / ")+"%"}a=a.slice(1)}a.indexOf("$");e=e+a+" "+i+"<br>"}return e.trim("<br>")},o.prototype.getTooltipAbilityManaCost=function(t){var e="";if(0==t.manacost.reduce(function(t,e){return t+e},0))return e;if(t.manacost.every(function(e){return e==t.manacost[0]}))return t.manacost[0].toString();for(var a=0;4>a;a++)null!=t.manacost[a]&&(e=e+" "+t.manacost[a]);return e},o.prototype.getTooltipAbilityCooldown=function(t){var e="";if(0==t.cooldown.reduce(function(t,e){return t+e},0))return e;if(t.cooldown.every(function(e){return e==t.cooldown[0]}))return t.cooldown[0].toString();for(var a=0;4>a;a++)null!=t.cooldown[a]&&(e=e+" "+t.cooldown[a]);return e},o.prototype.getAbilityTooltipData=function(t,e){if(void 0==o.prototype.abilityTooltipData[e]){var a={};if(void 0==o.prototype.heroData[t])for(var r=0;r<o.prototype.unitData[t].abilities.length;r++)o.prototype.unitData[t].abilities[r].name==e&&(a=o.prototype.unitData[t].abilities[r]);else for(var r=0;r<o.prototype.heroData[t].abilities.length;r++)o.prototype.heroData[t].abilities[r].name==e&&(a=o.prototype.heroData[t].abilities[r]);var l=i("<div>");l.append(i("<span>").html(a.displayname).addClass("item_field pull-left item_name")),a.abilityunitdamagetype&&l.append(i("<span>").html(o.prototype.abilityDamageTypes[a.abilityunitdamagetype]).addClass("item_field pull-right item_ability_damage_type").css("margin-right","10px")),l.append(i("<hr>").css("clear","both")),null!=a.description&&l.append(i("<div>").html(o.prototype.getTooltipAbilityDescription(a)).addClass("item_field item_description"));var n=o.prototype.getTooltipAbilityAttributes(a);""!=n&&l.append(i("<div>").html(n).addClass("item_field item_attributes"));var p=o.prototype.getTooltipAbilityCooldown(a),s=o.prototype.getTooltipAbilityManaCost(a);if(""!=p||""!=s){var d=i("<div>").addClass("item_cdmana");""!=s&&d.append(i("<span>").html(s.trim()).addClass("item_field item_manacost")),""!=p&&d.append(i("<span>").html(p.trim()).addClass("item_field item_cooldown")),l.append(d)}return null!=a.lore&&l.append(i("<div>").html(a.lore).addClass("item_field item_lore")),o.prototype.abilityTooltipData[e]=l.html(),l.html()}return o.prototype.abilityTooltipData[e]}});