define(["require","exports","module","herocalc_knockout","jquery","bootstrap","jquery-ui.custom","chartjs","chartjs-scatter","components","./herocalc_core"],function(e,t,o){"use strict";var s=e("herocalc_knockout"),a=e("jquery");e("bootstrap"),e("jquery-ui.custom"),e("chartjs"),e("chartjs-scatter"),e("components"),s.components.register("hero-pane",{require:"components/hero-pane"}),s.components.register("unit-pane",{require:"components/unit-pane"}),s.components.register("clone-pane",{require:"components/clone-pane"}),s.components.register("illusion-pane",{require:"components/illusion-pane"}),s.components.register("buff-settings",{require:"components/buff-settings"}),s.components.register("item-buff",{require:"components/item-buff"}),s.components.register("item-debuff",{require:"components/item-debuff"}),s.components.register("buff-section",{require:"components/buff-section"}),s.components.register("damage-details",{require:"components/damage-details"}),s.components.register("damage-amp",{require:"components/damage-amp"}),s.components.register("ability",{require:"components/ability"}),s.components.register("shop",{require:"components/shop"}),s.components.register("stat",{require:"components/stats/stat"}),s.components.register("stats0",{require:"components/stats/stats0"}),s.components.register("stats1",{require:"components/stats/stats1"}),s.components.register("stats2",{require:"components/stats/stats2"}),s.components.register("stats3",{require:"components/stats/stats3"}),s.components.register("stats-additional",{require:"components/stats/stats-additional"});var r=e("./herocalc_core").HEROCALCULATOR;r.prototype.PlayerColors=["#2E6AE6","#5DE6AD","#AD00AD","#DCD90A","#E66200","#E67AB0","#92A440","#5CC5E0","#00771F","#956000"],r.prototype.Tab=function(e,t,o,a,r,i){var n=this;return n.id=e,n.href=t,n.color=r,n.data=o,n.data.id=s.observable(n.href),n.text=a,n.template=i,n},r.prototype.Tab.prototype.toJS=function(){return{id:this.id,href:this.href,color:this.color,text:this.text,template:this.template}},r.prototype.TabGroup=function(e,t,o){var a=this;return a.hero=e,a.unit=t,a.clone=o,a.illusions=s.observableArray([]),a},r.prototype.TabGroup.prototype.toJS=function(){return{hero:this.hero.toJS(),unit:this.unit.toJS(),clone:this.clone.toJS(),illusions:this.illusions().map(function(e){return e.toJS()})}},r.prototype.HeroCalculatorViewModel=function(){var e=this;e.heroes=[];for(var t=0;10>t;t++)e.heroes.push(new r.prototype.HeroCalculatorModel(t));for(var t=0;5>t;t++){for(var o=[],i=5;10>i;i++)o.push(e.heroes[i]);e.heroes[t].enemies.push.apply(e.heroes[t].enemies,o)}for(var t=5;10>t;t++){for(var o=[],i=0;5>i;i++)o.push(e.heroes[i]);e.heroes[t].enemies.push.apply(e.heroes[t].enemies,o)}for(var t=0;10>t;t++){for(var o=[],i=0;10>i;i++)t!==i&&o.push(e.heroes[i]);e.heroes[t].otherHeroes.push.apply(e.heroes[t].otherHeroes,o)}for(var t=0;10>t;t++)e.heroes[t].clone=s.observable(new r.prototype.CloneViewModel(0,e.heroes[t])),e.heroes[t].unit=s.observable(new r.prototype.UnitViewModel(0,e.heroes[t])),e.heroes[t].selectedCompare(e.heroes[t].availableCompare()[5>t?4+t:t-5]),e.heroes[t].selectedEnemy(e.heroes[t].availableEnemies()[t%5]),e.heroes[t].unit().enemy(e.heroes[t].enemy()),e.heroes[t].unit().selectedUnit(e.heroes[t].unit().availableUnits()[0]),e.heroes[t].illusions.subscribe(function(t){for(var o=0;o<t.length;o++)if("added"==t[o].status){var s=this.index<2?"#5cb85c":"#d9534f",a=r.prototype.uniqueId();e.tabs()[this.index].illusions.push(new r.prototype.Tab("illusionTab"+this.index+"-"+a,"illusionPane"+this.index+"-"+a,e.heroes[this.index].illusions()[e.tabs()[this.index].illusions().length](),"Illusion "+a,s,"illusion-pane"))}},{vm:this,index:t},"arrayChange");e.heroes[0].bound(!0),e.tabs=s.observableArray([]);for(var n=[],t=0;10>t;t++){var l=r.prototype.PlayerColors[t],p=new r.prototype.TabGroup(new r.prototype.Tab("heroTab"+t,"heroPane"+t,e.heroes[t],"Hero "+t,l,"hero-pane"),new r.prototype.Tab("unitTab"+t,"unitPane"+t,e.heroes[t].unit(),"Unit "+t,l,"unit-pane"),new r.prototype.Tab("cloneTab"+t,"clonePane"+t,e.heroes[t].clone(),"Meepo Clone "+t,l,"clone-pane"));n.push(p)}e.tabs.push.apply(e.tabs,n),e.selectedItem=s.observable(),e.layout=s.observable("1"),e.displayShop=s.observable(!0),e.displayShopItemTooltip=s.observable(!0),e.allItems=s.observableArray([{name:"Str, Agi, Int, MS, Turn, Sight",value:"stats0"},{name:"Armor, Health, Mana, Regen, EHP",value:"stats1"},{name:"Phys Res, Magic Res, Lifesteal, Evasion, Bash, Miss",value:"stats2"},{name:"Damage, IAS, BAT, Attack",value:"stats3"}]),e.selectedItems=s.observableArray([]),e.moveUp=function(){var t=e.allItems.indexOf(e.selectedItems()[0]),o=e.allItems.indexOf(e.selectedItems()[e.selectedItems().length-1]);if(t>0){var s=e.allItems.splice(t-1,1);e.allItems.splice(o,0,s[0])}},e.moveDown=function(){var t=e.allItems.indexOf(e.selectedItems()[0]),o=e.allItems.indexOf(e.selectedItems()[e.selectedItems().length-1]);if(o<e.allItems().length-1){var s=e.allItems.splice(o+1,1);e.allItems.splice(t,0,s[0])}},e.selectedTabId=s.observable("heroTab0"),e.getSelectedTab=function(t){var o=t.replace("heroTab","").replace("cloneTab","").replace("unitTab","").replace("illusionTab","").split("-"),s=o[0],a=e.tabs()[s];return a},e.selectedTab=s.computed(function(){var t=e.getSelectedTab(e.selectedTabId());return-1!=e.selectedTabId().indexOf("hero")?t.hero:-1!=e.selectedTabId().indexOf("unit")?t.unit:-1!=e.selectedTabId().indexOf("clone")?t.clone:-1!=e.selectedTabId().indexOf("illusion")?t.illusions().find(function(t){return t.id==e.selectedTabId()}):e.tabs()[0].hero}),e.selectedTabs=s.observableArray(["heroTab0","heroTab1"]),e.boundSettings=s.observable(!1),e.clickTab=function(t,o,s){e.selectedTabId(o.target.id),e.selectedTabs()[1]!=o.target.id&&(e.selectedTabs.shift(),e.selectedTabs.push(o.target.id)),e.selectedTab().data.hasOwnProperty("bound")&&(e.selectedTab().data.bound(!0),setTimeout(function(){e.selectedTab().data.buildExplorer.graphData.valueHasMutated()},0)),"settingsTab"===o.target.id&&e.boundSettings(!0)},e.isSecondTab=function(t){return e.selectedTabs().indexOf(t)>-1&&e.selectedTabId()!=t},e.showSideTabId=function(t){return e.selectedTabs().indexOf(t)>-1&&e.sideView()},e.removeTab=function(t,o,s,r){o.id==e.selectedTabId()&&(e.clickTab(null,{target:{id:"heroTab0"}}),a("#heroTab0").tab("show")),e.tabs()[r].illusions.remove(function(e){return e==o}),e.heroes[r].illusions.remove(function(e){return e()==o.data})},e.sideView=s.observable(!1),e.sideView.subscribe(function(t){if(t){e.shopPopout()||e.displayShop(!1);for(var o=0;o<e.selectedTabs().length;o++){var s=e.getSelectedTab(e.selectedTabs()[o]);s&&s.hero.data.hasOwnProperty("bound")&&s.hero.data.bound(!0)}e.layout("0")}});var u=a(window);e.windowWidth=s.observable(u.width()),e.windowHeight=s.observable(u.height()),u.resize(function(){e.windowWidth(u.width()),e.windowHeight(u.height())}),e.shopDock=s.observable(!1),e.shopDock.subscribe(function(e){}),e.shopDockTrigger=s.computed(function(){e.windowWidth(),e.shopDock()}),e.shopPopout=s.observable(!1),e.shopPopout.subscribe(function(t){t?(e.displayShop(!0),a("#shop-dialog").dialog({minWidth:380,minHeight:0,closeText:"",open:function(t,o){a(t.target.offsetParent).find(".ui-dialog-titlebar").find("button").addClass("close glyphicon glyphicon-remove shop-button btn btn-default btn-xs pull-right").removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close close").css("margin-right","0px").parent().append(a("#shop-minimize")).append(a("#shop-maximize")),a(t.target.offsetParent).find(".ui-dialog-titlebar").dblclick(function(){e.displayShop(!e.displayShop())})},close:function(t,o){e.shopPopout(!1)}})):(a("#shop-container").prepend(a("#shop-minimize")).prepend(a("#shop-maximize")),a("#shop-dialog").dialog("destroy"))}),e.changeSelectedItem=function(t,o){e.itemInputValue(1),e.selectedItem(o.target.id)},e.getItemTooltipData=s.computed(function(){return r.prototype.getItemTooltipData(e.selectedItem())},this),e.getItemInputLabel=s.computed(function(){return-1!=r.prototype.stackableItems.indexOf(e.selectedItem())?"Stack Size":-1!=r.prototype.levelitems.indexOf(e.selectedItem())?"Upgrade Level":"bloodstone"==e.selectedItem()?"Charges":""},this),e.itemInputValue=s.observable(1),e.saveLink=s.observable(),e.getAppState=function(){var t={selectedItem:e.selectedItem,layout:e.layout,displayShop:e.displayShop,displayShopItemTooltip:e.displayShopItemTooltip,allItems:e.allItems,selectedItems:e.selectedItems,selectedTabId:e.selectedTabId,selectedTabs:e.selectedTabs,boundSettings:e.boundSettings,sideView:e.sideView,windowWidth:e.windowWidth,windowHeight:e.windowHeight,shopDock:e.shopDock,shopPopout:e.shopPopout,itemInputValue:e.itemInputValue,saveLink:e.saveLink};return t.tabs=e.tabs().map(function(e){return e.toJS()}),s.toJS(t)},e.getSaveData=function(){for(var t={version:"1.3.0",heroes:[]},o=0;10>o;o++){for(var a=e.heroes[o],r={hero:a.selectedHero().heroName,level:a.selectedHeroLevel(),items:[],abilities:[],skillPointHistory:a.skillPointHistory(),buffs:[],itemBuffs:[],debuffs:[],itemDebuffs:[],graphData:[],enemyIndex:a.enemy().index(),heroCompareIndex:a.heroCompare().index()},i=0;i<a.inventory.items().length;i++)r.items.push(s.toJS(a.inventory.items()[i]));for(var i=0;i<a.ability().abilities().length;i++)r.abilities.push({level:a.ability().abilities()[i].level(),isActive:a.ability().abilities()[i].isActive()});for(var i=0;i<a.buffs.buffs().length;i++)r.buffs.push({name:a.buffs.buffs()[i].name,level:a.buffs.buffs()[i].data.level(),isActive:a.buffs.buffs()[i].data.isActive()});for(var i=0;i<a.debuffs.buffs().length;i++)r.debuffs.push({name:a.debuffs.buffs()[i].name,level:a.debuffs.buffs()[i].data.level(),isActive:a.debuffs.buffs()[i].data.isActive()});for(var i=0;i<a.buffs.itemBuffs.items().length;i++)r.itemBuffs.push(s.toJS(a.buffs.itemBuffs.items()[i]));for(var i=0;i<a.debuffs.itemBuffs.items().length;i++)r.itemDebuffs.push(s.toJS(a.debuffs.itemBuffs.items()[i]));r.graphData=s.toJS(a.buildExplorer.graphData),t.heroes.push(r)}return t},e.save=function(){var t=e.getSaveData(),o=JSON.stringify(t);a.ajax({type:"POST",url:"save.php",data:{data:o},dataType:"json",success:function(t){e.saveLink("http://devilesk.com/dota2/apps/hero-calculator?id="+t.file)},failure:function(e){alert("Save request failed.")}})},e.load=function(t){for(var o=0;o<t.heroes.length;o++){var a=e.heroes[o];if(a.selectedHero(r.prototype.findWhere(a.availableHeroes(),{heroName:t.heroes[o].hero})),a.selectedHeroLevel(t.heroes[o].level),a.inventory.items.removeAll(),a.inventory.activeItems.removeAll(),t.heroes[o].hasOwnProperty("heroCompareIndex")){var i=a.availableCompare().filter(function(e){return e.hero.index()==t.heroes[o].heroCompareIndex});i.length&&(a.selectedCompare(i[0]),a.heroCompare(i[0].hero))}if(t.heroes[o].hasOwnProperty("enemyIndex")){var i=a.availableEnemies().filter(function(e){return e.hero.index()==t.heroes[o].enemyIndex});i.length&&(a.selectedEnemy(i[0]),a.enemy(i[0].hero))}for(var n=0;n<t.heroes[o].items.length;n++){var l=t.heroes[o].items[n],p={item:l.item,state:s.observable(l.state),size:l.size,enabled:s.observable(l.enabled)};a.inventory.items.push(p)}for(var n=0;n<t.heroes[o].abilities.length;n++)a.ability().abilities()[n].level(t.heroes[o].abilities[n].level),a.ability().abilities()[n].isActive(t.heroes[o].abilities[n].isActive);a.skillPointHistory(t.heroes[o].skillPointHistory);for(var n=0;n<t.heroes[o].buffs.length;n++){a.buffs.selectedBuff(r.prototype.findWhere(a.buffs.availableBuffs(),{buffName:t.heroes[o].buffs[n].name})),a.buffs.addBuff(a,{});var u=r.prototype.findWhere(a.buffs.buffs(),{name:t.heroes[o].buffs[n].name});u.data.level(t.heroes[o].buffs[n].level),u.data.isActive(t.heroes[o].buffs[n].isActive)}for(var n=0;n<t.heroes[o].debuffs.length;n++){a.debuffs.selectedBuff(r.prototype.findWhere(a.debuffs.availableDebuffs(),{buffName:t.heroes[o].debuffs[n].name})),a.debuffs.addBuff(a,{});var u=r.prototype.findWhere(a.debuffs.buffs(),{name:t.heroes[o].debuffs[n].name});u.data.level(t.heroes[o].debuffs[n].level),u.data.isActive(t.heroes[o].debuffs[n].isActive)}if(t.heroes[o].itemBuffs)for(var n=0;n<t.heroes[o].itemBuffs.length;n++){var l=t.heroes[o].itemBuffs[n],p={item:l.item,state:s.observable(l.state),size:l.size,enabled:s.observable(l.enabled)};a.buffs.itemBuffs.items.push(p)}if(t.heroes[o].itemDebuffs)for(var n=0;n<t.heroes[o].itemDebuffs.length;n++){var l=t.heroes[o].itemDebuffs[n],p={item:l.item,state:s.observable(l.state),size:l.size,enabled:s.observable(l.enabled)};a.debuffs.itemBuffs.items.push(p)}t.heroes[o].graphData&&a.buildExplorer.loadGraphData(t.heroes[o].graphData)}},e.sendReport=function(){a("#BugReportFormText").val()?(a.post("report.php",{name:a("#BugReportFormName").val(),email:a("#BugReportFormEmail").val(),body:a("#BugReportFormText").val()}).done(function(e){"Success"==e?(alert("Report successfully sent. Thanks!"),a("#BugReportFormText").val("")):alert("Failed to send report. Try again later or email admin@devilesk.com")}),a("#myModal").modal("hide")):alert("Message is required.")},e.getProperty=function(e,t){for(var o=e,s=0;s<t.length;s++)o=o[t[s]];return o},e.getDiffTextWrapper=function(t,o){return e.getDiffText(e.getDiffMagnitude(t,o))},e.getDiffMagnitude=function(t,o){var s=o.split(".");return e.getProperty(t.damageTotalInfo(),s).toFixed(2)-e.getProperty(t.heroCompare().damageTotalInfo(),s).toFixed(2)},e.getDiffText=function(e){return e>0?"+"+parseFloat(e.toFixed(2)):0>e?"&minus;"+parseFloat(-1*e.toFixed(2)).toString():""},e.highlightedTabInternal=s.observable(""),e.highlightedTab=s.computed(function(){return e.highlightedTabInternal()}).extend({throttle:100}),e.highlightTab=function(t){e.highlightedTabInternal(t)},e.unhighlightTab=function(t){e.highlightedTabInternal("")}},r.prototype.heroCalculator={},r.prototype.theme=s.observable(a("#theme-select").val()),r.prototype.init=function(e,t,o){a.when(a.get("templates.html",function(e){a("body").append('<div style="display:none">'+e+"</div>")}),a.getJSON(e,function(e){r.prototype.heroData=e,r.prototype.heroData.npc_dota_hero_chen.abilities[2].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE"),r.prototype.heroData.npc_dota_hero_nevermore.abilities[1].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE"),r.prototype.heroData.npc_dota_hero_nevermore.abilities[2].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE"),r.prototype.heroData.npc_dota_hero_morphling.abilities[3].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE"),r.prototype.heroData.npc_dota_hero_ogre_magi.abilities[3].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE"),r.prototype.heroData.npc_dota_hero_techies.abilities[4].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE"),r.prototype.heroData.npc_dota_hero_beastmaster.abilities[2].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE");var t=r.prototype.heroData.npc_dota_hero_lone_druid.abilities[3].behavior.indexOf("DOTA_ABILITY_BEHAVIOR_HIDDEN");r.prototype.heroData.npc_dota_hero_lone_druid.abilities[3].behavior.splice(t,1),t=r.prototype.heroData.npc_dota_hero_abaddon.abilities[2].behavior.indexOf("DOTA_ABILITY_BEHAVIOR_PASSIVE"),r.prototype.heroData.npc_dota_hero_abaddon.abilities[2].behavior.splice(t,1),t=r.prototype.heroData.npc_dota_hero_riki.abilities[2].behavior.indexOf("DOTA_ABILITY_BEHAVIOR_PASSIVE"),r.prototype.heroData.npc_dota_hero_riki.abilities[2].behavior.splice(t,1);for(var o in r.prototype.heroData)r.prototype.HeroOptions.push(new r.prototype.HeroOption(o.replace("npc_dota_hero_",""),r.prototype.heroData[o].displayname))}),a.getJSON(t,function(e){r.prototype.itemData=e}),a.getJSON(o,function(e){r.prototype.unitData=e})).done(function(e,t,o,s){r.prototype.run()})},r.prototype.run=function(){r.prototype.heroCalculator=new r.prototype.HeroCalculatorViewModel,s.applyBindings(r.prototype.heroCalculator),a("#theme-select").change(function(){r.prototype.theme(a(this).val())}),a("#spinner").hide(),a(".initial-hidden").css("display","inline-block"),a("#popHero0").addClass("active"),a("#heroPane0").addClass("active"),a('[data-toggle="tooltip"]').tooltip();var e=r.prototype.getParameterByName("id");e&&a.get("save/"+e+".json",function(e){r.prototype.heroCalculator.load(e)})},r.prototype.inventoryClipBoard={items:[],activeItems:[]},r.prototype.getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),o=t.exec(location.search);return null==o?"":decodeURIComponent(o[1].replace(/\+/g," "))}});
//# sourceMappingURL=herocalc_app.js.map