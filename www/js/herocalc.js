(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.HeroCalc = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');
    
var my = require("./herocalc_core");

my.prototype.AbilityModel = function (a, h) {
    var self = this;
    self.hero = h;
    self.abilityData = my.prototype.abilityData;
    self.hasScepter = ko.observable(false);
    self.isShapeShiftActive = ko.observable(false);
    self.abilities = a;
    for (var i = 0; i < self.abilities.length; i++) {
        self.abilities[i].level = ko.observable(0);
        self.abilities[i].isActive = ko.observable(false);
        self.abilities[i].isDetail = ko.observable(false);
        self.abilities[i].baseDamage = ko.observable(0);
        self.abilities[i].baseDamageReductionPct = ko.observable(0);
        self.abilities[i].baseDamageMultiplier = ko.observable(0);
        self.abilities[i].bash = ko.observable(0);
        self.abilities[i].bashBonusDamage = ko.observable(0);
        self.abilities[i].bonusDamage = ko.observable(0);
        self.abilities[i].bonusDamageOrb = ko.observable(0);
        self.abilities[i].bonusDamagePct = ko.observable(0);
        self.abilities[i].bonusDamagePrecisionAura = ko.observable(0);
        self.abilities[i].bonusDamageReduction = ko.observable(0);
        self.abilities[i].bonusHealth = ko.observable(0);
        self.abilities[i].bonusStrength = ko.observable(0);
        self.abilities[i].bonusStrength2 = ko.observable(0);
        self.abilities[i].bonusAgility = ko.observable(0);
        self.abilities[i].bonusAgility2 = ko.observable(0);
        self.abilities[i].bonusInt = ko.observable(0);
        self.abilities[i].bonusAllStatsReduction = ko.observable(0);
        self.abilities[i].damageAmplification = ko.observable(0);
        self.abilities[i].damageReduction = ko.observable(0);
        self.abilities[i].evasion = ko.observable(0);
        self.abilities[i].magicResist = ko.observable(0);
        self.abilities[i].manaregen = ko.observable(0);
        self.abilities[i].manaregenreduction = ko.observable(0);
        self.abilities[i].missChance = ko.observable(0);
        self.abilities[i].movementSpeedFlat = ko.observable(0);
        self.abilities[i].movementSpeedPct = ko.observable(0);
        self.abilities[i].movementSpeedPctReduction = ko.observable(0);
        self.abilities[i].turnRateReduction = ko.observable(0);
        self.abilities[i].attackrange = ko.observable(0);
        self.abilities[i].attackspeed = ko.observable(0);
        self.abilities[i].attackspeedreduction = ko.observable(0);
        self.abilities[i].armor = ko.observable(0);
        self.abilities[i].armorReduction = ko.observable(0);
        self.abilities[i].healthregen = ko.observable(0);
        self.abilities[i].lifesteal = ko.observable(0);
        self.abilities[i].visionnight = ko.observable(0);
        self.abilities[i].visionday = ko.observable(0);
    }
    self.abilityControlData = {};
    self.abilitySettingsData = function (data, parent, index) {
        if (self.abilityControlData[data] == undefined) {
            return self.processAbility(data, parent, index, self.abilityData[data]);
        }
        else {
            return self.abilityControlData[data];
        }
    }
    
    self.processAbility = function (data, parent, index, args) {
        var result = {};
        result.data = [];
        var v;
        var v_list = [];
        for (var i=0; i < args.length; i++) {
            switch (args[i].controlType) {
                case 'input':
                    v = ko.observable(0).extend({ numeric: 2 });
                    v.controlValueType = args[i].controlValueType;
                    v_list.push(v);
                    result.data.push({ labelName: args[i].label.toUpperCase() + ':', controlVal: v, controlType: args[i].controlType, display: args[i].display });
                break;
                case 'checkbox':
                    v = ko.observable(false);
                    v.controlValueType = args[i].controlValueType;
                    v_list.push(v);
                    result.data.push({ labelName: args[i].label.toUpperCase() + '?', controlVal: v, controlType: args[i].controlType, display: args[i].display });
                break;
                case 'radio':
                    v = ko.observable(args[i].controlOptions[0].value);
                    v.controlValueType = args[i].controlValueType;
                    v_list.push(v);
                    result.data.push({ labelName: args[i].label.toUpperCase() + '?', controlVal: v, controlType: args[i].controlType, display: args[i].display, controlOptions: args[i].controlOptions });
                break;
                case 'method':
                case 'text':
                    // single input abilities
                    if (args[i].controls == undefined) {
                        if (args[i].noLevel) {
                            var attributeValue = function (attributeName) {
                                return {fn: ko.computed(function () {
                                    var _ability = self.abilities.find(function(b) {
                                        return b.name == data;
                                    });
                                    return self.getAbilityAttributeValue(_ability.attributes, attributeName, 0);
                                })};
                            };
                        }
                        else {
                            var attributeValue = function (attributeName) {
                                return {fn: ko.computed(function () {
                                    var _ability = self.abilities.find(function(b) {
                                        return b.name == data;
                                    });
                                    return self.getAbilityAttributeValue(_ability.attributes, attributeName, _ability.level());
                                })};
                            };
                        }
                        var g = attributeValue(args[i].attributeName)
                        var r = self.getComputedFunction(v, g.fn, args[i].fn, parent, index, self, args[i].returnProperty, undefined, data);
                        if (args[i].ignoreTooltip) {
                            var tooltip = args[i].label || args[i].attributeName;
                        }
                        else {
                            var tooltip = self.getAbilityAttributeTooltip(self.abilities[index].attributes, args[i].attributeName) || args[i].label || args[i].attributeName;
                        }
                        result.data.push({ labelName: tooltip.toUpperCase(), controlVal: r, controlType: args[i].controlType, display: args[i].display, clean: g.fn });
                    }
                    // multi input abilities
                    else {
                        if (args[i].noLevel) {
                            var attributeValue = function (attributeName) {
                                return {fn: ko.computed(function () {
                                    return self.getAbilityAttributeValue(self.abilities[index].attributes, attributeName, 0);
                                })};
                            };
                        }
                        else {
                            var attributeValue = function (attributeName) {
                                return {fn: ko.computed(function () {
                                    return self.getAbilityAttributeValue(self.abilities[index].attributes, attributeName, self.abilities[index].level());
                                })};
                            };
                        }
                        var g = attributeValue(args[i].attributeName)
                        var r = self.getComputedFunction(v_list, g.fn, args[i].fn, parent, index, self, args[i].returnProperty, args[i].controls, data);
                        if (args[i].ignoreTooltip) {
                            var tooltip = args[i].label || args[i].attributeName;
                        }
                        else {
                            var tooltip = self.getAbilityAttributeTooltip(self.abilities[index].attributes, args[i].attributeName) || args[i].label || args[i].attributeName;
                        }
                        result.data.push({ labelName: tooltip.toUpperCase(), controlVal: r, controlType: args[i].controlType, display: args[i].display, clean: g.fn });
                    }
                    
                    if (args[i].controlType == 'method') {
                        v_list.push(r);
                    }
                break;
            }
        }
        self.abilityControlData[data] = result;
        return result;
    }

    self.getComputedFunction = function (v, attributeValue, fn, parent, index, abilityModel, returnProperty, controls, abilityName) {
        var _ability = abilityModel.abilities.find(function(b) {
            return b.name == abilityName;
        });
        return ko.pureComputed(function () {                
            var inputValue;
            if (controls == undefined) {
                if (v == undefined) {
                    inputValue = v;
                }
                else if (typeof v() == 'boolean') {
                    inputValue = v();
                }
                else if (v.controlValueType == undefined) {
                    inputValue = parseFloat(v());
                }
                else if (v.controlValueType == 'string') {
                    inputValue = v();
                }
                else {
                    inputValue = parseFloat(v());
                }
            }
            else {
                var v_list = [];
                for (var i=0;i<controls.length;i++) {
                    switch (typeof v[controls[i]]()) {
                        case 'boolean':
                        case 'object':
                            v_list.push(v[controls[i]]());
                        break;
                        default:
                            v_list.push(parseFloat(v[controls[i]]()));
                        break;
                    }
                }
                inputValue = v_list;
            }
            
            var returnVal = fn.call(this, inputValue, attributeValue(), parent, index, abilityModel, _ability);
            if (returnProperty != undefined) {
                _ability[returnProperty](returnVal);
            }
            return returnVal;
        }, this);
    }

    self.getAbilityAttributeValue = function (attributes, attributeName, level) {
        for (var i=0; i < attributes.length; i++) {
            if (attributes[i].name == attributeName) {
                if (level == 0) {
                    return parseFloat(attributes[i].value[0]);
                }
                else if (level > attributes[i].value.length) {
                    return parseFloat(attributes[i].value[0]);
                }
                else {
                    return parseFloat(attributes[i].value[level-1]);
                }
            }
        }
    }

    self.getAbilityAttributeTooltip = function (attributes, attributeName) {
        for (var i=0; i<attributes.length; i++) {
            if (attributes[i].name == attributeName) {
                if (attributes[i].hasOwnProperty('tooltip')) {
                    var d = attributes[i].tooltip.replace(/\\n/g, '');
                    return d;
                }
                else {
                    return '';
                }
            }
        }
        return '';
    }
    
    self.getAbilityLevelByAbilityName = function (abilityName) {
        for (var i = 0; i < self.abilities.length; i++) {
            if (self.abilities[i].name == abilityName) {
                return self.abilities[i].level();
            }
        }
        return -1;
    }

    self.getAbilityByName = function (abilityName) {
        for (var i = 0; i < self.abilities.length; i++) {
            if (self.abilities[i].name == abilityName) {
                return self.abilities[i];
            }
        }
        return undefined;
    }

    self.getAbilityPropertyValue = function (ability, property) {
        return parseFloat(ability[property]()[ability.level()-1]);
    }
    
    self.getAttributeBonusLevel = function () {
        for (var i = 0; i < self.abilities.length; i++) {
            if (self.abilities[i].name == 'attribute_bonus') {
                return self.abilities[i].level();
            }
        }
        return 0;        
    }
    
    self.getAllStatsReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        /*switch(attribute.name) {
                            // invoker_quas
                            case 'bonus_strength':
                                totalAttribute += parseInt(attribute.value[ability.level()-1]);
                            break;
                        }*/
                    }
                }
            }
            else if (ability.bonusAllStatsReduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // slark_essence_shift
                    totalAttribute+=ability.bonusAllStatsReduction();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getStrengthReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        /*switch(attribute.name) {
                            // invoker_quas
                            case 'bonus_strength':
                                totalAttribute += parseInt(attribute.value[ability.level()-1]);
                            break;
                        }*/
                    }
                }
            }
            else if (ability.bonusStrength != undefined && ability.name == 'undying_decay') {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // undying_decay
                    totalAttribute-=ability.bonusStrength();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getStrength = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        /*switch(attribute.name) {
                            // invoker_quas
                            case 'bonus_strength':
                                totalAttribute += parseInt(attribute.value[ability.level()-1]);
                            break;
                        }*/
                    }
                }
            }
            else {
                if (ability.bonusStrength != undefined) {
                    if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1) || ability.name == 'invoker_quas')) {
                        // pudge_flesh_heap,invoker_quas,morphling_morph_str,morphling_morph_agi,undying_decay
                        totalAttribute+=ability.bonusStrength();
                    }
                }
                if (ability.bonusStrength2 != undefined) {
                    if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                        // morphling_morph_str
                        totalAttribute+=ability.bonusStrength2();
                    }
                }
            }
        }
        return totalAttribute;
    });
    
    self.getAgility = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // drow_ranger_marksmanship
                            case 'marksmanship_agility_bonus':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
            else {
                if (ability.bonusAgility != undefined) {
                    if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1) || ability.name == 'invoker_wex')) {
                        // invoker_wex,morphling_morph_agi,morphling_morph_str
                        totalAttribute+=ability.bonusAgility();
                    }
                }
                if (ability.bonusAgility2 != undefined) {
                    if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                        // invoker_wex,morphling_morph_agi,morphling_morph_str
                        totalAttribute+=ability.bonusAgility2();
                    }
                }
            }
        }
        return totalAttribute;
    });

    self.getIntelligence = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // invoker_exort
                        /*    case 'bonus_intelligence':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;*/
                        }
                    }
                }
            }
            else if (ability.bonusInt != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1) || ability.name == 'invoker_exort')) {
                    // invoker_exort
                    totalAttribute+=ability.bonusInt();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getArmor = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // axe_berserkers_call,dragon_knight_dragon_blood,troll_warlord_berserkers_rage,lycan_shapeshift,enraged_wildkin_toughness_aura
                            case 'bonus_armor':
                                if (ability.name != 'templar_assassin_meld') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // sven_warcry
                            case 'warcry_armor':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                            // lich_frost_armor,ogre_magi_frost_armor
                            case 'armor_bonus':
                                if (ability.name == 'lich_frost_armor' || ability.name == 'ogre_magi_frost_armor') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.armor != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // shredder_reactive_armor,visage_gravekeepers_cloak
                    totalAttribute+=ability.armor();
                }
            }
        }
        return totalAttribute;
    });

    self.getArmorBaseReduction = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    switch(ability.name) {
                        //elder_titan_natural_order
                        case 'elder_titan_natural_order':
                            totalAttribute *= (1-self.getAbilityAttributeValue(self.abilities[i].attributes, 'armor_reduction_pct', ability.level())/100);
                        break;
                    }
                }
            }
        }
        return totalAttribute;
    });
    
    self.getArmorReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    switch(ability.name) {
                        //templar_assassin_meld
                        case 'templar_assassin_meld':
                            totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, 'bonus_armor', ability.level());
                        break;
                        // tidehunter_gush
                        case 'tidehunter_gush':
                            totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, 'armor_bonus', ability.level());
                        break;
                        // naga_siren_rip_tide
                        case 'naga_siren_rip_tide':
                        // slardar_amplify_damage
                        case 'slardar_amplify_damage':
                        // vengefulspirit_wave_of_terror
                        case 'vengefulspirit_wave_of_terror':
                            totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, 'armor_reduction', ability.level());
                        break;
                        // nevermore_dark_lord
                        case 'nevermore_dark_lord':
                            totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, 'presence_armor_reduction', ability.level());
                        break;
                    }
                }
            }
            else if (ability.armorReduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // alchemist_acid_spray
                    totalAttribute+=ability.armorReduction();
                }
            }
        }
        return totalAttribute;
    });

    self.getHealth = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // lone_druid_true_form,lycan_shapeshift,troll_warlord_berserkers_rage
                            case 'bonus_hp':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                            // lone_druid_synergy
                            case 'true_form_hp_bonus':
                                if (self.isTrueFormActive()) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.bonusHealth != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // clinkz_death_pact
                    totalAttribute+=ability.bonusHealth();
                }
            }
        }
        return totalAttribute;
    });
    
    self.isTrueFormActive = function () {
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (ability.isActive() && ability.name == 'lone_druid_true_form') {
                return true;
            }
        }
        return false;
    }

    self.getHealthRegen = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // alchemist_chemical_rage, dragon_knight_dragon_blood
                            case 'bonus_health_regen':
                            // broodmother_spin_web
                            case 'heath_regen':
                            // omniknight_guardian_angel,treant_living_armor,satyr_hellcaller_unholy_aura
                            case 'health_regen':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                            // legion_commander_press_the_attack
                            case 'hp_regen':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
            else if (ability.healthregen != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // shredder_reactive_armor,invoker_quas,necrolyte_sadist
                    totalAttribute+=ability.healthregen();
                }
            }
        }
        return totalAttribute;
    });

    self.getMana = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // obsidian_destroyer_essence_aura
                            case 'bonus_mana':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });
    
    self.getManaRegen = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // alchemist_chemical_rage
                            case 'bonus_mana_regen':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
            else if (ability.manaregen != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // necrolyte_sadist
                    totalAttribute+=ability.manaregen();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getManaRegenArcaneAura = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // crystal_maiden_brilliance_aura
                            case 'mana_regen':
                                if (ability.name == 'crystal_maiden_brilliance_aura') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });

    self.getManaRegenReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        //switch(attribute.name) {
                        //    // 
                        //    case '':
                        //        totalAttribute += parseInt(attribute.value[ability.level()-1]);
                        //    break;
                        //}
                    }
                }
            }
            else if (ability.manaregenreduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // pugna_nether_ward
                    totalAttribute+=ability.manaregenreduction();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getAttackRange = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // winter_wyvern_arctic_burn
                            case 'attack_range_bonus':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                            // templar_assassin_psi_blades,sniper_take_aim
                            case 'bonus_attack_range':
                            // terrorblade_metamorphosis,troll_warlord_berserkers_rage
                            case 'bonus_range':
                                if (ability.name == 'terrorblade_metamorphosis') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                                if (ability.name == 'troll_warlord_berserkers_rage') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // tiny_grow
                            case 'bonus_range_scepter':
                                if (ability.name == 'tiny_grow' && self.hasScepter()) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // enchantress_impetus
                            case 'bonus_attack_range_scepter':
                                if (ability.name == 'enchantress_impetus' && self.hasScepter()) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                        }
                    }
                    // lone_druid_true_form
                    if (ability.name == 'lone_druid_true_form') {
                        totalAttribute -= 422;
                    }
                }
                else if (ability.level() > 0 && ability.name == 'enchantress_impetus' && self.hasScepter()) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                          case 'bonus_attack_range_scepter':
                            totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                          break;
                        }
                    }
                }
            }
            else if (ability.attackrange != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // dragon_knight_elder_dragon_form
                    totalAttribute+=ability.attackrange();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getAttackSpeed = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // abaddon_frostmourne,troll_warlord_battle_trance
                            case 'attack_speed':
                            // visage_grave_chill
                            case 'attackspeed_bonus':
                            // mirana_leap
                            case 'leap_speedbonus_as':
                            // life_stealer
                            case 'attack_speed_bonus':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                            // clinkz_strafe,ursa_overpower
                            case 'attack_speed_bonus_pct':
                                if (ability.name == 'clinkz_strafe' || ability.name == 'ursa_overpower') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // axe_culling_blade,necronomicon_archer_aoe
                            case 'speed_bonus':
                                if (ability.name == 'axe_culling_blade' || ability.name == 'necronomicon_archer_aoe') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // ancient_apparition_chilling_touch
                            case 'attack_speed_pct':
                                if (ability.name == 'ancient_apparition_chilling_touch') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // beastmaster_inner_beast,lycan_feral_impulse,lone_druid_rabid,tiny_grow,phantom_assassin_phantom_strike,windrunner_focusfire,ogre_magi_bloodlust,centaur_khan_endurance_aura
                            case 'bonus_attack_speed':
                                if (ability.name == 'beastmaster_inner_beast' 
                                 || ability.name == 'lycan_feral_impulse' 
                                 || ability.name == 'lone_druid_rabid' 
                                 || ability.name == 'tiny_grow' 
                                 || ability.name == 'phantom_assassin_phantom_strike' 
                                 || ability.name == 'windrunner_focusfire' 
                                 || ability.name == 'ogre_magi_bloodlust'
                                 || ability.name == 'centaur_khan_endurance_aura') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.attackspeed != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // troll_warlord_fervor,wisp_overcharge,lina_fiery_soul,invoker_alacrity,invoker_wex,huskar_berserkers_blood
                    totalAttribute+=ability.attackspeed();
                }
            }
        }
        return totalAttribute;
    });

    self.getAttackSpeedReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // night_stalker_void,crystal_maiden_crystal_nova,ghost_frost_attack,ogre_magi_frost_armor,polar_furbolg_ursa_warrior_thunder_clap
                            case 'attackspeed_slow':
                            // lich_frost_armor,lich_frost_nova,enchantress_untouchable
                            case 'slow_attack_speed':
                            // beastmaster_primal_roar
                            case 'slow_attack_speed_pct':
                            // storm_spirit_overload
                            case 'overload_attack_slow':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                            // omniknight_degen_aura
                            case 'speed_bonus':
                                if (ability.name == 'omniknight_degen_aura') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // tusk_frozen_sigil,crystal_maiden_freezing_field
                            case 'attack_slow':
                                if (ability.name == 'crystal_maiden_freezing_field' && !self.hasScepter()) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                                else if (ability.name == 'tusk_frozen_sigil') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            case 'attack_slow_scepter':
                                if (ability.name == 'crystal_maiden_freezing_field' && self.hasScepter()) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // faceless_void_time_walk
                            case 'attack_speed_pct':
                                if (ability.name == 'faceless_void_time_walk') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // bounty_hunter_jinada
                            case 'bonus_attackspeed':
                                if (ability.name == 'bounty_hunter_jinada') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // brewmaster_thunder_clap
                            case 'attack_speed_slow':
                                if (ability.name == 'brewmaster_thunder_clap') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // medusa_stone_gaze
                            case 'slow':
                                if (ability.name == 'medusa_stone_gaze') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // visage_grave_chill
                            case 'attackspeed_bonus':
                                totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                            // abaddon_frostmourne
                            case 'attack_slow_tooltip':
                                if (ability.name == 'abaddon_frostmourne') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                        }
                    }
                    if (ability.name == 'enraged_wildkin_tornado') {
                        totalAttribute -= 15;
                    }
                }
            }
            else if (ability.attackspeedreduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // viper_viper_strike,viper_corrosive_skin,jakiro_liquid_fire,lich_chain_frost,sandking_epicenter,earth_spirit_rolling_boulder
                    totalAttribute+=ability.attackspeedreduction();
                }
            }
        }
        return totalAttribute;
    });
    self.getBash = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // slardar_bash
                            case 'chance':
                            // sniper_headshot
                            case 'proc_chance':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                        }
                    }
                }
            }
            else if (ability.bash != undefined) {
                // spirit_breaker_greater_bash,faceless_void_time_lock
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    totalAttribute *= (1 - ability.bash()/100);
                }
            }
        }
        return totalAttribute;
    });    
    self.getBaseDamage = ko.computed(function () {
        var totalAttribute = 0;
        var totalMultiplier = 1;
        var sources = {};
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // tiny_grow,terrorblade_metamorphosis
                            case 'bonus_damage':
                                if (ability.name == 'tiny_grow' || ability.name == 'terrorblade_metamorphosis') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level()),
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                        }
                    }
                }
            }
            else {
                if (ability.baseDamageMultiplier != undefined) {
                    // earthshaker_enchant_totem
                    if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                        totalMultiplier += ability.baseDamageMultiplier()/100;
                        /*totalAttribute += ability.baseDamage();
                        sources[ability.name] = {
                            'damage': ability.baseDamage(),
                            'damageType': 'physical',
                            'displayname': ability.displayname
                        }*/
                    }
                }
                if (ability.baseDamage != undefined) {
                    // clinkz_death_pact
                    if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                        totalAttribute += ability.baseDamage();
                        sources[ability.name] = {
                            'damage': ability.baseDamage(),
                            'damageType': 'physical',
                            'displayname': ability.displayname
                        }
                    }
                }
            }
        }
        return { sources: sources, total: totalAttribute, multiplier: totalMultiplier };
    });
    
    self.getSelfBaseDamageReductionPct = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // medusa_split_shot
                            case 'damage_modifier':
                                totalAttribute *= (1 + self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                            // windrunner_focusfire
                            case 'focusfire_damage_reduction':
                                if (!self.hasScepter()) {
                                    totalAttribute *= (1 + self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                            case 'focusfire_damage_reduction_scepter':
                                if (self.hasScepter()) {
                                    totalAttribute *= (1 + self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });
    
    self.getBaseDamageReductionPct = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // vengefulspirit_command_aura
                            case 'bonus_damage_pct':
                                if (ability.name == 'vengefulspirit_command_aura') {
                                    totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.baseDamageReductionPct != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // nevermore_requiem
                    totalAttribute *= (1 + ability.baseDamageReductionPct()/100);
                }
            }
        }
        return totalAttribute;
    });
    
    self.getBAT = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // troll_warlord_berserkers_rage,alchemist_chemical_rage,lone_druid_true_form,lycan_shapeshift
                            case 'base_attack_time':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });
    self.getBonusDamage = ko.computed(function () {
        var totalAttribute = 0;
        var sources = {};
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // broodmother_insatiable_hunger,luna_lunar_blessing,templar_assassin_refraction,templar_assassin_meld,troll_warlord_berserkers_rage,lone_druid_true_form_battle_cry
                            case 'bonus_damage':
                                if (ability.name == 'broodmother_insatiable_hunger' || ability.name == 'luna_lunar_blessing'
                                 || ability.name == 'templar_assassin_refraction' || ability.name == 'templar_assassin_meld'
                                 || ability.name == 'troll_warlord_berserkers_rage' || ability.name == 'lone_druid_true_form_battle_cry') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level()),
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                            // lycan_howl
                            case 'hero_bonus_damage':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                sources[ability.name] = {
                                    'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level()),
                                    'damageType': 'physical',
                                    'displayname': ability.displayname
                                }
                            break;
                        }
                    }
                    if (ability.name == 'storm_spirit_overload') {
                        totalAttribute += self.getAbilityPropertyValue(ability, 'damage');
                        sources[ability.name] = {
                            'damage': self.getAbilityPropertyValue(ability, 'damage'),
                            'damageType': 'magic',
                            'displayname': ability.displayname
                        }                        
                    }
                }
            }
            else if (ability.bonusDamage != undefined && ability.bonusDamage() != 0) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // nevermore_necromastery,ursa_fury_swipes,ursa_enrage,invoker_alacrity,invoker_exort,elder_titan_ancestral_spirit,spectre_desolate,razor_static_link
                    totalAttribute+=ability.bonusDamage();
                    sources[ability.name] = {
                        'damage': ability.bonusDamage(),
                        'damageType': ability.name == 'spectre_desolate' ? 'pure' : 'physical',
                        'displayname': ability.displayname
                    }
                }
            }
        }
        return { sources: sources, total: totalAttribute };
    });

    self.getBonusDamagePercent = ko.computed(function () {
        var totalAttribute = 0;
        var sources = {};
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // bloodseeker_bloodrage
                            case 'damage_increase_pct':
                                if (ability.name == 'bloodseeker_bloodrage') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100,
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                            // magnataur_empower,vengefulspirit_command_aura,alpha_wolf_command_aura
                            case 'bonus_damage_pct':
                                if (ability.name == 'magnataur_empower' || ability.name == 'vengefulspirit_command_aura' || ability.name == 'alpha_wolf_command_aura') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100,
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                            // sven_gods_strength
                            case 'gods_strength_damage':
                                if (ability.name == 'sven_gods_strength' && self.hero != undefined && self.hero.heroId() == 'sven') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100,
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                            case 'gods_strength_damage_scepter':
                                if (ability.name == 'sven_gods_strength' && self.hero == undefined) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100,
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.bonusDamagePct != undefined && ability.bonusDamagePct() != 0) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // bloodseeker_bloodrage
                    /*totalAttribute+=ability.bonusDamagePct()/100;
                    sources[ability.name] = {
                        'damage': ability.bonusDamagePct()/100,
                        'damageType': 'physical',
                        'displayname': ability.displayname
                    }*/
                }
            }
        }
        return { sources: sources, total: totalAttribute };
    });

    self.getBonusDamageBackstab = ko.computed(function () {
        var totalAttribute1 = 0;
        var totalAttribute2 = 0;
        var sources = [];
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (ability.name == 'riki_backstab') {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // riki_backstab
                            case 'damage_multiplier':
                                totalAttribute1 += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                sources.push({
                                    'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level()),
                                    'damageType': 'physical',
                                    'displayname': ability.displayname
                                });
                            break;
                        }
                    }/*
                    if (ability.bonusDamageBackstab != undefined) {
                        console.log('bonusDamageBackstab');
                        // damage_multiplier
                        totalAttribute2+=ability.bonusDamageBackstab();
                        sources.push({
                            'damage': ability.bonusDamageBackstab(),
                            'damageType': 'physical',
                            'displayname': ability.displayname
                        });
                    }
                    */
                }
            }
        }
        return { sources: sources, total: [totalAttribute1,totalAttribute2] };
    });
    
    self.getBonusDamagePrecisionAura = ko.computed(function () {
        var totalAttribute1 = 0;
        var totalAttribute2 = 0;
        var sources = [];
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (ability.name == 'drow_ranger_trueshot') {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // drow_ranger_trueshot
                            case 'trueshot_ranged_damage':
                                totalAttribute1 += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                sources.push({
                                    'damage': self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100,
                                    'damageType': 'physical',
                                    'displayname': ability.displayname
                                });
                            break;
                        }
                    }
                    if (ability.bonusDamagePrecisionAura != undefined) {
                        // drow_ranger_trueshot
                        totalAttribute2+=ability.bonusDamagePrecisionAura();
                        sources.push({
                            'damage': ability.bonusDamagePrecisionAura(),
                            'damageType': 'physical',
                            'displayname': ability.displayname
                        });
                    }
                }
            }
        }
        return { sources: sources, total: [totalAttribute1,totalAttribute2] };
    });
    
    self.getBonusDamageReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // bane_enfeeble
                            case 'enfeeble_attack_reduction':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
            else if (ability.bonusDamageReduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // rubick_fade_bolt,razor_static_link
                    totalAttribute+=ability.bonusDamageReduction();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getBonusDamageReductionPct = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // medusa_split_shot
                            case 'damage_modifier':
                                totalAttribute *= (1 + self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                            // windrunner_focusfire
                            case 'focusfire_damage_reduction':
                                if (!self.hasScepter()) {
                                    totalAttribute *= (1 + self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                            case 'focusfire_damage_reduction_scepter':
                                if (self.hasScepter()) {
                                    totalAttribute *= (1 + self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });

    self.getDamageAmplification = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                /*if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // bane_enfeeble
                            case 'enfeeble_attack_reduction':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }*/
            }
            else if (ability.damageAmplification != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // undying_flesh_golem
                    totalAttribute *= (1 + ability.damageAmplification()/100);
                }
            }
        }
        return totalAttribute;
    });
    
    self.getDamageReduction = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // bloodseeker_bloodrage
                            case 'damage_increase_pct':
                                if (ability.name == 'bloodseeker_bloodrage') {
                                    totalAttribute *= (1 + self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                        }
                    }
                    // kunkka_ghostship
                    if (ability.name == 'kunkka_ghostship') {
                        totalAttribute *= (1 - 50/100);
                    }
                }
            }
            else if (ability.damageReduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // wisp_overcharge,bristleback_bristleback,spectre_dispersion,medusa_mana_shield,ursa_enrage
                    totalAttribute *= (1 + ability.damageReduction()/100);
                }
            }
        }
        return totalAttribute;
    });

    self.getCritSource = ko.computed(function () {
        var sources = {};
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    switch(ability.name) {
                        // phantom_assassin_coup_de_grace,brewmaster_drunken_brawler,chaos_knight_chaos_strike,lycan_shapeshift,skeleton_king_mortal_strike,juggernaut_blade_dance,alpha_wolf_critical_strike,giant_wolf_critical_strike
                        case 'phantom_assassin_coup_de_grace':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'chance': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_chance', ability.level())/100,
                                    'multiplier': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_bonus', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        case 'brewmaster_drunken_brawler':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'chance': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_chance', ability.level())/100,
                                    'multiplier': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_multiplier', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        case 'chaos_knight_chaos_strike':
                        case 'lycan_shapeshift':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'chance': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_chance', ability.level())/100,
                                    'multiplier': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_multiplier', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        case 'skeleton_king_mortal_strike':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'chance': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_chance', ability.level())/100,
                                    'multiplier': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_mult', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        case 'juggernaut_blade_dance':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'chance': self.getAbilityAttributeValue(self.abilities[i].attributes, 'blade_dance_crit_chance', ability.level())/100,
                                    'multiplier': self.getAbilityAttributeValue(self.abilities[i].attributes, 'blade_dance_crit_mult', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        case 'alpha_wolf_critical_strike':
                        case 'giant_wolf_critical_strike':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'chance': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_chance', ability.level())/100,
                                    'multiplier': self.getAbilityAttributeValue(self.abilities[i].attributes, 'crit_mult', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                    }
                }
            }
        }
        return sources;
    });    

    self.getCleaveSource = ko.computed(function () {
        var sources = {};
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    switch(ability.name) {
                        // magnataur_empower
                        case 'magnataur_empower':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'radius': self.getAbilityAttributeValue(self.abilities[i].attributes, 'cleave_radius', ability.level()),
                                    'magnitude': self.getAbilityAttributeValue(self.abilities[i].attributes, 'cleave_damage_pct', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        // sven_great_cleave
                        case 'sven_great_cleave':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'radius': self.getAbilityAttributeValue(self.abilities[i].attributes, 'great_cleave_radius', ability.level()),
                                    'magnitude': self.getAbilityAttributeValue(self.abilities[i].attributes, 'great_cleave_damage', ability.level())/100,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        // kunkka_tidebringer
                        case 'kunkka_tidebringer':
                            if (sources[ability.name] == undefined) {
                                sources[ability.name] = {
                                    'radius': self.getAbilityAttributeValue(self.abilities[i].attributes, 'radius', ability.level()),
                                    'magnitude': 1,
                                    'count': 1,
                                    'displayname': ability.displayname
                                }
                            }
                            else {
                                sources[ability.name].count += 1;
                            }
                        break;
                        // tiny_grow
                        case 'tiny_grow':
                            if (self.hasScepter()) {
                                if (sources[ability.name] == undefined) {
                                    sources[ability.name] = {
                                        'radius': self.getAbilityAttributeValue(self.abilities[i].attributes, 'bonus_cleave_radius_scepter', ability.level()),
                                        'magnitude': self.getAbilityAttributeValue(self.abilities[i].attributes, 'bonus_cleave_damage_scepter', ability.level())/100,
                                        'count': 1,
                                        'displayname': ability.displayname
                                    }
                                }
                                else {
                                    sources[ability.name].count += 1;
                                }
                            }
                        break;
                    }
                }
            }
        }
        return sources;
    });    
    
    self.getCritChance = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // phantom_assassin_coup_de_grace,brewmaster_drunken_brawler,chaos_knight_chaos_strike,lycan_shapeshift,skeleton_king_mortal_strike
                            case 'crit_chance':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });            
    
    self.getEvasion = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // phantom_assassin_blur
                            case 'bonus_evasion':
                            // brewmaster_drunken_brawler
                            case 'dodge_chance':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });
    
    self.getEvasionBacktrack = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // faceless_void_backtrack
                            case 'dodge_chance_pct':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });
    
    self.getMissChance = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // broodmother_incapacitating_bite,brewmaster_drunken_haze
                            case 'miss_chance':
                            // riki_smoke_screen,keeper_of_the_light_blinding_light,tinker_laser
                            case 'miss_rate':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                        }
                    }
                }
            }
            else if (ability.missChance != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // night_stalker_crippling_fear
                    totalAttribute*=(1-ability.missChance()/100);
                }
            }
        }
        return totalAttribute;
    });
    
    self.getLifesteal = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // skeleton_king_vampiric_aura
                            case 'vampiric_aura':
                            // broodmother_insatiable_hunger
                            case 'lifesteal_pct':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
            else if (ability.lifesteal != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // life_stealer_open_wounds
                    totalAttribute+=ability.lifesteal();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getMagicResist = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // antimage_spell_shield
                            case 'spell_shield_resistance':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                            // phantom_lancer_phantom_edge
                            case 'magic_resistance_pct':
                                if (ability.name == 'phantom_lancer_phantom_edge') {
                                    totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                            // rubick_null_field
                            case 'magic_damage_reduction_pct':
                                if (ability.name == 'rubick_null_field') {
                                    totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.magicResist != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // huskar_berserkers_blood,viper_corrosive_skin,visage_gravekeepers_cloak
                    totalAttribute *= (1 - ability.magicResist()/100);
                }
            }
        }
        return totalAttribute;
    });

    self.getMagicResistReduction = ko.computed(function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // ancient_apparition_ice_vortex
                            case 'spell_resist_pct':
                            // pugna_decrepify
                            case 'bonus_spell_damage_pct':
                            // skywrath_mage_ancient_seal
                            case 'resist_debuff':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                            // elder_titan_natural_order
                            case 'magic_resistance_pct':
                                totalAttribute *= (1 - self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100);
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });
    
    self.getMovementSpeedFlat = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // alchemist_chemical_rage
                            case 'bonus_movespeed':
                                if (ability.name == 'alchemist_chemical_rage') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // tiny_grow
                            case 'bonus_movement_speed':
                                if (ability.name == 'tiny_grow') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }
                            break;
                            // troll_warlord_berserkers_rage
                            case 'bonus_move_speed':
                                if (ability.name == 'troll_warlord_berserkers_rage') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                                }                                
                            break;
                            // lone_druid_true_form
                            case 'speed_loss':
                                totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
            else if (ability.movementSpeedFlat != undefined) {
                // dragon_knight_elder_dragon_form
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    totalAttribute+=ability.movementSpeedFlat();
                }
            }
        }
        return totalAttribute;
    });
    
    self.getMovementSpeedPercent = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // abaddon_frostmourne 
                            case 'move_speed_pct':
                            // bounty_hunter_track 
                            case 'bonus_move_speed_pct':
                            // mirana_leap 
                            case 'leap_speedbonus':
                            // sven_warcry 
                            case 'warcry_movespeed':
                            // clinkz_wind_walk
                            case 'move_speed_bonus_pct':
                            // windrunner_windrun
                            case 'movespeed_bonus_pct':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                            break;
                            // broodmother_spin_web,spectre_spectral_dagger
                            case 'bonus_movespeed':
                                if (ability.name == 'broodmother_spin_web' || ability.name == 'spectre_spectral_dagger') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // axe_culling_blade,necronomicon_archer_aoe
                            case 'speed_bonus':
                                if (ability.name == 'axe_culling_blade' || ability.name == 'necronomicon_archer_aoe') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // nyx_assassin_vendetta 
                            case 'movement_speed':
                                if (ability.name == 'nyx_assassin_vendetta') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // spirit_breaker_empowering_haste
                            case 'bonus_movespeed_pct':
                                if (ability.name == 'spirit_breaker_empowering_haste') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // ogre_magi_bloodlust,death_prophet_witchcraft,kobold_taskmaster_speed_aura
                            case 'bonus_movement_speed':
                                if (ability.name == 'ogre_magi_bloodlust' || ability.name == 'death_prophet_witchcraft' || ability.name == 'kobold_taskmaster_speed_aura') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // razor_unstable_current,phantom_lancer_doppelwalk
                            case 'movement_speed_pct':
                                if (ability.name == 'razor_unstable_current' || ability.name == 'phantom_lancer_doppelwalk') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // treant_natures_guise,lone_druid_rabid
                            case 'bonus_move_speed':
                                if (ability.name == 'treant_natures_guise' || ability.name == 'lone_druid_rabid') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // wisp_tether
                            case 'movespeed':
                                if (ability.name == 'wisp_tether') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // kunkka_ghostship,visage_grave_chill
                            case 'movespeed_bonus':
                                if (ability.name == 'kunkka_ghostship' || ability.name == 'visage_grave_chill') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }                                
                            break;
                        }
                    }
                }
            }
            else if (ability.movementSpeedPct != undefined) {
                // axe_battle_hunger,bristleback_warpath,spirit_breaker_greater_bash,lina_fiery_soul,invoker_ghost_walk,invoker_wex,elder_titan_ancestral_spirit
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    totalAttribute+=ability.movementSpeedPct()/100;
                }
            }
        }
        return totalAttribute;
    });

    self.getMovementSpeedPercentReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // crystal_maiden_freezing_field
                            case 'movespeed_slow':
                                if (ability.name == 'crystal_maiden_freezing_field' && !self.hasScepter()) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            case 'movespeed_slow_scepter':
                                if (ability.name == 'crystal_maiden_freezing_field' && self.hasScepter()) {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // elder_titan_earth_splitter,magnataur_skewer,abaddon_frostmourne 
                            case 'slow_pct':
                                totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                            break;
                            // night_stalker_void,crystal_maiden_crystal_nova,ghost_frost_attack,ogre_magi_frost_armor,polar_furbolg_ursa_warrior_thunder_clap
                            case 'movespeed_slow':
                                if (ability.name != 'crystal_maiden_freezing_field') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // lich_frost_armor,lich_frost_nova,enchantress_enchant
                            case 'slow_movement_speed':
                            // beastmaster_primal_roar
                            case 'slow_movement_speed_pct':
                            // drow_ranger_frost_arrows
                            case 'frost_arrows_movement_speed':
                            // skeleton_king_hellfire_blast
                            case 'blast_slow':
                            // slardar_slithereen_crush
                            case 'crush_extra_slow':
                            // storm_spirit_overload:
                            case 'overload_move_slow':
                            // windrunner_windrun
                            case 'enemy_movespeed_bonus_pct':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                            break;
                            // phantom_assassin_stifling_dagger,tusk_frozen_sigil
                            case 'move_slow':
                                if (ability.name == 'phantom_assassin_stifling_dagger') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                                else if (ability.name == 'tusk_frozen_sigil') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // invoker_ice_wall,medusa_stone_gaze,wisp_tether
                            case 'slow':
                                if (ability.name == 'medusa_stone_gaze') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                                else {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // broodmother_incapacitating_bite,bounty_hunter_jinada,spectre_spectral_dagger,winter_wyvern_arctic_burn
                            case 'bonus_movespeed':
                                if (ability.name == 'broodmother_incapacitating_bite' || ability.name == 'bounty_hunter_jinada' || ability.name == 'winter_wyvern_arctic_burn' || ability.name == 'winter_wyvern_splinter_blast') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                                else if (ability.name == 'spectre_spectral_dagger') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // omniknight_degen_aura
                            case 'speed_bonus':
                                if (ability.name == 'omniknight_degen_aura') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // tidehunter_gush
                            case 'movement_speed':
                                if (ability.name == 'tidehunter_gush') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // pugna_decrepify,chen_penitence
                            case 'bonus_movement_speed':
                                if (ability.name == 'pugna_decrepify' || ability.name == 'chen_penitence') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // ancient_apparition_ice_vortex,phantom_lancer_spirit_lance,skywrath_mage_concussive_shot,faceless_void_time_walk
                            case 'movement_speed_pct':
                                if (ability.name == 'ancient_apparition_ice_vortex' || ability.name == 'phantom_lancer_spirit_lance' || ability.name == 'faceless_void_time_walk') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                                else if (ability.name == 'skywrath_mage_concussive_shot') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // razor_unstable_current
                            case 'slow_amount':
                                if (ability.name == 'razor_unstable_current') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // brewmaster_drunken_haze,brewmaster_thunder_clap,treant_leech_seed
                            case 'movement_slow':
                                if (ability.name == 'brewmaster_drunken_haze' || ability.name == 'brewmaster_thunder_clap') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                                else if (ability.name == 'ursa_earthshock' || ability.name == 'treant_leech_seed') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // skeleton_king_reincarnation
                            case 'movespeed':
                                if (ability.name == 'skeleton_king_reincarnation') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                            // kunkka_torrent,visage_grave_chill
                            case 'movespeed_bonus':
                                if (ability.name == 'kunkka_torrent') {
                                    totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                                else if (ability.name == 'visage_grave_chill') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                        }
                    }
                    if (ability.name == 'satyr_trickster_purge') {
                        totalAttribute -= 80/100;
                    }
                    else if (ability.name == 'enraged_wildkin_tornado') {
                        totalAttribute -= 15/100;
                    }
                }
            }
            else if (ability.movementSpeedPctReduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // axe_battle_hunger,batrider_sticky_napalm,shredder_chakram,meepo_geostrike,life_stealer_open_wounds,
                    // venomancer_poison_sting,viper_viper_strike,viper_corrosive_skin,viper_poison_attack,venomancer_venomous_gale,treant_leech_seed
                    // lich_chain_frost,sniper_shrapnel,centaur_stampede,huskar_life_break,jakiro_dual_breath,meepo_geostrike,sandking_epicenter
                    // earth_spirit_rolling_boulder,invoker_ghost_walk,invoker_ice_wall,elder_titan_earth_splitter
                    // undying_flesh_golem,templar_assassin_psionic_trap,nevermore_requiem,queenofpain_shadow_strike
                    totalAttribute+=ability.movementSpeedPctReduction()/100;
                }
            }
        }
        return totalAttribute;
    });

    self.getTurnRateReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // medusa_stone_gaze
                            case 'slow':
                                if (ability.name == 'medusa_stone_gaze') {
                                    totalAttribute -= self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.turnRateReduction != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // batrider_sticky_napalm
                    totalAttribute+=ability.turnRateReduction()/100;
                }
            }
        }
        return totalAttribute;
    });
    
    self.getVisionRangeNight = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // winter_wyvern_arctic_burn
                            case 'night_vision_bonus':
                            // lycan_shapeshift,luna_lunar_blessing
                            case 'bonus_night_vision':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level());
                            break;
                        }
                    }
                }
            }
            else if (ability.visionnight != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // 
                    totalAttribute+=ability.visionnight();
                }
            }
        }
        return totalAttribute;
    });

    self.getVisionRangePctReduction = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // night_stalker_darkness
                            case 'blind_percentage':
                                totalAttribute += self.getAbilityAttributeValue(self.abilities[i].attributes, attribute.name, ability.level())/100;
                            break;
                        }
                    }
                }
            }
        }
        return totalAttribute;
    });

    self.setEvasion = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                if (ability.name == 'windrunner_windrun') {
                    return 1;
                }
            }
        }
        return totalAttribute;
    });
    
    self.setMovementSpeed = ko.computed(function () {
        var MAX_MOVESPEED = 522;
        var MIN_MOVESPEED = 100;
        var totalAttribute = 0;
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                if (ability.name == 'spirit_breaker_charge_of_darkness') {
                    return self.getAbilityAttributeValue(ability.attributes, 'movement_speed', ability.level());
                }
                if (ability.name == 'dark_seer_surge') {
                    return MAX_MOVESPEED;
                }
                if (ability.name == 'centaur_stampede') {
                    return MAX_MOVESPEED;
                }
                if (ability.name == 'lycan_shapeshift') {
                    return MAX_MOVESPEED;
                }
                if (ability.name == 'lion_voodoo' || ability.name == 'shadow_shaman_voodoo') {
                    return MIN_MOVESPEED;
                }
            }
        }
        return totalAttribute;
    });

    self.getBashSource = function (attacktype) {
        var sources = {};
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // sniper_headshot
                            case 'proc_chance':
                                if (sources[ability.name] == undefined && ability.name == 'sniper_headshot') {
                                    sources[ability.name] = {
                                        'chance': self.getAbilityAttributeValue(ability.attributes, attribute.name, ability.level())/100,
                                        'damage': self.getAbilityPropertyValue(ability, 'damage'),
                                        'count': 1,
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                            // slardar_bash
                            case 'chance':
                                if (sources[ability.name] == undefined && ability.name == 'slardar_bash') {
                                    sources[ability.name] = {
                                        'chance': self.getAbilityAttributeValue(ability.attributes, attribute.name, ability.level())/100,
                                        'damage': self.getAbilityAttributeValue(ability.attributes, 'bonus_damage', ability.level()),
                                        'count': 1,
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.bashBonusDamage != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // faceless_void_time_lock
                    if (sources[ability.name] == undefined && ability.name == 'faceless_void_time_lock') {
                        sources[ability.name] = {
                            'chance': ability.bash()/100,
                            'damage': ability.bashBonusDamage(),
                            'count': 1,
                            'damageType': 'magic',
                            'displayname': ability.displayname
                        }
                    }
                    // spirit_breaker_greater_bash
                    if (sources[ability.name] == undefined && ability.name == 'spirit_breaker_greater_bash') {
                        sources[ability.name] = {
                            'chance': ability.bash()/100,
                            'damage': ability.bashBonusDamage()/100,
                            'count': 1,
                            'damageType': 'magic',
                            'displayname': ability.displayname
                        }
                    }
                }
            }
        }

        return sources;
    };
    
    self.getOrbSource = function () {
        var sources = {};
        for (var i = 0; i < self.abilities.length; i++) {
            var ability = self.abilities[i];
            if (!(ability.name in self.abilityData)) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    for (var j = 0; j < self.abilities[i].attributes.length; j++) {
                        var attribute = self.abilities[i].attributes[j];
                        switch(attribute.name) {
                            // antimage_mana_break
                            case 'mana_per_hit':
                                if (sources[ability.name] == undefined && ability.name == 'antimage_mana_break') {
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(ability.attributes, attribute.name, ability.level()) 
                                                * self.getAbilityAttributeValue(ability.attributes, 'damage_per_burn', ability.level()),
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                            // clinkz_searing_arrows
                            case 'damage_bonus':
                                if (sources[ability.name] == undefined && ability.name == 'clinkz_searing_arrows') {
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(ability.attributes, attribute.name, ability.level()),
                                        'damageType': 'physical',
                                        'displayname': ability.displayname
                                    }
                                }
                            // silencer_glaives_of_wisdom
                            case 'intellect_damage_pct':
                                if (sources[ability.name] == undefined && ability.name == 'silencer_glaives_of_wisdom') {
                                    sources[ability.name] = {
                                        'damage': self.getAbilityAttributeValue(ability.attributes, attribute.name, ability.level())/100 * self.hero.totalInt(),
                                        'damageType': 'pure',
                                        'displayname': ability.displayname
                                    }
                                }
                            break;
                        }
                    }
                }
            }
            else if (ability.bonusDamageOrb != undefined) {
                if (ability.level() > 0 && (ability.isActive() || (ability.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') != -1))) {
                    // obsidian_destroyer_arcane_orb
                    if (sources[ability.name] == undefined && ability.name == 'obsidian_destroyer_arcane_orb') {
                        sources[ability.name] = {
                            'damage': ability.bonusDamageOrb(),
                            'damageType': 'pure',
                            'displayname': ability.displayname
                        }
                    }
                }
            }
        }
        
        return sources;
    };
    
    self.toggleAbility = function (index, data, event) {
        if (self.abilities[index()].behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') < 0) {
            if (self.abilities[index()].isActive()) {
                self.abilities[index()].isActive(false);
            }
            else {
                self.abilities[index()].isActive(true);
            }
            
            if (self.abilities[index()].name == 'lycan_shapeshift') {
                self.isShapeShiftActive(self.abilities[index()].isActive());
            }
        }
    }.bind(this);

    self.toggleAbilityDetail = function (index, data, event) {
        if (self.abilities[index()].isDetail()) {
            self.abilities[index()].isDetail(false);
        }
        else {
            self.abilities[index()].isDetail(true);
        }
    }.bind(this);
    
    self.getAbility = function (abilityName) {
        return self.abilities.find(function(b) {
            return b.name == abilityName;
        });
    }
}

my.prototype.AbilityModel.prototype.levelUpAbility = function (index, data, event, hero) {
    var self = this;
    if (self.abilities[index()].level() < hero.getAbilityLevelMax(data) && hero.availableSkillPoints() > 0 ) {
        switch(self.abilities[index()].abilitytype) {
            case 'DOTA_ABILITY_TYPE_ULTIMATE':
                if (hero.heroId() == 'invoker') {
                    if (
                        (self.abilities[index()].level() == 0) && (parseInt(hero.selectedHeroLevel()) >= 2) ||
                        (self.abilities[index()].level() == 1) && (parseInt(hero.selectedHeroLevel()) >= 7) ||
                        (self.abilities[index()].level() == 2) && (parseInt(hero.selectedHeroLevel()) >= 11) ||
                        (self.abilities[index()].level() == 3) && (parseInt(hero.selectedHeroLevel()) >= 17)
                    ) {
                        self.abilities[index()].level(self.abilities[index()].level()+1);
                        hero.skillPointHistory.push(index());
                    }
                }
                else if (hero.heroId() == 'meepo') {
                    if (self.abilities[index()].level() * 7 + 3 <= parseInt(hero.selectedHeroLevel())) {
                        self.abilities[index()].level(self.abilities[index()].level()+1);
                        hero.skillPointHistory.push(index());
                    }
                }
                else {
                    if ((self.abilities[index()].level()+1) * 5 + 1 <= parseInt(hero.selectedHeroLevel())) {
                        self.abilities[index()].level(self.abilities[index()].level()+1);
                        hero.skillPointHistory.push(index());
                    }
                }
            break;
            default:
                if (self.abilities[index()].level() * 2 + 1 <= parseInt(hero.selectedHeroLevel())) {
                    self.abilities[index()].level(self.abilities[index()].level()+1);
                    hero.skillPointHistory.push(index());
                }
            break;
        }
        switch (self.abilities[index()].name) {
            case 'beastmaster_call_of_the_wild':
            case 'chen_test_of_faith':
            case 'morphling_morph_agi':
            case 'shadow_demon_shadow_poison':
                self.abilities[index() + 1].level(self.abilities[index()].level());
            break;
            case 'morphling_morph_str':
                self.abilities[index() - 1].level(self.abilities[index()].level());
            break;
            case 'keeper_of_the_light_spirit_form':
                self.abilities[index() - 1].level(self.abilities[index()].level());
                self.abilities[index() - 2].level(self.abilities[index()].level());
            break;
            case 'nevermore_shadowraze1':
                self.abilities[index() + 1].level(self.abilities[index()].level());
                self.abilities[index() + 2].level(self.abilities[index()].level());
            break;
            case 'nevermore_shadowraze2':
                self.abilities[index() - 1].level(self.abilities[index()].level());
                self.abilities[index() + 1].level(self.abilities[index()].level());
            break;
            case 'nevermore_shadowraze3':
                self.abilities[index() - 1].level(self.abilities[index()].level());
                self.abilities[index() - 2].level(self.abilities[index()].level());
            break;
            case 'ember_spirit_fire_remnant':
                self.abilities[index() - 1].level(self.abilities[index()].level());
            break;
            case 'lone_druid_true_form':
                self.abilities[index() - 1].level(self.abilities[index()].level());
            break;
        }
    }
};
my.prototype.AbilityModel.prototype.levelDownAbility = function (index, data, event, hero) {
    var self = this;
    if (self.abilities[index()].level() > 0) {
        self.abilities[index()].level(self.abilities[index()].level() - 1);
        hero.skillPointHistory.splice(hero.skillPointHistory().lastIndexOf(index()), 1);
        switch (self.abilities[index()].name) {
            case 'beastmaster_call_of_the_wild':
            case 'chen_test_of_faith':
            case 'morphling_morph_agi':
            case 'shadow_demon_shadow_poison':
                self.abilities[index() + 1].level(self.abilities[index()].level());
            break;
            case 'morphling_morph_str':
                self.abilities[index() - 1].level(self.abilities[index()].level());
            break;
            case 'keeper_of_the_light_spirit_form':
                self.abilities[index() - 1].level(self.abilities[index()].level());
                self.abilities[index() - 2].level(self.abilities[index()].level());
            break;
            case 'nevermore_shadowraze1':
                self.abilities[index() + 1].level(self.abilities[index()].level());
                self.abilities[index() + 2].level(self.abilities[index()].level());
            break;
            case 'nevermore_shadowraze2':
                self.abilities[index() - 1].level(self.abilities[index()].level());
                self.abilities[index() + 1].level(self.abilities[index()].level());
            break;
            case 'nevermore_shadowraze3':
                self.abilities[index() - 1].level(self.abilities[index()].level());
                self.abilities[index() - 2].level(self.abilities[index()].level());
            break;
            case 'ember_spirit_fire_remnant':
                self.abilities[index() - 1].level(self.abilities[index()].level());
            break;
            case 'lone_druid_true_form':
                self.abilities[index() - 1].level(self.abilities[index()].level());
            break;
        }
    }
};
},{"./herocalc_core":4,"./herocalc_knockout":10}],2:[function(require,module,exports){
'use strict';
    
var my = require("./herocalc_core");

my.prototype.abilityData = {
    'alchemist_acid_spray': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'armor_reduction',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -a;
            },
            returnProperty: 'armorReduction'
        }
    ],
    'alchemist_unstable_concoction': [
        {
            label: 'Brew Time',
            controlType: 'input'
        },
        {
            attributeName: 'max_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/5;
            }
        },
        {
            attributeName: 'max_stun',
            label: 'Total Stun',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/5;
            }
        }
    ],
    'ancient_apparition_cold_feet': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'stun_duration',
            label: 'Total Stun',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            }
        }
    ],
    'ancient_apparition_ice_blast': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'dot_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')+v*a;
            }
        }
    ],
    'antimage_mana_void': [
        {
            label: 'Enemy Missing Mana',
            controlType: 'input'
        },
        {
            attributeName: 'mana_void_damage_per_mana',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'axe_battle_hunger': [
        {
            label: 'Battle Hungered Enemies',
            controlType: 'input'
        },
        {
            attributeName: 'speed_bonus',
            label: 'Movement Speed Bonus',
            controlType: 'text',
            noLevel: true,
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'movementSpeedPct'
        },
        {
            attributeName: 'slow',
            label: 'Movement Speed Bonus',
            controlType: 'text',
            noLevel: true,
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'bane_nightmare': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'bane_fiends_grip': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'Enemy Max Mana',
            controlType: 'input'
        },
        {
            attributeName: 'fiend_grip_damage',
            label: 'Total Damage',
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (parent.inventory.hasScepter()) {
                    return v[0]*abilityModel.getAbilityAttributeValue(ability.attributes, 'fiend_grip_damage_scepter',ability.level());
                }
                else {
                    return v[0]*a;
                }
            }
        },
        {
            attributeName: 'fiend_grip_mana_drain',
            label: 'Total Mana Drain',
            controlType: 'text',
            controls: [0,1],
            noLevel: true,
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (parent.inventory.hasScepter()) {
                    return v[0]*v[1]*abilityModel.getAbilityAttributeValue(ability.attributes, 'fiend_grip_mana_drain_scepter',ability.level())/100;
                }
                else {
                    return v[0]*v[1]*a/100;
                }
            }
        }
    ],
    'batrider_sticky_napalm': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Bonus Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusDamage'
        },
        {
            attributeName: 'movement_speed_pct',
            label: 'Enemy Movement Speed Slow',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'turn_rate_pct',
            label: 'Enemy Turn Rate Slow',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'turnRateReduction'
        }
    ],
    'batrider_firefly': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_second',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'bloodseeker_rupture': [
        {
            label: 'Enemy Distance Traveled',
            controlType: 'input'
        },
        {
            attributeName: 'movement_damage_pct',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage') + v*a/100;
            }
        }
    ],
    'bristleback_viscous_nasal_goo': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'armor_per_stack',
            label: 'Enemy Armor Reduction',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -v*a;
            },
            returnProperty: 'armorReduction'
        },
        {
            attributeName: 'move_slow_per_stack',
            label: '%SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -(abilityModel.getAbilityAttributeValue(ability.attributes, 'base_move_slow',0)+v*a);
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'bristleback_quill_spray': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'quill_stack_damage',
            label: 'DAMAGE',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var total = abilityModel.getAbilityAttributeValue(ability.attributes, 'quill_base_damage',ability.level())+v*a,
                damage_cap = abilityModel.getAbilityAttributeValue(ability.attributes, 'max_damage',0);
                if (total > damage_cap) {
                    total = damage_cap;
                }
                return total;
            }
        }
    ],
    'bristleback_bristleback': [
        {
            label: 'Damage From',
            controlType: 'radio',
            controlValueType: 'string',
            controlOptions: [
                {text: 'Back', value: 'back'},
                {text: 'Side', value: 'side'}
            ]
        },
        {
            attributeName: 'back_damage_reduction',
            label: '%DAMAGE REDUCTION:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var ability = abilityModel.abilities.find(function(b) {
                    return b.name == 'bristleback_bristleback';
                });
                if (v == 'back') {
                    var total = abilityModel.getAbilityAttributeValue(ability.attributes, 'back_damage_reduction', ability.level());
                }
                else {
                    var total = abilityModel.getAbilityAttributeValue(ability.attributes, 'side_damage_reduction', ability.level());
                }
                return -total;
            },
            returnProperty: 'damageReduction'
        }
    ],
    'bristleback_warpath': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_stack',
            label: 'BONUS DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v < 1) {
                    return 0;
                }
                else {
                    return abilityModel.getAbilityAttributeValue(ability.attributes, 'base_damage',ability.level())+(v-1)*a;
                }
            }
        },
        {
            attributeName: 'move_speed_per_stack',
            label: '%MOVEMENT:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v < 1) {
                    return 0;
                }
                else {
                    return abilityModel.getAbilityAttributeValue(ability.attributes, 'base_move_speed',ability.level())+(v-1)*a;
                }
            },
            returnProperty: 'movementSpeedPct'
        }
    ],
    'centaur_return': [
        {
            label: 'Strength',
            controlType: 'input'
        },
        {
            attributeName: 'strength_pct',
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'return_damage',ability.level()) + v*a/100;
            }
        }
    ],
    'centaur_stampede': [
        {
            label: 'Strength',
            controlType: 'input'
        },
        {
            attributeName: 'strength_damage',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'slow_movement_speed',
            label: 'Enemy Movement Speed Slow',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'clinkz_death_pact': [
        {
            label: 'Consumed Unit HP',
            controlType: 'input'
        },
        {
            attributeName: 'damage_gain_pct',
            label: 'BASE DAMAGE GAIN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            },
            returnProperty: 'baseDamage'
        },
        {
            attributeName: 'health_gain_pct',
            label: 'HEALTH GAIN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            },
            returnProperty: 'bonusHealth'
        }
    ],
    'crystal_maiden_frostbite': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'dark_seer_ion_shell': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_second',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'dazzle_shadow_wave': [
        {
            label: 'Targets',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'dazzle_weave': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'armor_per_second',
            label: 'ARMOR',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'armor'
        },
        {
            attributeName: 'armor_per_second',
            label: 'ARMOR REDUCTION:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -v*a;
            },
            returnProperty: 'armorReduction'
        }
    ],
    'death_prophet_exorcism': [
        {
            label: 'Damage Dealt',
            controlType: 'input'
        },
        {
            attributeName: 'heal_percent',
            label: 'Total Armor',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            }
        }
    ],
    'disruptor_static_storm': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damagevalue = 0.25 * (130 + 40 * ability.level()) * (1/20),
                mult = (v*4)*((v*4)+1)/2;
                return damagevalue * mult;
            }
        }
    ],
    'doom_bringer_scorched_earth': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_second',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'bonus_movement_speed_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPct'
        },
        {
            attributeName: 'damage_per_second',
            label: 'HP REGEN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'healthregen'
        }
    ],
    'doom_bringer_doom': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (parent.inventory.hasScepter()) {
                    return v*abilityModel.getAbilityAttributeValue(ability.attributes, 'damage_scepter',ability.level());
                }
                else {
                    return v*a;
                }
            }
        }
    ],
    'dragon_knight_elder_dragon_form': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_attack_range',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackrange'
        },
        {
            attributeName: 'bonus_movement_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedFlat'
        }
    ],
    'drow_ranger_trueshot': [
        {
            label: 'Drow\'s Agility',
            controlType: 'input',
            display: 'buff'
        },
        {
            attributeName: 'trueshot_ranged_damage',
            label: 'DAMAGE BONUS:',
            ignoreTooltip: true,
            controlType: 'text',
            display: 'buff',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            },
            returnProperty: 'bonusDamagePrecisionAura'
        }
    ],
    'earth_spirit_rolling_boulder': [
        {
            label: 'Using Stone',
            controlType: 'checkbox'
        },
        {
            attributeName: 'move_slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return -a;
                }
                else {
                    return 0;
                }
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'earthshaker_enchant_totem': [
        {
            label: 'Activated',
            controlType: 'checkbox'
        },
        {
            attributeName: 'totem_damage_percentage',
            label: 'DAMAGE',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return a;
                }
                else {
                    return 0;
                }
            },
            returnProperty: 'baseDamageMultiplier'
        }
    ],
    'earthshaker_echo_slam': [
        {
            label: 'Enemies in Range',
            controlType: 'input'
        },
        {
            attributeName: 'echo_slam_echo_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'elder_titan_ancestral_spirit': [
        {
            label: 'HEROES PASSED THROUGH',
            controlType: 'input'
        },
        {
            label: 'CREEPS PASSED THROUGH',
            controlType: 'input'
        },
        {
            attributeName: 'damage_creeps',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]*abilityModel.getAbilityAttributeValue(ability.attributes, 'damage_heroes',ability.level()) + v[1]*a;
            },
            returnProperty: 'bonusDamage'
        },
        {
            attributeName: 'move_pct_creeps',
            label: '%BONUS SPEED:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]*abilityModel.getAbilityAttributeValue(ability.attributes, 'move_pct_heroes',ability.level()) + v[1]*a;
            },
            returnProperty: 'movementSpeedPct'
        }
    ],
    'elder_titan_earth_splitter': [
        {
            label: 'Enemy Max Health',
            controlType: 'input'
        },
        {
            attributeName: 'damage_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            }
        },
        {
            attributeName: 'slow_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'enchantress_natures_attendants': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'heal',
            label: 'HEAL:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'wisp_count',ability.level())*v*a;
            }
        }
    ],
    'enigma_malefice': [
        {
            label: 'Hits',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'stun_duration',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'enigma_midnight_pulse': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'Enemy Max Health',
            controlType: 'input'
        },
        {
            attributeName: 'damage_percent',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]*v[1]*a/100;
            }
        }
    ],
    'enigma_black_hole': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'far_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'near_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'faceless_void_time_lock': [
        {
            label: 'In Chronosphere',
            controlType: 'checkbox'
        },
        {
            attributeName: 'bonus_damage',
            label: '%MOVESPEED AS DAMAGE',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return a*2;
                }
                else {
                    return a;
                }
            },
            returnProperty: 'bashBonusDamage'
        },
        {
            attributeName: 'duration',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            }
        },
        {
            attributeName: 'chance_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'bash'
        }
    ],
    'gyrocopter_rocket_barrage': [
        {
            label: 'Rockets',
            controlType: 'input'
        },
        {
            attributeName: 'rockets_per_second',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            }
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
/*        'gyrocopter_homing_missile': [
        {
            label: 'Distance Traveled',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'gyrocopter_flak_cannon': [
        {
            label: 'Attacks',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],*/
    'huskar_burning_spear': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'health_cost',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'huskar_berserkers_blood': [
        {
            label: '%HP',
            controlType: 'input'
        },
        {
            attributeName: 'hp_threshold_max',
            label: 'Health at given %HP:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return parent.health()*v/100;
            }
        },
        {
            attributeName: 'hp_threshold_max',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            }
        },
        {
            attributeName: 'maximum_resistance',
            label: 'MAGIC RESISTANCE BONUS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var v = Math.min(v, 100);
                v = Math.max(v, 10);
                var hp_threshold_max = abilityModel.getAbilityAttributeValue(ability.attributes, 'hp_threshold_max',0);
                var d = 100 - hp_threshold_max;
                var c = (v - hp_threshold_max) / d;
                c = 1 - c;
                return c*a;
            },
            returnProperty: 'magicResist'
        },
        {
            attributeName: 'maximum_attack_speed',
            label: 'ATTACK SPEED BONUS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var v = Math.min(v, 100);
                v = Math.max(v, 10);
                var hp_threshold_max = abilityModel.getAbilityAttributeValue(ability.attributes, 'hp_threshold_max',0);
                var d = 100 - hp_threshold_max;
                var c = (v - hp_threshold_max) / d;
                c = 1 - c;
                return c*a;
            },
            returnProperty: 'attackspeed'
        }
    ],
    'huskar_life_break': [
        {
            label: 'Enemy Current HP',
            controlType: 'input'
        },
        {
            attributeName: 'health_damage',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            label: 'Huskar Current HP',
            controlType: 'input'
        },
        {
            attributeName: 'health_cost_percent',
            label: 'DAMAGE TAKEN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'movespeed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'invoker_quas': [
        {
            label: 'Instances',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_strength',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'bonusStrength'
        },
        {
            attributeName: 'health_regen_per_instance',
            label: 'HP REGEN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'healthregen'
        }
    ],
    'invoker_wex': [
        {
            label: 'Instances',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_agility',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'bonusAgility'
        },
        {
            attributeName: 'move_speed_per_instance',
            label: '%MOVE SPEED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'movementSpeedPct'
        },
        {
            attributeName: 'attack_speed_per_instance',
            label: '%ATTACK SPEED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'attackspeed'
        }
    ],
    'invoker_exort': [
        {
            label: 'Instances',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_intelligence',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'bonusInt'
        },
        {
            attributeName: 'bonus_damage_per_instance',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusDamage'
        }
    ],
    'invoker_ghost_walk': [
        {
            label: 'Quas Level',
            controlType: 'input'
        },
        {
            attributeName: 'enemy_slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v == 0) {
                    return 0;
                }
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'enemy_slow',v);
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            label: 'Wex Level',
            controlType: 'input',
            display: 'ability'
        },
        {
            attributeName: 'self_slow',
            label: 'Total Damage',
            controlType: 'text',
            display: 'ability',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v == 0) {
                    return 0;
                }
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'self_slow',v);
            },
            returnProperty: 'movementSpeedPct'
        }
    ],
    'invoker_alacrity': [
        {
            label: 'Wex Level',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_attack_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v == 0) {
                    return 0;
                }
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'bonus_attack_speed',v);
            },
            returnProperty: 'attackspeed'
        },
        {
            label: 'Exort Level',
            controlType: 'input',
        },
        {
            attributeName: 'bonus_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v == 0) {
                    return 0;
                }
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'bonus_damage',v);
            },
            returnProperty: 'bonusDamage'
        }
    ],
    'invoker_ice_wall': [
        {
            label: 'Quas Level',
            controlType: 'input'
        },
        {
            attributeName: 'slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v == 0) {
                    return 0;
                }
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'slow',v);
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            label: 'Exort Level',
            controlType: 'input',
            display: 'ability'
        },
        {
            label: 'Duration',
            controlType: 'input',
            display: 'ability'
        },
        {
            attributeName: 'damage_per_second',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            display: 'ability',
            controls: [1,2],
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v[0] == 0) {
                    return 0;
                }
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'damage_per_second',v[0])*v[1];
            }
        }
    ],
    'jakiro_dual_breath': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*2 + 
                abilityModel.getAbilityAttributeValue(ability.attributes, 'burn_damage',ability.level())*v;
            }
        },
        {
            attributeName: 'slow_movement_speed_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'slow_attack_speed_pct',
            label: '%ATTACK SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeedreduction'
        }
    ],
    'jakiro_liquid_fire': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'slow_attack_speed_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeedreduction'
        }
    ],
    'jakiro_macropyre': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'juggernaut_blade_fury': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'juggernaut_healing_ward': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'Max Health',
            controlType: 'input'
        },
        {
            attributeName: 'healing_ward_heal_amount',
            label: 'HEAL OVER TIME:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]*v[1]*a/100;
            }
        }
    ],
    'juggernaut_omni_slash': [
        {
            label: 'Jumps',
            controlType: 'input'
        },
        {
            label: 'MIN DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'omni_slash_damage',1)*v;
            }
        },
        {
            label: 'MAX DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'omni_slash_damage',2)*v;
            }
        }
    ],
    'keeper_of_the_light_illuminate': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_second',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'keeper_of_the_light_mana_leak': [
        {
            label: 'Distance Moved',
            controlType: 'input'
        },
        {
            label: 'Enemy Max Mana',
            controlType: 'input'
        },
        {
            attributeName: 'mana_leak_pct',
            label: 'MANA LEAKED:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]/100*v[1]*a/100;
            }
        }
    ],
    'legion_commander_duel': [
        {
            label: 'Duel Wins',
            controlType: 'input'
        },
        {
            attributeName: 'reward_damage',
            label: 'Total Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusDamage'
        }
    ],
    'leshrac_pulse_nova': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'mana_cost_per_second',
            label: 'MANA COST:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'lich_chain_frost': [
        {
            label: 'Bounce Hits',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'slow_movement_speed',
            label: 'Enemy Movement Speed Slow',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'slow_attack_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeedreduction'
        }
    ],
    'life_stealer_feast': [
        {
            label: 'Enemy Current HP',
            controlType: 'input'
        },
        {
            attributeName: 'hp_leech_percent',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            },
            returnProperty: 'bonusDamage'
        }
    ],
    'life_stealer_open_wounds': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'heal_percent',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'lifesteal'
        },
        {
            attributeName: 'slow_steps',
            label: '%SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            noLevel: true,
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'slow_steps',v+1);
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'lina_fiery_soul': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'fiery_soul_move_speed_bonus',
            label: 'Enemy Movement Speed Slow',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'movementSpeedPct'
        },
        {
            attributeName: 'fiery_soul_attack_speed_bonus',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'attackspeed'
        }
    ],
    'lion_mana_drain': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'mana_per_second',
            label: 'MANA DRAINED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'luna_moon_glaive': [
        {
            label: 'Damage',
            controlType: 'input'
        },
        {
            attributeName: 'damage_reduction_percent',
            label: 'BOUNCE DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var result = [];
                for (var i = 1; i < 6; i++) {
                    result.push((v*Math.pow(a/100,i)).toFixed(2))
                }
                return result.join('<br>');
            }
        }
    ],
    'luna_eclipse': [
        {
            label: 'Beam Count',
            controlType: 'input'
        },
        {
            attributeName: 'beams',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var lucentBeamAbility = abilityModel.abilities.find(function(b) {
                    return b.name == 'luna_lucent_beam';
                });
                if (lucentBeamAbility.level() == 0) return 0;
                var damage = abilityModel.getAbilityPropertyValue(lucentBeamAbility, 'damage');
                return v*damage;
            }
        }
    ],
    'medusa_mystic_snake': [
        {
            label: 'Jump Count',
            controlType: 'input'
        },
        {
            attributeName: 'snake_damage',
            label: 'Damage Per Jump:',
            ignoreTooltip: true,
            controlType: 'method',
            display: 'none',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var snake_jumps = abilityModel.getAbilityAttributeValue(ability.attributes, 'snake_jumps',ability.level());
                var snake_scale = abilityModel.getAbilityAttributeValue(ability.attributes, 'snake_scale',0);
                var damage = [];
                for (var i = 0; i < snake_jumps; i++) {
                    damage.push(a + a * i * snake_scale/100);
                }
                return damage;
            }
        },
        {
            attributeName: 'snake_damage',
            label: 'Damage Per Jump:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[1].join(' / ');
            }
        },
        {
            attributeName: 'snake_damage',
            label: 'Total Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[1].slice(0, v[0]).reduce(function (memo, o) { return memo + o }, 0);
            }
        },
        {
            attributeName: 'snake_damage',
            label: 'Max Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[1].reduce(function (memo, o) { return memo + o }, 0);
            }
        }
    ],
    'medusa_mana_shield': [
        {
            label: 'Damage',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_mana',
            label: 'MANA USED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return (v/a).toFixed(2);
            }
        },
        {
            attributeName: 'absorption_tooltip',
            label: '%DAMAGE REDUCTION:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -a;
            },
            returnProperty: 'damageReduction'
        }
    ],
    'meepo_poof': [
        {
            label: 'Meepo Count',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'meepo_geostrike': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        },
        {
            attributeName: 'slow',
            label: '%SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            noLevel: true,
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'slow',ability.level())*v;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'mirana_arrow': [
        {
            label: 'Arrow Travel Distance',
            controlType: 'input'
        },
        {
            attributeName: 'arrow_max_stun',
            label: 'STUN DURATION:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var arrow_min_stun = abilityModel.getAbilityAttributeValue(ability.attributes, 'arrow_min_stun',0);
                var arrow_max_stunrange = abilityModel.getAbilityAttributeValue(ability.attributes, 'arrow_max_stunrange',0);
                var scale = Math.min(v, arrow_max_stunrange) / arrow_max_stunrange;
                return Math.max(arrow_min_stun, Math.floor(a * scale / 0.1) * 0.1);
            }
        },
        {
            attributeName: 'arrow_bonus_damage',
            label: 'TOTAL DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var ability = ability;
                var damage = ability.damage()[ability.level()-1];
                var arrow_max_stunrange = abilityModel.getAbilityAttributeValue(ability.attributes, 'arrow_max_stunrange',0);
                var scale = Math.min(v, arrow_max_stunrange) / arrow_max_stunrange;
                var bonus_damage = Math.floor(a * scale / 2.8) * 2.8;
                return damage + ' + ' + bonus_damage + ' = ' + (damage + bonus_damage);
            }
        }
    ],
    'morphling_morph_agi': [
        {
            label: 'Shifts',
            controlType: 'input'
        },
        {
            attributeName: 'points_per_tick',
            label: 'AGI SHIFT GAIN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusAgility'
        },
        {
            attributeName: 'points_per_tick',
            label: 'STR SHIFT LOSS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -v*a;
            },
            returnProperty: 'bonusStrength'
        },
        {
            attributeName: 'bonus_attributes',
            label: 'SHIFT TIME:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'bonusAgility2'
        },
        {
            attributeName: 'morph_cooldown',
            label: 'SHIFT TIME:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'mana_cost',
            label: 'SHIFT MANA COST:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a*abilityModel.getAbilityAttributeValue(ability.attributes, 'morph_cooldown',ability.level());
            }
        }
    ],
    'morphling_morph_str': [
        {
            label: 'Shifts',
            controlType: 'input'
        },
        {
            attributeName: 'points_per_tick',
            label: 'STR SHIFT GAIN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusStrength'
        },
        {
            attributeName: 'points_per_tick',
            label: 'AGI SHIFT LOSS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -v*a;
            },
            returnProperty: 'bonusAgility'
        },
        {
            attributeName: 'bonus_attributes',
            label: 'SHIFT TIME:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'bonusStrength2'
        },
        {
            attributeName: 'morph_cooldown',
            label: 'SHIFT TIME:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'mana_cost',
            label: 'SHIFT MANA COST:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a*abilityModel.getAbilityAttributeValue(ability.attributes, 'morph_cooldown',ability.level());
            }
        }
    ],
    'furion_wrath_of_nature': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'necrolyte_heartstopper_aura': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'Enemy Max Health',
            controlType: 'input'
        },
        {
            attributeName: 'aura_damage',
            label: 'HEALTH LOST:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]*v[1]*a/100;
            }
        }
    ],
    'necrolyte_sadist': [
        {
            label: 'Unit Kills',
            controlType: 'input'
        },
        {
            label: 'Hero Kills',
            controlType: 'input'
        },
        {
            attributeName: 'health_regen',
            label: 'Total Damage',
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var hero_multiplier = abilityModel.getAbilityAttributeValue(ability.attributes, 'hero_multiplier',0)
                return (v[0]+v[1]*hero_multiplier)*a;
            },
            returnProperty: 'healthregen'
        },
        {
            attributeName: 'mana_regen',
            label: 'Total Damage',
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var hero_multiplier = abilityModel.getAbilityAttributeValue(ability.attributes, 'hero_multiplier',0)
                return (v[0]+v[1]*hero_multiplier)*a;
            },
            returnProperty: 'manaregen'
        }
    ],
    'night_stalker_crippling_fear': [
        {
            label: 'Is Night',
            controlType: 'checkbox'
        },
        {
            attributeName: 'miss_rate_night',
            label: '%CHANCE TO MISS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return abilityModel.getAbilityAttributeValue(ability.attributes, 'miss_rate_night',ability.level());
                }
                else {
                    return abilityModel.getAbilityAttributeValue(ability.attributes, 'miss_rate_day',ability.level());
                }
            },
            returnProperty: 'missChance'
        }
    ],    
    'night_stalker_hunter_in_the_night': [
        {
            label: 'Is Night',
            controlType: 'checkbox'
        },
        {
            attributeName: 'bonus_attack_speed_night',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return a;
                }
                else {
                    return 0;
                }
            },
            returnProperty: 'attackspeed'
        },
        {
            attributeName: 'bonus_movement_speed_pct_night',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return a;
                }
                else {
                    return 0;
                }
            },
            returnProperty: 'movementSpeedPct'
        }
    ],    
    'obsidian_destroyer_arcane_orb': [
        {
            label: 'Current Mana',
            controlType: 'input'
        },
        {
            attributeName: 'mana_pool_damage_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            },
            returnProperty: 'bonusDamageOrb'
        }
    ],
    'ogre_magi_ignite': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'burn_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'slow_movement_speed_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'pudge_rot': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        },
        {
            attributeName: 'rot_slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'pudge_flesh_heap': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'flesh_heap_strength_buff_amount',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusStrength'
        },
        {
            attributeName: 'flesh_heap_magic_resist',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'magicResist'
        }
    ],
    'pudge_dismember': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'dismember_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'pugna_nether_ward': [
        {
            label: 'Enemy Mana Spent',
            controlType: 'input'
        },
        {
            attributeName: 'mana_multiplier',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'mana_regen',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'manaregenreduction'
        }
    ],
    'pugna_life_drain': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'health_drain',
            label: 'HEALTH DRAINED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'queenofpain_shadow_strike': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'movement_slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'strike_damage',
            label: 'Total Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var duration_damage = abilityModel.getAbilityAttributeValue(ability.attributes, 'duration_damage',ability.level());
                var ticks = Math.floor(v/3);
                return a + duration_damage * ticks;
            }
        }
    ],
    'razor_plasma_field': [
        {
            label: 'Distance',
            controlType: 'input'
        },
        {
            attributeName: 'radius',
            label: 'MIN DISTANCE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return 200;
            }
        },
        {
            attributeName: 'radius',
            label: 'MAX DISTANCE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return 200 + a;
            }
        },
        {
            attributeName: 'radius',
            label: 'Instance Damage',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var max_radius = a + 200;
                var scale = (Math.min(Math.max(v, 200), max_radius) - 200) / (max_radius - 200);
                var damage_min = abilityModel.getAbilityAttributeValue(ability.attributes, 'damage_min',ability.level());
                var damage_max = abilityModel.getAbilityAttributeValue(ability.attributes, 'damage_max',ability.level());
                return damage_min + (damage_max - damage_min) * scale;
            }
        }
    ],
    'razor_static_link': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'drain_length',
            label: 'Damage Drained:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var tick_duration = Math.floor(v * 4) + 1;
                var ticks = Math.min(a * 4 + 1, tick_duration);
                var drain_rate = abilityModel.getAbilityAttributeValue(ability.attributes, 'drain_rate',ability.level());
                return ticks * drain_rate/4;
            },
            returnProperty: 'bonusDamage'
        },
        {
            attributeName: 'drain_length',
            label: 'Enemy Damage Lost:',
            ignoreTooltip: true,
            controlType: 'text',
            display: 'hidden',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var tick_duration = Math.floor(v * 4) + 1;
                var ticks = Math.min(a * 4 + 1, tick_duration);
                var drain_rate = abilityModel.getAbilityAttributeValue(ability.attributes, 'drain_rate',ability.level());
                return ticks * drain_rate/4;
            },
            returnProperty: 'bonusDamageReduction'
        }
    ],
    'razor_eye_of_the_storm': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'rubick_fade_bolt': [
        {
            label: 'Jumps',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a * (1 - v*abilityModel.getAbilityAttributeValue(ability.attributes, 'jump_damage_reduction_pct',ability.level())/100);
            }
        },
        {
            attributeName: 'hero_attack_damage_reduction',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'bonusDamageReduction'
        }
    ],
    'sandking_sand_storm': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'sandking_epicenter': [
        {
            label: 'Pulses',
            controlType: 'input'
        },
        {
            attributeName: 'epicenter_damage',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'epicenter_slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'epicenter_slow_as',
            label: '%ATTACK SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeedreduction'
        }
    ],
    'shadow_demon_shadow_poison': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'stack_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var stackmult = [1,2,4,8];
                if (v > 4) {
                    return a * stackmult[3] + 50 * (v - 4);
                }
                else if (v <= 0) {
                    return 0
                }
                else {
                    return a * stackmult[v-1]
                }
            }
        }
    ],
    'nevermore_necromastery': [
        {
            label: 'Souls',
            controlType: 'input'
        },
        {
            attributeName: 'necromastery_damage_per_soul',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusDamage'
        }
    ],
    'nevermore_requiem': [
        {
            label: 'Line Hit Count',
            controlType: 'input'
        },
        {
            attributeName: 'requiem_reduction_damage',
            label: 'Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        },
        {
            label: 'Return Line Hit Count (Scepter)',
            controlType: 'input'
        },
        {
            attributeName: 'requiem_damage_pct_scepter',
            label: 'Damage/Heal:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v*a/100;
            }
        },
        {
            attributeName: 'requiem_damage_pct_scepter',
            label: 'Total Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                return damage*v[0] + damage*v[1]*a/100;
            }
        },
        {
            attributeName: 'requiem_reduction_damage',
            label: '%DAMAGE REDUCTION:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'baseDamageReductionPct'
        },
        {
            attributeName: 'requiem_reduction_ms',
            label: '%DAMAGE REDUCTION:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'shadow_shaman_shackles': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'silencer_curse_of_the_silent': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return Math.floor(v)*a;
            }
        },
        {
            attributeName: 'movespeed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
/*        'silencer_glaives_of_wisdom': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],*/
    'skywrath_mage_mystic_flare': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'slark_essence_shift': [
        {
            label: 'Attacks',
            controlType: 'input'
        },
        {
            attributeName: 'agi_gain',
            label: 'Total Damage',
            controlType: 'text',
            display: 'ability',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'bonusAgility'
        },
        {
            attributeName: 'stat_loss',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -v*a;
            },
            returnProperty: 'bonusAllStatsReduction'
        }
    ],
    'slark_shadow_dance': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_regen_pct',
            label: 'TOTAL HEALTH REGENERATED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*parent.health()*a/100;
            }
        },
        {
            attributeName: 'bonus_regen_pct',
            label: 'HEALTH GAINED PER SECOND:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return parent.health()*a/100;
            },
            returnProperty: 'healthregen'
        },
        {
            attributeName: 'bonus_movement_speed',
            label: '%MOVE SPEED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPct'
        }
    ],
    'sniper_shrapnel': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        },
        {
            attributeName: 'building_damage',
            label: 'BUILDING DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'slow_movement_speed',
            label: 'Enemy Movement Speed Slow',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'spectre_desolate': [
        {
            label: 'Enemy Alone',
            controlType: 'checkbox'
        },
        {
            attributeName: 'bonus_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return a;
                }
                else {
                    return 0;
                }
            },
            returnProperty: 'bonusDamage'
        }
    ],
    'spectre_dispersion': [
        {
            label: 'Damage Taken',
            controlType: 'input'
        },
        {
            attributeName: 'damage_reflection_pct',
            label: 'DAMAGE REFLECTED:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -a;
            },
            returnProperty: 'damageReduction'
        },
        {
            attributeName: 'damage_reflection_pct',
            label: 'DAMAGE REFLECTED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            }
        }
    ],
    'storm_spirit_ball_lightning': [
        {
            label: 'MAX MANA',
            controlType: 'input'
        },
        {
            label: 'Distance',
            controlType: 'input'
        },
        {
            attributeName: 'ball_lightning_initial_mana_base',
            label: 'Total Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0, 1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')/100*v[1];
            }
        },
        {
            attributeName: 'ball_lightning_initial_mana_base',
            label: 'FLAT MANA COST:',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [0, 1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var distance_intervals = Math.floor(v[1]/100);
                var travel_cost_base = abilityModel.getAbilityAttributeValue(ability.attributes, 'ball_lightning_travel_cost_base',0);
                return a + distance_intervals * travel_cost_base;
            }
        },
        {
            attributeName: 'ball_lightning_initial_mana_percentage',
            label: '%MAX MANA COST:',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [0, 1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var distance_intervals = Math.floor(v[1]/100);
                var travel_cost_percent = abilityModel.getAbilityAttributeValue(ability.attributes, 'ball_lightning_travel_cost_percent',0);
                return a + distance_intervals * travel_cost_percent;
            }
        },
        {
            attributeName: 'ball_lightning_initial_mana_base',
            label: 'TOTAL MANA COST:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0, 1, 2, 3],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[2] + ' + ' + (v[3]/100 * v[0]) + ' (' + v[3] + '% of max) = ' + (v[2] + v[3]/100 * v[0]);
            }
        }
    ],
    'templar_assassin_psionic_trap': [
        {
            label: 'Charge Time',
            controlType: 'input'
        },
        {
            attributeName: 'movement_speed_min_tooltip',
            label: '%MOVE SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var max_slow = abilityModel.getAbilityAttributeValue(ability.attributes, 'movement_speed_max_tooltip',0);
                var slow_per_tick = (max_slow - a)/40;
                return -(a + slow_per_tick * Math.min(Math.max(0, v), 4) * 10);
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'shredder_reactive_armor': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_armor',
            label: 'Total Armor Bonus',
            controlType: 'text',
            noLevel: true,
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'armor'
        },
        {
            attributeName: 'bonus_hp_regen',
            label: 'Total HP Regen Bonus',
            controlType: 'text',
            noLevel: true,
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'healthregen'
        }
    ],
    'shredder_chakram': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_second',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var interval = abilityModel.getAbilityAttributeValue(ability.attributes, 'damage_interval',0);
                var ticks = Math.floor(v / interval);
                return a*interval*ticks;
            }
        },
        {
            attributeName: 'mana_per_second',
            label: 'MANA COST:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var interval = abilityModel.getAbilityAttributeValue(ability.attributes, 'damage_interval',0);
                var ticks = Math.floor(v / interval);
                return a*interval*ticks;
            }
        },
        {
            label: 'ENEMY %HP',
            controlType: 'input'
        },
        {
            attributeName: 'slow',
            label: 'MANA COST:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var ticks = 20 - Math.floor(Math.min(Math.max(v-1, 0), 99) / 5);
                return -a*ticks;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'spirit_breaker_greater_bash': [
        {
            label: 'Bash Proc',
            controlType: 'checkbox'
        },
        {
            attributeName: 'damage',
            label: '%MOVESPEED AS DAMAGE',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return a;
                }
                else {
                    return 0;
                }
            },
            returnProperty: 'bashBonusDamage'
        },
        {
            attributeName: 'bonus_movespeed_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (v) {
                    return a;
                }
                else {
                    return 0;
                }
            },
            returnProperty: 'movementSpeedPct'
        },
        {
            attributeName: 'chance_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a
            },
            returnProperty: 'bash'
        }
    ],
    'techies_land_mines': [
        {
            label: 'Number of Mines',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'damage',
            label: 'AFTER REDUCTIONS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var phys_reduction = parent.enemy().totalArmorPhysicalReduction(),
                    magic_reduction = parent.enemy().totalMagicResistance();
                return (v * a * (1 - phys_reduction / 100) * (1 - magic_reduction / 100)).toFixed(2);
            }
        }
    ],
    'techies_suicide': [
        {
            attributeName: 'damage',
            label: 'FULL DAMAGE AFTER REDUCTIONS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var phys_reduction = parent.enemy().totalArmorPhysicalReduction(),
                    magic_reduction = parent.enemy().totalMagicResistance();
                return (a * (1 - phys_reduction / 100) * (1 - magic_reduction / 100)).toFixed(2);
            }
        },
        {
            attributeName: 'partial_damage',
            label: 'PARTIAL DAMAGE AFTER REDUCTIONS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var phys_reduction = parent.enemy().totalArmorPhysicalReduction(),
                    magic_reduction = parent.enemy().totalMagicResistance();
                return (a * (1 - phys_reduction / 100) * (1 - magic_reduction / 100)).toFixed(2);
            }
        },
        {
            attributeName: 'damage',
            label: 'RESPAWN TIME:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return (parent.respawnTime() / 2).toFixed(0) + ' seconds';
            }
        }
    ],
    'techies_remote_mines': [
        {
            label: 'Number of Mines',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'damage',
            label: 'AFTER REDUCTIONS:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var magic_reduction = parent.enemy().totalMagicResistance();
                return (v * a * (1 - magic_reduction / 100)).toFixed(2);
            }
        }
    ],
    'tinker_march_of_the_machines': [
        {
            label: 'Robot Explosions',
            controlType: 'input'
        },
        {
            attributeName: 'machines_per_sec',
            label: 'TOTAL DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'treant_leech_seed': [
        {
            label: 'Pulses',
            controlType: 'input'
        },
        {
            attributeName: 'leech_damage',
            label: 'DAMAGE/HEAL:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'movement_slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'troll_warlord_fervor': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'attack_speed',
            label: 'ATTACK SPEED:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'attackspeed'
        }
    ],
    'undying_decay': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'str_steal',
            label: 'STRENGTH STOLEN:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                if (parent.inventory.hasScepter()) {
                    var str_steal_scepter = abilityModel.getAbilityAttributeValue(ability.attributes, 'str_steal_scepter',0);
                    return v*str_steal_scepter;
                }
                else {
                    return v*a;
                }
            },
            returnProperty: 'bonusStrength'
        },
    ],
    'undying_soul_rip': [
        {
            label: 'Units',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_unit',
            label: 'DAMAGE/HEAL:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'undying_flesh_golem': [
        {
            label: 'Distance',
            controlType: 'input'
        },
        {
            attributeName: 'max_speed_slow',
            label: '%MOVE SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var min_speed_slow = abilityModel.getAbilityAttributeValue(ability.attributes, 'min_speed_slow', 0);
                var radius = abilityModel.getAbilityAttributeValue(ability.attributes, 'radius', 0);
                var full_power_radius = abilityModel.getAbilityAttributeValue(ability.attributes, 'full_power_radius', 0);
                var distance = Math.min(Math.max(v, full_power_radius), radius);
                var scale = 1 - (distance - full_power_radius) / (radius - full_power_radius);
                return -Math.max(scale * a, min_speed_slow);
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'max_damage_amp',
            label: '%DAMAGE AMP:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var min_damage_amp = abilityModel.getAbilityAttributeValue(ability.attributes, 'min_damage_amp', 0);
                var radius = abilityModel.getAbilityAttributeValue(ability.attributes, 'radius', 0);
                var full_power_radius = abilityModel.getAbilityAttributeValue(ability.attributes, 'full_power_radius', 0);
                var distance = Math.min(Math.max(v, full_power_radius), radius);
                var scale = 1 - (distance - full_power_radius) / (radius - full_power_radius);
                return Math.max(scale * a, min_damage_amp);
            },
            returnProperty: 'damageAmplification'
        },
        {
            label: 'MAX HP',
            controlType: 'input'
        },
        {
            label: 'Hero Death Count',
            controlType: 'input'
        },
        {
            label: 'Creep Death Count',
            controlType: 'input'
        },
        {
            attributeName: 'death_heal',
            label: 'DEATH HEAL (HEROES):',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [1, 2],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]*v[1]*a/100;
            }
        },
        {
            attributeName: 'death_heal_creep',
            label: 'DEATH HEAL (CREEPS):',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [1, 3],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]*v[1]*a/100;
            }
        },
        {
            attributeName: 'death_heal_creep',
            label: 'TOTAL DEATH HEAL:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [4, 5],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v[0]+v[1];
            }
        }
    ],
    'ursa_fury_swipes': [
        {
            label: 'Stacks',
            controlType: 'input'
        },
        {
            attributeName: 'damage_per_stack',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var enrageAbility = abilityModel.abilities.find(function(b) {
                    return b.name == 'ursa_enrage';
                });
                if (enrageAbility.isActive() && enrageAbility.level() > 0) {
                    var enrage_multiplier = abilityModel.getAbilityAttributeValue(enrageAbility.attributes, 'enrage_multiplier', enrageAbility.level());
                    return v*a*enrage_multiplier;
                }
                return v*a;
            },
            returnProperty: 'bonusDamage'
        }
    ],
    'ursa_enrage': [
        {
            attributeName: 'damage_reduction',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -a;
            },
            returnProperty: 'damageReduction'
        }
    ],
    'venomancer_venomous_gale': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'tick_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityAttributeValue(ability.attributes, 'strike_damage',ability.level()) + Math.floor(v/3)*a;
            }
        },
        {
            attributeName: 'movement_slow',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'venomancer_poison_sting': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'movement_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'venomancer_poison_nova': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'viper_poison_attack': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'bonus_movement_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'bonus_attack_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeedreduction'
        }
    ],
    'viper_corrosive_skin': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'bonus_movement_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'bonus_attack_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeedreduction'
        },
        {
            attributeName: 'bonus_magic_resistance',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'magicResist'
        }
    ],
    'viper_viper_strike': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'bonus_movement_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'movementSpeedPctReduction'
        },
        {
            attributeName: 'bonus_attack_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeedreduction'
        }
    ],
    'visage_soul_assumption': [
        {
            label: 'Charges',
            controlType: 'input'
        },
        {
            attributeName: 'soul_charge_damage',
            label: 'Total Damage:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var soul_base_damage = abilityModel.getAbilityAttributeValue(ability.attributes, 'soul_base_damage',0);
                var stack_limit = abilityModel.getAbilityAttributeValue(ability.attributes, 'stack_limit', ability.level());
                stack_limit = Math.max(Math.min(v, stack_limit), 0);
                return soul_base_damage + stack_limit*a;
            }
        }
    ],
    'visage_gravekeepers_cloak': [
        {
            label: 'Layers',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_armor',
            label: 'ARMOR:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'armor'
        },
        {
            attributeName: 'bonus_resist',
            label: '%RESIST:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            },
            returnProperty: 'magicResist'
        }
    ],
    'warlock_shadow_word': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'warlock_upheaval': [
        {
            label: 'Channel Duration',
            controlType: 'input'
        },
        {
            attributeName: 'slow_rate_duration',
            label: '%MOVE SLOW:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var max_slow = abilityModel.getAbilityAttributeValue(ability.attributes, 'max_slow',0);
                var slow_per_tick = max_slow / (a - 0.5) / 2;
                var ticks = Math.max(Math.floor(v * 2) - 1, 0);
                return -Math.min(ticks * slow_per_tick, max_slow);
            },
            returnProperty: 'movementSpeedPctReduction'
        }
    ],
    'weaver_the_swarm': [
        {
            label: 'Attacks',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'armor_reduction',
            label: 'DAMAGE:',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return -v*a;
            },
            returnProperty: 'armorReduction'
        }
    ],
    'windrunner_powershot': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*v;
            }
        }
    ],
    'winter_wyvern_cold_embrace': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            label: 'Ally Max Health',
            controlType: 'input'
        },
        {
            attributeName: 'heal_percentage',
            label: 'TOTAL HEAL:',
            ignoreTooltip: true,
            controlType: 'text',
            controls: [0,1],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var base_heal = abilityModel.getAbilityAttributeValue(ability.attributes, 'heal_additive',ability.level());
                return (base_heal + v[1] * a/100) * v[0];
            }
        }
    ],
    'wisp_spirits': [
        {
            label: 'Collision Count',
            controlType: 'input'
        },
        {
            attributeName: 'hero_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'creep_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'wisp_overcharge': [
        {
            label: 'Current HP',
            controlType: 'input'
        },
        {
            attributeName: 'drain_pct',
            label: 'HP DRAINED:',
            ignoreTooltip: true, 
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            label: 'Current MP',
            controlType: 'input'
        },
        {
            attributeName: 'drain_pct',
            label: 'MP DRAINED:',
            ignoreTooltip: true, 
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        },
        {
            attributeName: 'bonus_attack_speed',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'attackspeed'
        },
        {
            attributeName: 'bonus_damage_pct',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return a;
            },
            returnProperty: 'damageReduction'
        }
    ],
    'witch_doctor_paralyzing_cask': [
        {
            label: 'Hero Bounce Count',
            controlType: 'input'
        },
        {
            attributeName: 'hero_damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var bounces = abilityModel.getAbilityAttributeValue(ability.attributes, 'bounces',ability.level());
                return Math.min(Math.max(v, 0), bounces)*a;
            }
        },
        {
            label: 'Creep Bounce Count',
            controlType: 'input'
        },
        {
            attributeName: 'hero_damage',
            label: 'CREEP DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var bounces = abilityModel.getAbilityAttributeValue(ability.attributes, 'bounces',ability.level());
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                return Math.min(Math.max(v, 0), bounces)*damage;
            }
        }
    ],
    'witch_doctor_voodoo_restoration': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'heal',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var interval = abilityModel.getAbilityAttributeValue(ability.attributes, 'heal_interval',ability.level());
                var heal_per_tick = a * interval;
                var ticks = Math.max(Math.floor(v / interval) - 1, 0);
                return heal_per_tick * ticks;
            }
        },
        {
            attributeName: 'mana_per_second',
            label: 'MANA COST:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var interval = abilityModel.getAbilityAttributeValue(ability.attributes, 'heal_interval',ability.level());
                var mana_per_tick = a * interval;
                var ticks = Math.max(Math.floor(v / interval) - 1, 0);
                return mana_per_tick * ticks;
            }
        }
    ],
    'witch_doctor_maledict': [
        {
            label: 'damage 0-4s',
            controlType: 'input'
        },
        {
            label: 'damage 4-8s',
            controlType: 'input'
        },
        {
            label: 'damage 8-12s',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_damage',
            label: 'Dot Damage after 3s:',
            ignoreTooltip: true,
            controlType: 'method',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                return 3*damage;
            }
        },
        {
            attributeName: 'bonus_damage',
            label: 'Burst Damage at 4s:',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [0, 3],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                var d = v.reduce(function (memo, o) { return memo + o }, 0);
                return Math.max(d, 0) * a/100;
            }
        },
        {
            attributeName: 'bonus_damage',
            label: 'Dot Damage after 7s:',
            ignoreTooltip: true,
            controlType: 'method',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                return 7*damage;
            }
        },
        {
            attributeName: 'bonus_damage',
            label: 'Burst Damage at 8s:',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [0, 1, 4, 5],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                var d = v.reduce(function (memo, o) { return memo + o }, 0);
                return Math.max(d, 0) * a/100;
            }
        },
        {
            attributeName: 'bonus_damage',
            label: 'Dot Damage after 11s:',
            ignoreTooltip: true,
            controlType: 'method',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                return 11*damage;
            }
        },
        {
            attributeName: 'bonus_damage',
            label: 'Burst Damage at 12s:',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [0, 1, 2, 4, 6, 7],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                var d = v.reduce(function (memo, o) { return memo + o }, 0);
                return Math.max(d, 0) * a/100;
            }
        },
        {
            attributeName: 'bonus_damage',
            label: 'Total Burst Damage:',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [4, 6, 8],
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v.reduce(function (memo, o) { return memo + o }, 0);
            }
        },
        {
            attributeName: 'bonus_damage',
            label: 'Total Maledict Damage:',
            ignoreTooltip: true,
            controlType: 'method',
            controls: [9],
            fn: function (v, a, parent, index, abilityModel, ability) {
                var duration = abilityModel.getAbilityAttributeValue(ability.attributes, 'duration_tooltip',0);
                var damage = abilityModel.getAbilityPropertyValue(ability, 'damage');
                return damage * duration + v[0];
            }
        },
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'bonus_damage',
            label: 'DOT Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                var duration = abilityModel.getAbilityAttributeValue(ability.attributes, 'duration_tooltip',0);
                return abilityModel.getAbilityPropertyValue(ability, 'damage')*Math.min(Math.max(v, 0), duration);
            }
        }
    ],
    'witch_doctor_death_ward': [
        {
            label: 'Duration',
            controlType: 'input'
        },
        {
            attributeName: 'damage',
            label: 'Total Damage',
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a;
            }
        }
    ],
    'zuus_static_field': [
        {
            label: 'Enemy HP',
            controlType: 'input'
        },
        {
            attributeName: 'damage_health_pct',
            label: 'DAMAGE:',
            ignoreTooltip: true,
            controlType: 'text',
            fn: function (v, a, parent, index, abilityModel, ability) {
                return v*a/100;
            }
        }
    ]
}
},{"./herocalc_core":4}],3:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');
    
var my = require("./herocalc_core");

my.prototype.BuffOption = function (hero, ability) {
    this.buffName = ability;
    if (my.prototype.heroData['npc_dota_hero_' + hero] == undefined) {
        this.hero = hero;
        this.abilityData = my.prototype.findWhere(my.prototype.unitData[hero].abilities, {name: ability})
        this.buffDisplayName = my.prototype.unitData[hero].displayname + ' - ' + this.abilityData.displayname;
    }
    else {
        this.hero = 'npc_dota_hero_' + hero;
        this.abilityData = my.prototype.findWhere(my.prototype.heroData['npc_dota_hero_' + hero].abilities, {name: ability})
        this.buffDisplayName = my.prototype.heroData['npc_dota_hero_' + hero].displayname + ' - ' + this.abilityData.displayname;        
        if (ability == 'sven_gods_strength') {
            this.buffDisplayName += ' (Aura for allies)';
        }
    }

};

my.prototype.ItemBuffOption = function (item) {
    this.buffName = item;
    if (my.prototype.heroData['npc_dota_hero_' + hero] == undefined) {
        this.hero = hero;
        this.abilityData = my.prototype.findWhere(my.prototype.unitData[hero].abilities, {name: item})
        this.buffDisplayName = my.prototype.unitData[hero].displayname + ' - ' + this.abilityData.displayname;        
    }
    else {
        this.hero = 'npc_dota_hero_' + hero;
        this.abilityData = my.prototype.findWhere(my.prototype.heroData['npc_dota_hero_' + hero].abilities, {name: item})
        this.buffDisplayName = my.prototype.heroData['npc_dota_hero_' + hero].displayname + ' - ' + this.abilityData.displayname;        
    }

};

my.prototype.BuffViewModel = function (a) {
    var self = new my.prototype.AbilityModel(ko.observableArray([]));
    self.availableBuffs = ko.observableArray(my.prototype.availableBuffs);
    self.availableDebuffs = ko.observableArray(my.prototype.availableDebuffs);
    self.selectedBuff = ko.observable(self.availableBuffs()[0]);
    
    self.buffs = ko.observableArray([]);
    self.itemBuffs = new my.prototype.InventoryViewModel();
    
    self.addBuff = function (data, event) {
        if (my.prototype.findWhere(self.buffs(), { name: self.selectedBuff().buffName })  == undefined) {
            var a = ko.wrap.fromJS(self.selectedBuff().abilityData);
            a.isActive = ko.observable(false);
            a.isDetail = ko.observable(false);
            a.baseDamage = ko.observable(0);
            a.bash = ko.observable(0);
            a.bashBonusDamage = ko.observable(0);
            a.bonusDamage = ko.observable(0);
            a.bonusDamageOrb = ko.observable(0);
            a.bonusDamagePct = ko.observable(0);
            a.bonusDamagePrecisionAura = ko.observable(0);
            a.bonusDamageReduction = ko.observable(0);
            a.bonusHealth = ko.observable(0);
            a.bonusStrength = ko.observable(0);
            a.bonusStrength2 = ko.observable(0);
            a.bonusAgility = ko.observable(0);
            a.bonusAgility2 = ko.observable(0);
            a.bonusInt = ko.observable(0);
            a.bonusAllStatsReduction = ko.observable(0);
            a.damageAmplification = ko.observable(0);
            a.damageReduction = ko.observable(0);
            a.evasion = ko.observable(0);
            a.magicResist = ko.observable(0);
            a.manaregen = ko.observable(0);
            a.manaregenreduction = ko.observable(0);
            a.missChance = ko.observable(0);
            a.movementSpeedFlat = ko.observable(0);
            a.movementSpeedPct = ko.observable(0);
            a.movementSpeedPctReduction = ko.observable(0);
            a.turnRateReduction = ko.observable(0);
            a.attackrange = ko.observable(0);
            a.attackspeed = ko.observable(0);
            a.attackspeedreduction = ko.observable(0);
            a.armor = ko.observable(0);
            a.armorReduction = ko.observable(0);
            a.healthregen = ko.observable(0);
            a.lifesteal = ko.observable(0);
            a.visionnight = ko.observable(0);
            a.visionday = ko.observable(0);
            switch (a.name) {
                case 'invoker_cold_snap':
                case 'invoker_ghost_walk':
                case 'invoker_tornado':
                case 'invoker_emp':
                case 'invoker_alacrity':
                case 'invoker_chaos_meteor':
                case 'invoker_sun_strike':
                case 'invoker_forge_spirit':
                case 'invoker_ice_wall':
                case 'invoker_deafening_blast':
                    a.level(1);
                break;
            }
            self.abilities.push(a);
            self.buffs.push({ name: self.selectedBuff().buffName, hero: self.selectedBuff().hero, data: a });
        }
    };
    
    self.removeBuff = function (data, event, abilityName) {
        if (my.prototype.findWhere(self.buffs(), { name: abilityName })  != undefined) {
                self.buffs.remove(my.prototype.findWhere(self.buffs(), { name: abilityName }));
                if (self.abilityControlData[abilityName] != undefined) {
                    for (var i = 0; i < self.abilityControlData[abilityName].data.length; i++) {
                        if (self.abilityControlData[abilityName].data[i].controlVal.dispose != undefined) {
                            self.abilityControlData[abilityName].data[i].controlVal.dispose();
                        }
                        if (self.abilityControlData[abilityName].data[i].clean != undefined) {
                            self.abilityControlData[abilityName].data[i].clean.dispose();
                        }
                    }
                    self.abilityControlData[abilityName] = undefined;
                }
                for (var i = 0; i < self.abilities.length; i++) {
                    if (self.abilities[i].name == abilityName) {
                        self.abilities[i].level(0);
                        self.abilities.remove(self.abilities[i]);
                        break;
                    }
                }
        }
    };
    self.toggleBuff = function (index, data, event) {
        if (self.buffs()[index()].data.behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE') < 0) {
            if (self.buffs()[index()].data.isActive()) {
                self.buffs()[index()].data.isActive(false);
                self.abilities[index()].isActive(false);
            }
            else {
                self.buffs()[index()].data.isActive(true);
                self.abilities[index()].isActive(true);
            }
        }
    }.bind(this);

    self.toggleBuffDetail = function (index, data, event) {
        if (self.buffs()[index()].data.isDetail()) {
            self.buffs()[index()].data.isDetail(false);
        }
        else {
            self.buffs()[index()].data.isDetail(true);
        }
    }.bind(this);

    // Overrides the ability module function to remove available skill point check
    self.levelUpAbility = function (index, data, event, hero) {
        if (self.abilities[index()].level() < hero.getAbilityLevelMax(data)) {
            switch(self.abilities[index()].abilitytype) {
                case 'DOTA_ABILITY_TYPE_ULTIMATE':
                    self.abilities[index()].level(self.abilities[index()].level() + 1);
                break;
                default:
                    self.abilities[index()].level(self.abilities[index()].level() + 1);
                break;
            }
            switch (self.abilities[index()].name) {
                case 'beastmaster_call_of_the_wild':
                case 'chen_test_of_faith':
                case 'morphling_morph_agi':
                case 'shadow_demon_shadow_poison':
                    self.abilities[index() + 1].level(self.abilities[index()].level());
                break;
                case 'morphling_morph_str':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                break;
                case 'keeper_of_the_light_spirit_form':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                    self.abilities[index() - 2].level(self.abilities[index()].level());
                case 'nevermore_shadowraze1':
                    self.abilities[index() + 1].level(self.abilities[index()].level());
                    self.abilities[index() + 2].level(self.abilities[index()].level());
                break;
                case 'nevermore_shadowraze2':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                    self.abilities[index() + 1].level(self.abilities[index()].level());
                break;
                case 'nevermore_shadowraze3':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                    self.abilities[index() - 2].level(self.abilities[index()].level());
                break;
            }
        }
    };
    self.levelDownAbility = function (index, data, event, hero) {
        if (self.abilities[index()].level() > 0) {
            self.abilities[index()].level(self.abilities[index()].level() - 1);
            switch (self.abilities[index()].name) {
                case 'beastmaster_call_of_the_wild':
                case 'chen_test_of_faith':
                case 'morphling_morph_agi':
                case 'shadow_demon_shadow_poison':
                    self.abilities[index() + 1].level(self.abilities[index()].level());
                break;
                case 'morphling_morph_str':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                break;
                case 'keeper_of_the_light_spirit_form':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                    self.abilities[index() - 2].level(self.abilities[index()].level());
                case 'nevermore_shadowraze1':
                    self.abilities[index() + 1].level(self.abilities[index()].level());
                    self.abilities[index() + 2].level(self.abilities[index()].level());
                break;
                case 'nevermore_shadowraze2':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                    self.abilities[index() + 1].level(self.abilities[index()].level());
                break;
                case 'nevermore_shadowraze3':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                    self.abilities[index() - 2].level(self.abilities[index()].level());
                break;
                case 'ember_spirit_fire_remnant':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                break;
                case 'lone_druid_true_form':
                    self.abilities[index() - 1].level(self.abilities[index()].level());
                break;
            }
        }
    };
    
    return self;
}
},{"./herocalc_core":4,"./herocalc_knockout":10}],4:[function(require,module,exports){
'use strict';
require('./polyfill');

function HEROCALCULATOR () {
   // ...
}

var my = HEROCALCULATOR;

my.prototype.heroData = {};
my.prototype.itemData = {};
my.prototype.unitData = {};
my.prototype.abilityData = {};

my.prototype.HeroOptions = [];

my.prototype.HeroOption = function (name, displayname, hero) {
    this.heroName = name;
    this.heroDisplayName = displayname;
    this.hero = hero;
};

my.prototype.idCounter = 0;
my.prototype.uniqueId = function (prefix) {
    var id = ++my.prototype.idCounter + '';
    return prefix ? prefix + id : id;
};
my.prototype.findWhere = function (arr, obj) {
    arrLoop: for (var i = 0; i < arr.length; i++) {
        objLoop: for (var key in obj) {
            if (arr[i][key] != obj[key]) {
                continue arrLoop;
            }
        }
        return arr[i];
    }
}
my.prototype.uniques = function (arr) {
    var a = [];
    for (var i=0, l=arr.length; i<l; i++)
        if (a.indexOf(arr[i]) === -1 && arr[i] !== '')
            a.push(arr[i]);
    return a;
}
my.prototype.union = function (a, b) {
    var arr = a.concat(b);
    return my.prototype.uniques(arr);
}

my.prototype.totalResources = 3;
my.prototype.numResourcesLoaded = 0;
my.prototype.onResourceLoaded = function (callback) {
    my.prototype.numResourcesLoaded++;
    if (my.prototype.numResourcesLoaded == my.prototype.totalResources) {
        
        my.prototype.availableBuffs = [
            new my.prototype.BuffOption('abaddon', 'abaddon_frostmourne'),
            new my.prototype.BuffOption('axe', 'axe_culling_blade'),
            new my.prototype.BuffOption('beastmaster', 'beastmaster_inner_beast'),
            new my.prototype.BuffOption('bloodseeker', 'bloodseeker_bloodrage'),
            new my.prototype.BuffOption('bounty_hunter', 'bounty_hunter_track'),
            new my.prototype.BuffOption('centaur', 'centaur_stampede'),
            new my.prototype.BuffOption('crystal_maiden', 'crystal_maiden_brilliance_aura'),
            new my.prototype.BuffOption('dark_seer', 'dark_seer_surge'),
            new my.prototype.BuffOption('dazzle', 'dazzle_weave'),
            new my.prototype.BuffOption('drow_ranger', 'drow_ranger_trueshot'),
            new my.prototype.BuffOption('invoker', 'invoker_alacrity'),
            new my.prototype.BuffOption('wisp', 'wisp_tether'),
            new my.prototype.BuffOption('wisp', 'wisp_overcharge'),
            new my.prototype.BuffOption('kunkka', 'kunkka_ghostship'),
            new my.prototype.BuffOption('lich', 'lich_frost_armor'),
            new my.prototype.BuffOption('life_stealer', 'life_stealer_open_wounds'),
            new my.prototype.BuffOption('luna', 'luna_lunar_blessing'),
            new my.prototype.BuffOption('lycan', 'lycan_howl'),
            new my.prototype.BuffOption('magnataur', 'magnataur_empower'),
            new my.prototype.BuffOption('mirana', 'mirana_leap'),
            new my.prototype.BuffOption('ogre_magi', 'ogre_magi_bloodlust'),
            new my.prototype.BuffOption('omniknight', 'omniknight_guardian_angel'),
            new my.prototype.BuffOption('rubick', 'rubick_null_field'),
            new my.prototype.BuffOption('skeleton_king', 'skeleton_king_vampiric_aura'),
            new my.prototype.BuffOption('spirit_breaker', 'spirit_breaker_empowering_haste'),
            new my.prototype.BuffOption('sven', 'sven_warcry'),
            new my.prototype.BuffOption('sven', 'sven_gods_strength'),
            new my.prototype.BuffOption('treant', 'treant_living_armor'),
            new my.prototype.BuffOption('troll_warlord', 'troll_warlord_battle_trance'),
            new my.prototype.BuffOption('vengefulspirit', 'vengefulspirit_command_aura'),
            new my.prototype.BuffOption('npc_dota_neutral_alpha_wolf', 'alpha_wolf_critical_strike'),
            new my.prototype.BuffOption('npc_dota_neutral_alpha_wolf', 'alpha_wolf_command_aura'),
            new my.prototype.BuffOption('npc_dota_neutral_polar_furbolg_ursa_warrior', 'centaur_khan_endurance_aura'),
            new my.prototype.BuffOption('npc_dota_neutral_giant_wolf', 'giant_wolf_critical_strike'),
            new my.prototype.BuffOption('npc_dota_neutral_kobold_taskmaster', 'kobold_taskmaster_speed_aura'),
            new my.prototype.BuffOption('npc_dota_neutral_ogre_magi', 'ogre_magi_frost_armor'),
            new my.prototype.BuffOption('npc_dota_neutral_satyr_hellcaller', 'satyr_hellcaller_unholy_aura'),
            new my.prototype.BuffOption('npc_dota_neutral_enraged_wildkin', 'enraged_wildkin_toughness_aura'),
            new my.prototype.BuffOption('npc_dota_necronomicon_archer_1', 'necronomicon_archer_aoe')
        ];

        my.prototype.availableDebuffs = [
            new my.prototype.BuffOption('abaddon', 'abaddon_frostmourne'),
            new my.prototype.BuffOption('alchemist', 'alchemist_acid_spray'),
            new my.prototype.BuffOption('ancient_apparition', 'ancient_apparition_ice_vortex'),
            new my.prototype.BuffOption('axe', 'axe_battle_hunger'),
            new my.prototype.BuffOption('bane', 'bane_enfeeble'),
            new my.prototype.BuffOption('batrider', 'batrider_sticky_napalm'),
            new my.prototype.BuffOption('beastmaster', 'beastmaster_primal_roar'),
            new my.prototype.BuffOption('bounty_hunter', 'bounty_hunter_jinada'),
            new my.prototype.BuffOption('brewmaster', 'brewmaster_thunder_clap'),
            new my.prototype.BuffOption('brewmaster', 'brewmaster_drunken_haze'),
            new my.prototype.BuffOption('bristleback', 'bristleback_viscous_nasal_goo'),
            new my.prototype.BuffOption('broodmother', 'broodmother_incapacitating_bite'),
            new my.prototype.BuffOption('centaur', 'centaur_stampede'),
            new my.prototype.BuffOption('chen', 'chen_penitence'),
            new my.prototype.BuffOption('crystal_maiden', 'crystal_maiden_crystal_nova'),
            new my.prototype.BuffOption('crystal_maiden', 'crystal_maiden_freezing_field'),
            new my.prototype.BuffOption('dazzle', 'dazzle_weave'),
            new my.prototype.BuffOption('drow_ranger', 'drow_ranger_frost_arrows'),
            new my.prototype.BuffOption('earth_spirit', 'earth_spirit_rolling_boulder'),
            new my.prototype.BuffOption('elder_titan', 'elder_titan_natural_order'),
            new my.prototype.BuffOption('elder_titan', 'elder_titan_earth_splitter'),
            new my.prototype.BuffOption('enchantress', 'enchantress_untouchable'),
            new my.prototype.BuffOption('enchantress', 'enchantress_enchant'),
            new my.prototype.BuffOption('faceless_void', 'faceless_void_time_walk'),
            new my.prototype.BuffOption('huskar', 'huskar_life_break'),
            new my.prototype.BuffOption('invoker', 'invoker_ghost_walk'),
            new my.prototype.BuffOption('invoker', 'invoker_ice_wall'),
            new my.prototype.BuffOption('wisp', 'wisp_tether'),
            new my.prototype.BuffOption('jakiro', 'jakiro_dual_breath'),
            new my.prototype.BuffOption('jakiro', 'jakiro_liquid_fire'),
            new my.prototype.BuffOption('keeper_of_the_light', 'keeper_of_the_light_blinding_light'),
            new my.prototype.BuffOption('kunkka', 'kunkka_torrent'),
            new my.prototype.BuffOption('lich', 'lich_frost_nova'),
            new my.prototype.BuffOption('lich', 'lich_frost_armor'),
            new my.prototype.BuffOption('lich', 'lich_chain_frost'),
            new my.prototype.BuffOption('life_stealer', 'life_stealer_open_wounds'),
            new my.prototype.BuffOption('lion', 'lion_voodoo'),
            new my.prototype.BuffOption('magnataur', 'magnataur_skewer'),
            new my.prototype.BuffOption('medusa', 'medusa_stone_gaze'),
            new my.prototype.BuffOption('meepo', 'meepo_geostrike'),
            new my.prototype.BuffOption('naga_siren', 'naga_siren_rip_tide'),
            new my.prototype.BuffOption('night_stalker', 'night_stalker_void'),
            new my.prototype.BuffOption('night_stalker', 'night_stalker_crippling_fear'),
            new my.prototype.BuffOption('night_stalker', 'night_stalker_darkness'),
            new my.prototype.BuffOption('ogre_magi', 'ogre_magi_ignite'),
            new my.prototype.BuffOption('omniknight', 'omniknight_degen_aura'),
            new my.prototype.BuffOption('phantom_assassin', 'phantom_assassin_stifling_dagger'),
            new my.prototype.BuffOption('phantom_lancer', 'phantom_lancer_spirit_lance'),
            new my.prototype.BuffOption('pudge', 'pudge_rot'),
            new my.prototype.BuffOption('pugna', 'pugna_decrepify'),
            new my.prototype.BuffOption('queenofpain', 'queenofpain_shadow_strike'),
            new my.prototype.BuffOption('riki', 'riki_smoke_screen'),
            new my.prototype.BuffOption('rubick', 'rubick_fade_bolt'),
            new my.prototype.BuffOption('sand_king', 'sandking_epicenter'),
            new my.prototype.BuffOption('nevermore', 'nevermore_dark_lord'),
            new my.prototype.BuffOption('shadow_shaman', 'shadow_shaman_voodoo'),
            new my.prototype.BuffOption('skeleton_king', 'skeleton_king_hellfire_blast'),
            new my.prototype.BuffOption('skeleton_king', 'skeleton_king_reincarnation'),
            new my.prototype.BuffOption('skywrath_mage', 'skywrath_mage_concussive_shot'),
            new my.prototype.BuffOption('skywrath_mage', 'skywrath_mage_ancient_seal'),
            new my.prototype.BuffOption('slardar', 'slardar_slithereen_crush'),
            new my.prototype.BuffOption('slardar', 'slardar_amplify_damage'),
            new my.prototype.BuffOption('slark', 'slark_essence_shift'),
            new my.prototype.BuffOption('sniper', 'sniper_shrapnel'),
            new my.prototype.BuffOption('spectre', 'spectre_spectral_dagger'),
            new my.prototype.BuffOption('storm_spirit', 'storm_spirit_overload'),
            new my.prototype.BuffOption('templar_assassin', 'templar_assassin_meld'),
            new my.prototype.BuffOption('tidehunter', 'tidehunter_gush'),
            new my.prototype.BuffOption('tinker', 'tinker_laser'),
            new my.prototype.BuffOption('treant', 'treant_leech_seed'),
            new my.prototype.BuffOption('tusk', 'tusk_frozen_sigil'),
            new my.prototype.BuffOption('undying', 'undying_flesh_golem'),
            new my.prototype.BuffOption('ursa', 'ursa_earthshock'),
            new my.prototype.BuffOption('vengefulspirit', 'vengefulspirit_wave_of_terror'),
            new my.prototype.BuffOption('vengefulspirit', 'vengefulspirit_command_aura'),
            new my.prototype.BuffOption('venomancer', 'venomancer_venomous_gale'),
            new my.prototype.BuffOption('venomancer', 'venomancer_poison_sting'),
            new my.prototype.BuffOption('viper', 'viper_poison_attack'),
            new my.prototype.BuffOption('viper', 'viper_corrosive_skin'),
            new my.prototype.BuffOption('viper', 'viper_viper_strike'),
            new my.prototype.BuffOption('visage', 'visage_grave_chill'),
            new my.prototype.BuffOption('warlock', 'warlock_upheaval'),
            new my.prototype.BuffOption('weaver', 'weaver_the_swarm'),
            new my.prototype.BuffOption('windrunner', 'windrunner_windrun'),
            new my.prototype.BuffOption('winter_wyvern', 'winter_wyvern_arctic_burn'),
            new my.prototype.BuffOption('winter_wyvern', 'winter_wyvern_splinter_blast'),
            new my.prototype.BuffOption('npc_dota_neutral_ghost', 'ghost_frost_attack'),
            new my.prototype.BuffOption('npc_dota_neutral_polar_furbolg_ursa_warrior', 'polar_furbolg_ursa_warrior_thunder_clap'),
            new my.prototype.BuffOption('npc_dota_neutral_ogre_magi', 'ogre_magi_frost_armor'),
            new my.prototype.BuffOption('npc_dota_neutral_satyr_trickster', 'satyr_trickster_purge'),
            new my.prototype.BuffOption('npc_dota_neutral_enraged_wildkin', 'enraged_wildkin_tornado')
        ];
        
        my.prototype.itemOptionsArr = [];
        for (var i = 0; i < my.prototype.validItems.length; i++) {
            my.prototype.itemOptionsArr.push(new my.prototype.ItemInput(my.prototype.validItems[i], my.prototype.itemData['item_' + my.prototype.validItems[i]].displayname));
        }
        
        var itemBuffs = ['assault', 'ancient_janggo', 'headdress', 'mekansm', 'pipe', 'ring_of_aquila', 'vladmir', 'ring_of_basilius', 'buckler', 'solar_crest'];
        my.prototype.itemBuffOptions = itemBuffs.map(function(item) {
            return new my.prototype.ItemInput(item, my.prototype.itemData['item_' + item].displayname);
        });
        
        var itemDebuffs = [
            {item: 'assault', debuff: null},
            {item: 'shivas_guard', debuff: null},
            {item: 'desolator', debuff: null},
            {item: 'medallion_of_courage', debuff: null},
            {item: 'radiance', debuff: null},
            {item: 'sheepstick', debuff: null},
            {item: 'veil_of_discord', debuff: null},
            {item: 'solar_crest', debuff: null},
            {item: 'silver_edge', debuff: {id: 'shadow_walk', name: 'Shadow Walk'}},
            {item: 'silver_edge', debuff: {id: 'maim', name: 'Lesser Maim'}}
        ]
        my.prototype.itemDebuffOptions = itemDebuffs.map(function(item) {
            return new my.prototype.ItemInput(item.item, my.prototype.itemData['item_' + item.item].displayname, item.debuff);
        });
        if (callback) callback();
    }
}

my.prototype.init = function (HERODATA_PATH,ITEMDATA_PATH,UNITDATA_PATH, callback) {
    my.prototype.numResourcesLoaded = 0;
    my.prototype.getJSON(HERODATA_PATH, function (data) {
        my.prototype.heroData = data;
        my.prototype.heroData['npc_dota_hero_chen'].abilities[2].behavior.push('DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE');
        my.prototype.heroData['npc_dota_hero_nevermore'].abilities[1].behavior.push('DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE');
        my.prototype.heroData['npc_dota_hero_nevermore'].abilities[2].behavior.push('DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE');
        my.prototype.heroData['npc_dota_hero_morphling'].abilities[3].behavior.push('DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE');
        my.prototype.heroData['npc_dota_hero_ogre_magi'].abilities[3].behavior.push('DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE');
        my.prototype.heroData['npc_dota_hero_techies'].abilities[4].behavior.push('DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE');
        my.prototype.heroData['npc_dota_hero_beastmaster'].abilities[2].behavior.push('DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE');
        var index = my.prototype.heroData['npc_dota_hero_lone_druid'].abilities[3].behavior.indexOf('DOTA_ABILITY_BEHAVIOR_HIDDEN');
        my.prototype.heroData['npc_dota_hero_lone_druid'].abilities[3].behavior.splice(index, 1);
        
        index = my.prototype.heroData['npc_dota_hero_abaddon'].abilities[2].behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE');
        my.prototype.heroData['npc_dota_hero_abaddon'].abilities[2].behavior.splice(index, 1);
        
        index = my.prototype.heroData['npc_dota_hero_riki'].abilities[2].behavior.indexOf('DOTA_ABILITY_BEHAVIOR_PASSIVE');
        my.prototype.heroData['npc_dota_hero_riki'].abilities[2].behavior.splice(index, 1);
        
        for (var h in my.prototype.heroData) {
            my.prototype.HeroOptions.push(new my.prototype.HeroOption(h.replace('npc_dota_hero_', ''), my.prototype.heroData[h].displayname));
        }
            
        my.prototype.onResourceLoaded(callback);
    });
    my.prototype.getJSON(ITEMDATA_PATH, function (data) {
        my.prototype.itemData = data;
        my.prototype.onResourceLoaded(callback);
    });
    my.prototype.getJSON(UNITDATA_PATH, function (data) {
        my.prototype.unitData = data;
        my.prototype.onResourceLoaded(callback);
    });
}

my.prototype.extend = function (out) {
    out = out || {};

    for (var i = 1; i < arguments.length; i++) {
        var obj = arguments[i];

        if (!obj)
            continue;

        for (var key in obj) {
            if (obj.hasOwnProperty(key)) {
                if (typeof obj[key] === 'object')
                    out[key] = deepExtend(out[key], obj[key]);
                else
                    out[key] = obj[key];
            }
        }
    }

    return out;
};

my.prototype.getJSON = function (url, successCallback, errorCallback) {
    var request = new XMLHttpRequest();
    request.open('GET', url, true);

    request.onload = function() {
        if (request.status >= 200 && request.status < 400) {
            // Success!
            var data = JSON.parse(request.responseText);
            successCallback(data);
        } else {
            // We reached our target server, but it returned an error
            errorCallback();
        }
    };

    request.onerror = function() {
        // There was a connection error of some sort
        errorCallback();
    };

    request.send();
}
module.exports = HEROCALCULATOR;
},{"./polyfill":13}],5:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');
    
var my = require("./herocalc_core");

my.prototype.illusionData = {
    chaos_knight_phantasm: {
        hero: 'chaos_knight',
        displayName: 'Chaos Knight Phantasm',
        use_selected_hero: false,
        max_level: 3,
        outgoing_damage: 'outgoing_damage',
        incoming_damage: 'incoming_damage'
    },
    naga_siren_mirror_image: {
        hero: 'naga_siren',
        displayName: 'Naga Siren Mirror Image',
        use_selected_hero: false,
        max_level: 4,
        outgoing_damage: 'outgoing_damage',
        incoming_damage: 'incoming_damage'
    },
    dark_seer_wall_of_replica: {
        hero: 'dark_seer',
        displayName: 'Dark Seer Wall of Replica',
        use_selected_hero: true,
        max_level: 3,
        outgoing_damage: 'replica_damage_outgoing',
        incoming_damage: 'replica_damage_incoming',
        outgoing_damage_scepter: 'replica_damage_outgoing_scepter'
    },
    morphling_replicate: {
        hero: 'morphling',
        displayName: 'Morphling Replicate',
        use_selected_hero: true,
        max_level: 3,
        outgoing_damage: 'illusion_damage_out_pct',
        incoming_damage: 'illusion_damage_in_pct'
    },
    phantom_lancer_doppelwalk: {
        hero: 'phantom_lancer',
        displayName: 'Phantom Lancer Doppelwalk',
        use_selected_hero: false,
        max_level: 4,
        outgoing_damage: 'illusion_damage_out_pct',
        incoming_damage: 'illusion_damage_in_pct'        
    },
    phantom_lancer_juxtapose: {
        hero: 'phantom_lancer',
        displayName: 'Phantom Lancer Juxtapose',
        use_selected_hero: false,
        max_level: 4,
        outgoing_damage: 'illusion_damage_out_pct',
        incoming_damage: 'illusion_damage_in_pct'        
    },
    phantom_lancer_spirit_lance: {
        hero: 'phantom_lancer',
        displayName: 'Phantom Lancer Spirit Lance',
        use_selected_hero: false,
        max_level: 4,
        outgoing_damage: 'illusion_damage_out_pct',
        incoming_damage: 'illusion_damage_in_pct'        
    },
    shadow_demon_disruption: {
        hero: 'shadow_demon',
        displayName: 'Shadow Demon Disruption',
        use_selected_hero: true,
        max_level: 4,
        outgoing_damage: 'illusion_outgoing_damage',
        incoming_damage: 'illusion_incoming_damage'        
    },
    spectre_haunt: {
        hero: 'spectre',
        displayName: 'Spectre Haunt',
        use_selected_hero: false,
        max_level: 3,
        outgoing_damage: 'illusion_damage_outgoing',
        incoming_damage: 'illusion_damage_incoming'        
    },
    terrorblade_conjure_image: {
        hero: 'terrorblade',
        displayName: 'Terrorblade Conjure Image',
        use_selected_hero: false,
        max_level: 4,
        outgoing_damage: 'illusion_outgoing_damage',
        incoming_damage: 'illusion_incoming_damage'        
    },
    terrorblade_reflection: {
        hero: 'terrorblade',
        displayName: 'Terrorblade Reflection',
        use_selected_hero: true,
        max_level: 4,
        outgoing_damage: 'illusion_outgoing_damage'     
    },
    item_manta: {
        hero: '',
        is_item: true,
        displayName: 'Manta Style Illusion',
        use_selected_hero: true,
        max_level: 1,
        outgoing_damage_melee: 'images_do_damage_percent_melee',
        incoming_damage_melee: 'images_take_damage_percent_melee',
        outgoing_damage_ranged: 'images_do_damage_percent_ranged',
        incoming_damage_ranged: 'images_take_damage_percent_ranged'
    }
}

my.prototype.IllusionViewModel = function (h, p, abilityLevel) {
    var self = new my.prototype.HeroModel(0);
    self.parent = p;
    self.inventory = self.parent.inventory;
    self.illusionType = ko.observable(self.parent.selectedIllusion().illusionName);
    self.illusionDisplayName = ko.observable(self.parent.selectedIllusion().illusionDisplayName);
    self.illusionAbilityLevel(abilityLevel);
    self.illusionAbilityMaxLevel = ko.observable(my.prototype.illusionData[self.parent.selectedIllusion().illusionName].max_level);
    if (!my.prototype.illusionData[self.illusionType()].use_selected_hero) {
        self.selectedHero(my.prototype.findWhere(self.availableHeroes(), {heroName: self.parent.selectedIllusion().baseHero}));
    }
    else {
        self.selectedHero(self.parent.selectedHero());
    }
    self.selectedHeroLevel(self.parent.selectedHeroLevel());
    self.hero = ko.computed(function() {
        return ko.wrap.fromJS(my.prototype.heroData['npc_dota_hero_' + self.selectedHero().heroName]);
    });
    
    self.ability().getAttributeBonusLevel = self.parent.ability().getAttributeBonusLevel;
    self.totalAgi = ko.computed(function () {
        return (self.heroData().attributebaseagility
                + self.heroData().attributeagilitygain * (self.selectedHeroLevel() - 1) 
                + self.inventory.getAttributes('agi') 
                + self.ability().getAttributeBonusLevel() * 2
                + self.ability().getAgility()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction()
               ).toFixed(2);
    });
    self.intStolen = ko.observable(0).extend({ numeric: 0 });
    self.totalInt = ko.computed(function () {
        return (self.heroData().attributebaseintelligence 
                + self.heroData().attributeintelligencegain * (self.selectedHeroLevel() - 1) 
                + self.inventory.getAttributes('int') 
                + self.ability().getAttributeBonusLevel() * 2
                + self.ability().getIntelligence()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction() + self.intStolen()
               ).toFixed(2);
    });
    self.totalStr = ko.computed(function () {
        return (self.heroData().attributebasestrength 
                + self.heroData().attributestrengthgain * (self.selectedHeroLevel() - 1) 
                + self.inventory.getAttributes('str') 
                + self.ability().getAttributeBonusLevel() * 2
                + self.ability().getStrength()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction()
               ).toFixed(2);
    });
    
    self.getAbilityAttributeValue = function(hero, ability, attributeName, level) {
        if (ability == 'item_manta') {
            var abilityObj = my.prototype.itemData[ability];
        }
        else {
            var abilityObj = my.prototype.findWhere(my.prototype.heroData['npc_dota_hero_' + hero].abilities, {name: ability});
        }
        var attribute = my.prototype.findWhere(abilityObj.attributes, {name: attributeName});
        if (level == 0) {
            return parseFloat(attribute.value[0]);
        }
        else if (level > attribute.length) {
            return parseFloat(attribute.value[0]);
        }
        else {
            return parseFloat(attribute.value[level - 1]);
        }
    }
    
    self.getIncomingDamageMultiplier = function(illusionType, hasScepter, attackType) {
        if (illusionType == 'item_manta') {
            if (attackType == 'DOTA_UNIT_CAP_MELEE_ATTACK') {
                return (1 + self.getAbilityAttributeValue(my.prototype.illusionData[self.illusionType()].hero, self.illusionType(), my.prototype.illusionData[illusionType].incoming_damage_melee, self.illusionAbilityLevel())/100)
            }
            else {
                return (1 + self.getAbilityAttributeValue(my.prototype.illusionData[self.illusionType()].hero, self.illusionType(), my.prototype.illusionData[illusionType].incoming_damage_ranged, self.illusionAbilityLevel())/100)
            }
        }
        else {
            return (1 + self.getAbilityAttributeValue(my.prototype.illusionData[self.illusionType()].hero, self.illusionType(), my.prototype.illusionData[illusionType].incoming_damage, self.illusionAbilityLevel())/100)
        }
    }
    self.getOutgoingDamageMultiplier = function(illusionType, hasScepter, attackType) {
        if (illusionType == 'item_manta') {
            if (attackType == 'DOTA_UNIT_CAP_MELEE_ATTACK') {
                return (1 + self.getAbilityAttributeValue(my.prototype.illusionData[self.illusionType()].hero, self.illusionType(), my.prototype.illusionData[illusionType].outgoing_damage_melee, self.illusionAbilityLevel())/100);
            }
            else {
                return (1 + self.getAbilityAttributeValue(my.prototype.illusionData[self.illusionType()].hero, self.illusionType(), my.prototype.illusionData[illusionType].outgoing_damage_ranged, self.illusionAbilityLevel())/100);
            }
        }
        else {
            return (1 + self.getAbilityAttributeValue(my.prototype.illusionData[self.illusionType()].hero, self.illusionType(), my.prototype.illusionData[illusionType].outgoing_damage, self.illusionAbilityLevel())/100);
        }
    }

    self.baseDamage = ko.computed(function() {
        return [Math.floor(my.prototype.heroData['npc_dota_hero_' + self.selectedHero().heroName].attackdamagemin + self.totalAttribute(self.primaryAttribute()) + self.ability().getBaseDamage().total)
                * self.getOutgoingDamageMultiplier(self.illusionType(), false, self.hero().attacktype()),
                Math.floor(my.prototype.heroData['npc_dota_hero_' + self.selectedHero().heroName].attackdamagemax + self.totalAttribute(self.primaryAttribute()) + self.ability().getBaseDamage().total)
                * self.getOutgoingDamageMultiplier(self.illusionType(), false, self.hero().attacktype())];
    });
    
    self.damage = ko.computed(function() {
        return [self.baseDamage()[0],
                self.baseDamage()[1]];
    });
    
    self.ehpPhysical = ko.computed(function() {
        var ehp = (self.health() * (1 + .06 * self.totalArmorPhysical())) / (1 - (1 - (self.inventory.getEvasion() * self.ability().getEvasion())))
        ehp *= (self.inventory.activeItems().some(function(item) {return item.item == 'mask_of_madness';}) ? (1 / 1.3) : 1);
        ehp *= (1 / self.getIncomingDamageMultiplier(self.illusionType(), false, self.hero().attacktype()));
        return ehp.toFixed(2);
    });
    self.ehpMagical = ko.computed(function() {
        var ehp = self.health() / self.totalMagicResistanceProduct();
        ehp *= (1 / self.getIncomingDamageMultiplier(self.illusionType(), false, self.hero().attacktype()));
        return ehp.toFixed(2);
    });
    
    self.totalArmorPhysical = ko.computed(function() {
        return (self.enemy().ability().getArmorBaseReduction() * self.debuffs.getArmorBaseReduction() * (my.prototype.heroData['npc_dota_hero_' + self.selectedHero().heroName].armorphysical + self.totalAgi() * .14)
                + self.ability().getArmor() + self.enemy().ability().getArmorReduction() + self.buffs.getArmor() + self.debuffs.getArmorReduction()).toFixed(2);
    });
    
    self.ias = ko.computed(function() {
        var val = parseFloat(self.totalAgi()) 
                + self.ability().getAttackSpeed() 
                + self.enemy().ability().getAttackSpeedReduction() 
                + self.buffs.getAttackSpeed() 
                + self.debuffs.getAttackSpeedReduction()
                + self.unit().ability().getAttackSpeed(); 
        if (val < -80) {
            return -80;
        }
        else if (val > 400) {
            return 400;
        }
        return val.toFixed(2);
    });
    
    return self;
}
},{"./herocalc_core":4,"./herocalc_knockout":10}],6:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');

var my = require("./herocalc_core");
require("./herocalc_hero_damage");

my.prototype.totalExp = [0, 200, 500, 900, 1400, 2000, 2600, 3400, 4400, 5400, 6000, 8200, 9000, 10400, 11900, 13500, 15200, 17000, 18900, 20900, 23000, 25200, 27500, 29900, 32400];
my.prototype.nextLevelExp = [200, 300, 400, 500, 600, 600, 800, 1000, 1000, 600, 2200, 800, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400, 2500, '&mdash;'];
my.prototype.diffProperties = [
    'totalAgi',
    'totalInt',
    'totalStr',
    'health',
    'healthregen',
    'mana',
    'manaregen',
    'totalArmorPhysical',
    'totalArmorPhysicalReduction',
    'totalMovementSpeed',
    'totalTurnRate',
    'baseDamage',
    'bonusDamage',
    'bonusDamageReduction',
    'damage',
    'totalMagicResistanceProduct',
    'totalMagicResistance',
    'bat',
    'ias',
    'attackTime',
    'attacksPerSecond',
    'evasion',
    'ehpPhysical',
    'ehpMagical',
    'bash',
    'critChance',
    //'critDamage',
    'missChance',
    'totalattackrange',
    'visionrangeday',
    'visionrangenight',
    'lifesteal'
];

my.prototype.IllusionOption = function (name, displayname, baseHero) {
    this.illusionName = name;
    this.illusionDisplayName = displayname;
    this.baseHero = baseHero;
};

my.prototype.createIllusionOptions = function () {
    var options = [];
    for (var h in my.prototype.illusionData) {
        options.push(new my.prototype.IllusionOption(h, my.prototype.illusionData[h].displayName, my.prototype.illusionData[h].hero));
    }
    return options;
}

my.prototype.HeroModel = function (h) {
    var self = this;
    self.heroId = ko.observable(h);
    self.selectedHeroLevel = ko.observable(1);
    self.inventory = new my.prototype.InventoryViewModel(self);
    self.selectedInventory = ko.observable(-1);
    self.buffs = new my.prototype.BuffViewModel();
    self.buffs.hasScepter = self.inventory.hasScepter;
    self.debuffs = new my.prototype.BuffViewModel();
    /*self.hero = ko.computed(function () {
        return ko.mapping.fromJS(my.prototype.heroData['npc_dota_hero_' + self.heroId()]);
    });*/
    self.heroData = ko.computed(function () {
      return my.prototype.heroData['npc_dota_hero_' + self.heroId()];
    });
    self.heroCompare = ko.observable(self);
    self.enemy = ko.observable(self);
    self.unit = ko.observable(self);
    self.clone = ko.observable(self);
    self.illusions = ko.observableArray([]);
    self.availableIllusions = ko.observableArray(my.prototype.createIllusionOptions());
    self.selectedIllusion = ko.observable(self.availableIllusions()[0]);
    self.illusionAbilityLevel = ko.observable(1);
    self.illusionAbilityMaxLevel = ko.computed(function () {
        return my.prototype.illusionData[self.selectedIllusion().illusionName].max_level;
    });
    
    self.skillPointHistory = ko.observableArray();
    
    self.ability = ko.computed(function () {
        var a = new my.prototype.AbilityModel(JSON.parse(JSON.stringify(self.heroData().abilities)), self);
        if (self.heroId() === 'earth_spirit' || self.heroId() === 'ogre_magi') {
            a.abilities[3].level(1);
        }
        else if (self.heroId() === 'invoker') {
            for (var i = 6; i < 16; i++) {
                a.abilities[i].level(1);
            }
        }
        self.skillPointHistory.removeAll();
        a.hasScepter = self.inventory.hasScepter
        return a;
    });

    self.availableSkillPoints = ko.computed(function () {
        var c = self.selectedHeroLevel();
        for (var i = 0; i < self.ability().abilities.length; i++) {
            var getIndex = function () {
                return i;
            };
            switch(self.ability().abilities[i].abilitytype) {
                case 'DOTA_ABILITY_TYPE_ULTIMATE':
                    if (self.heroId() === 'invoker') {
                        while (
                            ((self.ability().abilities[i].level() == 1) && (parseInt(self.selectedHeroLevel()) < 2)) ||
                            ((self.ability().abilities[i].level() == 2) && (parseInt(self.selectedHeroLevel()) < 7)) ||
                            ((self.ability().abilities[i].level() == 3) && (parseInt(self.selectedHeroLevel()) < 11)) ||
                            ((self.ability().abilities[i].level() == 4) && (parseInt(self.selectedHeroLevel()) < 17))
                        ) {
                            self.ability().levelDownAbility(getIndex, null, null, self);
                        }
                    }
                    else if (self.heroId() === 'meepo') {
                        while ((self.ability().abilities[i].level()-1) * 7 + 3 > parseInt(self.selectedHeroLevel())) {
                            self.ability().levelDownAbility(getIndex, null, null, self);
                        }
                    }
                    else {
                        while (self.ability().abilities[i].level() * 5 + 1 > parseInt(self.selectedHeroLevel())) {
                            self.ability().levelDownAbility(getIndex, null, null, self);
                        }
                    }
                break;
                default:
                    while (self.ability().abilities[i].level() * 2 - 1 > parseInt(self.selectedHeroLevel())) {
                        self.ability().levelDownAbility(getIndex, null, null, self);
                    }
                break;
            }
        }
        var getIndex = function () {
            return self.skillPointHistory()[self.skillPointHistory().length-1];
        };
        while (self.skillPointHistory().length > c) {
            self.ability().levelDownAbility(getIndex, null, null, self);
        }
        return c-self.skillPointHistory().length;
    }, this);
    self.primaryAttribute = ko.pureComputed(function () {
        var v = self.heroData().attributeprimary;
        if (v === 'DOTA_ATTRIBUTE_AGILITY') return 'agi';
        if (v === 'DOTA_ATTRIBUTE_INTELLECT') return 'int';
        if (v === 'DOTA_ATTRIBUTE_STRENGTH') return 'str';
        return '';
    });
    self.totalExp = ko.pureComputed(function () {
        return my.prototype.totalExp[self.selectedHeroLevel() - 1];
    });
    self.nextLevelExp = ko.pureComputed(function () {
        return my.prototype.nextLevelExp[self.selectedHeroLevel() - 1];
    });
    self.startingArmor = ko.pureComputed(function () {
        return (self.heroData().attributebaseagility * .14 + self.heroData().armorphysical).toFixed(2);
    });
    self.respawnTime = ko.pureComputed(function () {
        return 5 + 3.8 * self.selectedHeroLevel();
    });
    self.totalAttribute = function (a) {
        if (a === 'agi') return parseFloat(self.totalAgi());
        if (a === 'int') return parseFloat(self.totalInt());
        if (a === 'str') return parseFloat(self.totalStr());
        return 0;
    };
    self.totalAgi = ko.pureComputed(function () {
        return (self.heroData().attributebaseagility
                + self.heroData().attributeagilitygain * (self.selectedHeroLevel() - 1) 
                + self.inventory.getAttributes('agi') 
                + self.ability().getAttributeBonusLevel() * 2
                + self.ability().getAgility()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction()
               ).toFixed(2);
    });
    self.intStolen = ko.observable(0).extend({ numeric: 0 });
    self.totalInt = ko.pureComputed(function () {
        return (self.heroData().attributebaseintelligence 
                + self.heroData().attributeintelligencegain * (self.selectedHeroLevel() - 1) 
                + self.inventory.getAttributes('int') 
                + self.ability().getAttributeBonusLevel() * 2
                + self.ability().getIntelligence()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction() + self.intStolen()
               ).toFixed(2);
    });
    self.totalStr = ko.pureComputed(function () {
        return (self.heroData().attributebasestrength 
                + self.heroData().attributestrengthgain * (self.selectedHeroLevel() - 1) 
                + self.inventory.getAttributes('str') 
                + self.ability().getAttributeBonusLevel() * 2
                + self.ability().getStrength()
                + self.enemy().ability().getStrengthReduction()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction()
               ).toFixed(2);
    });
    self.health = ko.pureComputed(function () {
        return (self.heroData().statushealth + Math.floor(self.totalStr()) * 20 
                + self.inventory.getHealth()
                + self.ability().getHealth()).toFixed(2);
    });
    self.healthregen = ko.pureComputed(function () {
        var healthRegenAura = [self.inventory.getHealthRegenAura, self.buffs.itemBuffs.getHealthRegenAura].reduce(function (memo, fn) {
            var obj = fn(memo.excludeList);
            obj.value += memo.value;
            return obj;
        }, {value: 0, excludeList: []});
        return (self.heroData().statushealthregen + self.totalStr() * .03 
                + self.inventory.getHealthRegen() 
                + self.ability().getHealthRegen()
                + self.buffs.getHealthRegen()
                + healthRegenAura.value
                ).toFixed(2);
    });
    self.mana = ko.pureComputed(function () {
        return (self.heroData().statusmana
                + self.totalInt() * 12
                + self.inventory.getMana()
                + self.ability().getMana()).toFixed(2);
    });
    self.manaregen = ko.pureComputed(function () {
        return ((self.heroData().statusmanaregen 
                + self.totalInt() * .04 
                + self.ability().getManaRegen()) 
                * (1 + self.inventory.getManaRegenPercent()) 
                + (self.heroId() === 'crystal_maiden' ? self.ability().getManaRegenArcaneAura() * 2 : self.buffs.getManaRegenArcaneAura())
                + self.inventory.getManaRegenBloodstone()
                + self.inventory.getManaRegen()
                - self.enemy().ability().getManaRegenReduction()).toFixed(2);
    });
    self.totalArmorPhysical = ko.pureComputed(function () {
        var armorAura = [self.inventory.getArmorAura, self.buffs.itemBuffs.getArmorAura].reduce(function (memo, fn) {
            var obj = fn(memo.attributes);
            return obj;
        }, {value:0, attributes:[]});
        var armorReduction = [self.enemy().inventory.getArmorReduction, self.debuffs.itemBuffs.getArmorReduction].reduce(function (memo, fn) {
            var obj = fn(memo.excludeList);
            obj.value += memo.value;
            return obj;
        }, {value: 0, excludeList: []});
        return (self.enemy().ability().getArmorBaseReduction() * self.debuffs.getArmorBaseReduction() * (self.heroData().armorphysical + self.totalAgi() * .14)
                + self.inventory.getArmor()
                //+ self.inventory.getArmorAura().value
                //+ self.enemy().inventory.getArmorReduction()
                + self.ability().getArmor()
                + self.enemy().ability().getArmorReduction()
                + self.buffs.getArmor()
                + self.buffs.itemBuffs.getArmor()
                + self.debuffs.getArmorReduction()
                //+ self.buffs.itemBuffs.getArmorAura().value
                + armorAura.value
                + armorReduction.value
                //+ self.debuffs.getArmorReduction()
                ).toFixed(2);
    });
    self.totalArmorPhysicalReduction = ko.pureComputed(function () {
        var totalArmor = self.totalArmorPhysical();
        if (totalArmor >= 0) {
            return ((0.06 * self.totalArmorPhysical()) / (1 + 0.06 * self.totalArmorPhysical()) * 100).toFixed(2);
        }
        else {
            return -((0.06 * -self.totalArmorPhysical()) / (1 + 0.06 * -self.totalArmorPhysical()) * 100).toFixed(2);
        }
    });
    self.totalMovementSpeed = ko.pureComputed(function () {
        var MIN_MOVESPEED = 100;
        var ms = (self.ability().setMovementSpeed() > 0 ? self.ability().setMovementSpeed() : self.buffs.setMovementSpeed());
        if (ms > 0) {
            return ms;
        }
        else {
            var movementSpeedPercent = [self.inventory.getMovementSpeedPercent, self.buffs.itemBuffs.getMovementSpeedPercent].reduce(function (memo, fn) {
                var obj = fn(memo.excludeList);
                obj.value += memo.value;
                return obj;
            }, {value:0, excludeList:[]});
            var movementSpeedPercentReduction = [self.enemy().inventory.getMovementSpeedPercentReduction, self.debuffs.itemBuffs.getMovementSpeedPercentReduction].reduce(function (memo, fn) {
                var obj = fn(memo.excludeList);
                obj.value += memo.value;
                return obj;
            }, {value:0, excludeList:[]});
            return Math.max(
                self.enemy().inventory.isSheeped() || self.debuffs.itemBuffs.isSheeped() ? 140 :
                (self.heroData().movementspeed + self.inventory.getMovementSpeedFlat()+ self.ability().getMovementSpeedFlat()) * 
                (1 //+ self.inventory.getMovementSpeedPercent() 
                   + movementSpeedPercent.value
                   + movementSpeedPercentReduction.value
                   + self.ability().getMovementSpeedPercent() 
                   //+ self.enemy().inventory.getMovementSpeedPercentReduction() 
                   + self.enemy().ability().getMovementSpeedPercentReduction() 
                   + self.buffs.getMovementSpeedPercent() 
                   + self.debuffs.getMovementSpeedPercentReduction()
                   + self.unit().ability().getMovementSpeedPercent() 
                )
            , MIN_MOVESPEED).toFixed(2);
        }
    });
    self.totalTurnRate = ko.pureComputed(function () {
        return (self.heroData().movementturnrate 
                * (1 + self.enemy().ability().getTurnRateReduction()
                     + self.debuffs.getTurnRateReduction())).toFixed(2);
    });
    self.baseDamage = ko.pureComputed(function () {
        var totalAttribute = self.totalAttribute(self.primaryAttribute()),
            abilityBaseDamage = self.ability().getBaseDamage(),
            minDamage = self.heroData().attackdamagemin,
            maxDamage = self.heroData().attackdamagemax;
        return [Math.floor((minDamage + totalAttribute + abilityBaseDamage.total) * self.ability().getSelfBaseDamageReductionPct() * self.enemy().ability().getBaseDamageReductionPct() * self.debuffs.getBaseDamageReductionPct() * self.debuffs.itemBuffs.getBaseDamageReductionPct() * abilityBaseDamage.multiplier),
                Math.floor((maxDamage + totalAttribute + abilityBaseDamage.total) * self.ability().getSelfBaseDamageReductionPct() * self.enemy().ability().getBaseDamageReductionPct() * self.debuffs.getBaseDamageReductionPct() * self.debuffs.itemBuffs.getBaseDamageReductionPct() * abilityBaseDamage.multiplier)];
    });
    self.baseDamageAvg = ko.pureComputed(function () {
        return (self.baseDamage()[0] + self.baseDamage()[1]) / 2;
    });
    self.baseDamageMin = ko.pureComputed(function () {
        return self.baseDamage()[0];
    });
    self.baseDamageMax = ko.pureComputed(function () {
        return self.baseDamage()[1];
    });
    self.bonusDamage = ko.pureComputed(function () {
        return ((self.inventory.getBonusDamage().total
                + self.ability().getBonusDamage().total
                + self.buffs.getBonusDamage().total
                + Math.floor((self.baseDamage()[0] + self.baseDamage()[1]) / 2 
                              * (self.buffs.itemBuffs.getBonusDamagePercent(self.inventory.getBonusDamagePercent()).total
                                 + self.ability().getBonusDamagePercent().total
                                 + self.buffs.getBonusDamagePercent().total
                                )
                            )
                + Math.floor(
                    (self.heroData().attacktype == 'DOTA_UNIT_CAP_RANGED_ATTACK' 
                        ? ((self.heroId() == 'drow_ranger') ? self.ability().getBonusDamagePrecisionAura().total[0] * self.totalAgi() : self.buffs.getBonusDamagePrecisionAura().total[1])
                        : 0)
                  )
                + Math.floor(
                    ((self.heroId() == 'riki') ? self.ability().getBonusDamageBackstab().total[0] * self.totalAgi() : 0)
                  )
                ) * self.ability().getSelfBaseDamageReductionPct()
                  * self.enemy().ability().getBaseDamageReductionPct()
                  * self.debuffs.itemBuffs.getBaseDamageReductionPct());
    });
    self.bonusDamageReduction = ko.pureComputed(function () {
        return Math.abs(self.enemy().ability().getBonusDamageReduction() + self.debuffs.getBonusDamageReduction());
    });
    self.damageAvg = ko.pureComputed(function () {
        return (self.baseDamage()[0] + self.baseDamage()[1]) / 2 + self.bonusDamage();
    });
    self.damageMin = ko.pureComputed(function () {
        return self.baseDamage()[0] + self.bonusDamage();
    });
    self.damageMax = ko.pureComputed(function () {
        return self.baseDamage()[1] + self.bonusDamage();
    });
    self.damage = ko.pureComputed(function () {
        return [self.baseDamage()[0] + self.bonusDamage(),
                self.baseDamage()[1] + self.bonusDamage()];
    });
    self.totalMagicResistanceProduct = ko.pureComputed(function () {
        return (1 - self.heroData().magicalresistance / 100) 
                * self.inventory.getMagicResist()
                * self.ability().getMagicResist()
                * self.buffs.getMagicResist()
                * self.inventory.getMagicResistReductionSelf()
                * self.enemy().inventory.getMagicResistReduction()
                * self.enemy().ability().getMagicResistReduction()
                * self.debuffs.getMagicResistReduction()
                * self.debuffs.itemBuffs.getMagicResistReduction();
    });
    self.totalMagicResistance = ko.pureComputed(function () {
        return ((1 - self.totalMagicResistanceProduct()) * 100).toFixed(2);
    });
    self.bat = ko.pureComputed(function () {
        var abilityBAT = self.ability().getBAT();
        if (abilityBAT > 0) {
            return abilityBAT;
        }
        return self.heroData().attackrate;
    });
    self.ias = ko.pureComputed(function () {
        var attackSpeed = [self.inventory.getAttackSpeed, self.buffs.itemBuffs.getAttackSpeed].reduce(function (memo, fn) {
            var obj = fn(memo.excludeList);
            obj.value += memo.value;
            return obj;
        }, {value:0, excludeList:[]});
        var attackSpeedReduction = [self.enemy().inventory.getAttackSpeedReduction, self.debuffs.itemBuffs.getAttackSpeedReduction].reduce(function (memo, fn) {
            var obj = fn(memo.excludeList);
            obj.value += memo.value;
            return obj;
        }, {value:0, excludeList: []});
        var val = parseFloat(self.totalAgi()) 
                //+ self.inventory.getAttackSpeed() 
                + attackSpeed.value
                + attackSpeedReduction.value
                //+ self.enemy().inventory.getAttackSpeedReduction() 
                + self.ability().getAttackSpeed() 
                + self.enemy().ability().getAttackSpeedReduction() 
                + self.buffs.getAttackSpeed() 
                + self.debuffs.getAttackSpeedReduction()
                + self.unit().ability().getAttackSpeed(); 
        if (val < -80) {
            return -80;
        }
        else if (val > 500) {
            return 500;
        }
        return val.toFixed(2);
    });
    self.attackTime = ko.pureComputed(function () {
        return (self.bat() / (1 + self.ias() / 100)).toFixed(2);
    });
    self.attacksPerSecond = ko.pureComputed(function () {
        return ((1 + self.ias() / 100) / self.bat()).toFixed(2);
    });
    self.evasion = ko.pureComputed(function () {
        if (self.enemy().inventory.isSheeped() || self.debuffs.itemBuffs.isSheeped()) return 0;
        var e = self.ability().setEvasion();
        if (e) {
            return (e * 100).toFixed(2);
        }
        else {
            return ((1-(self.inventory.getEvasion() * self.ability().getEvasion() * self.ability().getEvasionBacktrack() * self.buffs.itemBuffs.getEvasion())) * 100).toFixed(2);
        }
    });
    self.ehpPhysical = ko.pureComputed(function () {
        var evasion = self.enemy().inventory.isSheeped() || self.debuffs.itemBuffs.isSheeped() ? 1 : self.inventory.getEvasion() * self.ability().getEvasion() * self.buffs.itemBuffs.getEvasion();
        if (self.totalArmorPhysical() >= 0) {
            var ehp = self.health() * (1 + .06 * self.totalArmorPhysical());
        }
        else {
            var ehp = self.health() * (1 - .06 * self.totalArmorPhysical()) / (1 - .12 * self.totalArmorPhysical());
        }
        ehp /= (1 - (1 - (evasion * self.ability().getEvasionBacktrack())));
        ehp /= (1 - parseFloat(self.enemy().missChance()) / 100);
        ehp *= (self.inventory.activeItems().some(function (item) {return item.item == 'mask_of_madness';}) ? (1 / 1.3) : 1);
        ehp *= (1 / self.ability().getDamageReduction());
        ehp *= (1 / self.buffs.getDamageReduction());
        ehp *= (1 / self.enemy().ability().getDamageAmplification());
        ehp *= (1 / self.debuffs.getDamageAmplification());
        return ehp.toFixed(2);
    });
    self.ehpMagical = ko.pureComputed(function () {
        var ehp = self.health() / self.totalMagicResistanceProduct();
        ehp *= (self.inventory.activeItems().some(function (item) {return item.item == 'mask_of_madness';}) ? (1 / 1.3) : 1);
        ehp *= (1 / self.ability().getDamageReduction());
        ehp *= (1 / self.buffs.getDamageReduction());
        ehp *= (1 / self.ability().getEvasionBacktrack());
        ehp *= (1 / self.enemy().ability().getDamageAmplification());
        ehp *= (1 / self.debuffs.getDamageAmplification());
        return ehp.toFixed(2);
    });
    self.bash = ko.pureComputed(function () {
        var attacktype = self.heroData().attacktype;
        return ((1 - (self.inventory.getBash(attacktype) * self.ability().getBash())) * 100).toFixed(2);
    });
    
    self.critChance = ko.pureComputed(function () {
        return ((1 - (self.inventory.getCritChance() * self.ability().getCritChance())) * 100).toFixed(2);
    });

    my.prototype.HeroDamageMixin(self);
    
    /*self.critDamage = ko.computed(function () {
        self.critInfo();
        return 0;
    });*/
    self.missChance = ko.pureComputed(function () {
        var missDebuff = [self.enemy().inventory.getMissChance, self.debuffs.itemBuffs.getMissChance].reduce(function (memo, fn) {
            var obj = fn(memo.excludeList);
            obj.value *= memo.value;
            return obj;
        }, {value:1, excludeList:[]});
        return ((1 - (self.enemy().ability().getMissChance() * self.debuffs.getMissChance() * missDebuff.value)) * 100).toFixed(2);
    });
    self.totalattackrange = ko.pureComputed(function () {
        var attacktype = self.heroData().attacktype;
        return self.heroData().attackrange + self.ability().getAttackRange() + self.inventory.getAttackRange(attacktype).value;
    });
    self.visionrangeday = ko.pureComputed(function () {
        return (self.heroData().visiondaytimerange) * (1 + self.enemy().ability().getVisionRangePctReduction() + self.debuffs.getVisionRangePctReduction());
    });
    self.visionrangenight = ko.pureComputed(function () {
        return (self.heroData().visionnighttimerange + self.inventory.getVisionRangeNight() + self.ability().getVisionRangeNight()) * (1 + self.enemy().ability().getVisionRangePctReduction() + self.debuffs.getVisionRangePctReduction());
    });
    self.lifesteal = ko.pureComputed(function () {
        var total = self.inventory.getLifesteal() + self.ability().getLifesteal() + self.buffs.getLifesteal();
        if (self.heroData().attacktype == 'DOTA_UNIT_CAP_MELEE_ATTACK') {
            var lifestealAura = [self.inventory.getLifestealAura, self.buffs.itemBuffs.getLifestealAura].reduce(function (memo, fn) {
                var obj = fn(memo.excludeList);
                obj.value += memo.value;
                return obj;
            }, {value: 0, excludeList: []});
            total += lifestealAura.value;
        }
        return (total).toFixed(2);
    });
    
    self.addIllusion = function (data, event) {
        self.illusions.push(ko.observable(new my.prototype.IllusionViewModel(0, self, self.illusionAbilityLevel())));
    };
    
    self.diffProperties = my.prototype.diffProperties;
    self.diff = {};

    for (var i = 0; i < self.diffProperties.length; i++) {
        var index = i;
        self.diff[self.diffProperties[index]] = self.getDiffFunction(self.diffProperties[index]);
    }
};

my.prototype.HeroModel.prototype.getDiffFunction = function (prop) {
    var self = this;
    return ko.computed(function () {
        if (prop == 'baseDamage') {
            return [self[prop]()[0] - self.heroCompare()[prop]()[0], self[prop]()[1] - self.heroCompare()[prop]()[1]];
        }
        else {
            return self[prop]() - self.heroCompare()[prop]();
        }
    }, this, { deferEvaluation: true });
}

my.prototype.HeroModel.prototype.getAbilityLevelMax = function (data) {
    if (data.abilitytype === 'DOTA_ABILITY_TYPE_ATTRIBUTES') {
        return 10;
    }
    else if (data.name === 'invoker_quas' || data.name === 'invoker_wex' || data.name === 'invoker_exort') {
        return 7;
    }
    else if (data.name === 'invoker_invoke') {
        return 4;
    }
    else if (data.name === 'earth_spirit_stone_caller' || data.name === 'ogre_magi_unrefined_fireblast') {
        return 1;
    }
    else if (data.abilitytype === 'DOTA_ABILITY_TYPE_ULTIMATE' || data.name === 'keeper_of_the_light_recall' ||
             data.name === 'keeper_of_the_light_blinding_light' || data.name === 'ember_spirit_activate_fire_remnant' ||
             data.name === 'lone_druid_true_form_battle_cry') {
        return 3;
    }
    else if (data.name === 'puck_ethereal_jaunt'  || data.name === 'shadow_demon_shadow_poison_release' ||
             data.name === 'templar_assassin_trap' || data.name === 'spectre_reality') {
        return 0;
    }
    else if (data.name === 'invoker_cold_snap'  || data.name === 'invoker_ghost_walk' || data.name === 'invoker_tornado' || 
             data.name === 'invoker_emp' || data.name === 'invoker_alacrity' || data.name === 'invoker_chaos_meteor' || 
             data.name === 'invoker_sun_strike' || data.name === 'invoker_forge_spirit' || data.name === 'invoker_ice_wall' || 
             data.name === 'invoker_deafening_blast') {
        return 0;
    }
    else if (data.name === 'techies_minefield_sign' || data.name === 'techies_focused_detonate') {
        return 0;
    }
    else {
        return 4;
    }
};
},{"./herocalc_core":4,"./herocalc_hero_damage":8,"./herocalc_knockout":10}],7:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');

var my = require("./herocalc_core");

my.prototype.CloneOption = function (name, displayname, levels, image, level) {
    this.heroName = ko.computed(function() {
        return (levels > 0) ? name + (level() <= levels ? level() : 1) : name;
    });
    this.heroDisplayName = displayname;
    this.image = image;
    this.levels = levels;
};

my.prototype.CloneViewModel = function (h,p) {
    var self = new my.prototype.HeroModel(h);
    self.parent = p;
    /*self.selectedHero(my.prototype.findWhere(self.availableHeroes(), {heroName: 'meepo'}));
    self.hero = ko.computed(function() {
        return ko.wrap.fromJS(my.prototype.heroData['npc_dota_hero_meepo']);
    });*/
    return self;
}
},{"./herocalc_core":4,"./herocalc_knockout":10}],8:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');
    
var my = require("./herocalc_core");

my.prototype.DamageTypeColor = {
    'physical': '#979aa2',
    'pure': 'goldenrod',
    'magic': '#428bca',
    'default': '#979aa2'
}

my.prototype.HeroDamageMixin = function (self) {
    self.critInfo = ko.pureComputed(function () {
        var critSources = self.inventory.getCritSource();
        my.prototype.extend(critSources, self.ability().getCritSource());
        my.prototype.extend(critSources, self.buffs.getCritSource());
        var critSourcesArray = [];
        for (var prop in critSources) {
            var el = critSources[prop];
            el.name = prop
            critSourcesArray.push(el);
        }
        function compareByMultiplier(a,b) {
            if (a.multiplier < b.multiplier)
                return 1;
            if (a.multiplier > b.multiplier)
                return -1;
            return 0;
        }

        critSourcesArray.sort(compareByMultiplier);
        
        var result = [];
        var critTotal = 0;
        for (var i = 0; i < critSourcesArray.length; i++) {
            var total = 1;
            for (var j = 0; j < i; j++) {
                for (var k = 0; k <critSourcesArray[j].count; k++) {
                    total *= (1 - critSourcesArray[j].chance);
                }
            }
            var total2 = 1;
            for (var k = 0; k < critSourcesArray[i].count; k++) {
                total2 *= (1 - critSourcesArray[i].chance);
            }
            total *= (1 - total2);
            critTotal += total;
            if (critSourcesArray[i].count > 1) {
                result.push({
                    'name':critSourcesArray[i].displayname + ' x' + critSourcesArray[i].count,
                    'chance':critSourcesArray[i].chance,
                    'multiplier':critSourcesArray[i].multiplier,
                    'count':critSourcesArray[i].count,
                    'totalChance':total
                });
            }
            else {
                result.push({
                    'name':critSourcesArray[i].displayname,
                    'chance':critSourcesArray[i].chance,
                    'multiplier':critSourcesArray[i].multiplier,
                    'count':critSourcesArray[i].count,
                    'totalChance':total
                });
            }
        }
        return { sources: result, total: critTotal };
    });

    self.cleaveInfo = ko.pureComputed(function () {
        var cleaveSources = self.inventory.getCleaveSource();
        my.prototype.extend(cleaveSources, self.ability().getCleaveSource());
        my.prototype.extend(cleaveSources, self.buffs.getCleaveSource());
        var cleaveSourcesArray = [];
        for (var prop in cleaveSources) {
            var el = cleaveSources[prop];
            el.name = prop
            cleaveSourcesArray.push(el);
        }
        function compareByRadius(a,b) {
            if (a.radius < b.radius)
                return 1;
            if (a.radius > b.radius)
                return -1;
            return 0;
        }

        cleaveSourcesArray.sort(compareByRadius);
        var cleaveSourcesByRadius = {};
        for (var i = 0; i < cleaveSourcesArray.length; i++) {
            var total = 0;
            for (var j = 0; j <cleaveSourcesArray.length; j++) {
                if (cleaveSourcesArray[j].radius >= cleaveSourcesArray[i].radius) {
                    total += cleaveSourcesArray[j].magnitude * cleaveSourcesArray[j].count;
                }
            }
            cleaveSourcesByRadius[cleaveSourcesArray[i].radius] = total;
        }
        var result = [];
        for (var prop in cleaveSourcesByRadius) {
            result.push({
                'radius':prop,
                'magnitude':cleaveSourcesByRadius[prop]
            });
        }
        return result;
    });
    
    self.bashInfo = ko.pureComputed(function () {
        var attacktype = self.heroData().attacktype;
        var bashSources = self.inventory.getBashSource(attacktype);
        my.prototype.extend(bashSources, self.ability().getBashSource());
        var bashSourcesArray = [];
        for (var prop in bashSources) {
            var el = bashSources[prop];
            el.name = prop
            bashSourcesArray.push(el);
        }
        function compareByDuration(a, b) {
            if (a.duration < b.duration)
                return 1;
            if (a.duration > b.duration)
                return -1;
            return 0;
        }

        //bashSourcesArray.sort(compareByDuration);
        
        var result = [];
        var bashTotal = 0;
        for (var i = 0;i < bashSourcesArray.length; i++) {
            var total = 1;
            for (var j = 0; j < i; j++) {
                for (var k = 0; k < bashSourcesArray[j].count; k++) {
                    total *= (1 - bashSourcesArray[j].chance);
                }
            }
            var total2 = 1;
            for (var k = 0; k < bashSourcesArray[i].count; k++) {
                total2 *= (1 - bashSourcesArray[i].chance);
            }
            total *= (1 - total2);
            bashTotal += total;
            if (bashSourcesArray[i].name === 'spirit_breaker_greater_bash') {
                var d = bashSourcesArray[i].damage * self.totalMovementSpeed();
            }
            else {
                var d = bashSourcesArray[i].damage;
            }
            if (bashSourcesArray[i].count > 1) {
                result.push({
                    'name':bashSourcesArray[i].displayname, // + ' x' + bashSourcesArray[i].count,
                    'chance':bashSourcesArray[i].chance,
                    'damage':d,
                    'count':bashSourcesArray[i].count,
                    'damageType':bashSourcesArray[i].damageType,
                    'totalChance':total
                });
            }
            else {
                result.push({
                    'name':bashSourcesArray[i].displayname,
                    'chance':bashSourcesArray[i].chance,
                    'damage':d,
                    'count':bashSourcesArray[i].count,
                    'damageType':bashSourcesArray[i].damageType,
                    'totalChance':total
                });
            }

        }
        return { sources: result, total: bashTotal };
    });
    
    self.orbProcInfo = ko.pureComputed(function () {
        var attacktype = self.heroData().attacktype;
        var damageSources = self.inventory.getOrbProcSource();
        var damageSourcesArray = [];
        for (var prop in damageSources) {
            var el = damageSources[prop];
            el.name = prop
            damageSourcesArray.push(el);
        }
        function compareByDamage(a, b) {
            if (a.priority > b.priority) {
                return 1;
            }
            if (a.priority < b.priority) {
                return -1;
            }
            if (a.damage < b.damage)
                return 1;
            if (a.damage > b.damage)
                return -1;
            return 0;
        }

        damageSourcesArray.sort(compareByDamage);
        
        var result = [];
        var damageTotal = 0;
        for (var i=0 ; i < damageSourcesArray.length; i++) {
            var total = 1;
            for (var j = 0; j < i; j++) {
                for (var k = 0; k < damageSourcesArray[j].count; k++) {
                    total *= (1 - damageSourcesArray[j].chance);
                }
            }
            var total2 = 1;
            for (var k = 0; k < damageSourcesArray[i].count; k++) {
                total2 *= (1 - damageSourcesArray[i].chance);
            }
            total *= (1 - total2);
            damageTotal += total;
            if (damageSourcesArray[i].count > 1) {
                result.push({
                    'name':damageSourcesArray[i].displayname + ' x' + damageSourcesArray[i].count,
                    'chance':damageSourcesArray[i].chance,
                    'damage':damageSourcesArray[i].damage,
                    'count':damageSourcesArray[i].count,
                    'damageType':damageSourcesArray[i].damageType,
                    'totalChance':total
                });
            }
            else {
                result.push({
                    'name':damageSourcesArray[i].displayname,
                    'chance':damageSourcesArray[i].chance,
                    'damage':damageSourcesArray[i].damage,
                    'count':damageSourcesArray[i].count,
                    'damageType':damageSourcesArray[i].damageType,
                    'totalChance':total
                });
            }
        }
        return { sources: result, total: damageTotal };
    });
    
    self.getReducedDamage = function (value, type) {
        var result = value;
        switch (type) {
            case 'physical':
                result = value * (1 - (0.06 * self.enemy().totalArmorPhysical()) / (1 + 0.06 * Math.abs(self.enemy().totalArmorPhysical())));
            break;
            case 'magic':
                result = value * (1 - self.enemy().totalMagicResistance() / 100);
            break;
            case 'pure':
                result = value;
            break;
            case 'composite':
                result = value * (1 - (0.06 * self.enemy().totalArmorPhysical()) / (1 + 0.06 * Math.abs(self.enemy().totalArmorPhysical())));
                result *= (1 - self.enemy().totalMagicResistance() / 100);
            break;
        }
        result *= self.ability().getDamageAmplification() * self.debuffs.getDamageAmplification();
        result *= self.enemy().ability().getDamageReduction() * self.enemy().buffs.getDamageReduction();
        return result;
    }
    
    self.damageTotalInfo = ko.pureComputed(function () {
        var bonusDamageArray = [
            self.ability().getBonusDamage().sources,
            self.buffs.getBonusDamage().sources
        ],
        bonusDamagePctArray = [
            self.ability().getBonusDamagePercent().sources,
            self.buffs.getBonusDamagePercent().sources
        ],
        itemBonusDamage = self.inventory.getBonusDamage().sources,
        itemBonusDamagePct = self.buffs.itemBuffs.getBonusDamagePercent(self.inventory.getBonusDamagePercent()).sources,
        critSources = self.critInfo(),
        abilityOrbSources = self.ability().getOrbSource(),
        itemOrbSources = self.inventory.getOrbSource(),
        itemProcOrbSources = self.orbProcInfo(),
        bashSources = self.bashInfo(),
        
        attackSources = [];
        
        attackSources.push({
            name: 'Base Attack',
            cooldown: 1
        });
        
        // weaver_geminate_attack
        if (self.heroId() === 'weaver') {
            var a = self.ability().abilities.find(function (ability) {
                return ability.name === 'weaver_geminate_attack';
            });
            if (a) {
                if (a.level() > 0) {
                    var cd = a.cooldown[a.level() - 1];
                    attackSources.push({
                        name: a.displayname,
                        cooldown: (1/cd)
                    });
                }
            }
        }
        
        // echo_sabre
        var item = self.inventory.items().find(function (o) { return o.item === "echo_sabre" && o.enabled(); });
        if (item && self.heroData().attacktype === 'DOTA_UNIT_CAP_MELEE_ATTACK') {
            var item_echo_sabre = my.prototype.itemData['item_echo_sabre'];
            attackSources.push({
                name: item_echo_sabre.displayname,
                cooldown: (1/item_echo_sabre.cooldown)
            });
        }

        var attacks = attackSources.map(function (a) {
            var baseDamage = (self.baseDamage()[0] + self.baseDamage()[1]) / 2,
            totalDamage = 0,
            totalCritableDamage = 0,
            totalCrit = 0,
            geminateAttack = { damage: 0, damageReduced: 0, cooldown: 6, active: false },
            echoSabreAttack = { damage: 0, damageReduced: 0, cooldown: my.prototype.itemData['item_echo_sabre'].cooldown[0], active: false },
            damage = {
                pure: 0,
                physical: 0,
                magic: 0
            },
            result = [],
            crits = [];
            
            // base damage
            result.push({
                name: 'Base Damage',
                damage: baseDamage,
                damageType: 'physical',
                damageReduced: self.getReducedDamage(baseDamage, 'physical'),
                enabled: ko.observable(true)
            });
            totalDamage += baseDamage;
            totalCritableDamage += baseDamage;
            damage.physical += baseDamage;
            
            // bonus damage from items
            for (i in itemBonusDamage) {
                var d = itemBonusDamage[i].damage*itemBonusDamage[i].count * self.ability().getSelfBaseDamageReductionPct() * self.enemy().ability().getBaseDamageReductionPct() * self.debuffs.itemBuffs.getBaseDamageReductionPct();
                result.push({
                    name: itemBonusDamage[i].displayname + (itemBonusDamage[i].count > 1 ? ' x' + itemBonusDamage[i].count : ''),
                    damage: d,
                    damageType: itemBonusDamage[i].damageType,
                    damageReduced: self.getReducedDamage(d, itemBonusDamage[i].damageType),
                    enabled: ko.observable(true)
                });
                totalDamage += d;
                totalCritableDamage += d;
                damage[itemBonusDamage[i].damageType] += d;
            }

            // bonus damage percent from items
            for (i in itemBonusDamagePct) {
                var d = baseDamage * itemBonusDamagePct[i].damage;
                result.push({
                    name: itemBonusDamagePct[i].displayname,
                    damage: d,
                    damageType: itemBonusDamagePct[i].damageType,
                    damageReduced: self.getReducedDamage(d, itemBonusDamagePct[i].damageType),
                    enabled: ko.observable(true)
                });
                totalDamage += d;
                totalCritableDamage += d;
                damage[itemBonusDamagePct[i].damageType] += d;
            }
            
            // bonus damage from abilities and buffs
            for (var i = 0; i < bonusDamageArray.length; i++) {
                for (j in bonusDamageArray[i]) {
                    var d = bonusDamageArray[i][j].damage;
                    result.push({
                        name: bonusDamageArray[i][j].displayname,
                        damage: d,
                        damageType: bonusDamageArray[i][j].damageType,
                        damageReduced: self.getReducedDamage(d, bonusDamageArray[i][j].damageType),
                        enabled: ko.observable(true)
                    });
                    totalDamage += d;
                    totalCritableDamage += d;
                    damage[bonusDamageArray[i][j].damageType] += d;
                }
            }
            
            // bonus damage percent from abilities and buffs
            for (var i = 0; i < bonusDamagePctArray.length; i++) {
                for (j in bonusDamagePctArray[i]) {
                    var d = baseDamage * bonusDamagePctArray[i][j].damage;
                    result.push({
                        name: bonusDamagePctArray[i][j].displayname,
                        damage: d,
                        damageType: bonusDamagePctArray[i][j].damageType,
                        damageReduced: self.getReducedDamage(d, bonusDamagePctArray[i][j].damageType),
                        enabled: ko.observable(true)
                    });
                    totalDamage += d;
                    totalCritableDamage += d;
                    damage[bonusDamagePctArray[i][j].damageType] += d;
                }
            }
            // drow_ranger_trueshot
            if (self.heroData().attacktype === 'DOTA_UNIT_CAP_RANGED_ATTACK') {
                if (self.heroId() === 'drow_ranger') {
                    var s = self.ability().getBonusDamagePrecisionAura().sources;
                    var index = 0;
                }
                else {
                    var s = self.buffs.getBonusDamagePrecisionAura().sources;
                    var index = 1;
                }
                if (s[index] != undefined) {
                    if (self.heroId() === 'drow_ranger') {
                        var d = s[index].damage * self.totalAgi();
                    }
                    else {
                        var d = s[index].damage;
                    }
                    result.push({
                        name: s[index].displayname,
                        damage: d,
                        damageType: 'physical',
                        damageReduced: self.getReducedDamage(d, 'physical'),
                        enabled: ko.observable(true)
                    });
                    totalDamage += d;
                    totalCritableDamage += d;
                    damage.physical += d;                    
                }
            }
            
            // riki_backstab
            if (self.heroId() === 'riki') {
                var s = self.ability().getBonusDamageBackstab().sources;
                var index = 0;
            }
            else {
                var s = self.buffs.getBonusDamageBackstab().sources;
                var index = 1;
            }
            if (s[index] != undefined) {
                if (self.heroId() === 'riki') {
                    var d = s[index].damage * self.totalAgi();
                }
                else {
                    var d = s[index].damage;
                }
                result.push({
                    name: s[index].displayname,
                    damage: d,
                    damageType: 'physical',
                    damageReduced: self.getReducedDamage(d, 'physical'),
                    enabled: ko.observable(true)
                });
                totalDamage += d;
                //totalCritableDamage += d;
                damage.physical += d;                    
            }

            // bash damage
            for (var i = 0; i < bashSources.sources.length; i++) {
                var o = bashSources.sources[i];
                var d = bashSources.sources[i].damage;
                var cd = self.attacksPerSecond();
                if (o.cooldown) {
                    cd = Math.max(1/o.cooldown, cd);
                }
                for (var j = 0; j < bashSources.sources[i].count; j++) {
                    result.push({
                        name: bashSources.sources[i].name,
                        damage: d,
                        damageType: bashSources.sources[i].damageType,
                        damageReduced: self.getReducedDamage(d, bashSources.sources[i].damageType),
                        dps: d * cd * bashSources.sources[i].chance,
                        dpsReduced: self.getReducedDamage(d, bashSources.sources[i].damageType) * cd * bashSources.sources[i].chance,
                        enabled: ko.observable(true)
                    });
                    totalDamage += d;
                    damage[bashSources.sources[i].damageType] += d;
                }

            }
            
            // %-based orbs
            for (var i = 0; i < itemProcOrbSources.sources.length; i++) {
                var d = itemProcOrbSources.sources[i].damage * (1 - Math.pow(1 - itemProcOrbSources.sources[i].chance, itemProcOrbSources.sources[i].count));
                result.push({
                    name: itemProcOrbSources.sources[i].name,
                    damage: d,
                    damageType: itemProcOrbSources.sources[i].damageType,
                    damageReduced: self.getReducedDamage(d, itemProcOrbSources.sources[i].damageType),
                    enabled: ko.observable(true)
                });
                totalDamage += d;
                damage[itemProcOrbSources.sources[i].damageType] += d;
            }
            
            // ability orbs
            for (var orb in abilityOrbSources) {
                var d = abilityOrbSources[orb].damage * (1 - itemProcOrbSources.total);
                result.push({
                    name: abilityOrbSources[orb].displayname,
                    damage: d,
                    damageType: abilityOrbSources[orb].damageType,
                    damageReduced: self.getReducedDamage(d, abilityOrbSources[orb].damageType),
                    enabled: ko.observable(true)
                });
                totalDamage += d;
                damage[abilityOrbSources[orb].damageType] += d;
            }
            
            // item orbs
            if (Object.keys(abilityOrbSources).length === 0) {
                for (var orb in itemOrbSources) {
                    var d = itemOrbSources[orb].damage * (1 - itemProcOrbSources.total);
                    result.push({
                        name: itemOrbSources[orb].displayname,
                        damage: d,
                        damageType: itemOrbSources[orb].damageType,
                        damageReduced: self.getReducedDamage(d, itemOrbSources[orb].damageType),
                        enabled: ko.observable(true)
                    });
                    totalDamage += d;
                    damage[itemOrbSources[orb].damageType] += d;
                }            
            }
            
            // crit damage
            for (var i = 0; i < critSources.sources.length; i++) {
                var d = totalCritableDamage * (critSources.sources[i].multiplier - 1);// * critSources.sources[i].totalChance;
                crits.push({
                    name: critSources.sources[i].name + ', ' + critSources.sources[i].multiplier + 'x, ' + (critSources.sources[i].totalChance * 100).toFixed(1) + '%',
                    damage: d,
                    damageType: 'physical',
                    damageReduced: self.getReducedDamage(d, 'physical'),
                    enabled: ko.observable(true),
                    chance: critSources.sources[i].totalChance
                });
                totalCrit += d;
            }

            var totalReduced = self.getReducedDamage(damage.pure, 'pure') 
                    + self.getReducedDamage(damage.physical, 'physical')
                    + self.getReducedDamage(damage.magic, 'magic'),
                totalCritReduced = self.getReducedDamage(totalCrit, 'physical'),
                dps = {
                    base: totalDamage * self.attacksPerSecond(),
                    crit: totalCrit * self.attacksPerSecond(),
                    geminateAttack: geminateAttack.active ? geminateAttack.damage / geminateAttack.cooldown : 0,
                    reduced: {
                        base: totalReduced * self.attacksPerSecond(),
                        crit: totalCritReduced * self.attacksPerSecond(),
                        geminateAttack: geminateAttack.active ? self.getReducedDamage(geminateAttack.damage, 'physical') / geminateAttack.cooldown : 0,
                    }
                }
                
            crits.forEach(function (o) {
                if (!o.dps) {
                    o.dps = o.damage * (o.cooldown || self.attacksPerSecond()) * o.chance;
                }
                if (!o.dpsReduced) {
                    o.dpsReduced = o.damageReduced * (o.cooldown || self.attacksPerSecond()) * o.chance;
                }
            });
                
            result.forEach(function (o) {
                if (!o.dps) {
                    o.dps = o.damage * (o.cooldown || self.attacksPerSecond());
                }
                if (!o.dpsReduced) {
                    o.dpsReduced = o.damageReduced * (o.cooldown || self.attacksPerSecond());
                }
            });
            
            var totalCritChance = crits.reduce(function (memo, o) { return memo + o.chance }, 0);
                
            var t1Crit = ko.computed(function () {
                var c = crits.find(function (o) { return o.enabled(); });
                return c ? c.damage : 0;
            });
            var t2Crit = ko.computed(function () {
                var c = crits.find(function (o) { return o.enabled(); });
                return c ? c.damageReduced : 0;
            });
            var t3Crit = ko.computed(function () {
                return crits.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.dps }, 0);
            });
            var t4Crit = ko.computed(function () {
                return crits.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.dpsReduced }, 0);
            });
                
            var t1 = ko.computed(function () {
                return result.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.damage }, 0) + t1Crit();
            });
            var t2 = ko.computed(function () {
                return result.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.damageReduced }, 0) + t2Crit();
            });
            var t3 = ko.computed(function () {
                return (result.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.dps }, 0) + t3Crit()) * a.cooldown;
            });
            var t4 = ko.computed(function () {
                return (result.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.dpsReduced }, 0) + t4Crit()) * a.cooldown;
            });
            
            var totalCritRow = [t1Crit, t2Crit, t3Crit, t4Crit];
            
            var totalRow = [t1, t2, t3, t4];

            return {
                name: a.name + ' Subtotal',
                cooldown: a.cooldown,
                enabled: ko.observable(true),
                visible: ko.observable(true),
                totalCritChance: totalCritChance,
                totalCritRow: totalCritRow,
                totalRow: totalRow,
                sources: result,
                sourcesCrit: crits,
                total: totalDamage,
                totalCrit: totalCrit,
                totalGeminateAttack: totalDamage + geminateAttack.damage,
                totalGeminateAttackReduced: totalReduced + geminateAttack.damageReduced,
                geminateAttack: geminateAttack,
                totalCritReduced: totalCritReduced,
                totalReduced: totalReduced,
                sumTotal: totalDamage + totalCrit,
                sumTotalReduced: totalReduced + totalCritReduced,
                dps: {
                    base: dps.base,
                    crit: dps.base + dps.crit,
                    geminateAttack: dps.base + dps.geminateAttack,
                    total: dps.base + dps.crit + dps.geminateAttack,
                    reduced: {
                        base: dps.reduced.base,
                        crit: dps.reduced.base + dps.reduced.crit,
                        geminateAttack: dps.reduced.base + dps.reduced.geminateAttack,
                        total: dps.reduced.base + dps.reduced.crit + dps.reduced.geminateAttack
                    }
                }
            };
        });
        
        var t1 = ko.computed(function () {
            return attacks.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.totalRow[0]() }, 0);
        });
        var t2 = ko.computed(function () {
            return attacks.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.totalRow[1]() }, 0);
        });
        var t3 = ko.computed(function () {
            return attacks.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.totalRow[2]() }, 0);
        });
        var t4 = ko.computed(function () {
            return attacks.filter(function (o) { return o.enabled(); }).reduce(function (memo, o) { return memo + o.totalRow[3]() }, 0);
        });
            
        return {
            attacks: attacks,
            totalRow: [t1, t2, t3, t4]
        }
    });
    
    self.getDamageTypeColor = function (damageType) {
        return my.prototype.DamageTypeColor[damageType] || my.prototype.DamageTypeColor['default'];
    }
    
}
},{"./herocalc_core":4,"./herocalc_knockout":10}],9:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');
var my = require("./herocalc_core");

my.prototype.stackableItems = ['clarity','flask','dust','ward_observer','ward_sentry','tango','tpscroll','smoke_of_deceit'],
my.prototype.levelitems = ['necronomicon','dagon','diffusal_blade','travel_boots'],
my.prototype.validItems = ["abyssal_blade","ultimate_scepter","courier","arcane_boots","armlet","assault","boots_of_elves","bfury","belt_of_strength","black_king_bar","blade_mail","blade_of_alacrity","blades_of_attack","blink","bloodstone","boots","travel_boots","bottle","bracer","broadsword","buckler","butterfly","chainmail","circlet","clarity","claymore","cloak","lesser_crit","greater_crit","dagon","demon_edge","desolator","diffusal_blade","rapier","ancient_janggo","dust","eagle","energy_booster","ethereal_blade","cyclone","skadi","flying_courier","force_staff","gauntlets","gem","ghost","gloves","hand_of_midas","headdress","flask","heart","heavens_halberd","helm_of_iron_will","helm_of_the_dominator","hood_of_defiance","hyperstone","branches","javelin","sphere","maelstrom","magic_stick","magic_wand","manta","mantle","mask_of_madness","medallion_of_courage","mekansm","mithril_hammer","mjollnir","monkey_king_bar","lifesteal","mystic_staff","necronomicon","null_talisman","oblivion_staff","ward_observer","ogre_axe","orb_of_venom","orchid","pers","phase_boots","pipe","platemail","point_booster","poor_mans_shield","power_treads","quarterstaff","quelling_blade","radiance","reaver","refresher","ring_of_aquila","ring_of_basilius","ring_of_health","ring_of_protection","ring_of_regen","robe","rod_of_atos","relic","sobi_mask","sange","sange_and_yasha","satanic","sheepstick","ward_sentry","shadow_amulet","invis_sword","shivas_guard","basher","slippers","smoke_of_deceit","soul_booster","soul_ring","staff_of_wizardry","stout_shield","talisman_of_evasion","tango","tpscroll","tranquil_boots","ultimate_orb","urn_of_shadows","vanguard","veil_of_discord","vitality_booster","vladmir","void_stone","wraith_band","yasha","crimson_guard","enchanted_mango","lotus_orb","glimmer_cape","guardian_greaves","moon_shard","silver_edge","solar_crest","octarine_core","aether_lens","faerie_fire","iron_talon","dragon_lance","echo_sabre","infused_raindrop","blight_stone","wind_lace","tome_of_knowledge","bloodthorn","hurricane_pike"],
my.prototype.itemsWithActive = ['heart','smoke_of_deceit','dust','ghost','tranquil_boots','phase_boots','power_treads','buckler','medallion_of_courage','ancient_janggo','mekansm','pipe','veil_of_discord','rod_of_atos','orchid','sheepstick','armlet','invis_sword','ethereal_blade','shivas_guard','manta','mask_of_madness','diffusal_blade','mjollnir','satanic','ring_of_basilius','ring_of_aquila', 'butterfly', 'moon_shard', 'silver_edge','bloodthorn'];

my.prototype.ItemInput = function (value, name, debuff) {
    if (my.prototype.itemData['item_' + value].ItemAliases instanceof Array) {
        var itemAlias = my.prototype.itemData['item_' + value].ItemAliases.join(' ');
    }
    else {
        var itemAlias = my.prototype.itemData['item_' + value].ItemAliases;
    }
    this.value = ko.observable(value);
    this.debuff = ko.observable(debuff);
    if (this.debuff()) {
        this.value = ko.observable(value + '|' + debuff.id);
        this.name = ko.observable(name + ' (' + debuff.name + ')');
        this.displayname = ko.observable(name + ' (' + debuff.name + ') <span style="display:none">' + ';' + itemAlias + '</span>');
    }
    else {
        this.value = ko.observable(value);
        this.name = ko.observable(name);
        this.displayname = ko.observable(name + ' <span style="display:none">' + ';' + itemAlias + '</span>');
    }
};

my.prototype.BasicInventoryViewModel = function (h) {
    var self = this;
    self.items = ko.observableArray([]);
    self.activeItems = ko.observableArray([]);
    self.addItem = function (data, event) {
        if (data.selectedItem() != undefined) {
            var new_item = {
                item: data.selectedItem().split('|')[0],
                state: ko.observable(0),
                size: data.itemInputValue(),
                enabled: ko.observable(true)
            }
            switch (new_item.item) {
                case 'dagon':
                    new_item.size = Math.min(new_item.size, 5);
                break;
                break;
                case 'travel_boots':
                case 'diffusal_blade':
                    new_item.size = Math.min(new_item.size, 2);
                break;
                case 'necronomicon':
                    new_item.size = Math.min(new_item.size, 3);
                break;
            }
            self.items.push(new_item);
            if (data.selectedItem() === 'ring_of_aquila' || data.selectedItem() === 'ring_of_basilius' || data.selectedItem() === 'heart') {
                self.toggleItem(undefined, new_item, undefined);
            }
        }
    };
    self.toggleItem = function (index, data, event) {
        if (my.prototype.itemsWithActive.indexOf(data.item) >= 0) {
            if (self.activeItems.indexOf(data) < 0) {
                self.activeItems.push(data);
            }
            else {
                self.activeItems.remove(data);
            }
            switch (data.item) {
                case 'power_treads':
                    if (data.state() < 2) {
                        data.state(data.state() + 1);
                    }
                    else {
                        data.state(0);
                    }                
                break;
                default:
                    if (data.state() == 0) {
                        data.state(1);
                    }
                    else {
                        data.state(0);
                    }                
                break;
            }
        }
    }.bind(this);
    self.removeItem = function (item) {
        self.activeItems.remove(item);
        self.items.remove(item);
    }.bind(this);
    self.toggleMuteItem = function (item) {
        item.enabled(!item.enabled());
    }.bind(this);      
    self.removeAll = function () {
        self.activeItems.removeAll();
        self.items.removeAll();
    }.bind(this);
}
my.prototype.BasicInventoryViewModel.prototype.getItemImage = function (data) {
    var state = ko.utils.unwrapObservable(data.state);
    switch (data.item) {
        case 'power_treads':
            if (state == 0) {
                return '/media/images/items/' + data.item + '_str.png';
            }
            else if (state == 1) {
                return '/media/images/items/' + data.item + '_int.png';
            }
            else {
                return '/media/images/items/' + data.item + '_agi.png';
            }
        break;
        case 'tranquil_boots':
        case 'ring_of_basilius':
            if (state == 0) {
                return '/media/images/items/' + data.item + '.png';
            }
            else {
                return '/media/images/items/' + data.item + '_active.png';
            }
        break;
        case 'armlet':
            if (state == 0) {
                return '/media/images/items/' + data.item + '.png';
            }
            else {
                return '/media/images/items/' + data.item + '_active.png';
            }
        break;
        case 'ring_of_aquila':
            if (state == 0) {
                return '/media/images/items/' + data.item + '_active.png';
            }
            else {
                return '/media/images/items/' + data.item + '.png';
            }
        break;
        case 'dagon':
        case 'diffusal_blade':
        case 'travel_boots':
        case 'necronomicon':
            if (data.size > 1) {
                return '/media/images/items/' + data.item + '_' + data.size + '.png';
            }
            else {
                return '/media/images/items/' + data.item + '.png';
            }
        break;
        default:
            return '/media/images/items/' + data.item + '.png';            
        break;
    }
};
my.prototype.BasicInventoryViewModel.prototype.getItemSizeLabel = function (data) {
    if (my.prototype.stackableItems.indexOf(data.item) != -1) {
        return '<span style="font-size:10px">Qty: </span>' + data.size;
    }
    else if (my.prototype.levelitems.indexOf(data.item) != -1) {
        return '<span style="font-size:10px">Lvl: </span>' + data.size;
    }
    else if (data.item == 'bloodstone') {
        return '<span style="font-size:10px">Charges: </span>' + data.size;
    }
    else {
        return '';
    }
};
my.prototype.BasicInventoryViewModel.prototype.getActiveBorder = function (data) {
    switch (data.item) {
        case 'power_treads':
        case 'tranquil_boots':
        case 'ring_of_basilius':
        case 'ring_of_aquila':
        case 'armlet':
            return 0;
        break;
        default:
            return ko.utils.unwrapObservable(data.state);    
        break;
    }
}
my.prototype.BasicInventoryViewModel.prototype.getItemAttributeValue = function (attributes, attributeName, level) {
    for (var i = 0; i < attributes.length; i++) {
        if (attributes[i].name == attributeName) {
            if (level == 0) {
                return parseFloat(attributes[i].value[0]);
            }
            else if (level > attributes[i].value.length) {
                return parseFloat(attributes[i].value[0]);
            }
            else {
                return parseFloat(attributes[i].value[level - 1]);
            }
        }
    }
}

my.prototype.InventoryViewModel = function (h) {
    var self = new my.prototype.BasicInventoryViewModel();
    self.hero = h;
    self.hasInventory = ko.observable(true);
    self.items = ko.observableArray([]);
    self.activeItems = ko.observableArray([]);
    self.hasScepter = ko.computed(function () {
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (item === 'ultimate_scepter' && self.items()[i].enabled()) {
                return true;
            }
            
        }
        return false;
    }, this);
    self.isEthereal = ko.computed(function () {
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if ((item === 'ghost' || item === 'ethereal_blade') && self.items()[i].enabled() && isActive) {
                return true;
            }
        }
        return false;
    }, this);
    self.isSheeped = ko.computed(function () {
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (item === 'sheepstick' && self.items()[i].enabled() && isActive) {
                return true;
            }
        }
        return false;
    }, this);
    self.totalCost = ko.computed(function () {
        var c = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (!self.items()[i].enabled()) continue;
            if (my.prototype.stackableItems.indexOf(item) != -1) {
                c += my.prototype.itemData['item_' + item].itemcost * self.items()[i].size;
            }
            else if (my.prototype.levelitems.indexOf(item) != -1) {
                switch(item) {
                    case 'diffusal_blade':
                        c += my.prototype.itemData['item_' + item].itemcost + (self.items()[i].size - 1) * 700;
                    break;
                    case 'necronomicon':
                    case 'dagon':
                        c += my.prototype.itemData['item_' + item].itemcost + (self.items()[i].size - 1) * 1250;
                    break;
                    default:
                        c += my.prototype.itemData['item_' + item].itemcost;
                    break;
                }
            }
            else {
                c += my.prototype.itemData['item_' + item].itemcost;
            }
            
        }
        return c;
    }, this);
    self.addItemBuff = function (data, event) {
        if (self.hasInventory() && self.selectedItemBuff() != undefined) {
            var new_item = {
                item: self.selectedItemBuff(),
                state: ko.observable(0),
                size: 1,
                enabled: ko.observable(true)
            }
            self.items.push(new_item);
            if (self.selectedItemBuff() === 'ring_of_aquila' || self.selectedItemBuff() === 'ring_of_basilius') {
                self.toggleItem(undefined, new_item, undefined);
            }
        }
    };
    self.addItemDebuff = function (data, event) {
        if (self.hasInventory() && self.selectedItemDebuff() != undefined) {
            var new_item = {
                item: self.selectedItemDebuff().split('|')[0],
                state: ko.observable(0),
                size: 1,
                enabled: ko.observable(true)
            }
            if (self.selectedItemDebuff().split('|').length == 2) {
                new_item.debuff = self.selectedItemDebuff().split('|')[1]
            }
            self.items.push(new_item);
            if (self.selectedItemDebuff() === 'ring_of_aquila' || self.selectedItemDebuff() === 'ring_of_basilius') {
                self.toggleItem(undefined, new_item, undefined);
            }
        }
    };
    
    self.getAttributes = function (attributetype) {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            var size = self.items()[i].size;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_all_stats':
                        totalAttribute += parseInt(attribute.value[0]);
                    break;
                    case 'bonus_stats':
                        totalAttribute += parseInt(attribute.value[0]);
                    break;
                }
                switch(attributetype) {
                    case 'agi':
                        if (attribute.name == 'bonus_agility') {
                            if (item == 'diffusal_blade') {
                                totalAttribute += parseInt(attribute.value[size-1]);
                            }
                            else {
                                totalAttribute += parseInt(attribute.value[0]);
                            }
                        }
                        if (attribute.name == 'bonus_stat' && self.items()[i].state() == 2) {totalAttribute += parseInt(attribute.value[0]);};
                        if (attribute.name == 'bonus_agi') {totalAttribute += parseInt(attribute.value[0]);};
                    break;
                    case 'int':
                        if (attribute.name == 'bonus_intellect') {
                            if (item == 'necronomicon') {
                                totalAttribute += parseInt(attribute.value[size-1]);
                            }
                            else if (item == 'diffusal_blade') {
                                totalAttribute += parseInt(attribute.value[size-1]);
                            }
                            else if (item == 'dagon') {
                                totalAttribute += parseInt(attribute.value[size-1]);
                            }
                            else {
                                totalAttribute += parseInt(attribute.value[0]);
                            }
                        }
                        if (attribute.name == 'bonus_intelligence') {totalAttribute += parseInt(attribute.value[0]);};
                        if (attribute.name == 'bonus_int') {totalAttribute += parseInt(attribute.value[0]);};
                        if (attribute.name == 'bonus_stat' && self.items()[i].state() == 1) {totalAttribute += parseInt(attribute.value[0]);};
                    break;
                    case 'str':
                        if (attribute.name == 'bonus_strength') {
                            if (item == 'necronomicon') {
                                totalAttribute += parseInt(attribute.value[size-1]);
                            }
                            else {
                                totalAttribute += parseInt(attribute.value[0]);
                            }
                        }
                        if (attribute.name == 'bonus_stat' && self.items()[i].state() == 0) {totalAttribute += parseInt(attribute.value[0]);};
                        if (attribute.name == 'bonus_str') {totalAttribute += parseInt(attribute.value[0]);};
                        if (attribute.name == 'unholy_bonus_strength' && isActive) {totalAttribute += parseInt(attribute.value[0]);};
                    break;
                }
            }
        }
        return totalAttribute;
    };
    self.getBash = function (attacktype) {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bash_chance':
                        totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                    break;
                    case 'bash_chance_melee':
                        if (attacktype == 'DOTA_UNIT_CAP_MELEE_ATTACK') { totalAttribute *= (1 - parseInt(attribute.value[0]) / 100); };
                    break;
                    case 'bash_chance_ranged':
                        if (attacktype == 'DOTA_UNIT_CAP_RANGED_ATTACK') { totalAttribute *= (1 - parseInt(attribute.value[0]) / 100); };
                    break;
                }
            }
        }
        return totalAttribute;
    };
    
    self.getCritChance = function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'crit_chance':
                        totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                    break;
                }
            }
        }
        return totalAttribute;
    };
    
    self.getCritSource = function () {
        var sources = {};
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            switch (item) {
                case 'lesser_crit':
                case 'greater_crit':
                case 'bloodthorn':
                    if (sources[item] == undefined) {
                        sources[item] = {
                            'chance': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'crit_chance', 0) / 100,
                            'multiplier': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'crit_multiplier', 0) / 100,
                            'count': 1,
                            'displayname': my.prototype.itemData['item_' + item].displayname
                        }
                    }
                    else {
                        sources[item].count += 1;
                    }
                break;
            }
            if (item === 'bloodthorn' && isActive) {
                if (sources['soul_rend'] == undefined) {
                    sources['soul_rend'] = {
                        'chance': 1,
                        'multiplier': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'target_crit_multiplier', 0) / 100,
                        'count': 1,
                        'displayname': 'Soul Rend'
                    }
                }
                else {
                    sources['soul_rend'].count += 1;
                }
            }
        }
        return sources;
    };

    self.getCleaveSource = function () {
        var sources = {};
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            switch (item) {
                case 'bfury':
                    if (sources[item] == undefined) {
                        sources[item] = {
                            'radius': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'cleave_radius', 0),
                            'magnitude': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'cleave_damage_percent', 0) / 100,
                            'count': 1,
                            'displayname': my.prototype.itemData['item_' + item].displayname
                        }
                    }
                    else {
                        sources[item].count += 1;
                    }
                break;
            }

        }
        return sources;
    };
    
    self.getBashSource = function (attacktype) {
        var sources = {};
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            switch (item) {
                case 'javelin':
                    if (sources[item] == undefined) {
                        sources[item] = {
                            'damage': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'bonus_chance_damage', 1),
                            'damageType': 'magic',
                            'count': 1,
                            'chance': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'bonus_chance', 1) / 100,
                            'displayname': my.prototype.itemData['item_' + item].displayname + ' Pierce'
                        }
                    }
                    else {
                        sources[item].count += 1;
                    }
                break;
                case 'monkey_king_bar':
                    if (sources[item] == undefined) {
                        sources[item] = {
                            'item': item,
                            'chance': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'bash_chance', 0) / 100,
                            'damage': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'bash_damage', 0),
                            'duration': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'bash_stun', 0),
                            'count': 1,
                            'damageType': 'magic',
                            'displayname': 'Mini-Bash' //my.prototype.itemData['item_' + item].displayname
                        }
                    }
                    else {
                        sources[item].count += 1;
                    }
                break;
                case 'abyssal_blade':
                case 'basher':
                    if (!sources.hasOwnProperty('bash')) {
                        sources['bash'] = {
                            'item': item,
                            'chance': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, (attacktype == 'DOTA_UNIT_CAP_MELEE_ATTACK') ?'bash_chance_melee' : 'bash_chance_ranged', 0) / 100,
                            'damage': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'bonus_chance_damage', 0),
                            'duration': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'bash_duration', 0),
                            'count': 1,
                            'damageType': 'physical',
                            'displayname': 'Bash' //my.prototype.itemData['item_' + item].displayname
                        }
                    }
                    else {
                        //sources[item].count += 1;
                    }
                break;
            }

        }
        return sources;
    };
    
    self.getOrbProcSource = function () {
        var sources = {};
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            switch (item) {
                case 'maelstrom':
                case 'mjollnir':
                    if (sources[item] == undefined) {
                        sources[item] = {
                            'chance': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'chain_chance', 0) / 100,
                            'damage': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'chain_damage', 0),
                            'count': 1,
                            'damageType': 'magic',
                            'displayname': my.prototype.itemData['item_' + item].displayname
                        }
                    }
                    else {
                        sources[item].count += 1;
                    }
                break;
            }

        }
        return sources;
    };

    self.getOrbSource = function () {
        var sources = {};
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            switch (item) {
                case 'diffusal_blade':
                    if (sources[item] == undefined) {
                        sources[item] = {
                            'chance': 1,
                            'damage': self.getItemAttributeValue(my.prototype.itemData['item_' + item].attributes, 'feedback_mana_burn', self.items()[i].size),
                            'count': 1,
                            'damageType': 'physical',
                            'displayname': my.prototype.itemData['item_' + item].displayname
                        }
                    }
                    else {
                        sources[item].count += 1;
                    }
                break;
            }

        }
        return sources;
    };
    
    self.getHealth = function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_health':
                        totalAttribute += parseInt(attribute.value[0]);
                    break;
                }
            }
        }
        return totalAttribute;
    };
    self.getHealthRegen = function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'health_regen':
                    case 'bonus_regen':
                        totalAttribute += parseInt(attribute.value[0]);
                    break;
                    case 'bonus_health_regen':
                        if (item == 'tranquil_boots' && !isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                        else if (item != 'tranquil_boots') {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                    break;
                    case 'hp_regen':
                        totalAttribute += parseInt(attribute.value[0]);
                    break;
                    case 'health_regen_rate':
                        if (item == 'heart' && isActive) {
                            totalAttribute += (parseInt(attribute.value[0]) / 100) * self.hero.health();
                        }
                    break;
                }
            }
        }
        return totalAttribute;
    };
    self.getHealthRegenAura = function (e) {
        var totalAttribute = 0,
            excludeList = e || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(item + attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'aura_health_regen':
                        totalAttribute += parseInt(attribute.value[0]);
                        excludeList.push(item + attribute.name);
                    break;
                }
            }
        }
        return {value: totalAttribute, excludeList: excludeList};
    };
    
    self.getMana = function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_mana':
                        totalAttribute += parseInt(attribute.value[0]);
                    break;
                }
            }
        }
        return totalAttribute;
    };
    
    self.getManaRegen = function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'aura_mana_regen':
                    case 'mana_regen_aura':
                        totalAttribute += parseFloat(attribute.value[0]);
                    break;
                    case 'mana_regen':
                        if (item == 'infused_raindrop') totalAttribute += parseFloat(attribute.value[0]);
                    break;
                }
            }
        }
        return totalAttribute;    
    };
    self.getManaRegenPercent = function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_mana_regen':
                    case 'mana_regen':
                    case 'bonus_mana_regen_pct':
                        if (item != 'infused_raindrop') totalAttribute += parseFloat(attribute.value[0]);
                    break;
                }
            }
        }
        return totalAttribute / 100;    
    };
    self.getManaRegenBloodstone = function () {
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            if (!self.items()[i].enabled()) continue;
            if (item.indexOf('bloodstone') != -1) {
                return parseInt(self.items()[i].size);
            }
        }
        return 0;
    };
    
    self.getArmor = function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_armor':
                        if (!isActive || item != 'medallion_of_courage') { totalAttribute += parseInt(attribute.value[0]); };
                    break;
                    case 'unholy_bonus_armor':
                        if (isActive && item == 'armlet') { totalAttribute += parseInt(attribute.value[0]); };
                    break;
                }
            }
        }
        return totalAttribute;
    };
    
    self.getArmorAura = function (aList) {
        var totalAttribute = 0,
            attributeList = aList || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0;j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (attributeList.find(function (a) { return attribute.name == a.name; })) continue;
                switch(attribute.name) {
                    // buckler
                    case 'bonus_aoe_armor':
                        if (isActive) {
                            attributeList.push({'name':attribute.name, 'value': parseInt(attribute.value[0])});
                        }
                    break;
                    // assault
                    case 'aura_positive_armor':
                        attributeList.push({'name':attribute.name, 'value': parseInt(attribute.value[0])});
                    break;
                    // ring_of_aquila,ring_of_basilius
                    case 'aura_bonus_armor':
                        if (isActive) {
                            attributeList.push({'name':attribute.name, 'value': parseInt(attribute.value[0])});
                        }
                    break;
                    // vladmir
                    case 'armor_aura':
                        attributeList.push({'name':attribute.name, 'value': parseInt(attribute.value[0])});
                    break;
                    // mekansm
                    case 'heal_bonus_armor':
                        if (isActive) {
                            attributeList.push({'name':attribute.name, 'value': parseInt(attribute.value[0])});
                        }
                    break;
                }
            }
        }
        // remove buckler if there is a mekansm
        if (attributeList.find(function (attribute) { return attribute.name == 'heal_bonus_armor'; })) {
            attributeList = attributeList.filter(function (attribute) {
                return attribute.name !== 'bonus_aoe_armor';
            });
        }
        // remove ring_of_aquila,ring_of_basilius if there is a vladmir
        if (attributeList.find(function (attribute) { return attribute.name == 'armor_aura'; })) {
            attributeList = attributeList.filter(function (attribute) {
                return attribute.name !== 'aura_bonus_armor';
            });
        }
        
        totalAttribute = attributeList.reduce(function (memo, attribute) {
            return memo += attribute.value;
        }, 0);
        return {value: totalAttribute, attributes: attributeList};
    };
    self.getArmorReduction = function (e) {
        var totalAttribute = 0,
            excludeList = e || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(attribute.name) > -1 || excludeList.indexOf(item + '_' + attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'armor_reduction':
                        totalAttribute += parseInt(attribute.value[0]);
                        excludeList.push(item + '_' + attribute.name);
                    break;
                    case 'aura_negative_armor':
                        totalAttribute += parseInt(attribute.value[0]);
                        excludeList.push(attribute.name);
                    break;
                    case 'corruption_armor':
                        totalAttribute += parseInt(attribute.value[0]);
                        excludeList.push(attribute.name);
                    break;
                }
            }
        }
        return {value: totalAttribute, excludeList: excludeList};
    };
    self.getEvasion = function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_evasion':
                        if (item != 'butterfly' || !isActive) totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                    break;
                }
            }
        }
        return totalAttribute;
    };
    self.getMovementSpeedFlat = function () {
        var totalAttribute = 0,
        hasBoots = false,
        hasEuls = false,
        hasWindLace = false,
        bootItems = ['boots','phase_boots','arcane_boots','travel_boots','power_treads','tranquil_boots','guardian_greaves'];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_movement_speed':
                        if (!hasBoots && bootItems.indexOf(item) >= 0) {
                            if (item != 'tranquil_boots' || (item == 'tranquil_boots' && !isActive)) {
                                totalAttribute += parseInt(attribute.value[0]);
                                hasBoots = true;
                            }
                        }
                        //else if (!hasEuls && item == 'cyclone') {
                        else if (item == 'cyclone') {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasEuls = true;
                        }
                    break;
                    case 'broken_movement_speed':
                        if (!hasBoots && bootItems.indexOf(item) >= 0) {
                            if (item == 'tranquil_boots' && isActive) {
                                totalAttribute += parseInt(attribute.value[0]);
                                hasBoots = true;
                            }
                        }
                    break;
                    case 'bonus_movement':
                        if (!hasBoots && bootItems.indexOf(item) >= 0) {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasBoots = true;
                        }
                    break;
                    case 'movement_speed':
                        if (!hasWindLace && item == 'wind_lace') {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasWindLace = true;
                        }
                    break;
                }
            }
        }
        return totalAttribute;
    };
    self.getMovementSpeedPercent = function (e) {
        var totalAttribute = 0,
            excludeList = e || [],
            hasYasha = false,
            hasDrums = false,
            hasDrumsActive = false,
            hasPhaseActive = false,
            hasShadowBladeActive = false,
            hasButterflyActive = false,
            hasMoMActive = false,
            yashaItems = ['manta','yasha','sange_and_yasha'];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'movement_speed_percent_bonus':
                        if (!hasYasha && yashaItems.indexOf(item) >= 0) {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasYasha = true;
                        }
                    break;
                    case 'bonus_aura_movement_speed_pct':
                        if (!hasDrums && item == 'ancient_janggo') {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasDrums = true;
                            excludeList.push(attribute.name);
                        }
                    break;
                    case 'phase_movement_speed':
                        if (isActive && !hasPhaseActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasPhaseActive = true;
                        }
                    break;
                    case 'bonus_movement_speed_pct':
                        if (isActive && !hasDrumsActive && item == 'ancient_janggo') {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasDrumsActive = true;
                            excludeList.push(attribute.name);
                        }
                    break;
                    case 'windwalk_movement_speed':
                        if (isActive && !hasShadowBladeActive && (item == 'invis_sword' || item == 'silver_edge')) {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasShadowBladeActive = true;
                        }
                    break;
                    case 'berserk_bonus_movement_speed':
                        if (isActive && !hasMoMActive && item == 'mask_of_madness') {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasMoMActive = true;
                        }
                    break;
                    case 'bonus_movement_speed': //manta
                        if (!hasYasha && item == 'manta') {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasYasha = true;
                        }
                        else if (item == 'smoke_of_deceit' && isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                    break;
                    case 'bonus_move_speed':
                        if (isActive && !hasButterflyActive && item == 'butterfly') {
                            totalAttribute += parseInt(attribute.value[0]);
                            hasButterflyActive = true;
                        }
                    break;
                }
            }
        }
        return {value: totalAttribute/100, excludeList: excludeList};
    };
    
    self.getMovementSpeedPercentReduction = function (e) {
        var totalAttribute = 0,
            excludeList = e || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'movespeed':
                        if (item == 'dust' && isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                    case 'blast_movement_speed':
                        if (item == 'shivas_guard' && isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                            excludeList.push(attribute.name);
                        }
                    case 'cold_movement_speed':
                        if (item == 'skadi') {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                    break;
                    case 'maim_movement_speed':
                        if (self.items()[i].debuff && self.items()[i].debuff == 'maim') {
                            totalAttribute += parseInt(attribute.value[0]);
                            excludeList.push(attribute.name);
                        }
                    break;
                }
            }
        }
        return {value: totalAttribute/100, excludeList: excludeList};
    };
    
    self.getBonusDamage = function () {
        var totalAttribute = 0;
        var sources = {};
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_damage':
                        totalAttribute += parseInt(attribute.value[0]);
                        if (sources[item] == undefined) {
                            sources[item] = {
                                'damage': parseInt(attribute.value[0]),
                                'damageType': 'physical',
                                'count':1,
                                'displayname': my.prototype.itemData['item_' + item].displayname
                            }                            
                        }
                        else {
                            sources[item].count += 1;
                        }
                    break;
                    case 'unholy_bonus_damage':
                        if (isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                            if (sources[item + '_active'] == undefined) {
                                sources[item + '_active'] = {
                                    'damage': parseInt(attribute.value[0]),
                                    'damageType': 'physical',
                                    'count':1,
                                    'displayname': my.prototype.itemData['item_' + item].displayname + ' Unholy Strength'
                                }                            
                            }
                            else {
                                sources[item].count += 1;
                            }
                        }
                    break;
                }
            }
        }
        return { sources: sources, total: totalAttribute };
    };
    self.getBonusDamagePercent = function (s) {
        s = s || {sources:{},total:0};
        var totalAttribute = s.total || 0;
        var sources = s.sources || {};
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'damage_aura':
                        if (sources[item] == undefined) {
                            totalAttribute += parseInt(attribute.value[0]) / 100;
                            sources[item] = {
                                'damage': parseInt(attribute.value[0]) / 100,
                                'damageType': 'physical',
                                'count':1,
                                'displayname': my.prototype.itemData['item_' + item].displayname
                            }
                        }
                        // else {
                            // sources[item].count += 1;
                        // }
                    break;
                }
            }
        }
        return { sources: sources, total: totalAttribute };
    };
    self.getAttackSpeed = function (e) {
        var totalAttribute = 0,
            hasPowerTreads = false,
            excludeList = e || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'bonus_attack_speed':
                        if (item == 'power_treads') {
                            if (!hasPowerTreads) {
                                totalAttribute += parseInt(attribute.value[0]);
                                hasPowerTreads = true;
                            }
                        }
                        else if (item == 'moon_shard') {
                            if (!isActive) {
                                totalAttribute += parseInt(attribute.value[0]);
                            }
                        }
                        else {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                    break;
                    case 'consumed_bonus':
                        if (item == 'moon_shard' && isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                    break;
                    break;
                    case 'bonus_speed':
                        totalAttribute += parseInt(attribute.value[0]);
                    break;
                    case 'aura_attack_speed':
                        if (item != 'shivas_guard') { totalAttribute += parseInt(attribute.value[0]); };
                    break;
                    // ancient_janggo
                    case 'bonus_aura_attack_speed_pct':
                        totalAttribute += parseInt(attribute.value[0]);
                        excludeList.push(attribute.name);
                    break;
                    // ancient_janggo
                    case 'bonus_attack_speed_pct':
                        if (isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                            excludeList.push(attribute.name);
                        }
                    break;
                    case 'unholy_bonus_attack_speed':
                        if (isActive) { totalAttribute += parseInt(attribute.value[0]); };
                    break;
                    case 'berserk_bonus_attack_speed':
                        if (isActive) { totalAttribute += parseInt(attribute.value[0]); };
                    break;
                }
            }
        }
        return {value: totalAttribute, excludeList: excludeList};
    };
    self.getAttackSpeedReduction = function (e) {
        var totalAttribute = 0,
            excludeList = e || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'aura_attack_speed':
                        if (item == 'shivas_guard') {
                            totalAttribute += parseInt(attribute.value[0]);
                            excludeList.push(attribute.name);
                        }
                    break;
                    case 'cold_attack_speed':
                        if (item == 'skadi') {
                            totalAttribute += parseInt(attribute.value[0]);
                            excludeList.push(attribute.name);
                        }
                    break;
                    case 'maim_attack_speed':
                        if (self.items()[i].debuff && self.items()[i].debuff == 'maim') {
                            totalAttribute += parseInt(attribute.value[0]);
                            excludeList.push(attribute.name);
                        }
                    break;
                }
            }
        }
        return {value: totalAttribute, excludeList: excludeList};
    };
    self.getLifesteal = function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'lifesteal_percent':
                        if (item == 'satanic') {
                            if (!isActive) { return parseInt(attribute.value[0]); };
                        }
                        else {
                            return parseInt(attribute.value[0]);
                        }
                    break;
                    case 'unholy_lifesteal_percent':
                        if (isActive) { return parseInt(attribute.value[0]); };
                    break;
                }
            }
        }
        return totalAttribute;
    };
    self.getLifestealAura = function (e) {
        var totalAttribute = 0,
            excludeList = e || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'vampiric_aura':
                        totalAttribute += parseInt(attribute.value[0]);
                        excludeList.push(attribute.name);
                    break;
                }
            }
        }
        return {value: totalAttribute, excludeList: excludeList};
    };
    self.getMagicResist = function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_magical_armor':
                        totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                    break;
                    case 'bonus_spell_resist':
                        totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                    break;
                    case 'magic_resistance':
                        totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                    break;
                }
            }
        }
        return totalAttribute;
    };
    self.getMagicResistReductionSelf = function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            if (isActive) {
                for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                    var attribute = my.prototype.itemData['item_' + item].attributes[j];
                    switch(attribute.name) {
                        case 'extra_spell_damage_percent':
                        case 'ethereal_damage_bonus':
                            return (1 - parseInt(attribute.value[0]) / 100);
                        break;
                    }
                }
            }
        }
        return totalAttribute;
    };   
    self.getMagicResistReduction = function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            if (isActive) {
                for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                    var attribute = my.prototype.itemData['item_' + item].attributes[j];
                    switch(attribute.name) {
                        case 'ethereal_damage_bonus':
                            if (!self.isEthereal()) totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                        case 'resist_debuff':
                            totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                        break;
                    }
                }
            }
        }
        return totalAttribute;
    };        

    self.getVisionRangeNight = ko.computed(function () {
        var totalAttribute = 0;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'bonus_night_vision':
                        if (item != 'moon_shard' || !isActive) {
                            totalAttribute += parseInt(attribute.value[0]);
                        }
                    break;
                }
            }
        }
        return totalAttribute;
    });
    
    self.getAttackRange = function (attacktype, aList) {
        var totalAttribute = 0,
            attributeList = aList || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0;j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (attributeList.find(function (a) { return attribute.name == a.name; })) continue;
                switch(attribute.name) {
                    // dragon_lance
                    case 'base_attack_range':
                        if (attacktype == 'DOTA_UNIT_CAP_RANGED_ATTACK') attributeList.push({'name':attribute.name, 'value': parseInt(attribute.value[0])});
                    break;
                }
            }
        }
        
        totalAttribute = attributeList.reduce(function (memo, attribute) {
            return memo += attribute.value;
        }, 0);
        return {value: totalAttribute, attributes: attributeList};
    };
    
    self.getMissChance = function (e) {
        var totalAttribute = 1,
            excludeList = e || [];
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                if (excludeList.indexOf(attribute.name) > -1) continue;
                switch(attribute.name) {
                    case 'miss_chance':
                        totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                        excludeList.push(attribute.name);
                    break;
                    case 'blind_pct':
                        totalAttribute *= (1 - parseInt(attribute.value[0]) / 100);
                        excludeList.push(attribute.name);
                    break;
                }
            }
        }
        return {value: totalAttribute, excludeList: excludeList};
    };
    
    self.getBaseDamageReductionPct = function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'backstab_reduction':
                        if (self.items()[i].debuff && self.items()[i].debuff == 'shadow_walk') {
                            totalAttribute *= (1 + parseInt(attribute.value[0]) / 100);
                        }
                    break;
                }
            }
        }
        return totalAttribute;
    };    
    self.getBonusDamageReductionPct = function () {
        var totalAttribute = 1;
        for (var i = 0; i < self.items().length; i++) {
            var item = self.items()[i].item;
            var isActive = self.activeItems.indexOf(self.items()[i]) >= 0 ? true : false;
            if (!self.items()[i].enabled()) continue;
            for (var j = 0; j < my.prototype.itemData['item_' + item].attributes.length; j++) {
                var attribute = my.prototype.itemData['item_' + item].attributes[j];
                switch(attribute.name) {
                    case 'backstab_reduction':
                        if (self.items()[i].debuff && self.items()[i].debuff == 'shadow_walk') {
                            totalAttribute *= (1 + parseInt(attribute.value[0]) / 100);
                        }
                    break;
                }
            }
        }
        return totalAttribute;
    };    
    
    self.itemOptions = ko.observableArray(my.prototype.itemOptionsArr);
    
    self.itemBuffOptions = ko.observableArray(my.prototype.itemBuffOptions);
    self.selectedItemBuff = ko.observable('assault');

    self.itemDebuffOptions = ko.observableArray(my.prototype.itemDebuffOptions);
    self.selectedItemDebuff = ko.observable('assault');
    
    return self;
};
},{"./herocalc_core":4,"./herocalc_knockout":10}],10:[function(require,module,exports){
(function (global){
'use strict';
var ko = (typeof window !== "undefined" ? window['ko'] : typeof global !== "undefined" ? global['ko'] : null);

ko.mapping = require('../lib/knockout.mapping');
ko.wrap = require('../lib/knockout.wrap');

ko.extenders.numeric = function(target, precision) {
    //create a writeable computed observable to intercept writes to our observable
    var result = ko.computed({
        read: target,  //always return the original observables value
        write: function(newValue) {
            var current = target(),
                roundingMultiplier = Math.pow(10, precision),
                newValueAsNum = isNaN(newValue) ? 0 : parseFloat(+newValue),
                valueToWrite = Math.round(newValueAsNum * roundingMultiplier) / roundingMultiplier;
 
            //only write if it changed
            if (valueToWrite !== current) {
                target(valueToWrite);
            } else {
                //if the rounded value is the same, but a different value was written, force a notification for the current field
                if (newValue !== current) {
                    target.notifySubscribers(valueToWrite);
                }
            }
        }
    }).extend({ notify: 'always' });
 
    //initialize with current value to make sure it is rounded appropriately
    result(target());
 
    //return the new computed observable
    return result;
};

module.exports = ko;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../lib/knockout.mapping":14,"../lib/knockout.wrap":15}],11:[function(require,module,exports){
'use strict';
var ko = require('./herocalc_knockout');
    
var my = require("./herocalc_core");

my.prototype.UnitOption = function (name, displayname, levels, image, level) {
    this.heroName = ko.computed(function() {
        return (levels > 0) ? name + (level() <= levels ? level() : 1) : name;
    });
    this.heroDisplayName = displayname;
    this.image = image;
    this.levels = levels;
};

my.prototype.UnitViewModel = function (h,p) {
    var self = new my.prototype.HeroModel(h);
    self.parent = p;
    self.selectedUnitLevel = ko.observable(1);
    self.availableUnits = ko.observableArray([
        new my.prototype.UnitOption('npc_dota_lone_druid_bear', 'Lone Druid Spirit Bear',4,'/media/images/units/spirit_bear.png', self.selectedUnitLevel),
        new my.prototype.UnitOption('npc_dota_brewmaster_earth_','Brewmaster Earth Warrior',3,'/media/images/units/npc_dota_brewmaster_earth.png', self.selectedUnitLevel),
        new my.prototype.UnitOption('npc_dota_brewmaster_fire_','Brewmaster Fire Warrior',3,'/media/images/units/npc_dota_brewmaster_fire.png', self.selectedUnitLevel),
        new my.prototype.UnitOption('npc_dota_brewmaster_storm_','Brewmaster Storm Warrior',3,'/media/images/units/npc_dota_brewmaster_storm.png', self.selectedUnitLevel),
        new my.prototype.UnitOption('npc_dota_necronomicon_archer_','Necronomicon Archer',3,'/media/images/units/npc_dota_necronomicon_archer.png', self.selectedUnitLevel),
        new my.prototype.UnitOption('npc_dota_necronomicon_warrior_','Necronomicon Warrior',3,'/media/images/units/npc_dota_necronomicon_warrior.png', self.selectedUnitLevel),
        new my.prototype.UnitOption('npc_dota_lycan_wolf','Lycan Wolf',4,'/media/images/units/npc_dota_lycan_wolf.png', self.selectedUnitLevel),
        new my.prototype.UnitOption('npc_dota_visage_familiar','Visage Familiar',3,'/media/images/units/npc_dota_visage_familiar.png', self.selectedUnitLevel)
    ]);
    self.selectedUnit = ko.observable(self.availableUnits()[0]);
    self.selectedUnit.subscribe(function(newValue) {
        if (newValue.heroName().indexOf('npc_dota_lone_druid_bear') != -1) {
            self.inventory.hasInventory(true);
            self.inventory.items.removeAll();
            self.inventory.activeItems.removeAll();
        }
        else {
            self.inventory.hasInventory(false);
            self.inventory.items.removeAll();
            self.inventory.activeItems.removeAll();
        }
    });
    self.hero = ko.computed(function() {
        return ko.wrap.fromJS(my.prototype.unitData[self.selectedUnit().heroName()]);
    });
    self.heroData = ko.computed(function() {
        return my.prototype.unitData[self.selectedUnit().heroName()];
    });
    self.getAbilityLevelMax = function(data) {
        if (data.abilitytype == 'DOTA_ABILITY_TYPE_ATTRIBUTES') {
            return 10;
        }
        else if (data.name == 'necronomicon_archer_mana_burn' || data.name == 'necronomicon_archer_aoe'
            || data.name == 'necronomicon_warrior_mana_burn' || data.name == 'necronomicon_warrior_last_will') {
            return 3;
        }
        else if (data.name == 'necronomicon_warrior_sight') {
            return 1;
        }
        else {
            return 4;
        }
    };
    self.ability = ko.computed(function() {
        var a = new my.prototype.AbilityModel(ko.mapping.fromJS(my.prototype.unitData[self.selectedUnit().heroName()].abilities));
        a.hasScepter = self.inventory.hasScepter
        switch (self.selectedUnit().heroName()) {
            case 'npc_dota_necronomicon_archer_1':
            case 'npc_dota_necronomicon_warrior_1':
                a.abilities[0].level(1);
                a.abilities[1].level(1);
            break;
            case 'npc_dota_necronomicon_archer_2':
            case 'npc_dota_necronomicon_warrior_2':
                a.abilities[0].level(2);
                a.abilities[1].level(2);
            break;
            case 'npc_dota_necronomicon_archer_3':
                a.abilities[0].level(3);
                a.abilities[1].level(3);
            break;
            case 'npc_dota_necronomicon_warrior_3':
                a.abilities[0].level(3);
                a.abilities[1].level(3);
                a.abilities[2].level(1);
            break;
        }
        a.levelUpAbility = function(index, data, event, hero) {
            switch (a.abilities[index()].name) {
                case 'necronomicon_archer_mana_burn':
                case 'necronomicon_archer_aoe':
                case 'necronomicon_warrior_mana_burn':
                case 'necronomicon_warrior_last_will':
                case 'necronomicon_warrior_sight':
                break;
                default:
                    if (a.abilities[index()].level() < hero.getAbilityLevelMax(data)) {
                        a.abilities[index()].level(a.abilities[index()].level()+1);
                    }                    
                break;
            }

        };
        a.levelDownAbility = function(index, data, event, hero) {            
            switch (a.abilities[index()].name) {
                case 'necronomicon_archer_mana_burn':
                case 'necronomicon_archer_aoe':
                case 'necronomicon_warrior_mana_burn':
                case 'necronomicon_warrior_last_will':
                case 'necronomicon_warrior_sight':
                break;
                default:
                    if (a.abilities[index()].level()>0) {
                        a.abilities[index()].level(a.abilities[index()].level()-1);
                    }
                break;
            }
        };
        return a;
    });        
    self.primaryAttribute = ko.computed(function() {
        //var v = my.prototype.unitData[self.selectedUnit().heroName()].attributeprimary;
        var v = 0;
        if (v == 'DOTA_ATTRIBUTE_AGILITY') {
            return 'agi'
        }
        else if (v == 'DOTA_ATTRIBUTE_INTELLECT') {
            return 'int'
        }
        else if (v == 'DOTA_ATTRIBUTE_STRENGTH') {
            return 'str'
        }
        else {
            return ''
        }
    });
    self.totalAttribute = function(a) {
        if (a == 'agi') {
            return parseFloat(self.totalAgi());
        }
        if (a == 'int') {
            return parseFloat(self.totalInt());
        }
        if (a == 'str') {
            return parseFloat(self.totalStr());
        }
        return 0;
    };
    self.totalAgi = ko.computed(function() {
        return (my.prototype.unitData[self.selectedUnit().heroName()].attributebaseagility
                + my.prototype.unitData[self.selectedUnit().heroName()].attributeagilitygain * (self.selectedHeroLevel() - 1) 
                //+ self.inventory.getAttributes('agi') 
                + self.ability().getAttributeBonusLevel()*2
                + self.ability().getAgility()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction()
               ).toFixed(2);
    });
    self.totalInt = ko.computed(function() {
        return (my.prototype.unitData[self.selectedUnit().heroName()].attributebaseintelligence 
                + my.prototype.unitData[self.selectedUnit().heroName()].attributeintelligencegain * (self.selectedHeroLevel() - 1) 
                //+ self.inventory.getAttributes('int') 
                + self.ability().getAttributeBonusLevel()*2
                + self.ability().getIntelligence()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction()
               ).toFixed(2);
    });
    self.totalStr = ko.computed(function() {
        return (my.prototype.unitData[self.selectedUnit().heroName()].attributebasestrength 
                + my.prototype.unitData[self.selectedUnit().heroName()].attributestrengthgain * (self.selectedHeroLevel() - 1) 
                //+ self.inventory.getAttributes('str') 
                + self.ability().getAttributeBonusLevel()*2
                + self.ability().getStrength()
                + self.enemy().ability().getAllStatsReduction()
                + self.debuffs.getAllStatsReduction()
               ).toFixed(2);
    });
    /*self.health = ko.computed(function() {
        return (my.prototype.unitData[self.selectedUnit().heroName()].statushealth + self.totalStr()*19 
                + self.inventory.getHealth()
                + self.ability().getHealth()).toFixed(2);
    });
    self.healthregen = ko.computed(function() {
        return (my.prototype.unitData[self.selectedUnit().heroName()].statushealthregen + self.totalStr()*.03 
                + self.inventory.getHealthRegen() 
                + self.ability().getHealthRegen()
                + self.buffs.getHealthRegen()).toFixed(2);
    });
    self.mana = ko.computed(function() {
        return (my.prototype.unitData[self.selectedUnit().heroName()].statusmana + self.totalInt()*13 + self.inventory.getMana()).toFixed(2);
    });
    self.manaregen = ko.computed(function() {
        return ((my.prototype.unitData[self.selectedUnit().heroName()].statusmanaregen 
                + self.totalInt()*.04 
                + self.ability().getManaRegen()) 
                * (1 + self.inventory.getManaRegenPercent()) 
                + (self.selectedHero().heroName == 'crystal_maiden' ? self.ability().getManaRegenArcaneAura() * 2 : self.buffs.getManaRegenArcaneAura())
                + self.inventory.getManaRegenBloodstone()
                - self.enemy().ability().getManaRegenReduction()).toFixed(2);
    });
    self.totalArmorPhysical = ko.computed(function() {
        return (self.enemy().ability().getArmorBaseReduction() * self.debuffs.getArmorBaseReduction() * (my.prototype.unitData[self.selectedUnit().heroName()].armorphysical + self.totalAgi()*.14)
                + self.inventory.getArmor() + self.ability().getArmor() + self.enemy().ability().getArmorReduction() + self.buffs.getArmor() + self.debuffs.getArmorReduction()).toFixed(2);
    });
    self.totalArmorPhysicalReduction = ko.computed(function() {
        return ((0.06 * self.totalArmorPhysical()) / (1 + 0.06 * self.totalArmorPhysical()) * 100).toFixed(2);
    });
    self.totalMovementSpeed = ko.computed(function() {
        if (self.parent.ability().isShapeShiftActive()) {
            return 522;
        }
        var ms = (self.ability().setMovementSpeed() > 0 ? self.ability().setMovementSpeed() : self.buffs.setMovementSpeed());
        if (ms > 0) {
            return ms;
        }
        else {
            return ((my.prototype.unitData[self.selectedUnit().heroName()].movementspeed + self.inventory.getMovementSpeedFlat()+ self.ability().getMovementSpeedFlat()) * 
                    (1 + self.inventory.getMovementSpeedPercent() 
                       + self.ability().getMovementSpeedPercent() 
                       + self.enemy().inventory.getMovementSpeedPercentReduction() 
                       + self.enemy().ability().getMovementSpeedPercentReduction() 
                       + self.buffs.getMovementSpeedPercent() 
                       + self.debuffs.getMovementSpeedPercentReduction()
                    )).toFixed(2);
        }
    });
    self.totalTurnRate = ko.computed(function() {
        return (my.prototype.unitData[self.selectedUnit().heroName()].movementturnrate 
                * (1 + self.enemy().ability().getTurnRateReduction()
                     + self.debuffs.getTurnRateReduction())).toFixed(2);
    });
    */
    self.baseDamage = ko.computed(function() {
        return [Math.floor(my.prototype.unitData[self.selectedUnit().heroName()].attackdamagemin + self.totalAttribute(self.primaryAttribute()) + self.ability().getBaseDamage().total),
                Math.floor(my.prototype.unitData[self.selectedUnit().heroName()].attackdamagemax + self.totalAttribute(self.primaryAttribute()) + self.ability().getBaseDamage().total)];
    });
    /*self.bonusDamage = ko.computed(function() {
        return self.inventory.getBonusDamage().total
                + self.ability().getBonusDamage().total
                + self.buffs.getBonusDamage().total
                + Math.floor((self.baseDamage()[0] + self.baseDamage()[1])/2 
                              * (self.inventory.getBonusDamagePercent().total
                                 + self.ability().getBonusDamagePercent().total
                                 + self.buffs.getBonusDamagePercent().total
                                )
                            )
                + Math.floor(
                    (self.hero().attacktype() == 'DOTA_UNIT_CAP_RANGED_ATTACK' 
                        ? ((self.selectedHero().heroName == 'drow_ranger') ? self.ability().getBonusDamagePrecisionAura().total[0] * self.totalAgi() : self.buffs.getBonusDamagePrecisionAura().total[1])
                        : 0)
                  );
    });*/
    /*self.bonusDamageReduction = ko.computed(function() {
        return Math.abs(self.enemy().ability().getBonusDamageReduction() + self.debuffs.getBonusDamageReduction());
    });
    self.damage = ko.computed(function() {
        return [self.baseDamage()[0] + self.bonusDamage()[0],
                self.baseDamage()[1] + self.bonusDamage()[1]];
    });*/
    self.totalMagicResistanceProduct = ko.computed(function() {
        return (1 - my.prototype.unitData[self.selectedUnit().heroName()].magicalresistance / 100) 
                   * (1 - self.inventory.getMagicResist() / 100) 
                   * (1 - self.ability().getMagicResist() / 100) 
                   * (1 - self.buffs.getMagicResist() / 100) 
                   * self.enemy().inventory.getMagicResistReduction()
                   * self.enemy().ability().getMagicResistReduction() 
                   * self.debuffs.getMagicResistReduction();
    });
    self.totalMagicResistance = ko.computed(function() {
        return (1 - self.totalMagicResistanceProduct());
    });
    self.bat = ko.computed(function() {
        var abilityBAT = self.ability().getBAT();
        if (abilityBAT > 0) {
            return abilityBAT;
        }
        return my.prototype.unitData[self.selectedUnit().heroName()].attackrate;
    });
    /*
    self.ias = ko.computed(function() {
        var val = parseFloat(self.totalAgi()) 
                + self.inventory.getAttackSpeed() 
                + self.ability().getAttackSpeed() 
                + self.enemy().ability().getAttackSpeedReduction() 
                + self.buffs.getAttackSpeed() 
                + self.debuffs.getAttackSpeedReduction();
        if (val < -80) {
            return -80;
        }
        else if (val > 400) {
            return 400;
        }
        return (val).toFixed(2);
    });*/
    self.attackTime = ko.computed(function() {
        return (self.bat() / (1 + self.ias() / 100)).toFixed(2);
    });
    self.attacksPerSecond = ko.computed(function() {
        return (1 + self.ias() / 100) / self.bat();
    });
    self.evasion = ko.computed(function() {
        var e = self.ability().setEvasion();
        if (e) {
            return (e * 100).toFixed(2) + '%';
        }
        else {
            return ((1-(self.inventory.getEvasion() * self.ability().getEvasion())) * 100).toFixed(2) + '%';
        }
    });
    self.ehpPhysical = ko.computed(function() {
        return ((self.health() * (1 + .06 * self.totalArmorPhysical())) / (1-(1-(self.inventory.getEvasion() * self.ability().getEvasion())))).toFixed(2);
    });
    self.ehpMagical = ko.computed(function() {
        return (self.health() / self.totalMagicResistanceProduct()).toFixed(2);
    });
    
    return self;
}
},{"./herocalc_core":4,"./herocalc_knockout":10}],12:[function(require,module,exports){
'use strict';

var core = require("./herocalc_core");
require("./herocalc_inventory");
require("./herocalc_abilitydata");
require("./herocalc_abilities");
require("./herocalc_buffs");
require("./herocalc_hero");
require("./herocalc_hero.illusion");
require("./herocalc_hero.meepo");
require("./herocalc_unit");

module.exports = core;
},{"./herocalc_abilities":1,"./herocalc_abilitydata":2,"./herocalc_buffs":3,"./herocalc_core":4,"./herocalc_hero":6,"./herocalc_hero.illusion":5,"./herocalc_hero.meepo":7,"./herocalc_inventory":9,"./herocalc_unit":11}],13:[function(require,module,exports){
if (!Array.prototype.find) {
  Array.prototype.find = function(predicate) {
    'use strict';
    if (this == null) {
      throw new TypeError('Array.prototype.find called on null or undefined');
    }
    if (typeof predicate !== 'function') {
      throw new TypeError('predicate must be a function');
    }
    var list = Object(this);
    var length = list.length >>> 0;
    var thisArg = arguments[1];
    var value;

    for (var i = 0; i < length; i++) {
      value = list[i];
      if (predicate.call(thisArg, value, i, list)) {
        return value;
      }
    }
    return undefined;
  };
}
},{}],14:[function(require,module,exports){
(function (global){
(function (factory) {
	// Module systems magic dance.

	if (typeof require === "function" && typeof exports === "object" && typeof module === "object") {
		// CommonJS or Node: hard-coded dependency on "knockout"
		factory((typeof window !== "undefined" ? window['ko'] : typeof global !== "undefined" ? global['ko'] : null), exports);
	} else if (typeof define === "function" && define["amd"]) {
		// AMD anonymous module with hard-coded dependency on "knockout"
		define(["knockout", "exports"], factory);
	} else {
		// <script> tag: use the global `ko` object, attaching a `mapping` property
		factory(ko, ko.mapping = {});
	}
}(function (ko, exports) {
	var DEBUG=true;
	var mappingProperty = "__ko_mapping__";
	var realKoDependentObservable = ko.dependentObservable;
	var mappingNesting = 0;
	var dependentObservables;
	var visitedObjects;
	var recognizedRootProperties = ["create", "update", "key", "arrayChanged"];
	var emptyReturn = {};

	var _defaultOptions = {
		include: ["_destroy"],
		ignore: [],
		copy: [],
		observe: []
	};
	var defaultOptions = _defaultOptions;

	// Author: KennyTM @ StackOverflow
	function unionArrays (x, y) {
		var obj = {};
		for (var i = x.length - 1; i >= 0; -- i) obj[x[i]] = x[i];
		for (var i = y.length - 1; i >= 0; -- i) obj[y[i]] = y[i];
		var res = [];

		for (var k in obj) {
			res.push(obj[k]);
		};

		return res;
	}

	function extendObject(destination, source) {
		var destType;

		for (var key in source) {
			if (source.hasOwnProperty(key) && source[key]) {
				destType = exports.getType(destination[key]);
				if (key && destination[key] && destType !== "array" && destType !== "string") {
					extendObject(destination[key], source[key]);
				} else {
					var bothArrays = exports.getType(destination[key]) === "array" && exports.getType(source[key]) === "array";
					if (bothArrays) {
						destination[key] = unionArrays(destination[key], source[key]);
					} else {
						destination[key] = source[key];
					}
				}
			}
		}
	}

	function merge(obj1, obj2) {
		var merged = {};
		extendObject(merged, obj1);
		extendObject(merged, obj2);

		return merged;
	}

	exports.isMapped = function (viewModel) {
		var unwrapped = ko.utils.unwrapObservable(viewModel);
		return unwrapped && unwrapped[mappingProperty];
	}

	exports.fromJS = function (jsObject /*, inputOptions, target*/ ) {
		if (arguments.length == 0) throw new Error("When calling ko.fromJS, pass the object you want to convert.");

		try {
			if (!mappingNesting++) {
				dependentObservables = [];
				visitedObjects = new objectLookup();
			}

			var options;
			var target;

			if (arguments.length == 2) {
				if (arguments[1][mappingProperty]) {
					target = arguments[1];
				} else {
					options = arguments[1];
				}
			}
			if (arguments.length == 3) {
				options = arguments[1];
				target = arguments[2];
			}

			if (target) {
				options = merge(options, target[mappingProperty]);
			}
			options = fillOptions(options);

			var result = updateViewModel(target, jsObject, options);
			if (target) {
				result = target;
			}

			// Evaluate any dependent observables that were proxied.
			// Do this after the model's observables have been created
			if (!--mappingNesting) {
				while (dependentObservables.length) {
					var DO = dependentObservables.pop();
					if (DO) {
						DO();
						
						// Move this magic property to the underlying dependent observable
						DO.__DO["throttleEvaluation"] = DO["throttleEvaluation"];
					}
				}
			}

			// Save any new mapping options in the view model, so that updateFromJS can use them later.
			result[mappingProperty] = merge(result[mappingProperty], options);

			return result;
		} catch(e) {
			mappingNesting = 0;
			throw e;
		}
	};

	exports.fromJSON = function (jsonString /*, options, target*/ ) {
		var parsed = ko.utils.parseJson(jsonString);
		arguments[0] = parsed;
		return exports.fromJS.apply(this, arguments);
	};

	exports.updateFromJS = function (viewModel) {
		throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");
	};

	exports.updateFromJSON = function (viewModel) {
		throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");
	};

	exports.toJS = function (rootObject, options) {
		if (!defaultOptions) exports.resetDefaultOptions();

		if (arguments.length == 0) throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");
		if (exports.getType(defaultOptions.ignore) !== "array") throw new Error("ko.mapping.defaultOptions().ignore should be an array.");
		if (exports.getType(defaultOptions.include) !== "array") throw new Error("ko.mapping.defaultOptions().include should be an array.");
		if (exports.getType(defaultOptions.copy) !== "array") throw new Error("ko.mapping.defaultOptions().copy should be an array.");

		// Merge in the options used in fromJS
		options = fillOptions(options, rootObject[mappingProperty]);

		// We just unwrap everything at every level in the object graph
		return exports.visitModel(rootObject, function (x) {
			return ko.utils.unwrapObservable(x)
		}, options);
	};

	exports.toJSON = function (rootObject, options) {
		var plainJavaScriptObject = exports.toJS(rootObject, options);
		return ko.utils.stringifyJson(plainJavaScriptObject);
	};

	exports.defaultOptions = function () {
		if (arguments.length > 0) {
			defaultOptions = arguments[0];
		} else {
			return defaultOptions;
		}
	};

	exports.resetDefaultOptions = function () {
		defaultOptions = {
			include: _defaultOptions.include.slice(0),
			ignore: _defaultOptions.ignore.slice(0),
			copy: _defaultOptions.copy.slice(0)
		};
	};

	exports.getType = function(x) {
		if ((x) && (typeof (x) === "object")) {
			if (x.constructor === Date) return "date";
			if (x.constructor === Array) return "array";
		}
		return typeof x;
	}

	function fillOptions(rawOptions, otherOptions) {
		var options = merge({}, rawOptions);

		// Move recognized root-level properties into a root namespace
		for (var i = recognizedRootProperties.length - 1; i >= 0; i--) {
			var property = recognizedRootProperties[i];
			
			// Carry on, unless this property is present
			if (!options[property]) continue;
			
			// Move the property into the root namespace
			if (!(options[""] instanceof Object)) options[""] = {};
			options[""][property] = options[property];
			delete options[property];
		}

		if (otherOptions) {
			options.ignore = mergeArrays(otherOptions.ignore, options.ignore);
			options.include = mergeArrays(otherOptions.include, options.include);
			options.copy = mergeArrays(otherOptions.copy, options.copy);
			options.observe = mergeArrays(otherOptions.observe, options.observe);
		}
		options.ignore = mergeArrays(options.ignore, defaultOptions.ignore);
		options.include = mergeArrays(options.include, defaultOptions.include);
		options.copy = mergeArrays(options.copy, defaultOptions.copy);
		options.observe = mergeArrays(options.observe, defaultOptions.observe);

		options.mappedProperties = options.mappedProperties || {};
		options.copiedProperties = options.copiedProperties || {};
		return options;
	}

	function mergeArrays(a, b) {
		if (exports.getType(a) !== "array") {
			if (exports.getType(a) === "undefined") a = [];
			else a = [a];
		}
		if (exports.getType(b) !== "array") {
			if (exports.getType(b) === "undefined") b = [];
			else b = [b];
		}

		return ko.utils.arrayGetDistinctValues(a.concat(b));
	}

	// When using a 'create' callback, we proxy the dependent observable so that it doesn't immediately evaluate on creation.
	// The reason is that the dependent observables in the user-specified callback may contain references to properties that have not been mapped yet.
	function withProxyDependentObservable(dependentObservables, callback) {
		var localDO = ko.dependentObservable;
		ko.dependentObservable = function (read, owner, options) {
			options = options || {};

			if (read && typeof read == "object") { // mirrors condition in knockout implementation of DO's
				options = read;
			}

			var realDeferEvaluation = options.deferEvaluation;

			var isRemoved = false;

			// We wrap the original dependent observable so that we can remove it from the 'dependentObservables' list we need to evaluate after mapping has
			// completed if the user already evaluated the DO themselves in the meantime.
			var wrap = function (DO) {
				// Temporarily revert ko.dependentObservable, since it is used in ko.isWriteableObservable
				var tmp = ko.dependentObservable;
				ko.dependentObservable = realKoDependentObservable;
				var isWriteable = ko.isWriteableObservable(DO);
				ko.dependentObservable = tmp;

				var wrapped = realKoDependentObservable({
					read: function () {
						if (!isRemoved) {
							ko.utils.arrayRemoveItem(dependentObservables, DO);
							isRemoved = true;
						}
						return DO.apply(DO, arguments);
					},
					write: isWriteable && function (val) {
						return DO(val);
					},
					deferEvaluation: true
				});
				if (DEBUG) wrapped._wrapper = true;
				wrapped.__DO = DO;
				return wrapped;
			};
			
			options.deferEvaluation = true; // will either set for just options, or both read/options.
			var realDependentObservable = new realKoDependentObservable(read, owner, options);

			if (!realDeferEvaluation) {
				realDependentObservable = wrap(realDependentObservable);
				dependentObservables.push(realDependentObservable);
			}

			return realDependentObservable;
		}
		ko.dependentObservable.fn = realKoDependentObservable.fn;
		ko.computed = ko.dependentObservable;
		var result = callback();
		ko.dependentObservable = localDO;
		ko.computed = ko.dependentObservable;
		return result;
	}

	function updateViewModel(mappedRootObject, rootObject, options, parentName, parent, parentPropertyName, mappedParent) {
		var isArray = exports.getType(ko.utils.unwrapObservable(rootObject)) === "array";

		parentPropertyName = parentPropertyName || "";

		// If this object was already mapped previously, take the options from there and merge them with our existing ones.
		if (exports.isMapped(mappedRootObject)) {
			var previousMapping = ko.utils.unwrapObservable(mappedRootObject)[mappingProperty];
			options = merge(previousMapping, options);
		}

		var callbackParams = {
			data: rootObject,
			parent: mappedParent || parent
		};

		var hasCreateCallback = function () {
			return options[parentName] && options[parentName].create instanceof Function;
		};

		var createCallback = function (data) {
			return withProxyDependentObservable(dependentObservables, function () {
				
				if (ko.utils.unwrapObservable(parent) instanceof Array) {
					return options[parentName].create({
						data: data || callbackParams.data,
						parent: callbackParams.parent,
						skip: emptyReturn
					});
				} else {
					return options[parentName].create({
						data: data || callbackParams.data,
						parent: callbackParams.parent
					});
				}				
			});
		};

		var hasUpdateCallback = function () {
			return options[parentName] && options[parentName].update instanceof Function;
		};

		var updateCallback = function (obj, data) {
			var params = {
				data: data || callbackParams.data,
				parent: callbackParams.parent,
				target: ko.utils.unwrapObservable(obj)
			};

			if (ko.isWriteableObservable(obj)) {
				params.observable = obj;
			}

			return options[parentName].update(params);
		}

		var alreadyMapped = visitedObjects.get(rootObject);
		if (alreadyMapped) {
			return alreadyMapped;
		}

		parentName = parentName || "";

		if (!isArray) {
			// For atomic types, do a direct update on the observable
			if (!canHaveProperties(rootObject)) {
				switch (exports.getType(rootObject)) {
				case "function":
					if (hasUpdateCallback()) {
						if (ko.isWriteableObservable(rootObject)) {
							rootObject(updateCallback(rootObject));
							mappedRootObject = rootObject;
						} else {
							mappedRootObject = updateCallback(rootObject);
						}
					} else {
						mappedRootObject = rootObject;
					}
					break;
				default:
					if (ko.isWriteableObservable(mappedRootObject)) {
						if (hasUpdateCallback()) {
							var valueToWrite = updateCallback(mappedRootObject);
							mappedRootObject(valueToWrite);
							return valueToWrite;
						} else {
							var valueToWrite = ko.utils.unwrapObservable(rootObject);
							mappedRootObject(valueToWrite);
							return valueToWrite;
						}
					} else {
						var hasCreateOrUpdateCallback = hasCreateCallback() || hasUpdateCallback();
						
						if (hasCreateCallback()) {
							mappedRootObject = createCallback();
						} else {
							mappedRootObject = ko.observable(ko.utils.unwrapObservable(rootObject));
						}

						if (hasUpdateCallback()) {
							mappedRootObject(updateCallback(mappedRootObject));
						}
						
						if (hasCreateOrUpdateCallback) return mappedRootObject;
					}
				}

			} else {
				mappedRootObject = ko.utils.unwrapObservable(mappedRootObject);
				if (!mappedRootObject) {
					if (hasCreateCallback()) {
						var result = createCallback();

						if (hasUpdateCallback()) {
							result = updateCallback(result);
						}

						return result;
					} else {
						if (hasUpdateCallback()) {
							return updateCallback(result);
						}

						mappedRootObject = {};
					}
				}

				if (hasUpdateCallback()) {
					mappedRootObject = updateCallback(mappedRootObject);
				}

				visitedObjects.save(rootObject, mappedRootObject);
				if (hasUpdateCallback()) return mappedRootObject;

				// For non-atomic types, visit all properties and update recursively
				visitPropertiesOrArrayEntries(rootObject, function (indexer) {
					var fullPropertyName = parentPropertyName.length ? parentPropertyName + "." + indexer : indexer;

					if (ko.utils.arrayIndexOf(options.ignore, fullPropertyName) != -1) {
						return;
					}

					if (ko.utils.arrayIndexOf(options.copy, fullPropertyName) != -1) {
						mappedRootObject[indexer] = rootObject[indexer];
						return;
					}

					if(typeof rootObject[indexer] != "object" && typeof rootObject[indexer] != "array" && options.observe.length > 0 && ko.utils.arrayIndexOf(options.observe, fullPropertyName) == -1)
					{
						mappedRootObject[indexer] = rootObject[indexer];
						options.copiedProperties[fullPropertyName] = true;
						return;
					}
					
					// In case we are adding an already mapped property, fill it with the previously mapped property value to prevent recursion.
					// If this is a property that was generated by fromJS, we should use the options specified there
					var prevMappedProperty = visitedObjects.get(rootObject[indexer]);
					var retval = updateViewModel(mappedRootObject[indexer], rootObject[indexer], options, indexer, mappedRootObject, fullPropertyName, mappedRootObject);
					var value = prevMappedProperty || retval;
					
					if(options.observe.length > 0 && ko.utils.arrayIndexOf(options.observe, fullPropertyName) == -1)
					{
						mappedRootObject[indexer] = value();
						options.copiedProperties[fullPropertyName] = true;
						return;
					}
					
					if (ko.isWriteableObservable(mappedRootObject[indexer])) {
						value = ko.utils.unwrapObservable(value);
						if (mappedRootObject[indexer]() !== value) {
							mappedRootObject[indexer](value);
						}
					} else {
						value = mappedRootObject[indexer] === undefined ? value : ko.utils.unwrapObservable(value);
						mappedRootObject[indexer] = value;
					}

					options.mappedProperties[fullPropertyName] = true;
				});
			}
		} else { //mappedRootObject is an array
			var changes = [];

			var hasKeyCallback = false;
			var keyCallback = function (x) {
				return x;
			}
			if (options[parentName] && options[parentName].key) {
				keyCallback = options[parentName].key;
				hasKeyCallback = true;
			}

			if (!ko.isObservable(mappedRootObject)) {
				// When creating the new observable array, also add a bunch of utility functions that take the 'key' of the array items into account.
				mappedRootObject = ko.observableArray([]);

				mappedRootObject.mappedRemove = function (valueOrPredicate) {
					var predicate = typeof valueOrPredicate == "function" ? valueOrPredicate : function (value) {
							return value === keyCallback(valueOrPredicate);
						};
					return mappedRootObject.remove(function (item) {
						return predicate(keyCallback(item));
					});
				}

				mappedRootObject.mappedRemoveAll = function (arrayOfValues) {
					var arrayOfKeys = filterArrayByKey(arrayOfValues, keyCallback);
					return mappedRootObject.remove(function (item) {
						return ko.utils.arrayIndexOf(arrayOfKeys, keyCallback(item)) != -1;
					});
				}

				mappedRootObject.mappedDestroy = function (valueOrPredicate) {
					var predicate = typeof valueOrPredicate == "function" ? valueOrPredicate : function (value) {
							return value === keyCallback(valueOrPredicate);
						};
					return mappedRootObject.destroy(function (item) {
						return predicate(keyCallback(item));
					});
				}

				mappedRootObject.mappedDestroyAll = function (arrayOfValues) {
					var arrayOfKeys = filterArrayByKey(arrayOfValues, keyCallback);
					return mappedRootObject.destroy(function (item) {
						return ko.utils.arrayIndexOf(arrayOfKeys, keyCallback(item)) != -1;
					});
				}

				mappedRootObject.mappedIndexOf = function (item) {
					var keys = filterArrayByKey(mappedRootObject(), keyCallback);
					var key = keyCallback(item);
					return ko.utils.arrayIndexOf(keys, key);
				}

				mappedRootObject.mappedGet = function (item) {
					return mappedRootObject()[mappedRootObject.mappedIndexOf(item)];
				}

				mappedRootObject.mappedCreate = function (value) {
					if (mappedRootObject.mappedIndexOf(value) !== -1) {
						throw new Error("There already is an object with the key that you specified.");
					}

					var item = hasCreateCallback() ? createCallback(value) : value;
					if (hasUpdateCallback()) {
						var newValue = updateCallback(item, value);
						if (ko.isWriteableObservable(item)) {
							item(newValue);
						} else {
							item = newValue;
						}
					}
					mappedRootObject.push(item);
					return item;
				}
			}

			var currentArrayKeys = filterArrayByKey(ko.utils.unwrapObservable(mappedRootObject), keyCallback).sort();
			var newArrayKeys = filterArrayByKey(rootObject, keyCallback);
			if (hasKeyCallback) newArrayKeys.sort();
			var editScript = ko.utils.compareArrays(currentArrayKeys, newArrayKeys);

			var ignoreIndexOf = {};
			
			var i, j;

			var unwrappedRootObject = ko.utils.unwrapObservable(rootObject);
			var itemsByKey = {};
			var optimizedKeys = true;
			for (i = 0, j = unwrappedRootObject.length; i < j; i++) {
				var key = keyCallback(unwrappedRootObject[i]);
				if (key === undefined || key instanceof Object) {
					optimizedKeys = false;
					break;
				}
				itemsByKey[key] = unwrappedRootObject[i];
			}

			var newContents = [];
			var passedOver = 0;
			for (i = 0, j = editScript.length; i < j; i++) {
				var key = editScript[i];
				var mappedItem;
				var fullPropertyName = parentPropertyName + "[" + i + "]";
				switch (key.status) {
				case "added":
					var item = optimizedKeys ? itemsByKey[key.value] : getItemByKey(ko.utils.unwrapObservable(rootObject), key.value, keyCallback);
					mappedItem = updateViewModel(undefined, item, options, parentName, mappedRootObject, fullPropertyName, parent);
					if(!hasCreateCallback()) {
						mappedItem = ko.utils.unwrapObservable(mappedItem);
					}

					var index = ignorableIndexOf(ko.utils.unwrapObservable(rootObject), item, ignoreIndexOf);
					
					if (mappedItem === emptyReturn) {
						passedOver++;
					} else {
						newContents[index - passedOver] = mappedItem;
					}
						
					ignoreIndexOf[index] = true;
					break;
				case "retained":
					var item = optimizedKeys ? itemsByKey[key.value] : getItemByKey(ko.utils.unwrapObservable(rootObject), key.value, keyCallback);
					mappedItem = getItemByKey(mappedRootObject, key.value, keyCallback);
					updateViewModel(mappedItem, item, options, parentName, mappedRootObject, fullPropertyName, parent);

					var index = ignorableIndexOf(ko.utils.unwrapObservable(rootObject), item, ignoreIndexOf);
					newContents[index] = mappedItem;
					ignoreIndexOf[index] = true;
					break;
				case "deleted":
					mappedItem = getItemByKey(mappedRootObject, key.value, keyCallback);
					break;
				}

				changes.push({
					event: key.status,
					item: mappedItem
				});
			}

			mappedRootObject(newContents);

			if (options[parentName] && options[parentName].arrayChanged) {
				ko.utils.arrayForEach(changes, function (change) {
					options[parentName].arrayChanged(change.event, change.item);
				});
			}
		}

		return mappedRootObject;
	}

	function ignorableIndexOf(array, item, ignoreIndices) {
		for (var i = 0, j = array.length; i < j; i++) {
			if (ignoreIndices[i] === true) continue;
			if (array[i] === item) return i;
		}
		return null;
	}

	function mapKey(item, callback) {
		var mappedItem;
		if (callback) mappedItem = callback(item);
		if (exports.getType(mappedItem) === "undefined") mappedItem = item;

		return ko.utils.unwrapObservable(mappedItem);
	}

	function getItemByKey(array, key, callback) {
		array = ko.utils.unwrapObservable(array);
		for (var i = 0, j = array.length; i < j; i++) {
			var item = array[i];
			if (mapKey(item, callback) === key) return item;
		}

		throw new Error("When calling ko.update*, the key '" + key + "' was not found!");
	}

	function filterArrayByKey(array, callback) {
		return ko.utils.arrayMap(ko.utils.unwrapObservable(array), function (item) {
			if (callback) {
				return mapKey(item, callback);
			} else {
				return item;
			}
		});
	}

	function visitPropertiesOrArrayEntries(rootObject, visitorCallback) {
		if (exports.getType(rootObject) === "array") {
			for (var i = 0; i < rootObject.length; i++)
			visitorCallback(i);
		} else {
			for (var propertyName in rootObject)
			visitorCallback(propertyName);
		}
	};

	function canHaveProperties(object) {
		var type = exports.getType(object);
		return ((type === "object") || (type === "array")) && (object !== null);
	}

	// Based on the parentName, this creates a fully classified name of a property

	function getPropertyName(parentName, parent, indexer) {
		var propertyName = parentName || "";
		if (exports.getType(parent) === "array") {
			if (parentName) {
				propertyName += "[" + indexer + "]";
			}
		} else {
			if (parentName) {
				propertyName += ".";
			}
			propertyName += indexer;
		}
		return propertyName;
	}

	exports.visitModel = function (rootObject, callback, options) {
		options = options || {};
		options.visitedObjects = options.visitedObjects || new objectLookup();

		var mappedRootObject;
		var unwrappedRootObject = ko.utils.unwrapObservable(rootObject);

		if (!canHaveProperties(unwrappedRootObject)) {
			return callback(rootObject, options.parentName);
		} else {
			options = fillOptions(options, unwrappedRootObject[mappingProperty]);

			// Only do a callback, but ignore the results
			callback(rootObject, options.parentName);
			mappedRootObject = exports.getType(unwrappedRootObject) === "array" ? [] : {};
		}

		options.visitedObjects.save(rootObject, mappedRootObject);

		var parentName = options.parentName;
		visitPropertiesOrArrayEntries(unwrappedRootObject, function (indexer) {
			if (options.ignore && ko.utils.arrayIndexOf(options.ignore, indexer) != -1) return;

			var propertyValue = unwrappedRootObject[indexer];
			options.parentName = getPropertyName(parentName, unwrappedRootObject, indexer);

			// If we don't want to explicitly copy the unmapped property...
			if (ko.utils.arrayIndexOf(options.copy, indexer) === -1) {
				// ...find out if it's a property we want to explicitly include
				if (ko.utils.arrayIndexOf(options.include, indexer) === -1) {
					// The mapped properties object contains all the properties that were part of the original object.
					// If a property does not exist, and it is not because it is part of an array (e.g. "myProp[3]"), then it should not be unmapped.
				    if (unwrappedRootObject[mappingProperty]
				        && unwrappedRootObject[mappingProperty].mappedProperties && !unwrappedRootObject[mappingProperty].mappedProperties[indexer]
				        && unwrappedRootObject[mappingProperty].copiedProperties && !unwrappedRootObject[mappingProperty].copiedProperties[indexer]
				        && !(exports.getType(unwrappedRootObject) === "array")) {
						return;
					}
				}
			}

			var outputProperty;
			switch (exports.getType(ko.utils.unwrapObservable(propertyValue))) {
			case "object":
			case "array":
			case "undefined":
				var previouslyMappedValue = options.visitedObjects.get(propertyValue);
				mappedRootObject[indexer] = (exports.getType(previouslyMappedValue) !== "undefined") ? previouslyMappedValue : exports.visitModel(propertyValue, callback, options);
				break;
			default:
				mappedRootObject[indexer] = callback(propertyValue, options.parentName);
			}
		});

		return mappedRootObject;
	}

	function simpleObjectLookup() {
		var keys = [];
		var values = [];
		this.save = function (key, value) {
			var existingIndex = ko.utils.arrayIndexOf(keys, key);
			if (existingIndex >= 0) values[existingIndex] = value;
			else {
				keys.push(key);
				values.push(value);
			}
		};
		this.get = function (key) {
			var existingIndex = ko.utils.arrayIndexOf(keys, key);
			var value = (existingIndex >= 0) ? values[existingIndex] : undefined;
			return value;
		};
	};
	
	function objectLookup() {
		var buckets = {};
		
		var findBucket = function(key) {
			var bucketKey;
			try {
				bucketKey = key;//JSON.stringify(key);
			}
			catch (e) {
				bucketKey = "$$$";
			}

			var bucket = buckets[bucketKey];
			if (bucket === undefined) {
				bucket = new simpleObjectLookup();
				buckets[bucketKey] = bucket;
			}
			return bucket;
		};
		
		this.save = function (key, value) {
			findBucket(key).save(key, value);
		};
		this.get = function (key) {
			return findBucket(key).get(key);
		};
	};
}));
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],15:[function(require,module,exports){
(function (global){
// Knockout Fast Mapping v0.1
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

(function (factory) {
	// Module systems magic dance.

	if (typeof require === "function" && typeof exports === "object" && typeof module === "object") {
		// CommonJS or Node: hard-coded dependency on "knockout"
		factory((typeof window !== "undefined" ? window['ko'] : typeof global !== "undefined" ? global['ko'] : null), exports);
	} else if (typeof define === "function" && define["amd"]) {
		// AMD anonymous module with hard-coded dependency on "knockout"
		define(["knockout", "exports"], factory);
	} else {
		// <script> tag: use the global `ko` object, attaching a `wrap` property
		factory(ko, ko.wrap = {});
	}
}(function (ko, exports) {
    
    // this function mimics ko.mapping
    exports.fromJS = function(jsObject, computedFunctions)
    {
        reset();
	return wrap(jsObject, computedFunctions);
    }

    // this function unwraps the outer for assigning the result to an observable
    // see https://github.com/SteveSanderson/knockout/issues/517
    exports.updateFromJS = function(observable, jsObject, computedFunctions)
    {
        reset();
	return observable(ko.utils.unwrapObservable(wrap(jsObject, computedFunctions)));
    }

    exports.fromJSON = function (jsonString, computedFunctions) {
	var parsed = ko.utils.parseJson(jsonString);
	arguments[0] = parsed;
	return exports.fromJS.apply(this, computedFunctions);
    };
    
    exports.toJS = function (observable) {
	return unwrap(observable);
    }

    exports.toJSON = function (observable) {
	var plainJavaScriptObject = exports.toJS(observable);
	return ko.utils.stringifyJson(plainJavaScriptObject);
    };

    function typeOf(value) {
	var s = typeof value;
	if (s === 'object') {
            if (value) {
                if (value.constructor == Date)
                    s = 'date';
		else if (Object.prototype.toString.call(value) == '[object Array]')
                    s = 'array';
            } else {
		s = 'null';
            }
	}
	return s;
    }

    // unwrapping
    function unwrapObject(o)
    {
	var t = {};

	for (var k in o)
	{
	    var v = o[k];

	    if (ko.isComputed(v))
		continue;

	    t[k] = unwrap(v);
	}

	return t;
    }

    function unwrapArray(a)
    {
	var r = [];

	if (!a || a.length == 0)
	    return r;
	
	for (var i = 0, l = a.length; i < l; ++i)
	    r.push(unwrap(a[i]));

	return r;
    }

    function unwrap(v)
    {
	var isObservable = ko.isObservable(v);

	if (isObservable)
	{
	    var val = v();

	    return unwrap(val);
	}
	else
	{
	    if (typeOf(v) == "array")
	    {
		return unwrapArray(v);
	    }
	    else if (typeOf(v) == "object")
	    {
		return unwrapObject(v);
	    }
	    else
	    {
		return v;
	    }
	}
    }

    function reset()
    {
        parents = [{obj: null, wrapped: null, lvl: ""}];
    }    
    
    // wrapping

    function wrapObject(o, computedFunctions)
    {
        // check for infinite recursion
        for (var i = 0; i < parents.length; ++i) {
            if (parents[i].obj === o) {
                return parents[i].wrapped;
            }
        }

	var t = {};

	for (var k in o)
	{
	    var v = o[k];

            parents.push({obj: o, wrapped: t, lvl: currentLvl() + "/" + k});

	    t[k] = wrap(v, computedFunctions);

            parents.pop();
	}

	if (computedFunctions && computedFunctions[currentLvl()])
	    t = computedFunctions[currentLvl()](t);

        if (hasES5Plugin())
            ko.track(t);

	return t;
    }

    function wrapArray(a, computedFunctions)
    {
	var r = ko.observableArray();

	if (!a || a.length == 0)
	    return r;

	for (var i = 0, l = a.length; i < l; ++i)
	    r.push(wrap(a[i], computedFunctions));

	return r;
    }

    // a stack, used for two purposes:
    //  - circular reference checking
    //  - computed functions
    var parents;

    function currentLvl()
    {
	return parents[parents.length-1].lvl;
    }

    function wrap(v, computedFunctions)
    {
	if (typeOf(v) == "array")
	{
	    return wrapArray(v, computedFunctions);
	}
	else if (typeOf(v) == "object")
	{
	    return wrapObject(v, computedFunctions);
	}
	else
	{
            if (!hasES5Plugin() && typeof v !== 'function')
            {
	        var t = ko.observable();
	        t(v);
	        return t;
            } else
                return v;
	}
    }

    function hasES5Plugin()
    {
        return ko.track != null;
    }
}));
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[12])(12)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJ3d3cvanMvaGVyb2NhbGMvaGVyb2NhbGNfYWJpbGl0aWVzLmpzIiwid3d3L2pzL2hlcm9jYWxjL2hlcm9jYWxjX2FiaWxpdHlkYXRhLmpzIiwid3d3L2pzL2hlcm9jYWxjL2hlcm9jYWxjX2J1ZmZzLmpzIiwid3d3L2pzL2hlcm9jYWxjL2hlcm9jYWxjX2NvcmUuanMiLCJ3d3cvanMvaGVyb2NhbGMvaGVyb2NhbGNfaGVyby5pbGx1c2lvbi5qcyIsInd3dy9qcy9oZXJvY2FsYy9oZXJvY2FsY19oZXJvLmpzIiwid3d3L2pzL2hlcm9jYWxjL2hlcm9jYWxjX2hlcm8ubWVlcG8uanMiLCJ3d3cvanMvaGVyb2NhbGMvaGVyb2NhbGNfaGVyb19kYW1hZ2UuanMiLCJ3d3cvanMvaGVyb2NhbGMvaGVyb2NhbGNfaW52ZW50b3J5LmpzIiwid3d3L2pzL2hlcm9jYWxjL2hlcm9jYWxjX2tub2Nrb3V0LmpzIiwid3d3L2pzL2hlcm9jYWxjL2hlcm9jYWxjX3VuaXQuanMiLCJ3d3cvanMvaGVyb2NhbGMvbWFpbi5qcyIsInd3dy9qcy9oZXJvY2FsYy9wb2x5ZmlsbC5qcyIsInd3dy9qcy9saWIva25vY2tvdXQubWFwcGluZy5qcyIsInd3dy9qcy9saWIva25vY2tvdXQud3JhcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbDRFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMytHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6cEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNyNENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3J5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG52YXIga28gPSByZXF1aXJlKCcuL2hlcm9jYWxjX2tub2Nrb3V0Jyk7XG4gICAgXG52YXIgbXkgPSByZXF1aXJlKFwiLi9oZXJvY2FsY19jb3JlXCIpO1xuXG5teS5wcm90b3R5cGUuQWJpbGl0eU1vZGVsID0gZnVuY3Rpb24gKGEsIGgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5oZXJvID0gaDtcbiAgICBzZWxmLmFiaWxpdHlEYXRhID0gbXkucHJvdG90eXBlLmFiaWxpdHlEYXRhO1xuICAgIHNlbGYuaGFzU2NlcHRlciA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xuICAgIHNlbGYuaXNTaGFwZVNoaWZ0QWN0aXZlID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgc2VsZi5hYmlsaXRpZXMgPSBhO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0ubGV2ZWwgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5pc0FjdGl2ZSA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5pc0RldGFpbCA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5iYXNlRGFtYWdlID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uYmFzZURhbWFnZVJlZHVjdGlvblBjdCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmJhc2VEYW1hZ2VNdWx0aXBsaWVyID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uYmFzaCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmJhc2hCb251c0RhbWFnZSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmJvbnVzRGFtYWdlID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uYm9udXNEYW1hZ2VPcmIgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5ib251c0RhbWFnZVBjdCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmJvbnVzRGFtYWdlUHJlY2lzaW9uQXVyYSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmJvbnVzRGFtYWdlUmVkdWN0aW9uID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uYm9udXNIZWFsdGggPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5ib251c1N0cmVuZ3RoID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uYm9udXNTdHJlbmd0aDIgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5ib251c0FnaWxpdHkgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5ib251c0FnaWxpdHkyID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uYm9udXNJbnQgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5ib251c0FsbFN0YXRzUmVkdWN0aW9uID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uZGFtYWdlQW1wbGlmaWNhdGlvbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmRhbWFnZVJlZHVjdGlvbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmV2YXNpb24gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5tYWdpY1Jlc2lzdCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLm1hbmFyZWdlbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLm1hbmFyZWdlbnJlZHVjdGlvbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLm1pc3NDaGFuY2UgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5tb3ZlbWVudFNwZWVkRmxhdCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLm1vdmVtZW50U3BlZWRQY3QgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5tb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0udHVyblJhdGVSZWR1Y3Rpb24gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5hdHRhY2tyYW5nZSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmF0dGFja3NwZWVkID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uYXR0YWNrc3BlZWRyZWR1Y3Rpb24gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5hcm1vciA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLmFybW9yUmVkdWN0aW9uID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgc2VsZi5hYmlsaXRpZXNbaV0uaGVhbHRocmVnZW4gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5saWZlc3RlYWwgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS52aXNpb25uaWdodCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2ldLnZpc2lvbmRheSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgfVxuICAgIHNlbGYuYWJpbGl0eUNvbnRyb2xEYXRhID0ge307XG4gICAgc2VsZi5hYmlsaXR5U2V0dGluZ3NEYXRhID0gZnVuY3Rpb24gKGRhdGEsIHBhcmVudCwgaW5kZXgpIHtcbiAgICAgICAgaWYgKHNlbGYuYWJpbGl0eUNvbnRyb2xEYXRhW2RhdGFdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHNlbGYucHJvY2Vzc0FiaWxpdHkoZGF0YSwgcGFyZW50LCBpbmRleCwgc2VsZi5hYmlsaXR5RGF0YVtkYXRhXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5hYmlsaXR5Q29udHJvbERhdGFbZGF0YV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgc2VsZi5wcm9jZXNzQWJpbGl0eSA9IGZ1bmN0aW9uIChkYXRhLCBwYXJlbnQsIGluZGV4LCBhcmdzKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgICAgcmVzdWx0LmRhdGEgPSBbXTtcbiAgICAgICAgdmFyIHY7XG4gICAgICAgIHZhciB2X2xpc3QgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgc3dpdGNoIChhcmdzW2ldLmNvbnRyb2xUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnaW5wdXQnOlxuICAgICAgICAgICAgICAgICAgICB2ID0ga28ub2JzZXJ2YWJsZSgwKS5leHRlbmQoeyBudW1lcmljOiAyIH0pO1xuICAgICAgICAgICAgICAgICAgICB2LmNvbnRyb2xWYWx1ZVR5cGUgPSBhcmdzW2ldLmNvbnRyb2xWYWx1ZVR5cGU7XG4gICAgICAgICAgICAgICAgICAgIHZfbGlzdC5wdXNoKHYpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0YS5wdXNoKHsgbGFiZWxOYW1lOiBhcmdzW2ldLmxhYmVsLnRvVXBwZXJDYXNlKCkgKyAnOicsIGNvbnRyb2xWYWw6IHYsIGNvbnRyb2xUeXBlOiBhcmdzW2ldLmNvbnRyb2xUeXBlLCBkaXNwbGF5OiBhcmdzW2ldLmRpc3BsYXkgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICAgICAgICAgICAgICB2ID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHYuY29udHJvbFZhbHVlVHlwZSA9IGFyZ3NbaV0uY29udHJvbFZhbHVlVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgdl9saXN0LnB1c2godik7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRhLnB1c2goeyBsYWJlbE5hbWU6IGFyZ3NbaV0ubGFiZWwudG9VcHBlckNhc2UoKSArICc/JywgY29udHJvbFZhbDogdiwgY29udHJvbFR5cGU6IGFyZ3NbaV0uY29udHJvbFR5cGUsIGRpc3BsYXk6IGFyZ3NbaV0uZGlzcGxheSB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdyYWRpbyc6XG4gICAgICAgICAgICAgICAgICAgIHYgPSBrby5vYnNlcnZhYmxlKGFyZ3NbaV0uY29udHJvbE9wdGlvbnNbMF0udmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB2LmNvbnRyb2xWYWx1ZVR5cGUgPSBhcmdzW2ldLmNvbnRyb2xWYWx1ZVR5cGU7XG4gICAgICAgICAgICAgICAgICAgIHZfbGlzdC5wdXNoKHYpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0YS5wdXNoKHsgbGFiZWxOYW1lOiBhcmdzW2ldLmxhYmVsLnRvVXBwZXJDYXNlKCkgKyAnPycsIGNvbnRyb2xWYWw6IHYsIGNvbnRyb2xUeXBlOiBhcmdzW2ldLmNvbnRyb2xUeXBlLCBkaXNwbGF5OiBhcmdzW2ldLmRpc3BsYXksIGNvbnRyb2xPcHRpb25zOiBhcmdzW2ldLmNvbnRyb2xPcHRpb25zIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ21ldGhvZCc6XG4gICAgICAgICAgICAgICAgY2FzZSAndGV4dCc6XG4gICAgICAgICAgICAgICAgICAgIC8vIHNpbmdsZSBpbnB1dCBhYmlsaXRpZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0uY29udHJvbHMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1tpXS5ub0xldmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZVZhbHVlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtmbjoga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXMuZmluZChmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIubmFtZSA9PSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoX2FiaWxpdHkuYXR0cmlidXRlcywgYXR0cmlidXRlTmFtZSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZVZhbHVlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtmbjoga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXMuZmluZChmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIubmFtZSA9PSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoX2FiaWxpdHkuYXR0cmlidXRlcywgYXR0cmlidXRlTmFtZSwgX2FiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBhdHRyaWJ1dGVWYWx1ZShhcmdzW2ldLmF0dHJpYnV0ZU5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHNlbGYuZ2V0Q29tcHV0ZWRGdW5jdGlvbih2LCBnLmZuLCBhcmdzW2ldLmZuLCBwYXJlbnQsIGluZGV4LCBzZWxmLCBhcmdzW2ldLnJldHVyblByb3BlcnR5LCB1bmRlZmluZWQsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0uaWdub3JlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b29sdGlwID0gYXJnc1tpXS5sYWJlbCB8fCBhcmdzW2ldLmF0dHJpYnV0ZU5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbHRpcCA9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVRvb2x0aXAoc2VsZi5hYmlsaXRpZXNbaW5kZXhdLmF0dHJpYnV0ZXMsIGFyZ3NbaV0uYXR0cmlidXRlTmFtZSkgfHwgYXJnc1tpXS5sYWJlbCB8fCBhcmdzW2ldLmF0dHJpYnV0ZU5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0YS5wdXNoKHsgbGFiZWxOYW1lOiB0b29sdGlwLnRvVXBwZXJDYXNlKCksIGNvbnRyb2xWYWw6IHIsIGNvbnRyb2xUeXBlOiBhcmdzW2ldLmNvbnRyb2xUeXBlLCBkaXNwbGF5OiBhcmdzW2ldLmRpc3BsYXksIGNsZWFuOiBnLmZuIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIG11bHRpIGlucHV0IGFiaWxpdGllc1xuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzW2ldLm5vTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlVmFsdWUgPSBmdW5jdGlvbiAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge2ZuOiBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaW5kZXhdLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZU5hbWUsIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVWYWx1ZSA9IGZ1bmN0aW9uIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7Zm46IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpbmRleF0uYXR0cmlidXRlcywgYXR0cmlidXRlTmFtZSwgc2VsZi5hYmlsaXRpZXNbaW5kZXhdLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gYXR0cmlidXRlVmFsdWUoYXJnc1tpXS5hdHRyaWJ1dGVOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBzZWxmLmdldENvbXB1dGVkRnVuY3Rpb24odl9saXN0LCBnLmZuLCBhcmdzW2ldLmZuLCBwYXJlbnQsIGluZGV4LCBzZWxmLCBhcmdzW2ldLnJldHVyblByb3BlcnR5LCBhcmdzW2ldLmNvbnRyb2xzLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzW2ldLmlnbm9yZVRvb2x0aXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbHRpcCA9IGFyZ3NbaV0ubGFiZWwgfHwgYXJnc1tpXS5hdHRyaWJ1dGVOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvb2x0aXAgPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVUb29sdGlwKHNlbGYuYWJpbGl0aWVzW2luZGV4XS5hdHRyaWJ1dGVzLCBhcmdzW2ldLmF0dHJpYnV0ZU5hbWUpIHx8IGFyZ3NbaV0ubGFiZWwgfHwgYXJnc1tpXS5hdHRyaWJ1dGVOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRhdGEucHVzaCh7IGxhYmVsTmFtZTogdG9vbHRpcC50b1VwcGVyQ2FzZSgpLCBjb250cm9sVmFsOiByLCBjb250cm9sVHlwZTogYXJnc1tpXS5jb250cm9sVHlwZSwgZGlzcGxheTogYXJnc1tpXS5kaXNwbGF5LCBjbGVhbjogZy5mbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0uY29udHJvbFR5cGUgPT0gJ21ldGhvZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZfbGlzdC5wdXNoKHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5hYmlsaXR5Q29udHJvbERhdGFbZGF0YV0gPSByZXN1bHQ7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgc2VsZi5nZXRDb21wdXRlZEZ1bmN0aW9uID0gZnVuY3Rpb24gKHYsIGF0dHJpYnV0ZVZhbHVlLCBmbiwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCByZXR1cm5Qcm9wZXJ0eSwgY29udHJvbHMsIGFiaWxpdHlOYW1lKSB7XG4gICAgICAgIHZhciBfYWJpbGl0eSA9IGFiaWxpdHlNb2RlbC5hYmlsaXRpZXMuZmluZChmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5uYW1lID09IGFiaWxpdHlOYW1lO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIGlucHV0VmFsdWU7XG4gICAgICAgICAgICBpZiAoY29udHJvbHMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHYgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUgPSB2O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdigpID09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2LmNvbnRyb2xWYWx1ZVR5cGUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUgPSBwYXJzZUZsb2F0KHYoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHYuY29udHJvbFZhbHVlVHlwZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IHBhcnNlRmxvYXQodigpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgdl9saXN0ID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaT0wO2k8Y29udHJvbHMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiB2W2NvbnRyb2xzW2ldXSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdl9saXN0LnB1c2godltjb250cm9sc1tpXV0oKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdl9saXN0LnB1c2gocGFyc2VGbG9hdCh2W2NvbnRyb2xzW2ldXSgpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdl9saXN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcmV0dXJuVmFsID0gZm4uY2FsbCh0aGlzLCBpbnB1dFZhbHVlLCBhdHRyaWJ1dGVWYWx1ZSgpLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIF9hYmlsaXR5KTtcbiAgICAgICAgICAgIGlmIChyZXR1cm5Qcm9wZXJ0eSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBfYWJpbGl0eVtyZXR1cm5Qcm9wZXJ0eV0ocmV0dXJuVmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWw7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cblxuICAgIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZXMsIGF0dHJpYnV0ZU5hbWUsIGxldmVsKSB7XG4gICAgICAgIGZvciAodmFyIGk9MDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVzW2ldLm5hbWUgPT0gYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGlmIChsZXZlbCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGF0dHJpYnV0ZXNbaV0udmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChsZXZlbCA+IGF0dHJpYnV0ZXNbaV0udmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGF0dHJpYnV0ZXNbaV0udmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYXR0cmlidXRlc1tpXS52YWx1ZVtsZXZlbC0xXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVG9vbHRpcCA9IGZ1bmN0aW9uIChhdHRyaWJ1dGVzLCBhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgIGZvciAodmFyIGk9MDsgaTxhdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlc1tpXS5uYW1lID09IGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlc1tpXS5oYXNPd25Qcm9wZXJ0eSgndG9vbHRpcCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gYXR0cmlidXRlc1tpXS50b29sdGlwLnJlcGxhY2UoL1xcXFxuL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgXG4gICAgc2VsZi5nZXRBYmlsaXR5TGV2ZWxCeUFiaWxpdHlOYW1lID0gZnVuY3Rpb24gKGFiaWxpdHlOYW1lKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmFiaWxpdGllc1tpXS5uYW1lID09IGFiaWxpdHlOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYWJpbGl0aWVzW2ldLmxldmVsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cblxuICAgIHNlbGYuZ2V0QWJpbGl0eUJ5TmFtZSA9IGZ1bmN0aW9uIChhYmlsaXR5TmFtZSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5hYmlsaXRpZXNbaV0ubmFtZSA9PSBhYmlsaXR5TmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHNlbGYuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUgPSBmdW5jdGlvbiAoYWJpbGl0eSwgcHJvcGVydHkpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYWJpbGl0eVtwcm9wZXJ0eV0oKVthYmlsaXR5LmxldmVsKCktMV0pO1xuICAgIH1cbiAgICBcbiAgICBzZWxmLmdldEF0dHJpYnV0ZUJvbnVzTGV2ZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmFiaWxpdGllc1tpXS5uYW1lID09ICdhdHRyaWJ1dGVfYm9udXMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYWJpbGl0aWVzW2ldLmxldmVsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7ICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgc2VsZi5nZXRBbGxTdGF0c1JlZHVjdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICAvKnN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludm9rZXJfcXVhc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX3N0cmVuZ3RoJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlW2FiaWxpdHkubGV2ZWwoKS0xXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkuYm9udXNBbGxTdGF0c1JlZHVjdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzbGFya19lc3NlbmNlX3NoaWZ0XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlKz1hYmlsaXR5LmJvbnVzQWxsU3RhdHNSZWR1Y3Rpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0U3RyZW5ndGhSZWR1Y3Rpb24gPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgLypzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnZva2VyX3F1YXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19zdHJlbmd0aCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVthYmlsaXR5LmxldmVsKCktMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSovXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmJvbnVzU3RyZW5ndGggIT0gdW5kZWZpbmVkICYmIGFiaWxpdHkubmFtZSA9PSAndW5keWluZ19kZWNheScpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyB1bmR5aW5nX2RlY2F5XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlLT1hYmlsaXR5LmJvbnVzU3RyZW5ndGgoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0U3RyZW5ndGggPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgLypzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnZva2VyX3F1YXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19zdHJlbmd0aCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVthYmlsaXR5LmxldmVsKCktMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSovXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5ib251c1N0cmVuZ3RoICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpIHx8IGFiaWxpdHkubmFtZSA9PSAnaW52b2tlcl9xdWFzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHB1ZGdlX2ZsZXNoX2hlYXAsaW52b2tlcl9xdWFzLG1vcnBobGluZ19tb3JwaF9zdHIsbW9ycGhsaW5nX21vcnBoX2FnaSx1bmR5aW5nX2RlY2F5XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSs9YWJpbGl0eS5ib251c1N0cmVuZ3RoKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkuYm9udXNTdHJlbmd0aDIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBtb3JwaGxpbmdfbW9ycGhfc3RyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSs9YWJpbGl0eS5ib251c1N0cmVuZ3RoMigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmdldEFnaWxpdHkgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZHJvd19yYW5nZXJfbWFya3NtYW5zaGlwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFya3NtYW5zaGlwX2FnaWxpdHlfYm9udXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmJvbnVzQWdpbGl0eSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSB8fCBhYmlsaXR5Lm5hbWUgPT0gJ2ludm9rZXJfd2V4JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludm9rZXJfd2V4LG1vcnBobGluZ19tb3JwaF9hZ2ksbW9ycGhsaW5nX21vcnBoX3N0clxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkuYm9udXNBZ2lsaXR5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkuYm9udXNBZ2lsaXR5MiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludm9rZXJfd2V4LG1vcnBobGluZ19tb3JwaF9hZ2ksbW9ycGhsaW5nX21vcnBoX3N0clxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkuYm9udXNBZ2lsaXR5MigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcblxuICAgIHNlbGYuZ2V0SW50ZWxsaWdlbmNlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludm9rZXJfZXhvcnRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qICAgIGNhc2UgJ2JvbnVzX2ludGVsbGlnZW5jZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyovXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmJvbnVzSW50ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkgfHwgYWJpbGl0eS5uYW1lID09ICdpbnZva2VyX2V4b3J0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaW52b2tlcl9leG9ydFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSs9YWJpbGl0eS5ib251c0ludCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRBcm1vciA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBheGVfYmVyc2Vya2Vyc19jYWxsLGRyYWdvbl9rbmlnaHRfZHJhZ29uX2Jsb29kLHRyb2xsX3dhcmxvcmRfYmVyc2Vya2Vyc19yYWdlLGx5Y2FuX3NoYXBlc2hpZnQsZW5yYWdlZF93aWxka2luX3RvdWdobmVzc19hdXJhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfYXJtb3InOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lICE9ICd0ZW1wbGFyX2Fzc2Fzc2luX21lbGQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN2ZW5fd2FyY3J5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnd2FyY3J5X2FybW9yJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGljaF9mcm9zdF9hcm1vcixvZ3JlX21hZ2lfZnJvc3RfYXJtb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhcm1vcl9ib251cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2xpY2hfZnJvc3RfYXJtb3InIHx8IGFiaWxpdHkubmFtZSA9PSAnb2dyZV9tYWdpX2Zyb3N0X2FybW9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkuYXJtb3IgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2hyZWRkZXJfcmVhY3RpdmVfYXJtb3IsdmlzYWdlX2dyYXZla2VlcGVyc19jbG9ha1xuICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSs9YWJpbGl0eS5hcm1vcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG5cbiAgICBzZWxmLmdldEFybW9yQmFzZVJlZHVjdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaChhYmlsaXR5Lm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZWxkZXJfdGl0YW5fbmF0dXJhbF9vcmRlclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZWxkZXJfdGl0YW5fbmF0dXJhbF9vcmRlcic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEtc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2FybW9yX3JlZHVjdGlvbl9wY3QnLCBhYmlsaXR5LmxldmVsKCkpLzEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRBcm1vclJlZHVjdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaChhYmlsaXR5Lm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGVtcGxhcl9hc3Nhc3Npbl9tZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd0ZW1wbGFyX2Fzc2Fzc2luX21lbGQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdib251c19hcm1vcicsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRpZGVodW50ZXJfZ3VzaFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndGlkZWh1bnRlcl9ndXNoJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCAnYXJtb3JfYm9udXMnLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBuYWdhX3NpcmVuX3JpcF90aWRlXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICduYWdhX3NpcmVuX3JpcF90aWRlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNsYXJkYXJfYW1wbGlmeV9kYW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NsYXJkYXJfYW1wbGlmeV9kYW1hZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmVuZ2VmdWxzcGlyaXRfd2F2ZV9vZl90ZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ZlbmdlZnVsc3Bpcml0X3dhdmVfb2ZfdGVycm9yJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCAnYXJtb3JfcmVkdWN0aW9uJywgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV2ZXJtb3JlX2RhcmtfbG9yZFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmV2ZXJtb3JlX2RhcmtfbG9yZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ3ByZXNlbmNlX2FybW9yX3JlZHVjdGlvbicsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkuYXJtb3JSZWR1Y3Rpb24gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWxjaGVtaXN0X2FjaWRfc3ByYXlcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkuYXJtb3JSZWR1Y3Rpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuXG4gICAgc2VsZi5nZXRIZWFsdGggPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9uZV9kcnVpZF90cnVlX2Zvcm0sbHljYW5fc2hhcGVzaGlmdCx0cm9sbF93YXJsb3JkX2JlcnNlcmtlcnNfcmFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2hwJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9uZV9kcnVpZF9zeW5lcmd5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndHJ1ZV9mb3JtX2hwX2JvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuaXNUcnVlRm9ybUFjdGl2ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5ib251c0hlYWx0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjbGlua3pfZGVhdGhfcGFjdFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSs9YWJpbGl0eS5ib251c0hlYWx0aCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5pc1RydWVGb3JtQWN0aXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKGFiaWxpdHkuaXNBY3RpdmUoKSAmJiBhYmlsaXR5Lm5hbWUgPT0gJ2xvbmVfZHJ1aWRfdHJ1ZV9mb3JtJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBzZWxmLmdldEhlYWx0aFJlZ2VuID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsY2hlbWlzdF9jaGVtaWNhbF9yYWdlLCBkcmFnb25fa25pZ2h0X2RyYWdvbl9ibG9vZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2hlYWx0aF9yZWdlbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnJvb2Rtb3RoZXJfc3Bpbl93ZWJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdoZWF0aF9yZWdlbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb21uaWtuaWdodF9ndWFyZGlhbl9hbmdlbCx0cmVhbnRfbGl2aW5nX2FybW9yLHNhdHlyX2hlbGxjYWxsZXJfdW5ob2x5X2F1cmFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdoZWFsdGhfcmVnZW4nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsZWdpb25fY29tbWFuZGVyX3ByZXNzX3RoZV9hdHRhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdocF9yZWdlbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5oZWFsdGhyZWdlbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzaHJlZGRlcl9yZWFjdGl2ZV9hcm1vcixpbnZva2VyX3F1YXMsbmVjcm9seXRlX3NhZGlzdFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSs9YWJpbGl0eS5oZWFsdGhyZWdlbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG5cbiAgICBzZWxmLmdldE1hbmEgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2JzaWRpYW5fZGVzdHJveWVyX2Vzc2VuY2VfYXVyYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX21hbmEnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRNYW5hUmVnZW4gPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxjaGVtaXN0X2NoZW1pY2FsX3JhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tYW5hX3JlZ2VuJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5Lm1hbmFyZWdlbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBuZWNyb2x5dGVfc2FkaXN0XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlKz1hYmlsaXR5Lm1hbmFyZWdlbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRNYW5hUmVnZW5BcmNhbmVBdXJhID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyeXN0YWxfbWFpZGVuX2JyaWxsaWFuY2VfYXVyYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbmFfcmVnZW4nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdjcnlzdGFsX21haWRlbl9icmlsbGlhbmNlX2F1cmEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcblxuICAgIHNlbGYuZ2V0TWFuYVJlZ2VuUmVkdWN0aW9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAvLyBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGNhc2UgJyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlW2FiaWxpdHkubGV2ZWwoKS0xXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5tYW5hcmVnZW5yZWR1Y3Rpb24gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcHVnbmFfbmV0aGVyX3dhcmRcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkubWFuYXJlZ2VucmVkdWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmdldEF0dGFja1JhbmdlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbnRlcl93eXZlcm5fYXJjdGljX2J1cm5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhdHRhY2tfcmFuZ2VfYm9udXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0ZW1wbGFyX2Fzc2Fzc2luX3BzaV9ibGFkZXMsc25pcGVyX3Rha2VfYWltXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfYXR0YWNrX3JhbmdlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0ZXJyb3JibGFkZV9tZXRhbW9ycGhvc2lzLHRyb2xsX3dhcmxvcmRfYmVyc2Vya2Vyc19yYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfcmFuZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICd0ZXJyb3JibGFkZV9tZXRhbW9ycGhvc2lzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAndHJvbGxfd2FybG9yZF9iZXJzZXJrZXJzX3JhZ2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAtPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRpbnlfZ3Jvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX3JhbmdlX3NjZXB0ZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICd0aW55X2dyb3cnICYmIHNlbGYuaGFzU2NlcHRlcigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuY2hhbnRyZXNzX2ltcGV0dXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19hdHRhY2tfcmFuZ2Vfc2NlcHRlcic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2VuY2hhbnRyZXNzX2ltcGV0dXMnICYmIHNlbGYuaGFzU2NlcHRlcigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGxvbmVfZHJ1aWRfdHJ1ZV9mb3JtXG4gICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2xvbmVfZHJ1aWRfdHJ1ZV9mb3JtJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gNDIyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgYWJpbGl0eS5uYW1lID09ICdlbmNoYW50cmVzc19pbXBldHVzJyAmJiBzZWxmLmhhc1NjZXB0ZXIoKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2F0dGFja19yYW5nZV9zY2VwdGVyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmF0dGFja3JhbmdlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRyYWdvbl9rbmlnaHRfZWxkZXJfZHJhZ29uX2Zvcm1cbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkuYXR0YWNrcmFuZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0QXR0YWNrU3BlZWQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWJhZGRvbl9mcm9zdG1vdXJuZSx0cm9sbF93YXJsb3JkX2JhdHRsZV90cmFuY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhdHRhY2tfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZpc2FnZV9ncmF2ZV9jaGlsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F0dGFja3NwZWVkX2JvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtaXJhbmFfbGVhcFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xlYXBfc3BlZWRib251c19hcyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGlmZV9zdGVhbGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXR0YWNrX3NwZWVkX2JvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xpbmt6X3N0cmFmZSx1cnNhX292ZXJwb3dlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F0dGFja19zcGVlZF9ib251c19wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdjbGlua3pfc3RyYWZlJyB8fCBhYmlsaXR5Lm5hbWUgPT0gJ3Vyc2Ffb3ZlcnBvd2VyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBheGVfY3VsbGluZ19ibGFkZSxuZWNyb25vbWljb25fYXJjaGVyX2FvZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NwZWVkX2JvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnYXhlX2N1bGxpbmdfYmxhZGUnIHx8IGFiaWxpdHkubmFtZSA9PSAnbmVjcm9ub21pY29uX2FyY2hlcl9hb2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuY2llbnRfYXBwYXJpdGlvbl9jaGlsbGluZ190b3VjaFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F0dGFja19zcGVlZF9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdhbmNpZW50X2FwcGFyaXRpb25fY2hpbGxpbmdfdG91Y2gnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlYXN0bWFzdGVyX2lubmVyX2JlYXN0LGx5Y2FuX2ZlcmFsX2ltcHVsc2UsbG9uZV9kcnVpZF9yYWJpZCx0aW55X2dyb3cscGhhbnRvbV9hc3Nhc3Npbl9waGFudG9tX3N0cmlrZSx3aW5kcnVubmVyX2ZvY3VzZmlyZSxvZ3JlX21hZ2lfYmxvb2RsdXN0LGNlbnRhdXJfa2hhbl9lbmR1cmFuY2VfYXVyYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2F0dGFja19zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2JlYXN0bWFzdGVyX2lubmVyX2JlYXN0JyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IGFiaWxpdHkubmFtZSA9PSAnbHljYW5fZmVyYWxfaW1wdWxzZScgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBhYmlsaXR5Lm5hbWUgPT0gJ2xvbmVfZHJ1aWRfcmFiaWQnIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgYWJpbGl0eS5uYW1lID09ICd0aW55X2dyb3cnIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgYWJpbGl0eS5uYW1lID09ICdwaGFudG9tX2Fzc2Fzc2luX3BoYW50b21fc3RyaWtlJyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IGFiaWxpdHkubmFtZSA9PSAnd2luZHJ1bm5lcl9mb2N1c2ZpcmUnIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgYWJpbGl0eS5uYW1lID09ICdvZ3JlX21hZ2lfYmxvb2RsdXN0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgYWJpbGl0eS5uYW1lID09ICdjZW50YXVyX2toYW5fZW5kdXJhbmNlX2F1cmEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5hdHRhY2tzcGVlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyB0cm9sbF93YXJsb3JkX2ZlcnZvcix3aXNwX292ZXJjaGFyZ2UsbGluYV9maWVyeV9zb3VsLGludm9rZXJfYWxhY3JpdHksaW52b2tlcl93ZXgsaHVza2FyX2JlcnNlcmtlcnNfYmxvb2RcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkuYXR0YWNrc3BlZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuXG4gICAgc2VsZi5nZXRBdHRhY2tTcGVlZFJlZHVjdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuaWdodF9zdGFsa2VyX3ZvaWQsY3J5c3RhbF9tYWlkZW5fY3J5c3RhbF9ub3ZhLGdob3N0X2Zyb3N0X2F0dGFjayxvZ3JlX21hZ2lfZnJvc3RfYXJtb3IscG9sYXJfZnVyYm9sZ191cnNhX3dhcnJpb3JfdGh1bmRlcl9jbGFwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXR0YWNrc3BlZWRfc2xvdyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGljaF9mcm9zdF9hcm1vcixsaWNoX2Zyb3N0X25vdmEsZW5jaGFudHJlc3NfdW50b3VjaGFibGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzbG93X2F0dGFja19zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmVhc3RtYXN0ZXJfcHJpbWFsX3JvYXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzbG93X2F0dGFja19zcGVlZF9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JtX3NwaXJpdF9vdmVybG9hZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ292ZXJsb2FkX2F0dGFja19zbG93JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb21uaWtuaWdodF9kZWdlbl9hdXJhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3BlZWRfYm9udXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdvbW5pa25pZ2h0X2RlZ2VuX2F1cmEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHR1c2tfZnJvemVuX3NpZ2lsLGNyeXN0YWxfbWFpZGVuX2ZyZWV6aW5nX2ZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXR0YWNrX3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdjcnlzdGFsX21haWRlbl9mcmVlemluZ19maWVsZCcgJiYgIXNlbGYuaGFzU2NlcHRlcigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3R1c2tfZnJvemVuX3NpZ2lsJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhdHRhY2tfc2xvd19zY2VwdGVyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnY3J5c3RhbF9tYWlkZW5fZnJlZXppbmdfZmllbGQnICYmIHNlbGYuaGFzU2NlcHRlcigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZhY2VsZXNzX3ZvaWRfdGltZV93YWxrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXR0YWNrX3NwZWVkX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2ZhY2VsZXNzX3ZvaWRfdGltZV93YWxrJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBib3VudHlfaHVudGVyX2ppbmFkYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2F0dGFja3NwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnYm91bnR5X2h1bnRlcl9qaW5hZGEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJyZXdtYXN0ZXJfdGh1bmRlcl9jbGFwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXR0YWNrX3NwZWVkX3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdicmV3bWFzdGVyX3RodW5kZXJfY2xhcCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlIC09IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWVkdXNhX3N0b25lX2dhemVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzbG93JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnbWVkdXNhX3N0b25lX2dhemUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAtPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZpc2FnZV9ncmF2ZV9jaGlsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F0dGFja3NwZWVkX2JvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWJhZGRvbl9mcm9zdG1vdXJuZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F0dGFja19zbG93X3Rvb2x0aXAnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdhYmFkZG9uX2Zyb3N0bW91cm5lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdlbnJhZ2VkX3dpbGRraW5fdG9ybmFkbycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlIC09IDE1O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5hdHRhY2tzcGVlZHJlZHVjdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyB2aXBlcl92aXBlcl9zdHJpa2UsdmlwZXJfY29ycm9zaXZlX3NraW4samFraXJvX2xpcXVpZF9maXJlLGxpY2hfY2hhaW5fZnJvc3Qsc2FuZGtpbmdfZXBpY2VudGVyLGVhcnRoX3NwaXJpdF9yb2xsaW5nX2JvdWxkZXJcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkuYXR0YWNrc3BlZWRyZWR1Y3Rpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIHNlbGYuZ2V0QmFzaCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzbGFyZGFyX2Jhc2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjaGFuY2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNuaXBlcl9oZWFkc2hvdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Byb2NfY2hhbmNlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5iYXNoICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIHNwaXJpdF9icmVha2VyX2dyZWF0ZXJfYmFzaCxmYWNlbGVzc192b2lkX3RpbWVfbG9ja1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gYWJpbGl0eS5iYXNoKCkvMTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pOyAgICBcbiAgICBzZWxmLmdldEJhc2VEYW1hZ2UgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIHZhciB0b3RhbE11bHRpcGxpZXIgPSAxO1xuICAgICAgICB2YXIgc291cmNlcyA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRpbnlfZ3Jvdyx0ZXJyb3JibGFkZV9tZXRhbW9ycGhvc2lzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfZGFtYWdlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAndGlueV9ncm93JyB8fCBhYmlsaXR5Lm5hbWUgPT0gJ3RlcnJvcmJsYWRlX21ldGFtb3JwaG9zaXMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkuYmFzZURhbWFnZU11bHRpcGxpZXIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVhcnRoc2hha2VyX2VuY2hhbnRfdG90ZW1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTXVsdGlwbGllciArPSBhYmlsaXR5LmJhc2VEYW1hZ2VNdWx0aXBsaWVyKCkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgLyp0b3RhbEF0dHJpYnV0ZSArPSBhYmlsaXR5LmJhc2VEYW1hZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogYWJpbGl0eS5iYXNlRGFtYWdlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmJhc2VEYW1hZ2UgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNsaW5rel9kZWF0aF9wYWN0XG4gICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBhYmlsaXR5LmJhc2VEYW1hZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogYWJpbGl0eS5iYXNlRGFtYWdlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzb3VyY2VzOiBzb3VyY2VzLCB0b3RhbDogdG90YWxBdHRyaWJ1dGUsIG11bHRpcGxpZXI6IHRvdGFsTXVsdGlwbGllciB9O1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0U2VsZkJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWVkdXNhX3NwbGl0X3Nob3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkYW1hZ2VfbW9kaWZpZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSArIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZHJ1bm5lcl9mb2N1c2ZpcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmb2N1c2ZpcmVfZGFtYWdlX3JlZHVjdGlvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VsZi5oYXNTY2VwdGVyKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZvY3VzZmlyZV9kYW1hZ2VfcmVkdWN0aW9uX3NjZXB0ZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5oYXNTY2VwdGVyKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmdldEJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmVuZ2VmdWxzcGlyaXRfY29tbWFuZF9hdXJhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfZGFtYWdlX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3ZlbmdlZnVsc3Bpcml0X2NvbW1hbmRfYXVyYScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5iYXNlRGFtYWdlUmVkdWN0aW9uUGN0ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5ldmVybW9yZV9yZXF1aWVtXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxICsgYWJpbGl0eS5iYXNlRGFtYWdlUmVkdWN0aW9uUGN0KCkvMTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0QkFUID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyb2xsX3dhcmxvcmRfYmVyc2Vya2Vyc19yYWdlLGFsY2hlbWlzdF9jaGVtaWNhbF9yYWdlLGxvbmVfZHJ1aWRfdHJ1ZV9mb3JtLGx5Y2FuX3NoYXBlc2hpZnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdiYXNlX2F0dGFja190aW1lJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIHNlbGYuZ2V0Qm9udXNEYW1hZ2UgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnJvb2Rtb3RoZXJfaW5zYXRpYWJsZV9odW5nZXIsbHVuYV9sdW5hcl9ibGVzc2luZyx0ZW1wbGFyX2Fzc2Fzc2luX3JlZnJhY3Rpb24sdGVtcGxhcl9hc3Nhc3Npbl9tZWxkLHRyb2xsX3dhcmxvcmRfYmVyc2Vya2Vyc19yYWdlLGxvbmVfZHJ1aWRfdHJ1ZV9mb3JtX2JhdHRsZV9jcnlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19kYW1hZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdicm9vZG1vdGhlcl9pbnNhdGlhYmxlX2h1bmdlcicgfHwgYWJpbGl0eS5uYW1lID09ICdsdW5hX2x1bmFyX2JsZXNzaW5nJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgYWJpbGl0eS5uYW1lID09ICd0ZW1wbGFyX2Fzc2Fzc2luX3JlZnJhY3Rpb24nIHx8IGFiaWxpdHkubmFtZSA9PSAndGVtcGxhcl9hc3Nhc3Npbl9tZWxkJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgYWJpbGl0eS5uYW1lID09ICd0cm9sbF93YXJsb3JkX2JlcnNlcmtlcnNfcmFnZScgfHwgYWJpbGl0eS5uYW1lID09ICdsb25lX2RydWlkX3RydWVfZm9ybV9iYXR0bGVfY3J5Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBseWNhbl9ob3dsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaGVyb19ib251c19kYW1hZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogYWJpbGl0eS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnc3Rvcm1fc3Bpcml0X292ZXJsb2FkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5UHJvcGVydHlWYWx1ZShhYmlsaXR5LCAnZGFtYWdlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ21hZ2ljJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmJvbnVzRGFtYWdlICE9IHVuZGVmaW5lZCAmJiBhYmlsaXR5LmJvbnVzRGFtYWdlKCkgIT0gMCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5ldmVybW9yZV9uZWNyb21hc3RlcnksdXJzYV9mdXJ5X3N3aXBlcyx1cnNhX2VucmFnZSxpbnZva2VyX2FsYWNyaXR5LGludm9rZXJfZXhvcnQsZWxkZXJfdGl0YW5fYW5jZXN0cmFsX3NwaXJpdCxzcGVjdHJlX2Rlc29sYXRlLHJhem9yX3N0YXRpY19saW5rXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlKz1hYmlsaXR5LmJvbnVzRGFtYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2UnOiBhYmlsaXR5LmJvbnVzRGFtYWdlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6IGFiaWxpdHkubmFtZSA9PSAnc3BlY3RyZV9kZXNvbGF0ZScgPyAncHVyZScgOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogYWJpbGl0eS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHNvdXJjZXM6IHNvdXJjZXMsIHRvdGFsOiB0b3RhbEF0dHJpYnV0ZSB9O1xuICAgIH0pO1xuXG4gICAgc2VsZi5nZXRCb251c0RhbWFnZVBlcmNlbnQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmxvb2RzZWVrZXJfYmxvb2RyYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGFtYWdlX2luY3JlYXNlX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2Jsb29kc2Vla2VyX2Jsb29kcmFnZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYWduYXRhdXJfZW1wb3dlcix2ZW5nZWZ1bHNwaXJpdF9jb21tYW5kX2F1cmEsYWxwaGFfd29sZl9jb21tYW5kX2F1cmFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19kYW1hZ2VfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnbWFnbmF0YXVyX2VtcG93ZXInIHx8IGFiaWxpdHkubmFtZSA9PSAndmVuZ2VmdWxzcGlyaXRfY29tbWFuZF9hdXJhJyB8fCBhYmlsaXR5Lm5hbWUgPT0gJ2FscGhhX3dvbGZfY29tbWFuZF9hdXJhJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2UnOiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN2ZW5fZ29kc19zdHJlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dvZHNfc3RyZW5ndGhfZGFtYWdlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnc3Zlbl9nb2RzX3N0cmVuZ3RoJyAmJiBzZWxmLmhlcm8gIT0gdW5kZWZpbmVkICYmIHNlbGYuaGVyby5oZXJvSWQoKSA9PSAnc3ZlbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdnb2RzX3N0cmVuZ3RoX2RhbWFnZV9zY2VwdGVyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnc3Zlbl9nb2RzX3N0cmVuZ3RoJyAmJiBzZWxmLmhlcm8gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6ICdwaHlzaWNhbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogYWJpbGl0eS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmJvbnVzRGFtYWdlUGN0ICE9IHVuZGVmaW5lZCAmJiBhYmlsaXR5LmJvbnVzRGFtYWdlUGN0KCkgIT0gMCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGJsb29kc2Vla2VyX2Jsb29kcmFnZVxuICAgICAgICAgICAgICAgICAgICAvKnRvdGFsQXR0cmlidXRlKz1hYmlsaXR5LmJvbnVzRGFtYWdlUGN0KCkvMTAwO1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogYWJpbGl0eS5ib251c0RhbWFnZVBjdCgpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSovXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHNvdXJjZXM6IHNvdXJjZXMsIHRvdGFsOiB0b3RhbEF0dHJpYnV0ZSB9O1xuICAgIH0pO1xuXG4gICAgc2VsZi5nZXRCb251c0RhbWFnZUJhY2tzdGFiID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUxID0gMDtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlMiA9IDA7XG4gICAgICAgIHZhciBzb3VyY2VzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdyaWtpX2JhY2tzdGFiJykge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByaWtpX2JhY2tzdGFiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGFtYWdlX211bHRpcGxpZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZTEgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6ICdwaHlzaWNhbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LypcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkuYm9udXNEYW1hZ2VCYWNrc3RhYiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdib251c0RhbWFnZUJhY2tzdGFiJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkYW1hZ2VfbXVsdGlwbGllclxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUyKz1hYmlsaXR5LmJvbnVzRGFtYWdlQmFja3N0YWIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IGFiaWxpdHkuYm9udXNEYW1hZ2VCYWNrc3RhYigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzb3VyY2VzOiBzb3VyY2VzLCB0b3RhbDogW3RvdGFsQXR0cmlidXRlMSx0b3RhbEF0dHJpYnV0ZTJdIH07XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRCb251c0RhbWFnZVByZWNpc2lvbkF1cmEgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZTEgPSAwO1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUyID0gMDtcbiAgICAgICAgdmFyIHNvdXJjZXMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2Ryb3dfcmFuZ2VyX3RydWVzaG90Jykge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkcm93X3Jhbmdlcl90cnVlc2hvdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RydWVzaG90X3JhbmdlZF9kYW1hZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZTEgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkuYm9udXNEYW1hZ2VQcmVjaXNpb25BdXJhICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZHJvd19yYW5nZXJfdHJ1ZXNob3RcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlMis9YWJpbGl0eS5ib251c0RhbWFnZVByZWNpc2lvbkF1cmEoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IGFiaWxpdHkuYm9udXNEYW1hZ2VQcmVjaXNpb25BdXJhKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHNvdXJjZXM6IHNvdXJjZXMsIHRvdGFsOiBbdG90YWxBdHRyaWJ1dGUxLHRvdGFsQXR0cmlidXRlMl0gfTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmdldEJvbnVzRGFtYWdlUmVkdWN0aW9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhbmVfZW5mZWVibGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdlbmZlZWJsZV9hdHRhY2tfcmVkdWN0aW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmJvbnVzRGFtYWdlUmVkdWN0aW9uICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJ1Ymlja19mYWRlX2JvbHQscmF6b3Jfc3RhdGljX2xpbmtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkuYm9udXNEYW1hZ2VSZWR1Y3Rpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0Qm9udXNEYW1hZ2VSZWR1Y3Rpb25QY3QgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWVkdXNhX3NwbGl0X3Nob3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkYW1hZ2VfbW9kaWZpZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSArIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2luZHJ1bm5lcl9mb2N1c2ZpcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmb2N1c2ZpcmVfZGFtYWdlX3JlZHVjdGlvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VsZi5oYXNTY2VwdGVyKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZvY3VzZmlyZV9kYW1hZ2VfcmVkdWN0aW9uX3NjZXB0ZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5oYXNTY2VwdGVyKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcblxuICAgIHNlbGYuZ2V0RGFtYWdlQW1wbGlmaWNhdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIC8qaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhbmVfZW5mZWVibGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdlbmZlZWJsZV9hdHRhY2tfcmVkdWN0aW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkuZGFtYWdlQW1wbGlmaWNhdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyB1bmR5aW5nX2ZsZXNoX2dvbGVtXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxICsgYWJpbGl0eS5kYW1hZ2VBbXBsaWZpY2F0aW9uKCkvMTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0RGFtYWdlUmVkdWN0aW9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJsb29kc2Vla2VyX2Jsb29kcmFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RhbWFnZV9pbmNyZWFzZV9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdibG9vZHNlZWtlcl9ibG9vZHJhZ2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSArIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBrdW5ra2FfZ2hvc3RzaGlwXG4gICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2t1bmtrYV9naG9zdHNoaXAnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSAtIDUwLzEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmRhbWFnZVJlZHVjdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyB3aXNwX292ZXJjaGFyZ2UsYnJpc3RsZWJhY2tfYnJpc3RsZWJhY2ssc3BlY3RyZV9kaXNwZXJzaW9uLG1lZHVzYV9tYW5hX3NoaWVsZCx1cnNhX2VucmFnZVxuICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSArIGFiaWxpdHkuZGFtYWdlUmVkdWN0aW9uKCkvMTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuXG4gICAgc2VsZi5nZXRDcml0U291cmNlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc291cmNlcyA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGFiaWxpdHkubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGhhbnRvbV9hc3Nhc3Npbl9jb3VwX2RlX2dyYWNlLGJyZXdtYXN0ZXJfZHJ1bmtlbl9icmF3bGVyLGNoYW9zX2tuaWdodF9jaGFvc19zdHJpa2UsbHljYW5fc2hhcGVzaGlmdCxza2VsZXRvbl9raW5nX21vcnRhbF9zdHJpa2UsanVnZ2VybmF1dF9ibGFkZV9kYW5jZSxhbHBoYV93b2xmX2NyaXRpY2FsX3N0cmlrZSxnaWFudF93b2xmX2NyaXRpY2FsX3N0cmlrZVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncGhhbnRvbV9hc3Nhc3Npbl9jb3VwX2RlX2dyYWNlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2NyaXRfY2hhbmNlJywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXVsdGlwbGllcic6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdjcml0X2JvbnVzJywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogYWJpbGl0eS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JyZXdtYXN0ZXJfZHJ1bmtlbl9icmF3bGVyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2NyaXRfY2hhbmNlJywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXVsdGlwbGllcic6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdjcml0X211bHRpcGxpZXInLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2hhb3Nfa25pZ2h0X2NoYW9zX3N0cmlrZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdseWNhbl9zaGFwZXNoaWZ0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2NyaXRfY2hhbmNlJywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXVsdGlwbGllcic6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdjcml0X211bHRpcGxpZXInLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2tlbGV0b25fa2luZ19tb3J0YWxfc3RyaWtlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2NyaXRfY2hhbmNlJywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXVsdGlwbGllcic6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdjcml0X211bHQnLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnanVnZ2VybmF1dF9ibGFkZV9kYW5jZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdibGFkZV9kYW5jZV9jcml0X2NoYW5jZScsIGFiaWxpdHkubGV2ZWwoKSkvMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ211bHRpcGxpZXInOiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCAnYmxhZGVfZGFuY2VfY3JpdF9tdWx0JywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogYWJpbGl0eS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FscGhhX3dvbGZfY3JpdGljYWxfc3RyaWtlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dpYW50X3dvbGZfY3JpdGljYWxfc3RyaWtlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2NyaXRfY2hhbmNlJywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbXVsdGlwbGllcic6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdjcml0X211bHQnLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzb3VyY2VzO1xuICAgIH0pOyAgICBcblxuICAgIHNlbGYuZ2V0Q2xlYXZlU291cmNlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc291cmNlcyA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGFiaWxpdHkubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFnbmF0YXVyX2VtcG93ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hZ25hdGF1cl9lbXBvd2VyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmFkaXVzJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2NsZWF2ZV9yYWRpdXMnLCBhYmlsaXR5LmxldmVsKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21hZ25pdHVkZSc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdjbGVhdmVfZGFtYWdlX3BjdCcsIGFiaWxpdHkubGV2ZWwoKSkvMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdmVuX2dyZWF0X2NsZWF2ZVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3Zlbl9ncmVhdF9jbGVhdmUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2FiaWxpdHkubmFtZV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyYWRpdXMnOiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCAnZ3JlYXRfY2xlYXZlX3JhZGl1cycsIGFiaWxpdHkubGV2ZWwoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWFnbml0dWRlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgJ2dyZWF0X2NsZWF2ZV9kYW1hZ2UnLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8ga3Vua2thX3RpZGVicmluZ2VyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdrdW5ra2FfdGlkZWJyaW5nZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2FiaWxpdHkubmFtZV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyYWRpdXMnOiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCAncmFkaXVzJywgYWJpbGl0eS5sZXZlbCgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtYWduaXR1ZGUnOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aW55X2dyb3dcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RpbnlfZ3Jvdyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuaGFzU2NlcHRlcigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2FiaWxpdHkubmFtZV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JhZGl1cyc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsICdib251c19jbGVhdmVfcmFkaXVzX3NjZXB0ZXInLCBhYmlsaXR5LmxldmVsKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtYWduaXR1ZGUnOiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCAnYm9udXNfY2xlYXZlX2RhbWFnZV9zY2VwdGVyJywgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzb3VyY2VzO1xuICAgIH0pOyAgICBcbiAgICBcbiAgICBzZWxmLmdldENyaXRDaGFuY2UgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGhhbnRvbV9hc3Nhc3Npbl9jb3VwX2RlX2dyYWNlLGJyZXdtYXN0ZXJfZHJ1bmtlbl9icmF3bGVyLGNoYW9zX2tuaWdodF9jaGFvc19zdHJpa2UsbHljYW5fc2hhcGVzaGlmdCxza2VsZXRvbl9raW5nX21vcnRhbF9zdHJpa2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcml0X2NoYW5jZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7ICAgICAgICAgICAgXG4gICAgXG4gICAgc2VsZi5nZXRFdmFzaW9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBoYW50b21fYXNzYXNzaW5fYmx1clxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2V2YXNpb24nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJyZXdtYXN0ZXJfZHJ1bmtlbl9icmF3bGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZG9kZ2VfY2hhbmNlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmdldEV2YXNpb25CYWNrdHJhY2sgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmFjZWxlc3Nfdm9pZF9iYWNrdHJhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkb2RnZV9jaGFuY2VfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmdldE1pc3NDaGFuY2UgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnJvb2Rtb3RoZXJfaW5jYXBhY2l0YXRpbmdfYml0ZSxicmV3bWFzdGVyX2RydW5rZW5faGF6ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21pc3NfY2hhbmNlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByaWtpX3Ntb2tlX3NjcmVlbixrZWVwZXJfb2ZfdGhlX2xpZ2h0X2JsaW5kaW5nX2xpZ2h0LHRpbmtlcl9sYXNlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21pc3NfcmF0ZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkubWlzc0NoYW5jZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBuaWdodF9zdGFsa2VyX2NyaXBwbGluZ19mZWFyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlKj0oMS1hYmlsaXR5Lm1pc3NDaGFuY2UoKS8xMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRMaWZlc3RlYWwgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2tlbGV0b25fa2luZ192YW1waXJpY19hdXJhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndmFtcGlyaWNfYXVyYSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnJvb2Rtb3RoZXJfaW5zYXRpYWJsZV9odW5nZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdsaWZlc3RlYWxfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5LmxpZmVzdGVhbCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBsaWZlX3N0ZWFsZXJfb3Blbl93b3VuZHNcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkubGlmZXN0ZWFsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmdldE1hZ2ljUmVzaXN0ID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKCEoYWJpbGl0eS5uYW1lIGluIHNlbGYuYWJpbGl0eURhdGEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFudGltYWdlX3NwZWxsX3NoaWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NwZWxsX3NoaWVsZF9yZXNpc3RhbmNlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBoYW50b21fbGFuY2VyX3BoYW50b21fZWRnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hZ2ljX3Jlc2lzdGFuY2VfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAncGhhbnRvbV9sYW5jZXJfcGhhbnRvbV9lZGdlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcnViaWNrX251bGxfZmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtYWdpY19kYW1hZ2VfcmVkdWN0aW9uX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3J1Ymlja19udWxsX2ZpZWxkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5Lm1hZ2ljUmVzaXN0ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGh1c2thcl9iZXJzZXJrZXJzX2Jsb29kLHZpcGVyX2NvcnJvc2l2ZV9za2luLHZpc2FnZV9ncmF2ZWtlZXBlcnNfY2xvYWtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBhYmlsaXR5Lm1hZ2ljUmVzaXN0KCkvMTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuXG4gICAgc2VsZi5nZXRNYWdpY1Jlc2lzdFJlZHVjdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmNpZW50X2FwcGFyaXRpb25faWNlX3ZvcnRleFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NwZWxsX3Jlc2lzdF9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHB1Z25hX2RlY3JlcGlmeVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX3NwZWxsX2RhbWFnZV9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNreXdyYXRoX21hZ2VfYW5jaWVudF9zZWFsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVzaXN0X2RlYnVmZic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbGRlcl90aXRhbl9uYXR1cmFsX29yZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFnaWNfcmVzaXN0YW5jZV9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSAtIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0TW92ZW1lbnRTcGVlZEZsYXQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxjaGVtaXN0X2NoZW1pY2FsX3JhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tb3Zlc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdhbGNoZW1pc3RfY2hlbWljYWxfcmFnZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGlueV9ncm93XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbW92ZW1lbnRfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICd0aW55X2dyb3cnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyb2xsX3dhcmxvcmRfYmVyc2Vya2Vyc19yYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbW92ZV9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3Ryb2xsX3dhcmxvcmRfYmVyc2Vya2Vyc19yYWdlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvbmVfZHJ1aWRfdHJ1ZV9mb3JtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3BlZWRfbG9zcyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlIC09IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5tb3ZlbWVudFNwZWVkRmxhdCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBkcmFnb25fa25pZ2h0X2VsZGVyX2RyYWdvbl9mb3JtXG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkubW92ZW1lbnRTcGVlZEZsYXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWJhZGRvbl9mcm9zdG1vdXJuZSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3ZlX3NwZWVkX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm91bnR5X2h1bnRlcl90cmFjayBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tb3ZlX3NwZWVkX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWlyYW5hX2xlYXAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGVhcF9zcGVlZGJvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdmVuX3dhcmNyeSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd3YXJjcnlfbW92ZXNwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjbGlua3pfd2luZF93YWxrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbW92ZV9zcGVlZF9ib251c19wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRydW5uZXJfd2luZHJ1blxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVzcGVlZF9ib251c19wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnJvb2Rtb3RoZXJfc3Bpbl93ZWIsc3BlY3RyZV9zcGVjdHJhbF9kYWdnZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tb3Zlc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdicm9vZG1vdGhlcl9zcGluX3dlYicgfHwgYWJpbGl0eS5uYW1lID09ICdzcGVjdHJlX3NwZWN0cmFsX2RhZ2dlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGF4ZV9jdWxsaW5nX2JsYWRlLG5lY3Jvbm9taWNvbl9hcmNoZXJfYW9lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3BlZWRfYm9udXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdheGVfY3VsbGluZ19ibGFkZScgfHwgYWJpbGl0eS5uYW1lID09ICduZWNyb25vbWljb25fYXJjaGVyX2FvZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG55eF9hc3Nhc3Npbl92ZW5kZXR0YSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3ZlbWVudF9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ255eF9hc3Nhc3Npbl92ZW5kZXR0YScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNwaXJpdF9icmVha2VyX2VtcG93ZXJpbmdfaGFzdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tb3Zlc3BlZWRfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnc3Bpcml0X2JyZWFrZXJfZW1wb3dlcmluZ19oYXN0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9ncmVfbWFnaV9ibG9vZGx1c3QsZGVhdGhfcHJvcGhldF93aXRjaGNyYWZ0LGtvYm9sZF90YXNrbWFzdGVyX3NwZWVkX2F1cmFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tb3ZlbWVudF9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ29ncmVfbWFnaV9ibG9vZGx1c3QnIHx8IGFiaWxpdHkubmFtZSA9PSAnZGVhdGhfcHJvcGhldF93aXRjaGNyYWZ0JyB8fCBhYmlsaXR5Lm5hbWUgPT0gJ2tvYm9sZF90YXNrbWFzdGVyX3NwZWVkX2F1cmEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByYXpvcl91bnN0YWJsZV9jdXJyZW50LHBoYW50b21fbGFuY2VyX2RvcHBlbHdhbGtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3ZlbWVudF9zcGVlZF9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdyYXpvcl91bnN0YWJsZV9jdXJyZW50JyB8fCBhYmlsaXR5Lm5hbWUgPT0gJ3BoYW50b21fbGFuY2VyX2RvcHBlbHdhbGsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0cmVhbnRfbmF0dXJlc19ndWlzZSxsb25lX2RydWlkX3JhYmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbW92ZV9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3RyZWFudF9uYXR1cmVzX2d1aXNlJyB8fCBhYmlsaXR5Lm5hbWUgPT0gJ2xvbmVfZHJ1aWRfcmFiaWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aXNwX3RldGhlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVzcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3dpc3BfdGV0aGVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8ga3Vua2thX2dob3N0c2hpcCx2aXNhZ2VfZ3JhdmVfY2hpbGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3Zlc3BlZWRfYm9udXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdrdW5ra2FfZ2hvc3RzaGlwJyB8fCBhYmlsaXR5Lm5hbWUgPT0gJ3Zpc2FnZV9ncmF2ZV9jaGlsbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5Lm1vdmVtZW50U3BlZWRQY3QgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gYXhlX2JhdHRsZV9odW5nZXIsYnJpc3RsZWJhY2tfd2FycGF0aCxzcGlyaXRfYnJlYWtlcl9ncmVhdGVyX2Jhc2gsbGluYV9maWVyeV9zb3VsLGludm9rZXJfZ2hvc3Rfd2FsayxpbnZva2VyX3dleCxlbGRlcl90aXRhbl9hbmNlc3RyYWxfc3Bpcml0XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUrPWFiaWxpdHkubW92ZW1lbnRTcGVlZFBjdCgpLzEwMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuXG4gICAgc2VsZi5nZXRNb3ZlbWVudFNwZWVkUGVyY2VudFJlZHVjdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjcnlzdGFsX21haWRlbl9mcmVlemluZ19maWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVzcGVlZF9zbG93JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnY3J5c3RhbF9tYWlkZW5fZnJlZXppbmdfZmllbGQnICYmICFzZWxmLmhhc1NjZXB0ZXIoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbW92ZXNwZWVkX3Nsb3dfc2NlcHRlcic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2NyeXN0YWxfbWFpZGVuX2ZyZWV6aW5nX2ZpZWxkJyAmJiBzZWxmLmhhc1NjZXB0ZXIoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxkZXJfdGl0YW5fZWFydGhfc3BsaXR0ZXIsbWFnbmF0YXVyX3NrZXdlcixhYmFkZG9uX2Zyb3N0bW91cm5lIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Nsb3dfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5pZ2h0X3N0YWxrZXJfdm9pZCxjcnlzdGFsX21haWRlbl9jcnlzdGFsX25vdmEsZ2hvc3RfZnJvc3RfYXR0YWNrLG9ncmVfbWFnaV9mcm9zdF9hcm1vcixwb2xhcl9mdXJib2xnX3Vyc2Ffd2Fycmlvcl90aHVuZGVyX2NsYXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3Zlc3BlZWRfc2xvdyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgIT0gJ2NyeXN0YWxfbWFpZGVuX2ZyZWV6aW5nX2ZpZWxkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGljaF9mcm9zdF9hcm1vcixsaWNoX2Zyb3N0X25vdmEsZW5jaGFudHJlc3NfZW5jaGFudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Nsb3dfbW92ZW1lbnRfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlYXN0bWFzdGVyX3ByaW1hbF9yb2FyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2xvd19tb3ZlbWVudF9zcGVlZF9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRyb3dfcmFuZ2VyX2Zyb3N0X2Fycm93c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Zyb3N0X2Fycm93c19tb3ZlbWVudF9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2tlbGV0b25fa2luZ19oZWxsZmlyZV9ibGFzdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JsYXN0X3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNsYXJkYXJfc2xpdGhlcmVlbl9jcnVzaFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NydXNoX2V4dHJhX3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JtX3NwaXJpdF9vdmVybG9hZDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdvdmVybG9hZF9tb3ZlX3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbmRydW5uZXJfd2luZHJ1blxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2VuZW15X21vdmVzcGVlZF9ib251c19wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGhhbnRvbV9hc3Nhc3Npbl9zdGlmbGluZ19kYWdnZXIsdHVza19mcm96ZW5fc2lnaWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3ZlX3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdwaGFudG9tX2Fzc2Fzc2luX3N0aWZsaW5nX2RhZ2dlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3R1c2tfZnJvemVuX3NpZ2lsJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW52b2tlcl9pY2Vfd2FsbCxtZWR1c2Ffc3RvbmVfZ2F6ZSx3aXNwX3RldGhlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdtZWR1c2Ffc3RvbmVfZ2F6ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlIC09IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJyb29kbW90aGVyX2luY2FwYWNpdGF0aW5nX2JpdGUsYm91bnR5X2h1bnRlcl9qaW5hZGEsc3BlY3RyZV9zcGVjdHJhbF9kYWdnZXIsd2ludGVyX3d5dmVybl9hcmN0aWNfYnVyblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX21vdmVzcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2Jyb29kbW90aGVyX2luY2FwYWNpdGF0aW5nX2JpdGUnIHx8IGFiaWxpdHkubmFtZSA9PSAnYm91bnR5X2h1bnRlcl9qaW5hZGEnIHx8IGFiaWxpdHkubmFtZSA9PSAnd2ludGVyX3d5dmVybl9hcmN0aWNfYnVybicgfHwgYWJpbGl0eS5uYW1lID09ICd3aW50ZXJfd3l2ZXJuX3NwbGludGVyX2JsYXN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkubmFtZSA9PSAnc3BlY3RyZV9zcGVjdHJhbF9kYWdnZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAtPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvbW5pa25pZ2h0X2RlZ2VuX2F1cmFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzcGVlZF9ib251cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ29tbmlrbmlnaHRfZGVnZW5fYXVyYScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRpZGVodW50ZXJfZ3VzaFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVtZW50X3NwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAndGlkZWh1bnRlcl9ndXNoJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHVnbmFfZGVjcmVwaWZ5LGNoZW5fcGVuaXRlbmNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbW92ZW1lbnRfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdwdWduYV9kZWNyZXBpZnknIHx8IGFiaWxpdHkubmFtZSA9PSAnY2hlbl9wZW5pdGVuY2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmNpZW50X2FwcGFyaXRpb25faWNlX3ZvcnRleCxwaGFudG9tX2xhbmNlcl9zcGlyaXRfbGFuY2Usc2t5d3JhdGhfbWFnZV9jb25jdXNzaXZlX3Nob3QsZmFjZWxlc3Nfdm9pZF90aW1lX3dhbGtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3ZlbWVudF9zcGVlZF9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdhbmNpZW50X2FwcGFyaXRpb25faWNlX3ZvcnRleCcgfHwgYWJpbGl0eS5uYW1lID09ICdwaGFudG9tX2xhbmNlcl9zcGlyaXRfbGFuY2UnIHx8IGFiaWxpdHkubmFtZSA9PSAnZmFjZWxlc3Nfdm9pZF90aW1lX3dhbGsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5uYW1lID09ICdza3l3cmF0aF9tYWdlX2NvbmN1c3NpdmVfc2hvdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlIC09IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJhem9yX3Vuc3RhYmxlX2N1cnJlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzbG93X2Ftb3VudCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3Jhem9yX3Vuc3RhYmxlX2N1cnJlbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBicmV3bWFzdGVyX2RydW5rZW5faGF6ZSxicmV3bWFzdGVyX3RodW5kZXJfY2xhcCx0cmVhbnRfbGVlY2hfc2VlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVtZW50X3Nsb3cnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdicmV3bWFzdGVyX2RydW5rZW5faGF6ZScgfHwgYWJpbGl0eS5uYW1lID09ICdicmV3bWFzdGVyX3RodW5kZXJfY2xhcCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlIC09IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3Vyc2FfZWFydGhzaG9jaycgfHwgYWJpbGl0eS5uYW1lID09ICd0cmVhbnRfbGVlY2hfc2VlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNrZWxldG9uX2tpbmdfcmVpbmNhcm5hdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVzcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3NrZWxldG9uX2tpbmdfcmVpbmNhcm5hdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGt1bmtrYV90b3JyZW50LHZpc2FnZV9ncmF2ZV9jaGlsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVzcGVlZF9ib251cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2t1bmtrYV90b3JyZW50Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkubmFtZSA9PSAndmlzYWdlX2dyYXZlX2NoaWxsJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSkvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnc2F0eXJfdHJpY2tzdGVyX3B1cmdlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgLT0gODAvMTAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkubmFtZSA9PSAnZW5yYWdlZF93aWxka2luX3Rvcm5hZG8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAtPSAxNS8xMDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsaXR5Lm1vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYXhlX2JhdHRsZV9odW5nZXIsYmF0cmlkZXJfc3RpY2t5X25hcGFsbSxzaHJlZGRlcl9jaGFrcmFtLG1lZXBvX2dlb3N0cmlrZSxsaWZlX3N0ZWFsZXJfb3Blbl93b3VuZHMsXG4gICAgICAgICAgICAgICAgICAgIC8vIHZlbm9tYW5jZXJfcG9pc29uX3N0aW5nLHZpcGVyX3ZpcGVyX3N0cmlrZSx2aXBlcl9jb3Jyb3NpdmVfc2tpbix2aXBlcl9wb2lzb25fYXR0YWNrLHZlbm9tYW5jZXJfdmVub21vdXNfZ2FsZSx0cmVhbnRfbGVlY2hfc2VlZFxuICAgICAgICAgICAgICAgICAgICAvLyBsaWNoX2NoYWluX2Zyb3N0LHNuaXBlcl9zaHJhcG5lbCxjZW50YXVyX3N0YW1wZWRlLGh1c2thcl9saWZlX2JyZWFrLGpha2lyb19kdWFsX2JyZWF0aCxtZWVwb19nZW9zdHJpa2Usc2FuZGtpbmdfZXBpY2VudGVyXG4gICAgICAgICAgICAgICAgICAgIC8vIGVhcnRoX3NwaXJpdF9yb2xsaW5nX2JvdWxkZXIsaW52b2tlcl9naG9zdF93YWxrLGludm9rZXJfaWNlX3dhbGwsZWxkZXJfdGl0YW5fZWFydGhfc3BsaXR0ZXJcbiAgICAgICAgICAgICAgICAgICAgLy8gdW5keWluZ19mbGVzaF9nb2xlbSx0ZW1wbGFyX2Fzc2Fzc2luX3BzaW9uaWNfdHJhcCxuZXZlcm1vcmVfcmVxdWllbSxxdWVlbm9mcGFpbl9zaGFkb3dfc3RyaWtlXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlKz1hYmlsaXR5Lm1vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24oKS8xMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcblxuICAgIHNlbGYuZ2V0VHVyblJhdGVSZWR1Y3Rpb24gPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWVkdXNhX3N0b25lX2dhemVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzbG93JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnbWVkdXNhX3N0b25lX2dhemUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAtPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkudHVyblJhdGVSZWR1Y3Rpb24gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYmF0cmlkZXJfc3RpY2t5X25hcGFsbVxuICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSs9YWJpbGl0eS50dXJuUmF0ZVJlZHVjdGlvbigpLzEwMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0VmlzaW9uUmFuZ2VOaWdodCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHkgPSBzZWxmLmFiaWxpdGllc1tpXTtcbiAgICAgICAgICAgIGlmICghKGFiaWxpdHkubmFtZSBpbiBzZWxmLmFiaWxpdHlEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VsZi5hYmlsaXRpZXNbaV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aW50ZXJfd3l2ZXJuX2FyY3RpY19idXJuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmlnaHRfdmlzaW9uX2JvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBseWNhbl9zaGFwZXNoaWZ0LGx1bmFfbHVuYXJfYmxlc3NpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19uaWdodF92aXNpb24nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkudmlzaW9ubmlnaHQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlKz1hYmlsaXR5LnZpc2lvbm5pZ2h0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcblxuICAgIHNlbGYuZ2V0VmlzaW9uUmFuZ2VQY3RSZWR1Y3Rpb24gPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmlnaHRfc3RhbGtlcl9kYXJrbmVzc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JsaW5kX3BlcmNlbnRhZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuXG4gICAgc2VsZi5zZXRFdmFzaW9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYWJpbGl0eSA9IHNlbGYuYWJpbGl0aWVzW2ldO1xuICAgICAgICAgICAgaWYgKGFiaWxpdHkubGV2ZWwoKSA+IDAgJiYgKGFiaWxpdHkuaXNBY3RpdmUoKSB8fCAoYWJpbGl0eS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfUEFTU0lWRScpICE9IC0xKSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICd3aW5kcnVubmVyX3dpbmRydW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5zZXRNb3ZlbWVudFNwZWVkID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgTUFYX01PVkVTUEVFRCA9IDUyMjtcbiAgICAgICAgdmFyIE1JTl9NT1ZFU1BFRUQgPSAxMDA7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ3NwaXJpdF9icmVha2VyX2NoYXJnZV9vZl9kYXJrbmVzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ21vdmVtZW50X3NwZWVkJywgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnZGFya19zZWVyX3N1cmdlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTUFYX01PVkVTUEVFRDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGFiaWxpdHkubmFtZSA9PSAnY2VudGF1cl9zdGFtcGVkZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1BWF9NT1ZFU1BFRUQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5Lm5hbWUgPT0gJ2x5Y2FuX3NoYXBlc2hpZnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBNQVhfTU9WRVNQRUVEO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5uYW1lID09ICdsaW9uX3Zvb2RvbycgfHwgYWJpbGl0eS5uYW1lID09ICdzaGFkb3dfc2hhbWFuX3Zvb2RvbycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1JTl9NT1ZFU1BFRUQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9KTtcblxuICAgIHNlbGYuZ2V0QmFzaFNvdXJjZSA9IGZ1bmN0aW9uIChhdHRhY2t0eXBlKSB7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc25pcGVyX2hlYWRzaG90XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJvY19jaGFuY2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCAmJiBhYmlsaXR5Lm5hbWUgPT0gJ3NuaXBlcl9oZWFkc2hvdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNsYXJkYXJfYmFzaFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NoYW5jZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2FiaWxpdHkubmFtZV0gPT0gdW5kZWZpbmVkICYmIGFiaWxpdHkubmFtZSA9PSAnc2xhcmRhcl9iYXNoJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuY2UnOiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnYm9udXNfZGFtYWdlJywgYWJpbGl0eS5sZXZlbCgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxpdHkuYmFzaEJvbnVzRGFtYWdlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChhYmlsaXR5LmxldmVsKCkgPiAwICYmIChhYmlsaXR5LmlzQWN0aXZlKCkgfHwgKGFiaWxpdHkuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSAhPSAtMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZhY2VsZXNzX3ZvaWRfdGltZV9sb2NrXG4gICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2FiaWxpdHkubmFtZV0gPT0gdW5kZWZpbmVkICYmIGFiaWxpdHkubmFtZSA9PSAnZmFjZWxlc3Nfdm9pZF90aW1lX2xvY2snKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6IGFiaWxpdHkuYmFzaCgpLzEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogYWJpbGl0eS5iYXNoQm9udXNEYW1hZ2UoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ21hZ2ljJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBhYmlsaXR5LmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gc3Bpcml0X2JyZWFrZXJfZ3JlYXRlcl9iYXNoXG4gICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2FiaWxpdHkubmFtZV0gPT0gdW5kZWZpbmVkICYmIGFiaWxpdHkubmFtZSA9PSAnc3Bpcml0X2JyZWFrZXJfZ3JlYXRlcl9iYXNoJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuY2UnOiBhYmlsaXR5LmJhc2goKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IGFiaWxpdHkuYmFzaEJvbnVzRGFtYWdlKCkvMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAnbWFnaWMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzb3VyY2VzO1xuICAgIH07XG4gICAgXG4gICAgc2VsZi5nZXRPcmJTb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gc2VsZi5hYmlsaXRpZXNbaV07XG4gICAgICAgICAgICBpZiAoIShhYmlsaXR5Lm5hbWUgaW4gc2VsZi5hYmlsaXR5RGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlbGYuYWJpbGl0aWVzW2ldLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBzZWxmLmFiaWxpdGllc1tpXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW50aW1hZ2VfbWFuYV9icmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbmFfcGVyX2hpdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2FiaWxpdHkubmFtZV0gPT0gdW5kZWZpbmVkICYmIGFiaWxpdHkubmFtZSA9PSAnYW50aW1hZ2VfbWFuYV9icmVhaycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUubmFtZSwgYWJpbGl0eS5sZXZlbCgpKSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnZGFtYWdlX3Blcl9idXJuJywgYWJpbGl0eS5sZXZlbCgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6ICdwaHlzaWNhbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogYWJpbGl0eS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xpbmt6X3NlYXJpbmdfYXJyb3dzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGFtYWdlX2JvbnVzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbYWJpbGl0eS5uYW1lXSA9PSB1bmRlZmluZWQgJiYgYWJpbGl0eS5uYW1lID09ICdjbGlua3pfc2VhcmluZ19hcnJvd3MnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2FiaWxpdHkubmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgYXR0cmlidXRlLm5hbWUsIGFiaWxpdHkubGV2ZWwoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNpbGVuY2VyX2dsYWl2ZXNfb2Zfd2lzZG9tXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW50ZWxsZWN0X2RhbWFnZV9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCAmJiBhYmlsaXR5Lm5hbWUgPT0gJ3NpbGVuY2VyX2dsYWl2ZXNfb2Zfd2lzZG9tJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2UnOiBzZWxmLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZS5uYW1lLCBhYmlsaXR5LmxldmVsKCkpLzEwMCAqIHNlbGYuaGVyby50b3RhbEludCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3B1cmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IGFiaWxpdHkuZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWJpbGl0eS5ib251c0RhbWFnZU9yYiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWJpbGl0eS5sZXZlbCgpID4gMCAmJiAoYWJpbGl0eS5pc0FjdGl2ZSgpIHx8IChhYmlsaXR5LmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgIT0gLTEpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBvYnNpZGlhbl9kZXN0cm95ZXJfYXJjYW5lX29yYlxuICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1thYmlsaXR5Lm5hbWVdID09IHVuZGVmaW5lZCAmJiBhYmlsaXR5Lm5hbWUgPT0gJ29ic2lkaWFuX2Rlc3Ryb3llcl9hcmNhbmVfb3JiJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1thYmlsaXR5Lm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2UnOiBhYmlsaXR5LmJvbnVzRGFtYWdlT3JiKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncHVyZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogYWJpbGl0eS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gc291cmNlcztcbiAgICB9O1xuICAgIFxuICAgIHNlbGYudG9nZ2xlQWJpbGl0eSA9IGZ1bmN0aW9uIChpbmRleCwgZGF0YSwgZXZlbnQpIHtcbiAgICAgICAgaWYgKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJykgPCAwKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0uaXNBY3RpdmUoKSkge1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmlzQWN0aXZlKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmlzQWN0aXZlKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubmFtZSA9PSAnbHljYW5fc2hhcGVzaGlmdCcpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmlzU2hhcGVTaGlmdEFjdGl2ZShzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5pc0FjdGl2ZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKTtcblxuICAgIHNlbGYudG9nZ2xlQWJpbGl0eURldGFpbCA9IGZ1bmN0aW9uIChpbmRleCwgZGF0YSwgZXZlbnQpIHtcbiAgICAgICAgaWYgKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmlzRGV0YWlsKCkpIHtcbiAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmlzRGV0YWlsKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmlzRGV0YWlsKHRydWUpO1xuICAgICAgICB9XG4gICAgfS5iaW5kKHRoaXMpO1xuICAgIFxuICAgIHNlbGYuZ2V0QWJpbGl0eSA9IGZ1bmN0aW9uIChhYmlsaXR5TmFtZSkge1xuICAgICAgICByZXR1cm4gc2VsZi5hYmlsaXRpZXMuZmluZChmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5uYW1lID09IGFiaWxpdHlOYW1lO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbm15LnByb3RvdHlwZS5BYmlsaXR5TW9kZWwucHJvdG90eXBlLmxldmVsVXBBYmlsaXR5ID0gZnVuY3Rpb24gKGluZGV4LCBkYXRhLCBldmVudCwgaGVybykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSA8IGhlcm8uZ2V0QWJpbGl0eUxldmVsTWF4KGRhdGEpICYmIGhlcm8uYXZhaWxhYmxlU2tpbGxQb2ludHMoKSA+IDAgKSB7XG4gICAgICAgIHN3aXRjaChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5hYmlsaXR5dHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnRE9UQV9BQklMSVRZX1RZUEVfVUxUSU1BVEUnOlxuICAgICAgICAgICAgICAgIGlmIChoZXJvLmhlcm9JZCgpID09ICdpbnZva2VyJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSA9PSAwKSAmJiAocGFyc2VJbnQoaGVyby5zZWxlY3RlZEhlcm9MZXZlbCgpKSA+PSAyKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkgPT0gMSkgJiYgKHBhcnNlSW50KGhlcm8uc2VsZWN0ZWRIZXJvTGV2ZWwoKSkgPj0gNykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpID09IDIpICYmIChwYXJzZUludChoZXJvLnNlbGVjdGVkSGVyb0xldmVsKCkpID49IDExKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkgPT0gMykgJiYgKHBhcnNlSW50KGhlcm8uc2VsZWN0ZWRIZXJvTGV2ZWwoKSkgPj0gMTcpXG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSsxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlcm8uc2tpbGxQb2ludEhpc3RvcnkucHVzaChpbmRleCgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChoZXJvLmhlcm9JZCgpID09ICdtZWVwbycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkgKiA3ICsgMyA8PSBwYXJzZUludChoZXJvLnNlbGVjdGVkSGVyb0xldmVsKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKzEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVyby5za2lsbFBvaW50SGlzdG9yeS5wdXNoKGluZGV4KCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkrMSkgKiA1ICsgMSA8PSBwYXJzZUludChoZXJvLnNlbGVjdGVkSGVyb0xldmVsKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKzEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVyby5za2lsbFBvaW50SGlzdG9yeS5wdXNoKGluZGV4KCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGlmIChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpICogMiArIDEgPD0gcGFyc2VJbnQoaGVyby5zZWxlY3RlZEhlcm9MZXZlbCgpKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKzEpO1xuICAgICAgICAgICAgICAgICAgICBoZXJvLnNraWxsUG9pbnRIaXN0b3J5LnB1c2goaW5kZXgoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5uYW1lKSB7XG4gICAgICAgICAgICBjYXNlICdiZWFzdG1hc3Rlcl9jYWxsX29mX3RoZV93aWxkJzpcbiAgICAgICAgICAgIGNhc2UgJ2NoZW5fdGVzdF9vZl9mYWl0aCc6XG4gICAgICAgICAgICBjYXNlICdtb3JwaGxpbmdfbW9ycGhfYWdpJzpcbiAgICAgICAgICAgIGNhc2UgJ3NoYWRvd19kZW1vbl9zaGFkb3dfcG9pc29uJzpcbiAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpICsgMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21vcnBobGluZ19tb3JwaF9zdHInOlxuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAna2VlcGVyX29mX3RoZV9saWdodF9zcGlyaXRfZm9ybSc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAyXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbmV2ZXJtb3JlX3NoYWRvd3JhemUxJzpcbiAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpICsgMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSArIDJdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICduZXZlcm1vcmVfc2hhZG93cmF6ZTInOlxuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpICsgMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ25ldmVybW9yZV9zaGFkb3dyYXplMyc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAyXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZW1iZXJfc3Bpcml0X2ZpcmVfcmVtbmFudCc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsb25lX2RydWlkX3RydWVfZm9ybSc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG59O1xubXkucHJvdG90eXBlLkFiaWxpdHlNb2RlbC5wcm90b3R5cGUubGV2ZWxEb3duQWJpbGl0eSA9IGZ1bmN0aW9uIChpbmRleCwgZGF0YSwgZXZlbnQsIGhlcm8pIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaWYgKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkgPiAwKSB7XG4gICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkgLSAxKTtcbiAgICAgICAgaGVyby5za2lsbFBvaW50SGlzdG9yeS5zcGxpY2UoaGVyby5za2lsbFBvaW50SGlzdG9yeSgpLmxhc3RJbmRleE9mKGluZGV4KCkpLCAxKTtcbiAgICAgICAgc3dpdGNoIChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5uYW1lKSB7XG4gICAgICAgICAgICBjYXNlICdiZWFzdG1hc3Rlcl9jYWxsX29mX3RoZV93aWxkJzpcbiAgICAgICAgICAgIGNhc2UgJ2NoZW5fdGVzdF9vZl9mYWl0aCc6XG4gICAgICAgICAgICBjYXNlICdtb3JwaGxpbmdfbW9ycGhfYWdpJzpcbiAgICAgICAgICAgIGNhc2UgJ3NoYWRvd19kZW1vbl9zaGFkb3dfcG9pc29uJzpcbiAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpICsgMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21vcnBobGluZ19tb3JwaF9zdHInOlxuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAna2VlcGVyX29mX3RoZV9saWdodF9zcGlyaXRfZm9ybSc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAyXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbmV2ZXJtb3JlX3NoYWRvd3JhemUxJzpcbiAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpICsgMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSArIDJdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICduZXZlcm1vcmVfc2hhZG93cmF6ZTInOlxuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpICsgMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ25ldmVybW9yZV9zaGFkb3dyYXplMyc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAyXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZW1iZXJfc3Bpcml0X2ZpcmVfcmVtbmFudCc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsb25lX2RydWlkX3RydWVfZm9ybSc6XG4gICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG59OyIsIid1c2Ugc3RyaWN0JztcbiAgICBcbnZhciBteSA9IHJlcXVpcmUoXCIuL2hlcm9jYWxjX2NvcmVcIik7XG5cbm15LnByb3RvdHlwZS5hYmlsaXR5RGF0YSA9IHtcbiAgICAnYWxjaGVtaXN0X2FjaWRfc3ByYXknOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYXJtb3JfcmVkdWN0aW9uJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2FybW9yUmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnYWxjaGVtaXN0X3Vuc3RhYmxlX2NvbmNvY3Rpb24nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnQnJldyBUaW1lJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtYXhfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmEvNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21heF9zdHVuJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgU3R1bicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphLzU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdhbmNpZW50X2FwcGFyaXRpb25fY29sZF9mZWV0JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3N0dW5fZHVyYXRpb24nLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBTdHVuJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnYW5jaWVudF9hcHBhcml0aW9uX2ljZV9ibGFzdCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZG90X2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSt2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdhbnRpbWFnZV9tYW5hX3ZvaWQnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRW5lbXkgTWlzc2luZyBNYW5hJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtYW5hX3ZvaWRfZGFtYWdlX3Blcl9tYW5hJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdheGVfYmF0dGxlX2h1bmdlcic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdCYXR0bGUgSHVuZ2VyZWQgRW5lbWllcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc3BlZWRfYm9udXMnLFxuICAgICAgICAgICAgbGFiZWw6ICdNb3ZlbWVudCBTcGVlZCBCb251cycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgbm9MZXZlbDogdHJ1ZSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3QnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzbG93JyxcbiAgICAgICAgICAgIGxhYmVsOiAnTW92ZW1lbnQgU3BlZWQgQm9udXMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIG5vTGV2ZWw6IHRydWUsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2JhbmVfbmlnaHRtYXJlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnYmFuZV9maWVuZHNfZ3JpcCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IE1heCBNYW5hJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdmaWVuZF9ncmlwX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgY29udHJvbHM6IFswLDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmludmVudG9yeS5oYXNTY2VwdGVyKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZbMF0qYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdmaWVuZF9ncmlwX2RhbWFnZV9zY2VwdGVyJyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZbMF0qYTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdmaWVuZF9ncmlwX21hbmFfZHJhaW4nLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBNYW5hIERyYWluJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsMV0sXG4gICAgICAgICAgICBub0xldmVsOiB0cnVlLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmludmVudG9yeS5oYXNTY2VwdGVyKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZbMF0qdlsxXSphYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2ZpZW5kX2dyaXBfbWFuYV9kcmFpbl9zY2VwdGVyJyxhYmlsaXR5LmxldmVsKCkpLzEwMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2WzBdKnZbMV0qYS8xMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnYmF0cmlkZXJfc3RpY2t5X25hcGFsbSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdTdGFja3MnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIEJvbnVzIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYm9udXNEYW1hZ2UnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtb3ZlbWVudF9zcGVlZF9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdFbmVteSBNb3ZlbWVudCBTcGVlZCBTbG93JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAndHVybl9yYXRlX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IFR1cm4gUmF0ZSBTbG93JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAndHVyblJhdGVSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdiYXRyaWRlcl9maXJlZmx5JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2VfcGVyX3NlY29uZCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnYmxvb2RzZWVrZXJfcnVwdHVyZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdFbmVteSBEaXN0YW5jZSBUcmF2ZWxlZCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbW92ZW1lbnRfZGFtYWdlX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpICsgdiphLzEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2JyaXN0bGViYWNrX3Zpc2NvdXNfbmFzYWxfZ29vJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1N0YWNrcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYXJtb3JfcGVyX3N0YWNrJyxcbiAgICAgICAgICAgIGxhYmVsOiAnRW5lbXkgQXJtb3IgUmVkdWN0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXJtb3JSZWR1Y3Rpb24nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtb3ZlX3Nsb3dfcGVyX3N0YWNrJyxcbiAgICAgICAgICAgIGxhYmVsOiAnJVNMT1c6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLShhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2Jhc2VfbW92ZV9zbG93JywwKSt2KmEpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2JyaXN0bGViYWNrX3F1aWxsX3NwcmF5JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1N0YWNrcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncXVpbGxfc3RhY2tfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciB0b3RhbCA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAncXVpbGxfYmFzZV9kYW1hZ2UnLGFiaWxpdHkubGV2ZWwoKSkrdiphLFxuICAgICAgICAgICAgICAgIGRhbWFnZV9jYXAgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ21heF9kYW1hZ2UnLDApO1xuICAgICAgICAgICAgICAgIGlmICh0b3RhbCA+IGRhbWFnZV9jYXApIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBkYW1hZ2VfY2FwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdicmlzdGxlYmFja19icmlzdGxlYmFjayc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEYW1hZ2UgRnJvbScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3JhZGlvJyxcbiAgICAgICAgICAgIGNvbnRyb2xWYWx1ZVR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgY29udHJvbE9wdGlvbnM6IFtcbiAgICAgICAgICAgICAgICB7dGV4dDogJ0JhY2snLCB2YWx1ZTogJ2JhY2snfSxcbiAgICAgICAgICAgICAgICB7dGV4dDogJ1NpZGUnLCB2YWx1ZTogJ3NpZGUnfVxuICAgICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYmFja19kYW1hZ2VfcmVkdWN0aW9uJyxcbiAgICAgICAgICAgIGxhYmVsOiAnJURBTUFHRSBSRURVQ1RJT046JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWJpbGl0eSA9IGFiaWxpdHlNb2RlbC5hYmlsaXRpZXMuZmluZChmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBiLm5hbWUgPT0gJ2JyaXN0bGViYWNrX2JyaXN0bGViYWNrJztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAodiA9PSAnYmFjaycpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdiYWNrX2RhbWFnZV9yZWR1Y3Rpb24nLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdzaWRlX2RhbWFnZV9yZWR1Y3Rpb24nLCBhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gLXRvdGFsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnZGFtYWdlUmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnYnJpc3RsZWJhY2tfd2FycGF0aCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdTdGFja3MnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZV9wZXJfc3RhY2snLFxuICAgICAgICAgICAgbGFiZWw6ICdCT05VUyBEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAodiA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdiYXNlX2RhbWFnZScsYWJpbGl0eS5sZXZlbCgpKSsodi0xKSphO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21vdmVfc3BlZWRfcGVyX3N0YWNrJyxcbiAgICAgICAgICAgIGxhYmVsOiAnJU1PVkVNRU5UOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYgPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnYmFzZV9tb3ZlX3NwZWVkJyxhYmlsaXR5LmxldmVsKCkpKyh2LTEpKmE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdCdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2NlbnRhdXJfcmV0dXJuJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1N0cmVuZ3RoJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzdHJlbmd0aF9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3JldHVybl9kYW1hZ2UnLGFiaWxpdHkubGV2ZWwoKSkgKyB2KmEvMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnY2VudGF1cl9zdGFtcGVkZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdTdHJlbmd0aCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc3RyZW5ndGhfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3Nsb3dfbW92ZW1lbnRfc3BlZWQnLFxuICAgICAgICAgICAgbGFiZWw6ICdFbmVteSBNb3ZlbWVudCBTcGVlZCBTbG93JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdjbGlua3pfZGVhdGhfcGFjdCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdDb25zdW1lZCBVbml0IEhQJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2VfZ2Fpbl9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdCQVNFIERBTUFHRSBHQUlOOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYS8xMDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdiYXNlRGFtYWdlJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVhbHRoX2dhaW5fcGN0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnSEVBTFRIIEdBSU46JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphLzEwMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzSGVhbHRoJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnY3J5c3RhbF9tYWlkZW5fZnJvc3RiaXRlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnZGFya19zZWVyX2lvbl9zaGVsbCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlX3Blcl9zZWNvbmQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2RhenpsZV9zaGFkb3dfd2F2ZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdUYXJnZXRzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnZGF6emxlX3dlYXZlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdhcm1vcl9wZXJfc2Vjb25kJyxcbiAgICAgICAgICAgIGxhYmVsOiAnQVJNT1InLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdhcm1vcidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2FybW9yX3Blcl9zZWNvbmQnLFxuICAgICAgICAgICAgbGFiZWw6ICdBUk1PUiBSRURVQ1RJT046JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLXYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2FybW9yUmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnZGVhdGhfcHJvcGhldF9leG9yY2lzbSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEYW1hZ2UgRGVhbHQnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hlYWxfcGVyY2VudCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIEFybW9yJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmEvMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnZGlzcnVwdG9yX3N0YXRpY19zdG9ybSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhbWFnZXZhbHVlID0gMC4yNSAqICgxMzAgKyA0MCAqIGFiaWxpdHkubGV2ZWwoKSkgKiAoMS8yMCksXG4gICAgICAgICAgICAgICAgbXVsdCA9ICh2KjQpKigodio0KSsxKS8yO1xuICAgICAgICAgICAgICAgIHJldHVybiBkYW1hZ2V2YWx1ZSAqIG11bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdkb29tX2JyaW5nZXJfc2NvcmNoZWRfZWFydGgnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZV9wZXJfc2Vjb25kJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19tb3ZlbWVudF9zcGVlZF9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlX3Blcl9zZWNvbmQnLFxuICAgICAgICAgICAgbGFiZWw6ICdIUCBSRUdFTjonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnaGVhbHRocmVnZW4nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdkb29tX2JyaW5nZXJfZG9vbSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuaW52ZW50b3J5Lmhhc1NjZXB0ZXIoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdiphYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2RhbWFnZV9zY2VwdGVyJyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdkcmFnb25fa25pZ2h0X2VsZGVyX2RyYWdvbl9mb3JtJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19hdHRhY2tfcmFuZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdhdHRhY2tyYW5nZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX21vdmVtZW50X3NwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZEZsYXQnXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdkcm93X3Jhbmdlcl90cnVlc2hvdCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEcm93XFwncyBBZ2lsaXR5JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnLFxuICAgICAgICAgICAgZGlzcGxheTogJ2J1ZmYnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICd0cnVlc2hvdF9yYW5nZWRfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFIEJPTlVTOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGRpc3BsYXk6ICdidWZmJyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYS8xMDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZVByZWNpc2lvbkF1cmEnXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdlYXJ0aF9zcGlyaXRfcm9sbGluZ19ib3VsZGVyJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1VzaW5nIFN0b25lJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnY2hlY2tib3gnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtb3ZlX3Nsb3cnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1hO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2VhcnRoc2hha2VyX2VuY2hhbnRfdG90ZW0nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnQWN0aXZhdGVkJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnY2hlY2tib3gnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICd0b3RlbV9kYW1hZ2VfcGVyY2VudGFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAodikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2Jhc2VEYW1hZ2VNdWx0aXBsaWVyJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnZWFydGhzaGFrZXJfZWNob19zbGFtJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0VuZW1pZXMgaW4gUmFuZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2VjaG9fc2xhbV9lY2hvX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnZWxkZXJfdGl0YW5fYW5jZXN0cmFsX3NwaXJpdCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdIRVJPRVMgUEFTU0VEIFRIUk9VR0gnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdDUkVFUFMgUEFTU0VEIFRIUk9VR0gnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZV9jcmVlcHMnLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgY29udHJvbHM6IFswLDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdlswXSphYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2RhbWFnZV9oZXJvZXMnLGFiaWxpdHkubGV2ZWwoKSkgKyB2WzFdKmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21vdmVfcGN0X2NyZWVwcycsXG4gICAgICAgICAgICBsYWJlbDogJyVCT05VUyBTUEVFRDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsMV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2WzBdKmFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnbW92ZV9wY3RfaGVyb2VzJyxhYmlsaXR5LmxldmVsKCkpICsgdlsxXSphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdCdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2VsZGVyX3RpdGFuX2VhcnRoX3NwbGl0dGVyJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IE1heCBIZWFsdGgnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZV9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYS8xMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzbG93X3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLWE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnZW5jaGFudHJlc3NfbmF0dXJlc19hdHRlbmRhbnRzJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdoZWFsJyxcbiAgICAgICAgICAgIGxhYmVsOiAnSEVBTDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3dpc3BfY291bnQnLGFiaWxpdHkubGV2ZWwoKSkqdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnZW5pZ21hX21hbGVmaWNlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0hpdHMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzdHVuX2R1cmF0aW9uJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdlbmlnbWFfbWlkbmlnaHRfcHVsc2UnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdFbmVteSBNYXggSGVhbHRoJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2VfcGVyY2VudCcsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsMV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2WzBdKnZbMV0qYS8xMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdlbmlnbWFfYmxhY2tfaG9sZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZmFyX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbmVhcl9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2ZhY2VsZXNzX3ZvaWRfdGltZV9sb2NrJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0luIENocm9ub3NwaGVyZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2NoZWNrYm94J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnJU1PVkVTUEVFRCBBUyBEQU1BR0UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEqMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2Jhc2hCb251c0RhbWFnZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2R1cmF0aW9uJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnY2hhbmNlX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2Jhc2gnXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdneXJvY29wdGVyX3JvY2tldF9iYXJyYWdlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1JvY2tldHMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3JvY2tldHNfcGVyX3NlY29uZCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpKnY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuLyogICAgICAgICdneXJvY29wdGVyX2hvbWluZ19taXNzaWxlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0Rpc3RhbmNlIFRyYXZlbGVkJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2d5cm9jb3B0ZXJfZmxha19jYW5ub24nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnQXR0YWNrcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLCovXG4gICAgJ2h1c2thcl9idXJuaW5nX3NwZWFyJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1N0YWNrcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVhbHRoX2Nvc3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpKnY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdodXNrYXJfYmVyc2Vya2Vyc19ibG9vZCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICclSFAnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hwX3RocmVzaG9sZF9tYXgnLFxuICAgICAgICAgICAgbGFiZWw6ICdIZWFsdGggYXQgZ2l2ZW4gJUhQOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5oZWFsdGgoKSp2LzEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hwX3RocmVzaG9sZF9tYXgnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtYXhpbXVtX3Jlc2lzdGFuY2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdNQUdJQyBSRVNJU1RBTkNFIEJPTlVTOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHYgPSBNYXRoLm1pbih2LCAxMDApO1xuICAgICAgICAgICAgICAgIHYgPSBNYXRoLm1heCh2LCAxMCk7XG4gICAgICAgICAgICAgICAgdmFyIGhwX3RocmVzaG9sZF9tYXggPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2hwX3RocmVzaG9sZF9tYXgnLDApO1xuICAgICAgICAgICAgICAgIHZhciBkID0gMTAwIC0gaHBfdGhyZXNob2xkX21heDtcbiAgICAgICAgICAgICAgICB2YXIgYyA9ICh2IC0gaHBfdGhyZXNob2xkX21heCkgLyBkO1xuICAgICAgICAgICAgICAgIGMgPSAxIC0gYztcbiAgICAgICAgICAgICAgICByZXR1cm4gYyphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbWFnaWNSZXNpc3QnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtYXhpbXVtX2F0dGFja19zcGVlZCcsXG4gICAgICAgICAgICBsYWJlbDogJ0FUVEFDSyBTUEVFRCBCT05VUzonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciB2ID0gTWF0aC5taW4odiwgMTAwKTtcbiAgICAgICAgICAgICAgICB2ID0gTWF0aC5tYXgodiwgMTApO1xuICAgICAgICAgICAgICAgIHZhciBocF90aHJlc2hvbGRfbWF4ID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdocF90aHJlc2hvbGRfbWF4JywwKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IDEwMCAtIGhwX3RocmVzaG9sZF9tYXg7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSAodiAtIGhwX3RocmVzaG9sZF9tYXgpIC8gZDtcbiAgICAgICAgICAgICAgICBjID0gMSAtIGM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2F0dGFja3NwZWVkJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnaHVza2FyX2xpZmVfYnJlYWsnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRW5lbXkgQ3VycmVudCBIUCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVhbHRoX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnSHVza2FyIEN1cnJlbnQgSFAnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hlYWx0aF9jb3N0X3BlcmNlbnQnLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0UgVEFLRU46JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbW92ZXNwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2ludm9rZXJfcXVhcyc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdJbnN0YW5jZXMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX3N0cmVuZ3RoJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYm9udXNTdHJlbmd0aCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hlYWx0aF9yZWdlbl9wZXJfaW5zdGFuY2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdIUCBSRUdFTjonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdoZWFsdGhyZWdlbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2ludm9rZXJfd2V4JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0luc3RhbmNlcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfYWdpbGl0eScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzQWdpbGl0eSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21vdmVfc3BlZWRfcGVyX2luc3RhbmNlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnJU1PVkUgU1BFRUQ6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2F0dGFja19zcGVlZF9wZXJfaW5zdGFuY2UnLFxuICAgICAgICAgICAgbGFiZWw6ICclQVRUQUNLIFNQRUVEOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2F0dGFja3NwZWVkJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnaW52b2tlcl9leG9ydCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdJbnN0YW5jZXMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2ludGVsbGlnZW5jZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzSW50J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfZGFtYWdlX3Blcl9pbnN0YW5jZScsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZSdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2ludm9rZXJfZ2hvc3Rfd2Fsayc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdRdWFzIExldmVsJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdlbmVteV9zbG93JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIGlmICh2ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2VuZW15X3Nsb3cnLHYpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdXZXggTGV2ZWwnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgICBkaXNwbGF5OiAnYWJpbGl0eSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3NlbGZfc2xvdycsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZGlzcGxheTogJ2FiaWxpdHknLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAodiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdzZWxmX3Nsb3cnLHYpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdCdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2ludm9rZXJfYWxhY3JpdHknOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnV2V4IExldmVsJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19hdHRhY2tfc3BlZWQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnYm9udXNfYXR0YWNrX3NwZWVkJyx2KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2F0dGFja3NwZWVkJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0V4b3J0IExldmVsJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIGlmICh2ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2JvbnVzX2RhbWFnZScsdik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZSdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2ludm9rZXJfaWNlX3dhbGwnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnUXVhcyBMZXZlbCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc2xvdycsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAodiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdzbG93Jyx2KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRXhvcnQgTGV2ZWwnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgICBkaXNwbGF5OiAnYWJpbGl0eSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0JyxcbiAgICAgICAgICAgIGRpc3BsYXk6ICdhYmlsaXR5J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlX3Blcl9zZWNvbmQnLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZGlzcGxheTogJ2FiaWxpdHknLFxuICAgICAgICAgICAgY29udHJvbHM6IFsxLDJdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAodlswXSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdkYW1hZ2VfcGVyX3NlY29uZCcsdlswXSkqdlsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2pha2lyb19kdWFsX2JyZWF0aCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5UHJvcGVydHlWYWx1ZShhYmlsaXR5LCAnZGFtYWdlJykqMiArIFxuICAgICAgICAgICAgICAgIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnYnVybl9kYW1hZ2UnLGFiaWxpdHkubGV2ZWwoKSkqdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3Nsb3dfbW92ZW1lbnRfc3BlZWRfcGN0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3Nsb3dfYXR0YWNrX3NwZWVkX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJyVBVFRBQ0sgU0xPVzonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXR0YWNrc3BlZWRyZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdqYWtpcm9fbGlxdWlkX2ZpcmUnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc2xvd19hdHRhY2tfc3BlZWRfcGN0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXR0YWNrc3BlZWRyZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdqYWtpcm9fbWFjcm9weXJlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2p1Z2dlcm5hdXRfYmxhZGVfZnVyeSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5UHJvcGVydHlWYWx1ZShhYmlsaXR5LCAnZGFtYWdlJykqdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2p1Z2dlcm5hdXRfaGVhbGluZ193YXJkJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnTWF4IEhlYWx0aCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVhbGluZ193YXJkX2hlYWxfYW1vdW50JyxcbiAgICAgICAgICAgIGxhYmVsOiAnSEVBTCBPVkVSIFRJTUU6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgY29udHJvbHM6IFswLDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdlswXSp2WzFdKmEvMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnanVnZ2VybmF1dF9vbW5pX3NsYXNoJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0p1bXBzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnTUlOIERBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ29tbmlfc2xhc2hfZGFtYWdlJywxKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ01BWCBEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdvbW5pX3NsYXNoX2RhbWFnZScsMikqdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2tlZXBlcl9vZl90aGVfbGlnaHRfaWxsdW1pbmF0ZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlX3Blcl9zZWNvbmQnLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAna2VlcGVyX29mX3RoZV9saWdodF9tYW5hX2xlYWsnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRGlzdGFuY2UgTW92ZWQnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdFbmVteSBNYXggTWFuYScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbWFuYV9sZWFrX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ01BTkEgTEVBS0VEOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGNvbnRyb2xzOiBbMCwxXSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZbMF0vMTAwKnZbMV0qYS8xMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdsZWdpb25fY29tbWFuZGVyX2R1ZWwnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVlbCBXaW5zJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdyZXdhcmRfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzRGFtYWdlJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnbGVzaHJhY19wdWxzZV9ub3ZhJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21hbmFfY29zdF9wZXJfc2Vjb25kJyxcbiAgICAgICAgICAgIGxhYmVsOiAnTUFOQSBDT1NUOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2xpY2hfY2hhaW5fZnJvc3QnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnQm91bmNlIEhpdHMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc2xvd19tb3ZlbWVudF9zcGVlZCcsXG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IE1vdmVtZW50IFNwZWVkIFNsb3cnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc2xvd19hdHRhY2tfc3BlZWQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdhdHRhY2tzcGVlZHJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2xpZmVfc3RlYWxlcl9mZWFzdCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdFbmVteSBDdXJyZW50IEhQJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdocF9sZWVjaF9wZXJjZW50JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmEvMTAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYm9udXNEYW1hZ2UnXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdsaWZlX3N0ZWFsZXJfb3Blbl93b3VuZHMnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hlYWxfcGVyY2VudCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2xpZmVzdGVhbCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3Nsb3dfc3RlcHMnLFxuICAgICAgICAgICAgbGFiZWw6ICclU0xPVzonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBub0xldmVsOiB0cnVlLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdzbG93X3N0ZXBzJyx2KzEpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2xpbmFfZmllcnlfc291bCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZmllcnlfc291bF9tb3ZlX3NwZWVkX2JvbnVzJyxcbiAgICAgICAgICAgIGxhYmVsOiAnRW5lbXkgTW92ZW1lbnQgU3BlZWQgU2xvdycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2ZpZXJ5X3NvdWxfYXR0YWNrX3NwZWVkX2JvbnVzJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdhdHRhY2tzcGVlZCdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2xpb25fbWFuYV9kcmFpbic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbWFuYV9wZXJfc2Vjb25kJyxcbiAgICAgICAgICAgIGxhYmVsOiAnTUFOQSBEUkFJTkVEOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2x1bmFfbW9vbl9nbGFpdmUnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2VfcmVkdWN0aW9uX3BlcmNlbnQnLFxuICAgICAgICAgICAgbGFiZWw6ICdCT1VOQ0UgREFNQUdFOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgNjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCh2Kk1hdGgucG93KGEvMTAwLGkpKS50b0ZpeGVkKDIpKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmpvaW4oJzxicj4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2x1bmFfZWNsaXBzZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdCZWFtIENvdW50JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdiZWFtcycsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbHVjZW50QmVhbUFiaWxpdHkgPSBhYmlsaXR5TW9kZWwuYWJpbGl0aWVzLmZpbmQoZnVuY3Rpb24oYikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYi5uYW1lID09ICdsdW5hX2x1Y2VudF9iZWFtJztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAobHVjZW50QmVhbUFiaWxpdHkubGV2ZWwoKSA9PSAwKSByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB2YXIgZGFtYWdlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGx1Y2VudEJlYW1BYmlsaXR5LCAnZGFtYWdlJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqZGFtYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnbWVkdXNhX215c3RpY19zbmFrZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdKdW1wIENvdW50JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzbmFrZV9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdEYW1hZ2UgUGVyIEp1bXA6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ21ldGhvZCcsXG4gICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBzbmFrZV9qdW1wcyA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnc25ha2VfanVtcHMnLGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgdmFyIHNuYWtlX3NjYWxlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdzbmFrZV9zY2FsZScsMCk7XG4gICAgICAgICAgICAgICAgdmFyIGRhbWFnZSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc25ha2VfanVtcHM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBkYW1hZ2UucHVzaChhICsgYSAqIGkgKiBzbmFrZV9zY2FsZS8xMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZGFtYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc25ha2VfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnRGFtYWdlIFBlciBKdW1wOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGNvbnRyb2xzOiBbMCwxXSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZbMV0uam9pbignIC8gJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzbmFrZV9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgY29udHJvbHM6IFswLDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdlsxXS5zbGljZSgwLCB2WzBdKS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvIH0sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc25ha2VfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnTWF4IERhbWFnZTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsMV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2WzFdLnJlZHVjZShmdW5jdGlvbiAobWVtbywgbykgeyByZXR1cm4gbWVtbyArIG8gfSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdtZWR1c2FfbWFuYV9zaGllbGQnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2VfcGVyX21hbmEnLFxuICAgICAgICAgICAgbGFiZWw6ICdNQU5BIFVTRUQ6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHYvYSkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2Fic29ycHRpb25fdG9vbHRpcCcsXG4gICAgICAgICAgICBsYWJlbDogJyVEQU1BR0UgUkVEVUNUSU9OOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1hO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnZGFtYWdlUmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnbWVlcG9fcG9vZic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdNZWVwbyBDb3VudCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5UHJvcGVydHlWYWx1ZShhYmlsaXR5LCAnZGFtYWdlJykqdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ21lZXBvX2dlb3N0cmlrZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdTdGFja3MnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc2xvdycsXG4gICAgICAgICAgICBsYWJlbDogJyVTTE9XOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIG5vTGV2ZWw6IHRydWUsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3Nsb3cnLGFiaWxpdHkubGV2ZWwoKSkqdjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdtaXJhbmFfYXJyb3cnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnQXJyb3cgVHJhdmVsIERpc3RhbmNlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdhcnJvd19tYXhfc3R1bicsXG4gICAgICAgICAgICBsYWJlbDogJ1NUVU4gRFVSQVRJT046JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJyb3dfbWluX3N0dW4gPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2Fycm93X21pbl9zdHVuJywwKTtcbiAgICAgICAgICAgICAgICB2YXIgYXJyb3dfbWF4X3N0dW5yYW5nZSA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnYXJyb3dfbWF4X3N0dW5yYW5nZScsMCk7XG4gICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gTWF0aC5taW4odiwgYXJyb3dfbWF4X3N0dW5yYW5nZSkgLyBhcnJvd19tYXhfc3R1bnJhbmdlO1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChhcnJvd19taW5fc3R1biwgTWF0aC5mbG9vcihhICogc2NhbGUgLyAwLjEpICogMC4xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2Fycm93X2JvbnVzX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RPVEFMIERBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBhYmlsaXR5ID0gYWJpbGl0eTtcbiAgICAgICAgICAgICAgICB2YXIgZGFtYWdlID0gYWJpbGl0eS5kYW1hZ2UoKVthYmlsaXR5LmxldmVsKCktMV07XG4gICAgICAgICAgICAgICAgdmFyIGFycm93X21heF9zdHVucmFuZ2UgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2Fycm93X21heF9zdHVucmFuZ2UnLDApO1xuICAgICAgICAgICAgICAgIHZhciBzY2FsZSA9IE1hdGgubWluKHYsIGFycm93X21heF9zdHVucmFuZ2UpIC8gYXJyb3dfbWF4X3N0dW5yYW5nZTtcbiAgICAgICAgICAgICAgICB2YXIgYm9udXNfZGFtYWdlID0gTWF0aC5mbG9vcihhICogc2NhbGUgLyAyLjgpICogMi44O1xuICAgICAgICAgICAgICAgIHJldHVybiBkYW1hZ2UgKyAnICsgJyArIGJvbnVzX2RhbWFnZSArICcgPSAnICsgKGRhbWFnZSArIGJvbnVzX2RhbWFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdtb3JwaGxpbmdfbW9ycGhfYWdpJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1NoaWZ0cycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncG9pbnRzX3Blcl90aWNrJyxcbiAgICAgICAgICAgIGxhYmVsOiAnQUdJIFNISUZUIEdBSU46JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYm9udXNBZ2lsaXR5J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncG9pbnRzX3Blcl90aWNrJyxcbiAgICAgICAgICAgIGxhYmVsOiAnU1RSIFNISUZUIExPU1M6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLXYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzU3RyZW5ndGgnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19hdHRyaWJ1dGVzJyxcbiAgICAgICAgICAgIGxhYmVsOiAnU0hJRlQgVElNRTonLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0FnaWxpdHkyJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbW9ycGhfY29vbGRvd24nLFxuICAgICAgICAgICAgbGFiZWw6ICdTSElGVCBUSU1FOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21hbmFfY29zdCcsXG4gICAgICAgICAgICBsYWJlbDogJ1NISUZUIE1BTkEgQ09TVDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmEqYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdtb3JwaF9jb29sZG93bicsYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ21vcnBobGluZ19tb3JwaF9zdHInOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnU2hpZnRzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdwb2ludHNfcGVyX3RpY2snLFxuICAgICAgICAgICAgbGFiZWw6ICdTVFIgU0hJRlQgR0FJTjonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c1N0cmVuZ3RoJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncG9pbnRzX3Blcl90aWNrJyxcbiAgICAgICAgICAgIGxhYmVsOiAnQUdJIFNISUZUIExPU1M6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLXYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzQWdpbGl0eSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2F0dHJpYnV0ZXMnLFxuICAgICAgICAgICAgbGFiZWw6ICdTSElGVCBUSU1FOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzU3RyZW5ndGgyJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbW9ycGhfY29vbGRvd24nLFxuICAgICAgICAgICAgbGFiZWw6ICdTSElGVCBUSU1FOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21hbmFfY29zdCcsXG4gICAgICAgICAgICBsYWJlbDogJ1NISUZUIE1BTkEgQ09TVDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmEqYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdtb3JwaF9jb29sZG93bicsYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ2Z1cmlvbl93cmF0aF9vZl9uYXR1cmUnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnbmVjcm9seXRlX2hlYXJ0c3RvcHBlcl9hdXJhJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRW5lbXkgTWF4IEhlYWx0aCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYXVyYV9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdIRUFMVEggTE9TVDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsMV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2WzBdKnZbMV0qYS8xMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICduZWNyb2x5dGVfc2FkaXN0JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1VuaXQgS2lsbHMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdIZXJvIEtpbGxzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdoZWFsdGhfcmVnZW4nLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGNvbnRyb2xzOiBbMCwxXSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGhlcm9fbXVsdGlwbGllciA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnaGVyb19tdWx0aXBsaWVyJywwKVxuICAgICAgICAgICAgICAgIHJldHVybiAodlswXSt2WzFdKmhlcm9fbXVsdGlwbGllcikqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2hlYWx0aHJlZ2VuJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbWFuYV9yZWdlbicsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgY29udHJvbHM6IFswLDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgaGVyb19tdWx0aXBsaWVyID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdoZXJvX211bHRpcGxpZXInLDApXG4gICAgICAgICAgICAgICAgcmV0dXJuICh2WzBdK3ZbMV0qaGVyb19tdWx0aXBsaWVyKSphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbWFuYXJlZ2VuJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnbmlnaHRfc3RhbGtlcl9jcmlwcGxpbmdfZmVhcic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdJcyBOaWdodCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2NoZWNrYm94J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbWlzc19yYXRlX25pZ2h0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnJUNIQU5DRSBUTyBNSVNTOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnbWlzc19yYXRlX25pZ2h0JyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnbWlzc19yYXRlX2RheScsYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtaXNzQ2hhbmNlJ1xuICAgICAgICB9XG4gICAgXSwgICAgXG4gICAgJ25pZ2h0X3N0YWxrZXJfaHVudGVyX2luX3RoZV9uaWdodCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdJcyBOaWdodCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2NoZWNrYm94J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfYXR0YWNrX3NwZWVkX25pZ2h0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIGlmICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXR0YWNrc3BlZWQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19tb3ZlbWVudF9zcGVlZF9wY3RfbmlnaHQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0J1xuICAgICAgICB9XG4gICAgXSwgICAgXG4gICAgJ29ic2lkaWFuX2Rlc3Ryb3llcl9hcmNhbmVfb3JiJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0N1cnJlbnQgTWFuYScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbWFuYV9wb29sX2RhbWFnZV9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYS8xMDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZU9yYidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ29ncmVfbWFnaV9pZ25pdGUnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2J1cm5fZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzbG93X21vdmVtZW50X3NwZWVkX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdwdWRnZV9yb3QnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpKnY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdyb3Rfc2xvdycsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdwdWRnZV9mbGVzaF9oZWFwJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1N0YWNrcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZmxlc2hfaGVhcF9zdHJlbmd0aF9idWZmX2Ftb3VudCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYm9udXNTdHJlbmd0aCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2ZsZXNoX2hlYXBfbWFnaWNfcmVzaXN0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbWFnaWNSZXNpc3QnXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdwdWRnZV9kaXNtZW1iZXInOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2Rpc21lbWJlcl9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3B1Z25hX25ldGhlcl93YXJkJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IE1hbmEgU3BlbnQnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21hbmFfbXVsdGlwbGllcicsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtYW5hX3JlZ2VuJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbWFuYXJlZ2VucmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAncHVnbmFfbGlmZV9kcmFpbic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVhbHRoX2RyYWluJyxcbiAgICAgICAgICAgIGxhYmVsOiAnSEVBTFRIIERSQUlORUQ6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAncXVlZW5vZnBhaW5fc2hhZG93X3N0cmlrZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbW92ZW1lbnRfc2xvdycsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzdHJpa2VfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGR1cmF0aW9uX2RhbWFnZSA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnZHVyYXRpb25fZGFtYWdlJyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHZhciB0aWNrcyA9IE1hdGguZmxvb3Iodi8zKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYSArIGR1cmF0aW9uX2RhbWFnZSAqIHRpY2tzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAncmF6b3JfcGxhc21hX2ZpZWxkJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0Rpc3RhbmNlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdyYWRpdXMnLFxuICAgICAgICAgICAgbGFiZWw6ICdNSU4gRElTVEFOQ0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMjAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncmFkaXVzJyxcbiAgICAgICAgICAgIGxhYmVsOiAnTUFYIERJU1RBTkNFOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDIwMCArIGE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdyYWRpdXMnLFxuICAgICAgICAgICAgbGFiZWw6ICdJbnN0YW5jZSBEYW1hZ2UnLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBtYXhfcmFkaXVzID0gYSArIDIwMDtcbiAgICAgICAgICAgICAgICB2YXIgc2NhbGUgPSAoTWF0aC5taW4oTWF0aC5tYXgodiwgMjAwKSwgbWF4X3JhZGl1cykgLSAyMDApIC8gKG1heF9yYWRpdXMgLSAyMDApO1xuICAgICAgICAgICAgICAgIHZhciBkYW1hZ2VfbWluID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdkYW1hZ2VfbWluJyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHZhciBkYW1hZ2VfbWF4ID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdkYW1hZ2VfbWF4JyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBkYW1hZ2VfbWluICsgKGRhbWFnZV9tYXggLSBkYW1hZ2VfbWluKSAqIHNjYWxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAncmF6b3Jfc3RhdGljX2xpbmsnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RyYWluX2xlbmd0aCcsXG4gICAgICAgICAgICBsYWJlbDogJ0RhbWFnZSBEcmFpbmVkOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpY2tfZHVyYXRpb24gPSBNYXRoLmZsb29yKHYgKiA0KSArIDE7XG4gICAgICAgICAgICAgICAgdmFyIHRpY2tzID0gTWF0aC5taW4oYSAqIDQgKyAxLCB0aWNrX2R1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICB2YXIgZHJhaW5fcmF0ZSA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnZHJhaW5fcmF0ZScsYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGlja3MgKiBkcmFpbl9yYXRlLzQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RyYWluX2xlbmd0aCcsXG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IERhbWFnZSBMb3N0OicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGRpc3BsYXk6ICdoaWRkZW4nLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGlja19kdXJhdGlvbiA9IE1hdGguZmxvb3IodiAqIDQpICsgMTtcbiAgICAgICAgICAgICAgICB2YXIgdGlja3MgPSBNYXRoLm1pbihhICogNCArIDEsIHRpY2tfZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgIHZhciBkcmFpbl9yYXRlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdkcmFpbl9yYXRlJyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aWNrcyAqIGRyYWluX3JhdGUvNDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzRGFtYWdlUmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAncmF6b3JfZXllX29mX3RoZV9zdG9ybSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdydWJpY2tfZmFkZV9ib2x0JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0p1bXBzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEgKiAoMSAtIHYqYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdqdW1wX2RhbWFnZV9yZWR1Y3Rpb25fcGN0JyxhYmlsaXR5LmxldmVsKCkpLzEwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdoZXJvX2F0dGFja19kYW1hZ2VfcmVkdWN0aW9uJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYm9udXNEYW1hZ2VSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdzYW5ka2luZ19zYW5kX3N0b3JtJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnc2FuZGtpbmdfZXBpY2VudGVyJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1B1bHNlcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZXBpY2VudGVyX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdlcGljZW50ZXJfc2xvdycsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdlcGljZW50ZXJfc2xvd19hcycsXG4gICAgICAgICAgICBsYWJlbDogJyVBVFRBQ0sgU0xPVzonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXR0YWNrc3BlZWRyZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdzaGFkb3dfZGVtb25fc2hhZG93X3BvaXNvbic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnc3RhY2tfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBzdGFja211bHQgPSBbMSwyLDQsOF07XG4gICAgICAgICAgICAgICAgaWYgKHYgPiA0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhICogc3RhY2ttdWx0WzNdICsgNTAgKiAodiAtIDQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhICogc3RhY2ttdWx0W3YtMV1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICduZXZlcm1vcmVfbmVjcm9tYXN0ZXJ5JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1NvdWxzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICduZWNyb21hc3RlcnlfZGFtYWdlX3Blcl9zb3VsJyxcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzRGFtYWdlJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnbmV2ZXJtb3JlX3JlcXVpZW0nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnTGluZSBIaXQgQ291bnQnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3JlcXVpZW1fcmVkdWN0aW9uX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0RhbWFnZTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpKnY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnUmV0dXJuIExpbmUgSGl0IENvdW50IChTY2VwdGVyKScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncmVxdWllbV9kYW1hZ2VfcGN0X3NjZXB0ZXInLFxuICAgICAgICAgICAgbGFiZWw6ICdEYW1hZ2UvSGVhbDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpKnYqYS8xMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdyZXF1aWVtX2RhbWFnZV9wY3Rfc2NlcHRlcicsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsMV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBkYW1hZ2UgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpO1xuICAgICAgICAgICAgICAgIHJldHVybiBkYW1hZ2UqdlswXSArIGRhbWFnZSp2WzFdKmEvMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncmVxdWllbV9yZWR1Y3Rpb25fZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnJURBTUFHRSBSRURVQ1RJT046JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2Jhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdyZXF1aWVtX3JlZHVjdGlvbl9tcycsXG4gICAgICAgICAgICBsYWJlbDogJyVEQU1BR0UgUkVEVUNUSU9OOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdzaGFkb3dfc2hhbWFuX3NoYWNrbGVzJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAnc2lsZW5jZXJfY3Vyc2Vfb2ZfdGhlX3NpbGVudCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHYpKmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtb3Zlc3BlZWQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbi8qICAgICAgICAnc2lsZW5jZXJfZ2xhaXZlc19vZl93aXNkb20nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSwqL1xuICAgICdza3l3cmF0aF9tYWdlX215c3RpY19mbGFyZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICdzbGFya19lc3NlbmNlX3NoaWZ0JzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0F0dGFja3MnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2FnaV9nYWluJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBkaXNwbGF5OiAnYWJpbGl0eScsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0FnaWxpdHknXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzdGF0X2xvc3MnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC12KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0FsbFN0YXRzUmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnc2xhcmtfc2hhZG93X2RhbmNlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19yZWdlbl9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdUT1RBTCBIRUFMVEggUkVHRU5FUkFURUQ6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdipwYXJlbnQuaGVhbHRoKCkqYS8xMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19yZWdlbl9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdIRUFMVEggR0FJTkVEIFBFUiBTRUNPTkQ6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50LmhlYWx0aCgpKmEvMTAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnaGVhbHRocmVnZW4nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19tb3ZlbWVudF9zcGVlZCcsXG4gICAgICAgICAgICBsYWJlbDogJyVNT1ZFIFNQRUVEOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0J1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnc25pcGVyX3NocmFwbmVsJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5UHJvcGVydHlWYWx1ZShhYmlsaXR5LCAnZGFtYWdlJykqdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2J1aWxkaW5nX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0JVSUxESU5HIERBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzbG93X21vdmVtZW50X3NwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnRW5lbXkgTW92ZW1lbnQgU3BlZWQgU2xvdycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdzcGVjdHJlX2Rlc29sYXRlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IEFsb25lJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnY2hlY2tib3gnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZSdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3NwZWN0cmVfZGlzcGVyc2lvbic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEYW1hZ2UgVGFrZW4nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZV9yZWZsZWN0aW9uX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRSBSRUZMRUNURUQ6JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2RhbWFnZVJlZHVjdGlvbidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZV9yZWZsZWN0aW9uX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRSBSRUZMRUNURUQ6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphLzEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3N0b3JtX3NwaXJpdF9iYWxsX2xpZ2h0bmluZyc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdNQVggTUFOQScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0Rpc3RhbmNlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdiYWxsX2xpZ2h0bmluZ19pbml0aWFsX21hbmFfYmFzZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsIDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKS8xMDAqdlsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JhbGxfbGlnaHRuaW5nX2luaXRpYWxfbWFuYV9iYXNlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnRkxBVCBNQU5BIENPU1Q6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ21ldGhvZCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsIDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2VfaW50ZXJ2YWxzID0gTWF0aC5mbG9vcih2WzFdLzEwMCk7XG4gICAgICAgICAgICAgICAgdmFyIHRyYXZlbF9jb3N0X2Jhc2UgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2JhbGxfbGlnaHRuaW5nX3RyYXZlbF9jb3N0X2Jhc2UnLDApO1xuICAgICAgICAgICAgICAgIHJldHVybiBhICsgZGlzdGFuY2VfaW50ZXJ2YWxzICogdHJhdmVsX2Nvc3RfYmFzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JhbGxfbGlnaHRuaW5nX2luaXRpYWxfbWFuYV9wZXJjZW50YWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnJU1BWCBNQU5BIENPU1Q6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ21ldGhvZCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsIDFdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2VfaW50ZXJ2YWxzID0gTWF0aC5mbG9vcih2WzFdLzEwMCk7XG4gICAgICAgICAgICAgICAgdmFyIHRyYXZlbF9jb3N0X3BlcmNlbnQgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2JhbGxfbGlnaHRuaW5nX3RyYXZlbF9jb3N0X3BlcmNlbnQnLDApO1xuICAgICAgICAgICAgICAgIHJldHVybiBhICsgZGlzdGFuY2VfaW50ZXJ2YWxzICogdHJhdmVsX2Nvc3RfcGVyY2VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JhbGxfbGlnaHRuaW5nX2luaXRpYWxfbWFuYV9iYXNlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVE9UQUwgTUFOQSBDT1NUOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGNvbnRyb2xzOiBbMCwgMSwgMiwgM10sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2WzJdICsgJyArICcgKyAodlszXS8xMDAgKiB2WzBdKSArICcgKCcgKyB2WzNdICsgJyUgb2YgbWF4KSA9ICcgKyAodlsyXSArIHZbM10vMTAwICogdlswXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICd0ZW1wbGFyX2Fzc2Fzc2luX3BzaW9uaWNfdHJhcCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdDaGFyZ2UgVGltZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbW92ZW1lbnRfc3BlZWRfbWluX3Rvb2x0aXAnLFxuICAgICAgICAgICAgbGFiZWw6ICclTU9WRSBTTE9XOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIG1heF9zbG93ID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdtb3ZlbWVudF9zcGVlZF9tYXhfdG9vbHRpcCcsMCk7XG4gICAgICAgICAgICAgICAgdmFyIHNsb3dfcGVyX3RpY2sgPSAobWF4X3Nsb3cgLSBhKS80MDtcbiAgICAgICAgICAgICAgICByZXR1cm4gLShhICsgc2xvd19wZXJfdGljayAqIE1hdGgubWluKE1hdGgubWF4KDAsIHYpLCA0KSAqIDEwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICdzaHJlZGRlcl9yZWFjdGl2ZV9hcm1vcic6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdTdGFja3MnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2FybW9yJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgQXJtb3IgQm9udXMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIG5vTGV2ZWw6IHRydWUsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdhcm1vcidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2hwX3JlZ2VuJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgSFAgUmVnZW4gQm9udXMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIG5vTGV2ZWw6IHRydWUsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdoZWFsdGhyZWdlbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3NocmVkZGVyX2NoYWtyYW0nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZV9wZXJfc2Vjb25kJyxcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGludGVydmFsID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdkYW1hZ2VfaW50ZXJ2YWwnLDApO1xuICAgICAgICAgICAgICAgIHZhciB0aWNrcyA9IE1hdGguZmxvb3IodiAvIGludGVydmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYSppbnRlcnZhbCp0aWNrcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21hbmFfcGVyX3NlY29uZCcsXG4gICAgICAgICAgICBsYWJlbDogJ01BTkEgQ09TVDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBpbnRlcnZhbCA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnZGFtYWdlX2ludGVydmFsJywwKTtcbiAgICAgICAgICAgICAgICB2YXIgdGlja3MgPSBNYXRoLmZsb29yKHYgLyBpbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEqaW50ZXJ2YWwqdGlja3M7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRU5FTVkgJUhQJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdzbG93JyxcbiAgICAgICAgICAgIGxhYmVsOiAnTUFOQSBDT1NUOicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGlja3MgPSAyMCAtIE1hdGguZmxvb3IoTWF0aC5taW4oTWF0aC5tYXgodi0xLCAwKSwgOTkpIC8gNSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1hKnRpY2tzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3NwaXJpdF9icmVha2VyX2dyZWF0ZXJfYmFzaCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdCYXNoIFByb2MnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdjaGVja2JveCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJyVNT1ZFU1BFRUQgQVMgREFNQUdFJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIGlmICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYmFzaEJvbnVzRGFtYWdlJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfbW92ZXNwZWVkX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICBpZiAodikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3QnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdjaGFuY2VfcGN0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdiYXNoJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAndGVjaGllc19sYW5kX21pbmVzJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ051bWJlciBvZiBNaW5lcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdBRlRFUiBSRURVQ1RJT05TOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHBoeXNfcmVkdWN0aW9uID0gcGFyZW50LmVuZW15KCkudG90YWxBcm1vclBoeXNpY2FsUmVkdWN0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgIG1hZ2ljX3JlZHVjdGlvbiA9IHBhcmVudC5lbmVteSgpLnRvdGFsTWFnaWNSZXNpc3RhbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh2ICogYSAqICgxIC0gcGh5c19yZWR1Y3Rpb24gLyAxMDApICogKDEgLSBtYWdpY19yZWR1Y3Rpb24gLyAxMDApKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAndGVjaGllc19zdWljaWRlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnRlVMTCBEQU1BR0UgQUZURVIgUkVEVUNUSU9OUzonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBwaHlzX3JlZHVjdGlvbiA9IHBhcmVudC5lbmVteSgpLnRvdGFsQXJtb3JQaHlzaWNhbFJlZHVjdGlvbigpLFxuICAgICAgICAgICAgICAgICAgICBtYWdpY19yZWR1Y3Rpb24gPSBwYXJlbnQuZW5lbXkoKS50b3RhbE1hZ2ljUmVzaXN0YW5jZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAoYSAqICgxIC0gcGh5c19yZWR1Y3Rpb24gLyAxMDApICogKDEgLSBtYWdpY19yZWR1Y3Rpb24gLyAxMDApKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAncGFydGlhbF9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdQQVJUSUFMIERBTUFHRSBBRlRFUiBSRURVQ1RJT05TOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHBoeXNfcmVkdWN0aW9uID0gcGFyZW50LmVuZW15KCkudG90YWxBcm1vclBoeXNpY2FsUmVkdWN0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgIG1hZ2ljX3JlZHVjdGlvbiA9IHBhcmVudC5lbmVteSgpLnRvdGFsTWFnaWNSZXNpc3RhbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChhICogKDEgLSBwaHlzX3JlZHVjdGlvbiAvIDEwMCkgKiAoMSAtIG1hZ2ljX3JlZHVjdGlvbiAvIDEwMCkpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdSRVNQQVdOIFRJTUU6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHBhcmVudC5yZXNwYXduVGltZSgpIC8gMikudG9GaXhlZCgwKSArICcgc2Vjb25kcyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICd0ZWNoaWVzX3JlbW90ZV9taW5lcyc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdOdW1iZXIgb2YgTWluZXMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnQUZURVIgUkVEVUNUSU9OUzonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBtYWdpY19yZWR1Y3Rpb24gPSBwYXJlbnQuZW5lbXkoKS50b3RhbE1hZ2ljUmVzaXN0YW5jZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAodiAqIGEgKiAoMSAtIG1hZ2ljX3JlZHVjdGlvbiAvIDEwMCkpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICd0aW5rZXJfbWFyY2hfb2ZfdGhlX21hY2hpbmVzJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1JvYm90IEV4cGxvc2lvbnMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21hY2hpbmVzX3Blcl9zZWMnLFxuICAgICAgICAgICAgbGFiZWw6ICdUT1RBTCBEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKSp2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAndHJlYW50X2xlZWNoX3NlZWQnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnUHVsc2VzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdsZWVjaF9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0UvSEVBTDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtb3ZlbWVudF9zbG93JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3Ryb2xsX3dhcmxvcmRfZmVydm9yJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1N0YWNrcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYXR0YWNrX3NwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnQVRUQUNLIFNQRUVEOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2F0dGFja3NwZWVkJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAndW5keWluZ19kZWNheSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdTdGFja3MnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3N0cl9zdGVhbCcsXG4gICAgICAgICAgICBsYWJlbDogJ1NUUkVOR1RIIFNUT0xFTjonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuaW52ZW50b3J5Lmhhc1NjZXB0ZXIoKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyX3N0ZWFsX3NjZXB0ZXIgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3N0cl9zdGVhbF9zY2VwdGVyJywwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYqc3RyX3N0ZWFsX3NjZXB0ZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2JvbnVzU3RyZW5ndGgnXG4gICAgICAgIH0sXG4gICAgXSxcbiAgICAndW5keWluZ19zb3VsX3JpcCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdVbml0cycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlX3Blcl91bml0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnREFNQUdFL0hFQUw6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAndW5keWluZ19mbGVzaF9nb2xlbSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEaXN0YW5jZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbWF4X3NwZWVkX3Nsb3cnLFxuICAgICAgICAgICAgbGFiZWw6ICclTU9WRSBTTE9XOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIG1pbl9zcGVlZF9zbG93ID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdtaW5fc3BlZWRfc2xvdycsIDApO1xuICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3JhZGl1cycsIDApO1xuICAgICAgICAgICAgICAgIHZhciBmdWxsX3Bvd2VyX3JhZGl1cyA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnZnVsbF9wb3dlcl9yYWRpdXMnLCAwKTtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBNYXRoLm1pbihNYXRoLm1heCh2LCBmdWxsX3Bvd2VyX3JhZGl1cyksIHJhZGl1cyk7XG4gICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gMSAtIChkaXN0YW5jZSAtIGZ1bGxfcG93ZXJfcmFkaXVzKSAvIChyYWRpdXMgLSBmdWxsX3Bvd2VyX3JhZGl1cyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1NYXRoLm1heChzY2FsZSAqIGEsIG1pbl9zcGVlZF9zbG93KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtYXhfZGFtYWdlX2FtcCcsXG4gICAgICAgICAgICBsYWJlbDogJyVEQU1BR0UgQU1QOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIG1pbl9kYW1hZ2VfYW1wID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdtaW5fZGFtYWdlX2FtcCcsIDApO1xuICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3JhZGl1cycsIDApO1xuICAgICAgICAgICAgICAgIHZhciBmdWxsX3Bvd2VyX3JhZGl1cyA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnZnVsbF9wb3dlcl9yYWRpdXMnLCAwKTtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBNYXRoLm1pbihNYXRoLm1heCh2LCBmdWxsX3Bvd2VyX3JhZGl1cyksIHJhZGl1cyk7XG4gICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gMSAtIChkaXN0YW5jZSAtIGZ1bGxfcG93ZXJfcmFkaXVzKSAvIChyYWRpdXMgLSBmdWxsX3Bvd2VyX3JhZGl1cyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KHNjYWxlICogYSwgbWluX2RhbWFnZV9hbXApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnZGFtYWdlQW1wbGlmaWNhdGlvbidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdNQVggSFAnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdIZXJvIERlYXRoIENvdW50JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnQ3JlZXAgRGVhdGggQ291bnQnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RlYXRoX2hlYWwnLFxuICAgICAgICAgICAgbGFiZWw6ICdERUFUSCBIRUFMIChIRVJPRVMpOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdtZXRob2QnLFxuICAgICAgICAgICAgY29udHJvbHM6IFsxLCAyXSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZbMF0qdlsxXSphLzEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RlYXRoX2hlYWxfY3JlZXAnLFxuICAgICAgICAgICAgbGFiZWw6ICdERUFUSCBIRUFMIChDUkVFUFMpOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdtZXRob2QnLFxuICAgICAgICAgICAgY29udHJvbHM6IFsxLCAzXSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZbMF0qdlsxXSphLzEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RlYXRoX2hlYWxfY3JlZXAnLFxuICAgICAgICAgICAgbGFiZWw6ICdUT1RBTCBERUFUSCBIRUFMOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGNvbnRyb2xzOiBbNCwgNV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2WzBdK3ZbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICd1cnNhX2Z1cnlfc3dpcGVzJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ1N0YWNrcycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlX3Blcl9zdGFjaycsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW5yYWdlQWJpbGl0eSA9IGFiaWxpdHlNb2RlbC5hYmlsaXRpZXMuZmluZChmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBiLm5hbWUgPT0gJ3Vyc2FfZW5yYWdlJztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoZW5yYWdlQWJpbGl0eS5pc0FjdGl2ZSgpICYmIGVucmFnZUFiaWxpdHkubGV2ZWwoKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVucmFnZV9tdWx0aXBsaWVyID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShlbnJhZ2VBYmlsaXR5LmF0dHJpYnV0ZXMsICdlbnJhZ2VfbXVsdGlwbGllcicsIGVucmFnZUFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2KmEqZW5yYWdlX211bHRpcGxpZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdib251c0RhbWFnZSdcbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3Vyc2FfZW5yYWdlJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlX3JlZHVjdGlvbicsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLWE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdkYW1hZ2VSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICd2ZW5vbWFuY2VyX3Zlbm9tb3VzX2dhbGUnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3RpY2tfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3N0cmlrZV9kYW1hZ2UnLGFiaWxpdHkubGV2ZWwoKSkgKyBNYXRoLmZsb29yKHYvMykqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ21vdmVtZW50X3Nsb3cnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAndmVub21hbmNlcl9wb2lzb25fc3RpbmcnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbW92ZW1lbnRfc3BlZWQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAndmVub21hbmNlcl9wb2lzb25fbm92YSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICd2aXBlcl9wb2lzb25fYXR0YWNrJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX21vdmVtZW50X3NwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbW92ZW1lbnRTcGVlZFBjdFJlZHVjdGlvbidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2F0dGFja19zcGVlZCcsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ2F0dGFja3NwZWVkcmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAndmlwZXJfY29ycm9zaXZlX3NraW4nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfbW92ZW1lbnRfc3BlZWQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfYXR0YWNrX3NwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXR0YWNrc3BlZWRyZWR1Y3Rpb24nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19tYWdpY19yZXNpc3RhbmNlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnbWFnaWNSZXNpc3QnXG4gICAgICAgIH1cbiAgICBdLFxuICAgICd2aXBlcl92aXBlcl9zdHJpa2UnOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZScsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfbW92ZW1lbnRfc3BlZWQnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfYXR0YWNrX3NwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXR0YWNrc3BlZWRyZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICd2aXNhZ2Vfc291bF9hc3N1bXB0aW9uJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0NoYXJnZXMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3NvdWxfY2hhcmdlX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ1RvdGFsIERhbWFnZTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBzb3VsX2Jhc2VfZGFtYWdlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdzb3VsX2Jhc2VfZGFtYWdlJywwKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RhY2tfbGltaXQgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ3N0YWNrX2xpbWl0JywgYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBzdGFja19saW1pdCA9IE1hdGgubWF4KE1hdGgubWluKHYsIHN0YWNrX2xpbWl0KSwgMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvdWxfYmFzZV9kYW1hZ2UgKyBzdGFja19saW1pdCphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSxcbiAgICAndmlzYWdlX2dyYXZla2VlcGVyc19jbG9hayc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdMYXllcnMnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2FybW9yJyxcbiAgICAgICAgICAgIGxhYmVsOiAnQVJNT1I6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXJtb3InXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19yZXNpc3QnLFxuICAgICAgICAgICAgbGFiZWw6ICclUkVTSVNUOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXR1cm5Qcm9wZXJ0eTogJ21hZ2ljUmVzaXN0J1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnd2FybG9ja19zaGFkb3dfd29yZCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpKnY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICd3YXJsb2NrX3VwaGVhdmFsJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0NoYW5uZWwgRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ3Nsb3dfcmF0ZV9kdXJhdGlvbicsXG4gICAgICAgICAgICBsYWJlbDogJyVNT1ZFIFNMT1c6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF4X3Nsb3cgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ21heF9zbG93JywwKTtcbiAgICAgICAgICAgICAgICB2YXIgc2xvd19wZXJfdGljayA9IG1heF9zbG93IC8gKGEgLSAwLjUpIC8gMjtcbiAgICAgICAgICAgICAgICB2YXIgdGlja3MgPSBNYXRoLm1heChNYXRoLmZsb29yKHYgKiAyKSAtIDEsIDApO1xuICAgICAgICAgICAgICAgIHJldHVybiAtTWF0aC5taW4odGlja3MgKiBzbG93X3Blcl90aWNrLCBtYXhfc2xvdyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0dXJuUHJvcGVydHk6ICdtb3ZlbWVudFNwZWVkUGN0UmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnd2VhdmVyX3RoZV9zd2FybSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdBdHRhY2tzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdhcm1vcl9yZWR1Y3Rpb24nLFxuICAgICAgICAgICAgbGFiZWw6ICdEQU1BR0U6JyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtdiphO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXJtb3JSZWR1Y3Rpb24nXG4gICAgICAgIH1cbiAgICBdLFxuICAgICd3aW5kcnVubmVyX3Bvd2Vyc2hvdCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpKnY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdLFxuICAgICd3aW50ZXJfd3l2ZXJuX2NvbGRfZW1icmFjZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdEdXJhdGlvbicsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0FsbHkgTWF4IEhlYWx0aCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVhbF9wZXJjZW50YWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVE9UQUwgSEVBTDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsMV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBiYXNlX2hlYWwgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2hlYWxfYWRkaXRpdmUnLGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChiYXNlX2hlYWwgKyB2WzFdICogYS8xMDApICogdlswXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3dpc3Bfc3Bpcml0cyc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdDb2xsaXNpb24gQ291bnQnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hlcm9fZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdjcmVlcF9kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3dpc3Bfb3ZlcmNoYXJnZSc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdDdXJyZW50IEhQJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkcmFpbl9wY3QnLFxuICAgICAgICAgICAgbGFiZWw6ICdIUCBEUkFJTkVEOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLCBcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnQ3VycmVudCBNUCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZHJhaW5fcGN0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnTVAgRFJBSU5FRDonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSwgXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfYXR0YWNrX3NwZWVkJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnYXR0YWNrc3BlZWQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19kYW1hZ2VfcGN0JyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHVyblByb3BlcnR5OiAnZGFtYWdlUmVkdWN0aW9uJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICAnd2l0Y2hfZG9jdG9yX3BhcmFseXppbmdfY2Fzayc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdIZXJvIEJvdW5jZSBDb3VudCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVyb19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGJvdW5jZXMgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2JvdW5jZXMnLGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHYsIDApLCBib3VuY2VzKSphO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0NyZWVwIEJvdW5jZSBDb3VudCcsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnaGVyb19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdDUkVFUCBEQU1BR0U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYm91bmNlcyA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnYm91bmNlcycsYWJpbGl0eS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICB2YXIgZGFtYWdlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodiwgMCksIGJvdW5jZXMpKmRhbWFnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3dpdGNoX2RvY3Rvcl92b29kb29fcmVzdG9yYXRpb24nOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnRHVyYXRpb24nLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdpbnB1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2hlYWwnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGludGVydmFsID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdoZWFsX2ludGVydmFsJyxhYmlsaXR5LmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIHZhciBoZWFsX3Blcl90aWNrID0gYSAqIGludGVydmFsO1xuICAgICAgICAgICAgICAgIHZhciB0aWNrcyA9IE1hdGgubWF4KE1hdGguZmxvb3IodiAvIGludGVydmFsKSAtIDEsIDApO1xuICAgICAgICAgICAgICAgIHJldHVybiBoZWFsX3Blcl90aWNrICogdGlja3M7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdtYW5hX3Blcl9zZWNvbmQnLFxuICAgICAgICAgICAgbGFiZWw6ICdNQU5BIENPU1Q6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJ2YWwgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKGFiaWxpdHkuYXR0cmlidXRlcywgJ2hlYWxfaW50ZXJ2YWwnLGFiaWxpdHkubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgdmFyIG1hbmFfcGVyX3RpY2sgPSBhICogaW50ZXJ2YWw7XG4gICAgICAgICAgICAgICAgdmFyIHRpY2tzID0gTWF0aC5tYXgoTWF0aC5mbG9vcih2IC8gaW50ZXJ2YWwpIC0gMSwgMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hbmFfcGVyX3RpY2sgKiB0aWNrcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3dpdGNoX2RvY3Rvcl9tYWxlZGljdCc6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6ICdkYW1hZ2UgMC00cycsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ2lucHV0J1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ2RhbWFnZSA0LThzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiAnZGFtYWdlIDgtMTJzJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdEb3QgRGFtYWdlIGFmdGVyIDNzOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdtZXRob2QnLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGFtYWdlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gMypkYW1hZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdCdXJzdCBEYW1hZ2UgYXQgNHM6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ21ldGhvZCcsXG4gICAgICAgICAgICBjb250cm9sczogWzAsIDNdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGFtYWdlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IHYucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBvKSB7IHJldHVybiBtZW1vICsgbyB9LCAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoZCwgMCkgKiBhLzEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0RvdCBEYW1hZ2UgYWZ0ZXIgN3M6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ21ldGhvZCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBkYW1hZ2UgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpO1xuICAgICAgICAgICAgICAgIHJldHVybiA3KmRhbWFnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2JvbnVzX2RhbWFnZScsXG4gICAgICAgICAgICBsYWJlbDogJ0J1cnN0IERhbWFnZSBhdCA4czonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnbWV0aG9kJyxcbiAgICAgICAgICAgIGNvbnRyb2xzOiBbMCwgMSwgNCwgNV0sXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBkYW1hZ2UgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gdi5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvIH0sIDApO1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChkLCAwKSAqIGEvMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnRG90IERhbWFnZSBhZnRlciAxMXM6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ21ldGhvZCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBkYW1hZ2UgPSBhYmlsaXR5TW9kZWwuZ2V0QWJpbGl0eVByb3BlcnR5VmFsdWUoYWJpbGl0eSwgJ2RhbWFnZScpO1xuICAgICAgICAgICAgICAgIHJldHVybiAxMSpkYW1hZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdCdXJzdCBEYW1hZ2UgYXQgMTJzOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdtZXRob2QnLFxuICAgICAgICAgICAgY29udHJvbHM6IFswLCAxLCAyLCA0LCA2LCA3XSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhbWFnZSA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5UHJvcGVydHlWYWx1ZShhYmlsaXR5LCAnZGFtYWdlJyk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSB2LnJlZHVjZShmdW5jdGlvbiAobWVtbywgbykgeyByZXR1cm4gbWVtbyArIG8gfSwgMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KGQsIDApICogYS8xMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBCdXJzdCBEYW1hZ2U6JyxcbiAgICAgICAgICAgIGlnbm9yZVRvb2x0aXA6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sVHlwZTogJ21ldGhvZCcsXG4gICAgICAgICAgICBjb250cm9sczogWzQsIDYsIDhdLFxuICAgICAgICAgICAgZm46IGZ1bmN0aW9uICh2LCBhLCBwYXJlbnQsIGluZGV4LCBhYmlsaXR5TW9kZWwsIGFiaWxpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdi5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvIH0sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnYm9udXNfZGFtYWdlJyxcbiAgICAgICAgICAgIGxhYmVsOiAnVG90YWwgTWFsZWRpY3QgRGFtYWdlOicsXG4gICAgICAgICAgICBpZ25vcmVUb29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdtZXRob2QnLFxuICAgICAgICAgICAgY29udHJvbHM6IFs5XSxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlBdHRyaWJ1dGVWYWx1ZShhYmlsaXR5LmF0dHJpYnV0ZXMsICdkdXJhdGlvbl90b29sdGlwJywwKTtcbiAgICAgICAgICAgICAgICB2YXIgZGFtYWdlID0gYWJpbGl0eU1vZGVsLmdldEFiaWxpdHlQcm9wZXJ0eVZhbHVlKGFiaWxpdHksICdkYW1hZ2UnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGFtYWdlICogZHVyYXRpb24gKyB2WzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdib251c19kYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdET1QgRGFtYWdlJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUoYWJpbGl0eS5hdHRyaWJ1dGVzLCAnZHVyYXRpb25fdG9vbHRpcCcsMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHlNb2RlbC5nZXRBYmlsaXR5UHJvcGVydHlWYWx1ZShhYmlsaXR5LCAnZGFtYWdlJykqTWF0aC5taW4oTWF0aC5tYXgodiwgMCksIGR1cmF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3dpdGNoX2RvY3Rvcl9kZWF0aF93YXJkJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0R1cmF0aW9uJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2UnLFxuICAgICAgICAgICAgbGFiZWw6ICdUb3RhbCBEYW1hZ2UnLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAodiwgYSwgcGFyZW50LCBpbmRleCwgYWJpbGl0eU1vZGVsLCBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYqYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgJ3p1dXNfc3RhdGljX2ZpZWxkJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogJ0VuZW15IEhQJyxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAnaW5wdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdkYW1hZ2VfaGVhbHRoX3BjdCcsXG4gICAgICAgICAgICBsYWJlbDogJ0RBTUFHRTonLFxuICAgICAgICAgICAgaWdub3JlVG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBmbjogZnVuY3Rpb24gKHYsIGEsIHBhcmVudCwgaW5kZXgsIGFiaWxpdHlNb2RlbCwgYWJpbGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2KmEvMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXVxufSIsIid1c2Ugc3RyaWN0JztcbnZhciBrbyA9IHJlcXVpcmUoJy4vaGVyb2NhbGNfa25vY2tvdXQnKTtcbiAgICBcbnZhciBteSA9IHJlcXVpcmUoXCIuL2hlcm9jYWxjX2NvcmVcIik7XG5cbm15LnByb3RvdHlwZS5CdWZmT3B0aW9uID0gZnVuY3Rpb24gKGhlcm8sIGFiaWxpdHkpIHtcbiAgICB0aGlzLmJ1ZmZOYW1lID0gYWJpbGl0eTtcbiAgICBpZiAobXkucHJvdG90eXBlLmhlcm9EYXRhWyducGNfZG90YV9oZXJvXycgKyBoZXJvXSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5oZXJvID0gaGVybztcbiAgICAgICAgdGhpcy5hYmlsaXR5RGF0YSA9IG15LnByb3RvdHlwZS5maW5kV2hlcmUobXkucHJvdG90eXBlLnVuaXREYXRhW2hlcm9dLmFiaWxpdGllcywge25hbWU6IGFiaWxpdHl9KVxuICAgICAgICB0aGlzLmJ1ZmZEaXNwbGF5TmFtZSA9IG15LnByb3RvdHlwZS51bml0RGF0YVtoZXJvXS5kaXNwbGF5bmFtZSArICcgLSAnICsgdGhpcy5hYmlsaXR5RGF0YS5kaXNwbGF5bmFtZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRoaXMuaGVybyA9ICducGNfZG90YV9oZXJvXycgKyBoZXJvO1xuICAgICAgICB0aGlzLmFiaWxpdHlEYXRhID0gbXkucHJvdG90eXBlLmZpbmRXaGVyZShteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fJyArIGhlcm9dLmFiaWxpdGllcywge25hbWU6IGFiaWxpdHl9KVxuICAgICAgICB0aGlzLmJ1ZmZEaXNwbGF5TmFtZSA9IG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb18nICsgaGVyb10uZGlzcGxheW5hbWUgKyAnIC0gJyArIHRoaXMuYWJpbGl0eURhdGEuZGlzcGxheW5hbWU7ICAgICAgICBcbiAgICAgICAgaWYgKGFiaWxpdHkgPT0gJ3N2ZW5fZ29kc19zdHJlbmd0aCcpIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZkRpc3BsYXlOYW1lICs9ICcgKEF1cmEgZm9yIGFsbGllcyknO1xuICAgICAgICB9XG4gICAgfVxuXG59O1xuXG5teS5wcm90b3R5cGUuSXRlbUJ1ZmZPcHRpb24gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgIHRoaXMuYnVmZk5hbWUgPSBpdGVtO1xuICAgIGlmIChteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fJyArIGhlcm9dID09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmhlcm8gPSBoZXJvO1xuICAgICAgICB0aGlzLmFiaWxpdHlEYXRhID0gbXkucHJvdG90eXBlLmZpbmRXaGVyZShteS5wcm90b3R5cGUudW5pdERhdGFbaGVyb10uYWJpbGl0aWVzLCB7bmFtZTogaXRlbX0pXG4gICAgICAgIHRoaXMuYnVmZkRpc3BsYXlOYW1lID0gbXkucHJvdG90eXBlLnVuaXREYXRhW2hlcm9dLmRpc3BsYXluYW1lICsgJyAtICcgKyB0aGlzLmFiaWxpdHlEYXRhLmRpc3BsYXluYW1lOyAgICAgICAgXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmhlcm8gPSAnbnBjX2RvdGFfaGVyb18nICsgaGVybztcbiAgICAgICAgdGhpcy5hYmlsaXR5RGF0YSA9IG15LnByb3RvdHlwZS5maW5kV2hlcmUobXkucHJvdG90eXBlLmhlcm9EYXRhWyducGNfZG90YV9oZXJvXycgKyBoZXJvXS5hYmlsaXRpZXMsIHtuYW1lOiBpdGVtfSlcbiAgICAgICAgdGhpcy5idWZmRGlzcGxheU5hbWUgPSBteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fJyArIGhlcm9dLmRpc3BsYXluYW1lICsgJyAtICcgKyB0aGlzLmFiaWxpdHlEYXRhLmRpc3BsYXluYW1lOyAgICAgICAgXG4gICAgfVxuXG59O1xuXG5teS5wcm90b3R5cGUuQnVmZlZpZXdNb2RlbCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgdmFyIHNlbGYgPSBuZXcgbXkucHJvdG90eXBlLkFiaWxpdHlNb2RlbChrby5vYnNlcnZhYmxlQXJyYXkoW10pKTtcbiAgICBzZWxmLmF2YWlsYWJsZUJ1ZmZzID0ga28ub2JzZXJ2YWJsZUFycmF5KG15LnByb3RvdHlwZS5hdmFpbGFibGVCdWZmcyk7XG4gICAgc2VsZi5hdmFpbGFibGVEZWJ1ZmZzID0ga28ub2JzZXJ2YWJsZUFycmF5KG15LnByb3RvdHlwZS5hdmFpbGFibGVEZWJ1ZmZzKTtcbiAgICBzZWxmLnNlbGVjdGVkQnVmZiA9IGtvLm9ic2VydmFibGUoc2VsZi5hdmFpbGFibGVCdWZmcygpWzBdKTtcbiAgICBcbiAgICBzZWxmLmJ1ZmZzID0ga28ub2JzZXJ2YWJsZUFycmF5KFtdKTtcbiAgICBzZWxmLml0ZW1CdWZmcyA9IG5ldyBteS5wcm90b3R5cGUuSW52ZW50b3J5Vmlld01vZGVsKCk7XG4gICAgXG4gICAgc2VsZi5hZGRCdWZmID0gZnVuY3Rpb24gKGRhdGEsIGV2ZW50KSB7XG4gICAgICAgIGlmIChteS5wcm90b3R5cGUuZmluZFdoZXJlKHNlbGYuYnVmZnMoKSwgeyBuYW1lOiBzZWxmLnNlbGVjdGVkQnVmZigpLmJ1ZmZOYW1lIH0pICA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBhID0ga28ud3JhcC5mcm9tSlMoc2VsZi5zZWxlY3RlZEJ1ZmYoKS5hYmlsaXR5RGF0YSk7XG4gICAgICAgICAgICBhLmlzQWN0aXZlID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgICAgICAgICBhLmlzRGV0YWlsID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgICAgICAgICBhLmJhc2VEYW1hZ2UgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5iYXNoID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuYmFzaEJvbnVzRGFtYWdlID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuYm9udXNEYW1hZ2UgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5ib251c0RhbWFnZU9yYiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmJvbnVzRGFtYWdlUGN0ID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuYm9udXNEYW1hZ2VQcmVjaXNpb25BdXJhID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuYm9udXNEYW1hZ2VSZWR1Y3Rpb24gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5ib251c0hlYWx0aCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmJvbnVzU3RyZW5ndGggPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5ib251c1N0cmVuZ3RoMiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmJvbnVzQWdpbGl0eSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmJvbnVzQWdpbGl0eTIgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5ib251c0ludCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmJvbnVzQWxsU3RhdHNSZWR1Y3Rpb24gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5kYW1hZ2VBbXBsaWZpY2F0aW9uID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuZGFtYWdlUmVkdWN0aW9uID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuZXZhc2lvbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLm1hZ2ljUmVzaXN0ID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEubWFuYXJlZ2VuID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEubWFuYXJlZ2VucmVkdWN0aW9uID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEubWlzc0NoYW5jZSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLm1vdmVtZW50U3BlZWRGbGF0ID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEubW92ZW1lbnRTcGVlZFBjdCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLm1vdmVtZW50U3BlZWRQY3RSZWR1Y3Rpb24gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS50dXJuUmF0ZVJlZHVjdGlvbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmF0dGFja3JhbmdlID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuYXR0YWNrc3BlZWQgPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5hdHRhY2tzcGVlZHJlZHVjdGlvbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmFybW9yID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEuYXJtb3JSZWR1Y3Rpb24gPSBrby5vYnNlcnZhYmxlKDApO1xuICAgICAgICAgICAgYS5oZWFsdGhyZWdlbiA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLmxpZmVzdGVhbCA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgICAgICAgICBhLnZpc2lvbm5pZ2h0ID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIGEudmlzaW9uZGF5ID0ga28ub2JzZXJ2YWJsZSgwKTtcbiAgICAgICAgICAgIHN3aXRjaCAoYS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnaW52b2tlcl9jb2xkX3NuYXAnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2ludm9rZXJfZ2hvc3Rfd2Fsayc6XG4gICAgICAgICAgICAgICAgY2FzZSAnaW52b2tlcl90b3JuYWRvJzpcbiAgICAgICAgICAgICAgICBjYXNlICdpbnZva2VyX2VtcCc6XG4gICAgICAgICAgICAgICAgY2FzZSAnaW52b2tlcl9hbGFjcml0eSc6XG4gICAgICAgICAgICAgICAgY2FzZSAnaW52b2tlcl9jaGFvc19tZXRlb3InOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2ludm9rZXJfc3VuX3N0cmlrZSc6XG4gICAgICAgICAgICAgICAgY2FzZSAnaW52b2tlcl9mb3JnZV9zcGlyaXQnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2ludm9rZXJfaWNlX3dhbGwnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2ludm9rZXJfZGVhZmVuaW5nX2JsYXN0JzpcbiAgICAgICAgICAgICAgICAgICAgYS5sZXZlbCgxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzLnB1c2goYSk7XG4gICAgICAgICAgICBzZWxmLmJ1ZmZzLnB1c2goeyBuYW1lOiBzZWxmLnNlbGVjdGVkQnVmZigpLmJ1ZmZOYW1lLCBoZXJvOiBzZWxmLnNlbGVjdGVkQnVmZigpLmhlcm8sIGRhdGE6IGEgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFxuICAgIHNlbGYucmVtb3ZlQnVmZiA9IGZ1bmN0aW9uIChkYXRhLCBldmVudCwgYWJpbGl0eU5hbWUpIHtcbiAgICAgICAgaWYgKG15LnByb3RvdHlwZS5maW5kV2hlcmUoc2VsZi5idWZmcygpLCB7IG5hbWU6IGFiaWxpdHlOYW1lIH0pICAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmJ1ZmZzLnJlbW92ZShteS5wcm90b3R5cGUuZmluZFdoZXJlKHNlbGYuYnVmZnMoKSwgeyBuYW1lOiBhYmlsaXR5TmFtZSB9KSk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuYWJpbGl0eUNvbnRyb2xEYXRhW2FiaWxpdHlOYW1lXSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdHlDb250cm9sRGF0YVthYmlsaXR5TmFtZV0uZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuYWJpbGl0eUNvbnRyb2xEYXRhW2FiaWxpdHlOYW1lXS5kYXRhW2ldLmNvbnRyb2xWYWwuZGlzcG9zZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdHlDb250cm9sRGF0YVthYmlsaXR5TmFtZV0uZGF0YVtpXS5jb250cm9sVmFsLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmFiaWxpdHlDb250cm9sRGF0YVthYmlsaXR5TmFtZV0uZGF0YVtpXS5jbGVhbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdHlDb250cm9sRGF0YVthYmlsaXR5TmFtZV0uZGF0YVtpXS5jbGVhbi5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXR5Q29udHJvbERhdGFbYWJpbGl0eU5hbWVdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmFiaWxpdGllc1tpXS5uYW1lID09IGFiaWxpdHlOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpXS5sZXZlbCgwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzLnJlbW92ZShzZWxmLmFiaWxpdGllc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgc2VsZi50b2dnbGVCdWZmID0gZnVuY3Rpb24gKGluZGV4LCBkYXRhLCBldmVudCkge1xuICAgICAgICBpZiAoc2VsZi5idWZmcygpW2luZGV4KCldLmRhdGEuYmVoYXZpb3IuaW5kZXhPZignRE9UQV9BQklMSVRZX0JFSEFWSU9SX1BBU1NJVkUnKSA8IDApIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmJ1ZmZzKClbaW5kZXgoKV0uZGF0YS5pc0FjdGl2ZSgpKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5idWZmcygpW2luZGV4KCldLmRhdGEuaXNBY3RpdmUoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmlzQWN0aXZlKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGYuYnVmZnMoKVtpbmRleCgpXS5kYXRhLmlzQWN0aXZlKHRydWUpO1xuICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmlzQWN0aXZlKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgc2VsZi50b2dnbGVCdWZmRGV0YWlsID0gZnVuY3Rpb24gKGluZGV4LCBkYXRhLCBldmVudCkge1xuICAgICAgICBpZiAoc2VsZi5idWZmcygpW2luZGV4KCldLmRhdGEuaXNEZXRhaWwoKSkge1xuICAgICAgICAgICAgc2VsZi5idWZmcygpW2luZGV4KCldLmRhdGEuaXNEZXRhaWwoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2VsZi5idWZmcygpW2luZGV4KCldLmRhdGEuaXNEZXRhaWwodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAvLyBPdmVycmlkZXMgdGhlIGFiaWxpdHkgbW9kdWxlIGZ1bmN0aW9uIHRvIHJlbW92ZSBhdmFpbGFibGUgc2tpbGwgcG9pbnQgY2hlY2tcbiAgICBzZWxmLmxldmVsVXBBYmlsaXR5ID0gZnVuY3Rpb24gKGluZGV4LCBkYXRhLCBldmVudCwgaGVybykge1xuICAgICAgICBpZiAoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSA8IGhlcm8uZ2V0QWJpbGl0eUxldmVsTWF4KGRhdGEpKSB7XG4gICAgICAgICAgICBzd2l0Y2goc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0uYWJpbGl0eXR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdET1RBX0FCSUxJVFlfVFlQRV9VTFRJTUFURSc6XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkgKyAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpICsgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzd2l0Y2ggKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdiZWFzdG1hc3Rlcl9jYWxsX29mX3RoZV93aWxkJzpcbiAgICAgICAgICAgICAgICBjYXNlICdjaGVuX3Rlc3Rfb2ZfZmFpdGgnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ21vcnBobGluZ19tb3JwaF9hZ2knOlxuICAgICAgICAgICAgICAgIGNhc2UgJ3NoYWRvd19kZW1vbl9zaGFkb3dfcG9pc29uJzpcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSArIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ21vcnBobGluZ19tb3JwaF9zdHInOlxuICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpIC0gMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAna2VlcGVyX29mX3RoZV9saWdodF9zcGlyaXRfZm9ybSc6XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDJdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGNhc2UgJ25ldmVybW9yZV9zaGFkb3dyYXplMSc6XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgKyAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSArIDJdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ25ldmVybW9yZV9zaGFkb3dyYXplMic6XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSArIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ25ldmVybW9yZV9zaGFkb3dyYXplMyc6XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDJdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBzZWxmLmxldmVsRG93bkFiaWxpdHkgPSBmdW5jdGlvbiAoaW5kZXgsIGRhdGEsIGV2ZW50LCBoZXJvKSB7XG4gICAgICAgIGlmIChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpID4gMCkge1xuICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSAtIDEpO1xuICAgICAgICAgICAgc3dpdGNoIChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYmVhc3RtYXN0ZXJfY2FsbF9vZl90aGVfd2lsZCc6XG4gICAgICAgICAgICAgICAgY2FzZSAnY2hlbl90ZXN0X29mX2ZhaXRoJzpcbiAgICAgICAgICAgICAgICBjYXNlICdtb3JwaGxpbmdfbW9ycGhfYWdpJzpcbiAgICAgICAgICAgICAgICBjYXNlICdzaGFkb3dfZGVtb25fc2hhZG93X3BvaXNvbic6XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgKyAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdtb3JwaGxpbmdfbW9ycGhfc3RyJzpcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2tlZXBlcl9vZl90aGVfbGlnaHRfc3Bpcml0X2Zvcm0nOlxuICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpIC0gMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAyXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBjYXNlICduZXZlcm1vcmVfc2hhZG93cmF6ZTEnOlxuICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpICsgMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgKyAyXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICduZXZlcm1vcmVfc2hhZG93cmF6ZTInOlxuICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpIC0gMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgKyAxXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICduZXZlcm1vcmVfc2hhZG93cmF6ZTMnOlxuICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdGllc1tpbmRleCgpIC0gMV0ubGV2ZWwoc2VsZi5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYWJpbGl0aWVzW2luZGV4KCkgLSAyXS5sZXZlbChzZWxmLmFiaWxpdGllc1tpbmRleCgpXS5sZXZlbCgpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdlbWJlcl9zcGlyaXRfZmlyZV9yZW1uYW50JzpcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2xvbmVfZHJ1aWRfdHJ1ZV9mb3JtJzpcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXRpZXNbaW5kZXgoKSAtIDFdLmxldmVsKHNlbGYuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gc2VsZjtcbn0iLCIndXNlIHN0cmljdCc7XG5yZXF1aXJlKCcuL3BvbHlmaWxsJyk7XG5cbmZ1bmN0aW9uIEhFUk9DQUxDVUxBVE9SICgpIHtcbiAgIC8vIC4uLlxufVxuXG52YXIgbXkgPSBIRVJPQ0FMQ1VMQVRPUjtcblxubXkucHJvdG90eXBlLmhlcm9EYXRhID0ge307XG5teS5wcm90b3R5cGUuaXRlbURhdGEgPSB7fTtcbm15LnByb3RvdHlwZS51bml0RGF0YSA9IHt9O1xubXkucHJvdG90eXBlLmFiaWxpdHlEYXRhID0ge307XG5cbm15LnByb3RvdHlwZS5IZXJvT3B0aW9ucyA9IFtdO1xuXG5teS5wcm90b3R5cGUuSGVyb09wdGlvbiA9IGZ1bmN0aW9uIChuYW1lLCBkaXNwbGF5bmFtZSwgaGVybykge1xuICAgIHRoaXMuaGVyb05hbWUgPSBuYW1lO1xuICAgIHRoaXMuaGVyb0Rpc3BsYXlOYW1lID0gZGlzcGxheW5hbWU7XG4gICAgdGhpcy5oZXJvID0gaGVybztcbn07XG5cbm15LnByb3RvdHlwZS5pZENvdW50ZXIgPSAwO1xubXkucHJvdG90eXBlLnVuaXF1ZUlkID0gZnVuY3Rpb24gKHByZWZpeCkge1xuICAgIHZhciBpZCA9ICsrbXkucHJvdG90eXBlLmlkQ291bnRlciArICcnO1xuICAgIHJldHVybiBwcmVmaXggPyBwcmVmaXggKyBpZCA6IGlkO1xufTtcbm15LnByb3RvdHlwZS5maW5kV2hlcmUgPSBmdW5jdGlvbiAoYXJyLCBvYmopIHtcbiAgICBhcnJMb29wOiBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBvYmpMb29wOiBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgICAgICAgICBpZiAoYXJyW2ldW2tleV0gIT0gb2JqW2tleV0pIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZSBhcnJMb29wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcnJbaV07XG4gICAgfVxufVxubXkucHJvdG90eXBlLnVuaXF1ZXMgPSBmdW5jdGlvbiAoYXJyKSB7XG4gICAgdmFyIGEgPSBbXTtcbiAgICBmb3IgKHZhciBpPTAsIGw9YXJyLmxlbmd0aDsgaTxsOyBpKyspXG4gICAgICAgIGlmIChhLmluZGV4T2YoYXJyW2ldKSA9PT0gLTEgJiYgYXJyW2ldICE9PSAnJylcbiAgICAgICAgICAgIGEucHVzaChhcnJbaV0pO1xuICAgIHJldHVybiBhO1xufVxubXkucHJvdG90eXBlLnVuaW9uID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICB2YXIgYXJyID0gYS5jb25jYXQoYik7XG4gICAgcmV0dXJuIG15LnByb3RvdHlwZS51bmlxdWVzKGFycik7XG59XG5cbm15LnByb3RvdHlwZS50b3RhbFJlc291cmNlcyA9IDM7XG5teS5wcm90b3R5cGUubnVtUmVzb3VyY2VzTG9hZGVkID0gMDtcbm15LnByb3RvdHlwZS5vblJlc291cmNlTG9hZGVkID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgbXkucHJvdG90eXBlLm51bVJlc291cmNlc0xvYWRlZCsrO1xuICAgIGlmIChteS5wcm90b3R5cGUubnVtUmVzb3VyY2VzTG9hZGVkID09IG15LnByb3RvdHlwZS50b3RhbFJlc291cmNlcykge1xuICAgICAgICBcbiAgICAgICAgbXkucHJvdG90eXBlLmF2YWlsYWJsZUJ1ZmZzID0gW1xuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdhYmFkZG9uJywgJ2FiYWRkb25fZnJvc3Rtb3VybmUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignYXhlJywgJ2F4ZV9jdWxsaW5nX2JsYWRlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2JlYXN0bWFzdGVyJywgJ2JlYXN0bWFzdGVyX2lubmVyX2JlYXN0JyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2Jsb29kc2Vla2VyJywgJ2Jsb29kc2Vla2VyX2Jsb29kcmFnZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdib3VudHlfaHVudGVyJywgJ2JvdW50eV9odW50ZXJfdHJhY2snKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignY2VudGF1cicsICdjZW50YXVyX3N0YW1wZWRlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2NyeXN0YWxfbWFpZGVuJywgJ2NyeXN0YWxfbWFpZGVuX2JyaWxsaWFuY2VfYXVyYScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdkYXJrX3NlZXInLCAnZGFya19zZWVyX3N1cmdlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2RhenpsZScsICdkYXp6bGVfd2VhdmUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignZHJvd19yYW5nZXInLCAnZHJvd19yYW5nZXJfdHJ1ZXNob3QnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignaW52b2tlcicsICdpbnZva2VyX2FsYWNyaXR5JyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3dpc3AnLCAnd2lzcF90ZXRoZXInKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignd2lzcCcsICd3aXNwX292ZXJjaGFyZ2UnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigna3Vua2thJywgJ2t1bmtrYV9naG9zdHNoaXAnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbGljaCcsICdsaWNoX2Zyb3N0X2FybW9yJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2xpZmVfc3RlYWxlcicsICdsaWZlX3N0ZWFsZXJfb3Blbl93b3VuZHMnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbHVuYScsICdsdW5hX2x1bmFyX2JsZXNzaW5nJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2x5Y2FuJywgJ2x5Y2FuX2hvd2wnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbWFnbmF0YXVyJywgJ21hZ25hdGF1cl9lbXBvd2VyJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ21pcmFuYScsICdtaXJhbmFfbGVhcCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdvZ3JlX21hZ2knLCAnb2dyZV9tYWdpX2Jsb29kbHVzdCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdvbW5pa25pZ2h0JywgJ29tbmlrbmlnaHRfZ3VhcmRpYW5fYW5nZWwnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigncnViaWNrJywgJ3J1Ymlja19udWxsX2ZpZWxkJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3NrZWxldG9uX2tpbmcnLCAnc2tlbGV0b25fa2luZ192YW1waXJpY19hdXJhJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3NwaXJpdF9icmVha2VyJywgJ3NwaXJpdF9icmVha2VyX2VtcG93ZXJpbmdfaGFzdGUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignc3ZlbicsICdzdmVuX3dhcmNyeScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdzdmVuJywgJ3N2ZW5fZ29kc19zdHJlbmd0aCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCd0cmVhbnQnLCAndHJlYW50X2xpdmluZ19hcm1vcicpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCd0cm9sbF93YXJsb3JkJywgJ3Ryb2xsX3dhcmxvcmRfYmF0dGxlX3RyYW5jZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCd2ZW5nZWZ1bHNwaXJpdCcsICd2ZW5nZWZ1bHNwaXJpdF9jb21tYW5kX2F1cmEnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbnBjX2RvdGFfbmV1dHJhbF9hbHBoYV93b2xmJywgJ2FscGhhX3dvbGZfY3JpdGljYWxfc3RyaWtlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ25wY19kb3RhX25ldXRyYWxfYWxwaGFfd29sZicsICdhbHBoYV93b2xmX2NvbW1hbmRfYXVyYScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCducGNfZG90YV9uZXV0cmFsX3BvbGFyX2Z1cmJvbGdfdXJzYV93YXJyaW9yJywgJ2NlbnRhdXJfa2hhbl9lbmR1cmFuY2VfYXVyYScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCducGNfZG90YV9uZXV0cmFsX2dpYW50X3dvbGYnLCAnZ2lhbnRfd29sZl9jcml0aWNhbF9zdHJpa2UnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbnBjX2RvdGFfbmV1dHJhbF9rb2JvbGRfdGFza21hc3RlcicsICdrb2JvbGRfdGFza21hc3Rlcl9zcGVlZF9hdXJhJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ25wY19kb3RhX25ldXRyYWxfb2dyZV9tYWdpJywgJ29ncmVfbWFnaV9mcm9zdF9hcm1vcicpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCducGNfZG90YV9uZXV0cmFsX3NhdHlyX2hlbGxjYWxsZXInLCAnc2F0eXJfaGVsbGNhbGxlcl91bmhvbHlfYXVyYScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCducGNfZG90YV9uZXV0cmFsX2VucmFnZWRfd2lsZGtpbicsICdlbnJhZ2VkX3dpbGRraW5fdG91Z2huZXNzX2F1cmEnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbnBjX2RvdGFfbmVjcm9ub21pY29uX2FyY2hlcl8xJywgJ25lY3Jvbm9taWNvbl9hcmNoZXJfYW9lJylcbiAgICAgICAgXTtcblxuICAgICAgICBteS5wcm90b3R5cGUuYXZhaWxhYmxlRGVidWZmcyA9IFtcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignYWJhZGRvbicsICdhYmFkZG9uX2Zyb3N0bW91cm5lJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2FsY2hlbWlzdCcsICdhbGNoZW1pc3RfYWNpZF9zcHJheScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdhbmNpZW50X2FwcGFyaXRpb24nLCAnYW5jaWVudF9hcHBhcml0aW9uX2ljZV92b3J0ZXgnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignYXhlJywgJ2F4ZV9iYXR0bGVfaHVuZ2VyJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2JhbmUnLCAnYmFuZV9lbmZlZWJsZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdiYXRyaWRlcicsICdiYXRyaWRlcl9zdGlja3lfbmFwYWxtJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2JlYXN0bWFzdGVyJywgJ2JlYXN0bWFzdGVyX3ByaW1hbF9yb2FyJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2JvdW50eV9odW50ZXInLCAnYm91bnR5X2h1bnRlcl9qaW5hZGEnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignYnJld21hc3RlcicsICdicmV3bWFzdGVyX3RodW5kZXJfY2xhcCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdicmV3bWFzdGVyJywgJ2JyZXdtYXN0ZXJfZHJ1bmtlbl9oYXplJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2JyaXN0bGViYWNrJywgJ2JyaXN0bGViYWNrX3Zpc2NvdXNfbmFzYWxfZ29vJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2Jyb29kbW90aGVyJywgJ2Jyb29kbW90aGVyX2luY2FwYWNpdGF0aW5nX2JpdGUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignY2VudGF1cicsICdjZW50YXVyX3N0YW1wZWRlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2NoZW4nLCAnY2hlbl9wZW5pdGVuY2UnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignY3J5c3RhbF9tYWlkZW4nLCAnY3J5c3RhbF9tYWlkZW5fY3J5c3RhbF9ub3ZhJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2NyeXN0YWxfbWFpZGVuJywgJ2NyeXN0YWxfbWFpZGVuX2ZyZWV6aW5nX2ZpZWxkJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2RhenpsZScsICdkYXp6bGVfd2VhdmUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignZHJvd19yYW5nZXInLCAnZHJvd19yYW5nZXJfZnJvc3RfYXJyb3dzJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2VhcnRoX3NwaXJpdCcsICdlYXJ0aF9zcGlyaXRfcm9sbGluZ19ib3VsZGVyJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2VsZGVyX3RpdGFuJywgJ2VsZGVyX3RpdGFuX25hdHVyYWxfb3JkZXInKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignZWxkZXJfdGl0YW4nLCAnZWxkZXJfdGl0YW5fZWFydGhfc3BsaXR0ZXInKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignZW5jaGFudHJlc3MnLCAnZW5jaGFudHJlc3NfdW50b3VjaGFibGUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignZW5jaGFudHJlc3MnLCAnZW5jaGFudHJlc3NfZW5jaGFudCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdmYWNlbGVzc192b2lkJywgJ2ZhY2VsZXNzX3ZvaWRfdGltZV93YWxrJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2h1c2thcicsICdodXNrYXJfbGlmZV9icmVhaycpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdpbnZva2VyJywgJ2ludm9rZXJfZ2hvc3Rfd2FsaycpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdpbnZva2VyJywgJ2ludm9rZXJfaWNlX3dhbGwnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignd2lzcCcsICd3aXNwX3RldGhlcicpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdqYWtpcm8nLCAnamFraXJvX2R1YWxfYnJlYXRoJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2pha2lybycsICdqYWtpcm9fbGlxdWlkX2ZpcmUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigna2VlcGVyX29mX3RoZV9saWdodCcsICdrZWVwZXJfb2ZfdGhlX2xpZ2h0X2JsaW5kaW5nX2xpZ2h0JyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2t1bmtrYScsICdrdW5ra2FfdG9ycmVudCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdsaWNoJywgJ2xpY2hfZnJvc3Rfbm92YScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdsaWNoJywgJ2xpY2hfZnJvc3RfYXJtb3InKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbGljaCcsICdsaWNoX2NoYWluX2Zyb3N0JyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ2xpZmVfc3RlYWxlcicsICdsaWZlX3N0ZWFsZXJfb3Blbl93b3VuZHMnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbGlvbicsICdsaW9uX3Zvb2RvbycpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdtYWduYXRhdXInLCAnbWFnbmF0YXVyX3NrZXdlcicpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdtZWR1c2EnLCAnbWVkdXNhX3N0b25lX2dhemUnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbWVlcG8nLCAnbWVlcG9fZ2Vvc3RyaWtlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ25hZ2Ffc2lyZW4nLCAnbmFnYV9zaXJlbl9yaXBfdGlkZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCduaWdodF9zdGFsa2VyJywgJ25pZ2h0X3N0YWxrZXJfdm9pZCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCduaWdodF9zdGFsa2VyJywgJ25pZ2h0X3N0YWxrZXJfY3JpcHBsaW5nX2ZlYXInKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbmlnaHRfc3RhbGtlcicsICduaWdodF9zdGFsa2VyX2RhcmtuZXNzJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ29ncmVfbWFnaScsICdvZ3JlX21hZ2lfaWduaXRlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ29tbmlrbmlnaHQnLCAnb21uaWtuaWdodF9kZWdlbl9hdXJhJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3BoYW50b21fYXNzYXNzaW4nLCAncGhhbnRvbV9hc3Nhc3Npbl9zdGlmbGluZ19kYWdnZXInKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigncGhhbnRvbV9sYW5jZXInLCAncGhhbnRvbV9sYW5jZXJfc3Bpcml0X2xhbmNlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3B1ZGdlJywgJ3B1ZGdlX3JvdCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdwdWduYScsICdwdWduYV9kZWNyZXBpZnknKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigncXVlZW5vZnBhaW4nLCAncXVlZW5vZnBhaW5fc2hhZG93X3N0cmlrZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdyaWtpJywgJ3Jpa2lfc21va2Vfc2NyZWVuJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3J1YmljaycsICdydWJpY2tfZmFkZV9ib2x0JyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3NhbmRfa2luZycsICdzYW5ka2luZ19lcGljZW50ZXInKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbmV2ZXJtb3JlJywgJ25ldmVybW9yZV9kYXJrX2xvcmQnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignc2hhZG93X3NoYW1hbicsICdzaGFkb3dfc2hhbWFuX3Zvb2RvbycpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdza2VsZXRvbl9raW5nJywgJ3NrZWxldG9uX2tpbmdfaGVsbGZpcmVfYmxhc3QnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignc2tlbGV0b25fa2luZycsICdza2VsZXRvbl9raW5nX3JlaW5jYXJuYXRpb24nKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignc2t5d3JhdGhfbWFnZScsICdza3l3cmF0aF9tYWdlX2NvbmN1c3NpdmVfc2hvdCcpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdza3l3cmF0aF9tYWdlJywgJ3NreXdyYXRoX21hZ2VfYW5jaWVudF9zZWFsJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3NsYXJkYXInLCAnc2xhcmRhcl9zbGl0aGVyZWVuX2NydXNoJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3NsYXJkYXInLCAnc2xhcmRhcl9hbXBsaWZ5X2RhbWFnZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdzbGFyaycsICdzbGFya19lc3NlbmNlX3NoaWZ0JyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3NuaXBlcicsICdzbmlwZXJfc2hyYXBuZWwnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignc3BlY3RyZScsICdzcGVjdHJlX3NwZWN0cmFsX2RhZ2dlcicpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCdzdG9ybV9zcGlyaXQnLCAnc3Rvcm1fc3Bpcml0X292ZXJsb2FkJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3RlbXBsYXJfYXNzYXNzaW4nLCAndGVtcGxhcl9hc3Nhc3Npbl9tZWxkJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3RpZGVodW50ZXInLCAndGlkZWh1bnRlcl9ndXNoJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3RpbmtlcicsICd0aW5rZXJfbGFzZXInKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigndHJlYW50JywgJ3RyZWFudF9sZWVjaF9zZWVkJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3R1c2snLCAndHVza19mcm96ZW5fc2lnaWwnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigndW5keWluZycsICd1bmR5aW5nX2ZsZXNoX2dvbGVtJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3Vyc2EnLCAndXJzYV9lYXJ0aHNob2NrJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3ZlbmdlZnVsc3Bpcml0JywgJ3ZlbmdlZnVsc3Bpcml0X3dhdmVfb2ZfdGVycm9yJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3ZlbmdlZnVsc3Bpcml0JywgJ3ZlbmdlZnVsc3Bpcml0X2NvbW1hbmRfYXVyYScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCd2ZW5vbWFuY2VyJywgJ3Zlbm9tYW5jZXJfdmVub21vdXNfZ2FsZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCd2ZW5vbWFuY2VyJywgJ3Zlbm9tYW5jZXJfcG9pc29uX3N0aW5nJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3ZpcGVyJywgJ3ZpcGVyX3BvaXNvbl9hdHRhY2snKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigndmlwZXInLCAndmlwZXJfY29ycm9zaXZlX3NraW4nKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbigndmlwZXInLCAndmlwZXJfdmlwZXJfc3RyaWtlJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3Zpc2FnZScsICd2aXNhZ2VfZ3JhdmVfY2hpbGwnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignd2FybG9jaycsICd3YXJsb2NrX3VwaGVhdmFsJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3dlYXZlcicsICd3ZWF2ZXJfdGhlX3N3YXJtJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3dpbmRydW5uZXInLCAnd2luZHJ1bm5lcl93aW5kcnVuJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ3dpbnRlcl93eXZlcm4nLCAnd2ludGVyX3d5dmVybl9hcmN0aWNfYnVybicpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCd3aW50ZXJfd3l2ZXJuJywgJ3dpbnRlcl93eXZlcm5fc3BsaW50ZXJfYmxhc3QnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbnBjX2RvdGFfbmV1dHJhbF9naG9zdCcsICdnaG9zdF9mcm9zdF9hdHRhY2snKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbnBjX2RvdGFfbmV1dHJhbF9wb2xhcl9mdXJib2xnX3Vyc2Ffd2FycmlvcicsICdwb2xhcl9mdXJib2xnX3Vyc2Ffd2Fycmlvcl90aHVuZGVyX2NsYXAnKSxcbiAgICAgICAgICAgIG5ldyBteS5wcm90b3R5cGUuQnVmZk9wdGlvbignbnBjX2RvdGFfbmV1dHJhbF9vZ3JlX21hZ2knLCAnb2dyZV9tYWdpX2Zyb3N0X2FybW9yJyksXG4gICAgICAgICAgICBuZXcgbXkucHJvdG90eXBlLkJ1ZmZPcHRpb24oJ25wY19kb3RhX25ldXRyYWxfc2F0eXJfdHJpY2tzdGVyJywgJ3NhdHlyX3RyaWNrc3Rlcl9wdXJnZScpLFxuICAgICAgICAgICAgbmV3IG15LnByb3RvdHlwZS5CdWZmT3B0aW9uKCducGNfZG90YV9uZXV0cmFsX2VucmFnZWRfd2lsZGtpbicsICdlbnJhZ2VkX3dpbGRraW5fdG9ybmFkbycpXG4gICAgICAgIF07XG4gICAgICAgIFxuICAgICAgICBteS5wcm90b3R5cGUuaXRlbU9wdGlvbnNBcnIgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBteS5wcm90b3R5cGUudmFsaWRJdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbXkucHJvdG90eXBlLml0ZW1PcHRpb25zQXJyLnB1c2gobmV3IG15LnByb3RvdHlwZS5JdGVtSW5wdXQobXkucHJvdG90eXBlLnZhbGlkSXRlbXNbaV0sIG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgbXkucHJvdG90eXBlLnZhbGlkSXRlbXNbaV1dLmRpc3BsYXluYW1lKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHZhciBpdGVtQnVmZnMgPSBbJ2Fzc2F1bHQnLCAnYW5jaWVudF9qYW5nZ28nLCAnaGVhZGRyZXNzJywgJ21la2Fuc20nLCAncGlwZScsICdyaW5nX29mX2FxdWlsYScsICd2bGFkbWlyJywgJ3Jpbmdfb2ZfYmFzaWxpdXMnLCAnYnVja2xlcicsICdzb2xhcl9jcmVzdCddO1xuICAgICAgICBteS5wcm90b3R5cGUuaXRlbUJ1ZmZPcHRpb25zID0gaXRlbUJ1ZmZzLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IG15LnByb3RvdHlwZS5JdGVtSW5wdXQoaXRlbSwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5kaXNwbGF5bmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdmFyIGl0ZW1EZWJ1ZmZzID0gW1xuICAgICAgICAgICAge2l0ZW06ICdhc3NhdWx0JywgZGVidWZmOiBudWxsfSxcbiAgICAgICAgICAgIHtpdGVtOiAnc2hpdmFzX2d1YXJkJywgZGVidWZmOiBudWxsfSxcbiAgICAgICAgICAgIHtpdGVtOiAnZGVzb2xhdG9yJywgZGVidWZmOiBudWxsfSxcbiAgICAgICAgICAgIHtpdGVtOiAnbWVkYWxsaW9uX29mX2NvdXJhZ2UnLCBkZWJ1ZmY6IG51bGx9LFxuICAgICAgICAgICAge2l0ZW06ICdyYWRpYW5jZScsIGRlYnVmZjogbnVsbH0sXG4gICAgICAgICAgICB7aXRlbTogJ3NoZWVwc3RpY2snLCBkZWJ1ZmY6IG51bGx9LFxuICAgICAgICAgICAge2l0ZW06ICd2ZWlsX29mX2Rpc2NvcmQnLCBkZWJ1ZmY6IG51bGx9LFxuICAgICAgICAgICAge2l0ZW06ICdzb2xhcl9jcmVzdCcsIGRlYnVmZjogbnVsbH0sXG4gICAgICAgICAgICB7aXRlbTogJ3NpbHZlcl9lZGdlJywgZGVidWZmOiB7aWQ6ICdzaGFkb3dfd2FsaycsIG5hbWU6ICdTaGFkb3cgV2Fsayd9fSxcbiAgICAgICAgICAgIHtpdGVtOiAnc2lsdmVyX2VkZ2UnLCBkZWJ1ZmY6IHtpZDogJ21haW0nLCBuYW1lOiAnTGVzc2VyIE1haW0nfX1cbiAgICAgICAgXVxuICAgICAgICBteS5wcm90b3R5cGUuaXRlbURlYnVmZk9wdGlvbnMgPSBpdGVtRGVidWZmcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBteS5wcm90b3R5cGUuSXRlbUlucHV0KGl0ZW0uaXRlbSwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtLml0ZW1dLmRpc3BsYXluYW1lLCBpdGVtLmRlYnVmZik7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgfVxufVxuXG5teS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChIRVJPREFUQV9QQVRILElURU1EQVRBX1BBVEgsVU5JVERBVEFfUEFUSCwgY2FsbGJhY2spIHtcbiAgICBteS5wcm90b3R5cGUubnVtUmVzb3VyY2VzTG9hZGVkID0gMDtcbiAgICBteS5wcm90b3R5cGUuZ2V0SlNPTihIRVJPREFUQV9QQVRILCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBteS5wcm90b3R5cGUuaGVyb0RhdGEgPSBkYXRhO1xuICAgICAgICBteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fY2hlbiddLmFiaWxpdGllc1syXS5iZWhhdmlvci5wdXNoKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfTk9UX0xFQVJOQUJMRScpO1xuICAgICAgICBteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fbmV2ZXJtb3JlJ10uYWJpbGl0aWVzWzFdLmJlaGF2aW9yLnB1c2goJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9OT1RfTEVBUk5BQkxFJyk7XG4gICAgICAgIG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19uZXZlcm1vcmUnXS5hYmlsaXRpZXNbMl0uYmVoYXZpb3IucHVzaCgnRE9UQV9BQklMSVRZX0JFSEFWSU9SX05PVF9MRUFSTkFCTEUnKTtcbiAgICAgICAgbXkucHJvdG90eXBlLmhlcm9EYXRhWyducGNfZG90YV9oZXJvX21vcnBobGluZyddLmFiaWxpdGllc1szXS5iZWhhdmlvci5wdXNoKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfTk9UX0xFQVJOQUJMRScpO1xuICAgICAgICBteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fb2dyZV9tYWdpJ10uYWJpbGl0aWVzWzNdLmJlaGF2aW9yLnB1c2goJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9OT1RfTEVBUk5BQkxFJyk7XG4gICAgICAgIG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb190ZWNoaWVzJ10uYWJpbGl0aWVzWzRdLmJlaGF2aW9yLnB1c2goJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9OT1RfTEVBUk5BQkxFJyk7XG4gICAgICAgIG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19iZWFzdG1hc3RlciddLmFiaWxpdGllc1syXS5iZWhhdmlvci5wdXNoKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfTk9UX0xFQVJOQUJMRScpO1xuICAgICAgICB2YXIgaW5kZXggPSBteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fbG9uZV9kcnVpZCddLmFiaWxpdGllc1szXS5iZWhhdmlvci5pbmRleE9mKCdET1RBX0FCSUxJVFlfQkVIQVZJT1JfSElEREVOJyk7XG4gICAgICAgIG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19sb25lX2RydWlkJ10uYWJpbGl0aWVzWzNdLmJlaGF2aW9yLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIFxuICAgICAgICBpbmRleCA9IG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19hYmFkZG9uJ10uYWJpbGl0aWVzWzJdLmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJyk7XG4gICAgICAgIG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19hYmFkZG9uJ10uYWJpbGl0aWVzWzJdLmJlaGF2aW9yLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIFxuICAgICAgICBpbmRleCA9IG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19yaWtpJ10uYWJpbGl0aWVzWzJdLmJlaGF2aW9yLmluZGV4T2YoJ0RPVEFfQUJJTElUWV9CRUhBVklPUl9QQVNTSVZFJyk7XG4gICAgICAgIG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19yaWtpJ10uYWJpbGl0aWVzWzJdLmJlaGF2aW9yLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKHZhciBoIGluIG15LnByb3RvdHlwZS5oZXJvRGF0YSkge1xuICAgICAgICAgICAgbXkucHJvdG90eXBlLkhlcm9PcHRpb25zLnB1c2gobmV3IG15LnByb3RvdHlwZS5IZXJvT3B0aW9uKGgucmVwbGFjZSgnbnBjX2RvdGFfaGVyb18nLCAnJyksIG15LnByb3RvdHlwZS5oZXJvRGF0YVtoXS5kaXNwbGF5bmFtZSkpO1xuICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgbXkucHJvdG90eXBlLm9uUmVzb3VyY2VMb2FkZWQoY2FsbGJhY2spO1xuICAgIH0pO1xuICAgIG15LnByb3RvdHlwZS5nZXRKU09OKElURU1EQVRBX1BBVEgsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIG15LnByb3RvdHlwZS5pdGVtRGF0YSA9IGRhdGE7XG4gICAgICAgIG15LnByb3RvdHlwZS5vblJlc291cmNlTG9hZGVkKGNhbGxiYWNrKTtcbiAgICB9KTtcbiAgICBteS5wcm90b3R5cGUuZ2V0SlNPTihVTklUREFUQV9QQVRILCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBteS5wcm90b3R5cGUudW5pdERhdGEgPSBkYXRhO1xuICAgICAgICBteS5wcm90b3R5cGUub25SZXNvdXJjZUxvYWRlZChjYWxsYmFjayk7XG4gICAgfSk7XG59XG5cbm15LnByb3RvdHlwZS5leHRlbmQgPSBmdW5jdGlvbiAob3V0KSB7XG4gICAgb3V0ID0gb3V0IHx8IHt9O1xuXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIG9iaiA9IGFyZ3VtZW50c1tpXTtcblxuICAgICAgICBpZiAoIW9iailcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHtcbiAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqW2tleV0gPT09ICdvYmplY3QnKVxuICAgICAgICAgICAgICAgICAgICBvdXRba2V5XSA9IGRlZXBFeHRlbmQob3V0W2tleV0sIG9ialtrZXldKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIG91dFtrZXldID0gb2JqW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb3V0O1xufTtcblxubXkucHJvdG90eXBlLmdldEpTT04gPSBmdW5jdGlvbiAodXJsLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCB0cnVlKTtcblxuICAgIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA+PSAyMDAgJiYgcmVxdWVzdC5zdGF0dXMgPCA0MDApIHtcbiAgICAgICAgICAgIC8vIFN1Y2Nlc3MhXG4gICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gV2UgcmVhY2hlZCBvdXIgdGFyZ2V0IHNlcnZlciwgYnV0IGl0IHJldHVybmVkIGFuIGVycm9yXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFRoZXJlIHdhcyBhIGNvbm5lY3Rpb24gZXJyb3Igb2Ygc29tZSBzb3J0XG4gICAgICAgIGVycm9yQ2FsbGJhY2soKTtcbiAgICB9O1xuXG4gICAgcmVxdWVzdC5zZW5kKCk7XG59XG5tb2R1bGUuZXhwb3J0cyA9IEhFUk9DQUxDVUxBVE9SOyIsIid1c2Ugc3RyaWN0JztcbnZhciBrbyA9IHJlcXVpcmUoJy4vaGVyb2NhbGNfa25vY2tvdXQnKTtcbiAgICBcbnZhciBteSA9IHJlcXVpcmUoXCIuL2hlcm9jYWxjX2NvcmVcIik7XG5cbm15LnByb3RvdHlwZS5pbGx1c2lvbkRhdGEgPSB7XG4gICAgY2hhb3Nfa25pZ2h0X3BoYW50YXNtOiB7XG4gICAgICAgIGhlcm86ICdjaGFvc19rbmlnaHQnLFxuICAgICAgICBkaXNwbGF5TmFtZTogJ0NoYW9zIEtuaWdodCBQaGFudGFzbScsXG4gICAgICAgIHVzZV9zZWxlY3RlZF9oZXJvOiBmYWxzZSxcbiAgICAgICAgbWF4X2xldmVsOiAzLFxuICAgICAgICBvdXRnb2luZ19kYW1hZ2U6ICdvdXRnb2luZ19kYW1hZ2UnLFxuICAgICAgICBpbmNvbWluZ19kYW1hZ2U6ICdpbmNvbWluZ19kYW1hZ2UnXG4gICAgfSxcbiAgICBuYWdhX3NpcmVuX21pcnJvcl9pbWFnZToge1xuICAgICAgICBoZXJvOiAnbmFnYV9zaXJlbicsXG4gICAgICAgIGRpc3BsYXlOYW1lOiAnTmFnYSBTaXJlbiBNaXJyb3IgSW1hZ2UnLFxuICAgICAgICB1c2Vfc2VsZWN0ZWRfaGVybzogZmFsc2UsXG4gICAgICAgIG1heF9sZXZlbDogNCxcbiAgICAgICAgb3V0Z29pbmdfZGFtYWdlOiAnb3V0Z29pbmdfZGFtYWdlJyxcbiAgICAgICAgaW5jb21pbmdfZGFtYWdlOiAnaW5jb21pbmdfZGFtYWdlJ1xuICAgIH0sXG4gICAgZGFya19zZWVyX3dhbGxfb2ZfcmVwbGljYToge1xuICAgICAgICBoZXJvOiAnZGFya19zZWVyJyxcbiAgICAgICAgZGlzcGxheU5hbWU6ICdEYXJrIFNlZXIgV2FsbCBvZiBSZXBsaWNhJyxcbiAgICAgICAgdXNlX3NlbGVjdGVkX2hlcm86IHRydWUsXG4gICAgICAgIG1heF9sZXZlbDogMyxcbiAgICAgICAgb3V0Z29pbmdfZGFtYWdlOiAncmVwbGljYV9kYW1hZ2Vfb3V0Z29pbmcnLFxuICAgICAgICBpbmNvbWluZ19kYW1hZ2U6ICdyZXBsaWNhX2RhbWFnZV9pbmNvbWluZycsXG4gICAgICAgIG91dGdvaW5nX2RhbWFnZV9zY2VwdGVyOiAncmVwbGljYV9kYW1hZ2Vfb3V0Z29pbmdfc2NlcHRlcidcbiAgICB9LFxuICAgIG1vcnBobGluZ19yZXBsaWNhdGU6IHtcbiAgICAgICAgaGVybzogJ21vcnBobGluZycsXG4gICAgICAgIGRpc3BsYXlOYW1lOiAnTW9ycGhsaW5nIFJlcGxpY2F0ZScsXG4gICAgICAgIHVzZV9zZWxlY3RlZF9oZXJvOiB0cnVlLFxuICAgICAgICBtYXhfbGV2ZWw6IDMsXG4gICAgICAgIG91dGdvaW5nX2RhbWFnZTogJ2lsbHVzaW9uX2RhbWFnZV9vdXRfcGN0JyxcbiAgICAgICAgaW5jb21pbmdfZGFtYWdlOiAnaWxsdXNpb25fZGFtYWdlX2luX3BjdCdcbiAgICB9LFxuICAgIHBoYW50b21fbGFuY2VyX2RvcHBlbHdhbGs6IHtcbiAgICAgICAgaGVybzogJ3BoYW50b21fbGFuY2VyJyxcbiAgICAgICAgZGlzcGxheU5hbWU6ICdQaGFudG9tIExhbmNlciBEb3BwZWx3YWxrJyxcbiAgICAgICAgdXNlX3NlbGVjdGVkX2hlcm86IGZhbHNlLFxuICAgICAgICBtYXhfbGV2ZWw6IDQsXG4gICAgICAgIG91dGdvaW5nX2RhbWFnZTogJ2lsbHVzaW9uX2RhbWFnZV9vdXRfcGN0JyxcbiAgICAgICAgaW5jb21pbmdfZGFtYWdlOiAnaWxsdXNpb25fZGFtYWdlX2luX3BjdCcgICAgICAgIFxuICAgIH0sXG4gICAgcGhhbnRvbV9sYW5jZXJfanV4dGFwb3NlOiB7XG4gICAgICAgIGhlcm86ICdwaGFudG9tX2xhbmNlcicsXG4gICAgICAgIGRpc3BsYXlOYW1lOiAnUGhhbnRvbSBMYW5jZXIgSnV4dGFwb3NlJyxcbiAgICAgICAgdXNlX3NlbGVjdGVkX2hlcm86IGZhbHNlLFxuICAgICAgICBtYXhfbGV2ZWw6IDQsXG4gICAgICAgIG91dGdvaW5nX2RhbWFnZTogJ2lsbHVzaW9uX2RhbWFnZV9vdXRfcGN0JyxcbiAgICAgICAgaW5jb21pbmdfZGFtYWdlOiAnaWxsdXNpb25fZGFtYWdlX2luX3BjdCcgICAgICAgIFxuICAgIH0sXG4gICAgcGhhbnRvbV9sYW5jZXJfc3Bpcml0X2xhbmNlOiB7XG4gICAgICAgIGhlcm86ICdwaGFudG9tX2xhbmNlcicsXG4gICAgICAgIGRpc3BsYXlOYW1lOiAnUGhhbnRvbSBMYW5jZXIgU3Bpcml0IExhbmNlJyxcbiAgICAgICAgdXNlX3NlbGVjdGVkX2hlcm86IGZhbHNlLFxuICAgICAgICBtYXhfbGV2ZWw6IDQsXG4gICAgICAgIG91dGdvaW5nX2RhbWFnZTogJ2lsbHVzaW9uX2RhbWFnZV9vdXRfcGN0JyxcbiAgICAgICAgaW5jb21pbmdfZGFtYWdlOiAnaWxsdXNpb25fZGFtYWdlX2luX3BjdCcgICAgICAgIFxuICAgIH0sXG4gICAgc2hhZG93X2RlbW9uX2Rpc3J1cHRpb246IHtcbiAgICAgICAgaGVybzogJ3NoYWRvd19kZW1vbicsXG4gICAgICAgIGRpc3BsYXlOYW1lOiAnU2hhZG93IERlbW9uIERpc3J1cHRpb24nLFxuICAgICAgICB1c2Vfc2VsZWN0ZWRfaGVybzogdHJ1ZSxcbiAgICAgICAgbWF4X2xldmVsOiA0LFxuICAgICAgICBvdXRnb2luZ19kYW1hZ2U6ICdpbGx1c2lvbl9vdXRnb2luZ19kYW1hZ2UnLFxuICAgICAgICBpbmNvbWluZ19kYW1hZ2U6ICdpbGx1c2lvbl9pbmNvbWluZ19kYW1hZ2UnICAgICAgICBcbiAgICB9LFxuICAgIHNwZWN0cmVfaGF1bnQ6IHtcbiAgICAgICAgaGVybzogJ3NwZWN0cmUnLFxuICAgICAgICBkaXNwbGF5TmFtZTogJ1NwZWN0cmUgSGF1bnQnLFxuICAgICAgICB1c2Vfc2VsZWN0ZWRfaGVybzogZmFsc2UsXG4gICAgICAgIG1heF9sZXZlbDogMyxcbiAgICAgICAgb3V0Z29pbmdfZGFtYWdlOiAnaWxsdXNpb25fZGFtYWdlX291dGdvaW5nJyxcbiAgICAgICAgaW5jb21pbmdfZGFtYWdlOiAnaWxsdXNpb25fZGFtYWdlX2luY29taW5nJyAgICAgICAgXG4gICAgfSxcbiAgICB0ZXJyb3JibGFkZV9jb25qdXJlX2ltYWdlOiB7XG4gICAgICAgIGhlcm86ICd0ZXJyb3JibGFkZScsXG4gICAgICAgIGRpc3BsYXlOYW1lOiAnVGVycm9yYmxhZGUgQ29uanVyZSBJbWFnZScsXG4gICAgICAgIHVzZV9zZWxlY3RlZF9oZXJvOiBmYWxzZSxcbiAgICAgICAgbWF4X2xldmVsOiA0LFxuICAgICAgICBvdXRnb2luZ19kYW1hZ2U6ICdpbGx1c2lvbl9vdXRnb2luZ19kYW1hZ2UnLFxuICAgICAgICBpbmNvbWluZ19kYW1hZ2U6ICdpbGx1c2lvbl9pbmNvbWluZ19kYW1hZ2UnICAgICAgICBcbiAgICB9LFxuICAgIHRlcnJvcmJsYWRlX3JlZmxlY3Rpb246IHtcbiAgICAgICAgaGVybzogJ3RlcnJvcmJsYWRlJyxcbiAgICAgICAgZGlzcGxheU5hbWU6ICdUZXJyb3JibGFkZSBSZWZsZWN0aW9uJyxcbiAgICAgICAgdXNlX3NlbGVjdGVkX2hlcm86IHRydWUsXG4gICAgICAgIG1heF9sZXZlbDogNCxcbiAgICAgICAgb3V0Z29pbmdfZGFtYWdlOiAnaWxsdXNpb25fb3V0Z29pbmdfZGFtYWdlJyAgICAgXG4gICAgfSxcbiAgICBpdGVtX21hbnRhOiB7XG4gICAgICAgIGhlcm86ICcnLFxuICAgICAgICBpc19pdGVtOiB0cnVlLFxuICAgICAgICBkaXNwbGF5TmFtZTogJ01hbnRhIFN0eWxlIElsbHVzaW9uJyxcbiAgICAgICAgdXNlX3NlbGVjdGVkX2hlcm86IHRydWUsXG4gICAgICAgIG1heF9sZXZlbDogMSxcbiAgICAgICAgb3V0Z29pbmdfZGFtYWdlX21lbGVlOiAnaW1hZ2VzX2RvX2RhbWFnZV9wZXJjZW50X21lbGVlJyxcbiAgICAgICAgaW5jb21pbmdfZGFtYWdlX21lbGVlOiAnaW1hZ2VzX3Rha2VfZGFtYWdlX3BlcmNlbnRfbWVsZWUnLFxuICAgICAgICBvdXRnb2luZ19kYW1hZ2VfcmFuZ2VkOiAnaW1hZ2VzX2RvX2RhbWFnZV9wZXJjZW50X3JhbmdlZCcsXG4gICAgICAgIGluY29taW5nX2RhbWFnZV9yYW5nZWQ6ICdpbWFnZXNfdGFrZV9kYW1hZ2VfcGVyY2VudF9yYW5nZWQnXG4gICAgfVxufVxuXG5teS5wcm90b3R5cGUuSWxsdXNpb25WaWV3TW9kZWwgPSBmdW5jdGlvbiAoaCwgcCwgYWJpbGl0eUxldmVsKSB7XG4gICAgdmFyIHNlbGYgPSBuZXcgbXkucHJvdG90eXBlLkhlcm9Nb2RlbCgwKTtcbiAgICBzZWxmLnBhcmVudCA9IHA7XG4gICAgc2VsZi5pbnZlbnRvcnkgPSBzZWxmLnBhcmVudC5pbnZlbnRvcnk7XG4gICAgc2VsZi5pbGx1c2lvblR5cGUgPSBrby5vYnNlcnZhYmxlKHNlbGYucGFyZW50LnNlbGVjdGVkSWxsdXNpb24oKS5pbGx1c2lvbk5hbWUpO1xuICAgIHNlbGYuaWxsdXNpb25EaXNwbGF5TmFtZSA9IGtvLm9ic2VydmFibGUoc2VsZi5wYXJlbnQuc2VsZWN0ZWRJbGx1c2lvbigpLmlsbHVzaW9uRGlzcGxheU5hbWUpO1xuICAgIHNlbGYuaWxsdXNpb25BYmlsaXR5TGV2ZWwoYWJpbGl0eUxldmVsKTtcbiAgICBzZWxmLmlsbHVzaW9uQWJpbGl0eU1heExldmVsID0ga28ub2JzZXJ2YWJsZShteS5wcm90b3R5cGUuaWxsdXNpb25EYXRhW3NlbGYucGFyZW50LnNlbGVjdGVkSWxsdXNpb24oKS5pbGx1c2lvbk5hbWVdLm1heF9sZXZlbCk7XG4gICAgaWYgKCFteS5wcm90b3R5cGUuaWxsdXNpb25EYXRhW3NlbGYuaWxsdXNpb25UeXBlKCldLnVzZV9zZWxlY3RlZF9oZXJvKSB7XG4gICAgICAgIHNlbGYuc2VsZWN0ZWRIZXJvKG15LnByb3RvdHlwZS5maW5kV2hlcmUoc2VsZi5hdmFpbGFibGVIZXJvZXMoKSwge2hlcm9OYW1lOiBzZWxmLnBhcmVudC5zZWxlY3RlZElsbHVzaW9uKCkuYmFzZUhlcm99KSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzZWxmLnNlbGVjdGVkSGVybyhzZWxmLnBhcmVudC5zZWxlY3RlZEhlcm8oKSk7XG4gICAgfVxuICAgIHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoc2VsZi5wYXJlbnQuc2VsZWN0ZWRIZXJvTGV2ZWwoKSk7XG4gICAgc2VsZi5oZXJvID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBrby53cmFwLmZyb21KUyhteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fJyArIHNlbGYuc2VsZWN0ZWRIZXJvKCkuaGVyb05hbWVdKTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmFiaWxpdHkoKS5nZXRBdHRyaWJ1dGVCb251c0xldmVsID0gc2VsZi5wYXJlbnQuYWJpbGl0eSgpLmdldEF0dHJpYnV0ZUJvbnVzTGV2ZWw7XG4gICAgc2VsZi50b3RhbEFnaSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIChzZWxmLmhlcm9EYXRhKCkuYXR0cmlidXRlYmFzZWFnaWxpdHlcbiAgICAgICAgICAgICAgICArIHNlbGYuaGVyb0RhdGEoKS5hdHRyaWJ1dGVhZ2lsaXR5Z2FpbiAqIChzZWxmLnNlbGVjdGVkSGVyb0xldmVsKCkgLSAxKSBcbiAgICAgICAgICAgICAgICArIHNlbGYuaW52ZW50b3J5LmdldEF0dHJpYnV0ZXMoJ2FnaScpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0QXR0cmlidXRlQm9udXNMZXZlbCgpICogMlxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0QWdpbGl0eSgpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEFsbFN0YXRzUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZGVidWZmcy5nZXRBbGxTdGF0c1JlZHVjdGlvbigpXG4gICAgICAgICAgICAgICApLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5pbnRTdG9sZW4gPSBrby5vYnNlcnZhYmxlKDApLmV4dGVuZCh7IG51bWVyaWM6IDAgfSk7XG4gICAgc2VsZi50b3RhbEludCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIChzZWxmLmhlcm9EYXRhKCkuYXR0cmlidXRlYmFzZWludGVsbGlnZW5jZSBcbiAgICAgICAgICAgICAgICArIHNlbGYuaGVyb0RhdGEoKS5hdHRyaWJ1dGVpbnRlbGxpZ2VuY2VnYWluICogKHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKSAtIDEpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5pbnZlbnRvcnkuZ2V0QXR0cmlidXRlcygnaW50JykgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRBdHRyaWJ1dGVCb251c0xldmVsKCkgKiAyXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRJbnRlbGxpZ2VuY2UoKVxuICAgICAgICAgICAgICAgICsgc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRBbGxTdGF0c1JlZHVjdGlvbigpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmRlYnVmZnMuZ2V0QWxsU3RhdHNSZWR1Y3Rpb24oKSArIHNlbGYuaW50U3RvbGVuKClcbiAgICAgICAgICAgICAgICkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBzZWxmLnRvdGFsU3RyID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKHNlbGYuaGVyb0RhdGEoKS5hdHRyaWJ1dGViYXNlc3RyZW5ndGggXG4gICAgICAgICAgICAgICAgKyBzZWxmLmhlcm9EYXRhKCkuYXR0cmlidXRlc3RyZW5ndGhnYWluICogKHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKSAtIDEpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5pbnZlbnRvcnkuZ2V0QXR0cmlidXRlcygnc3RyJykgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRBdHRyaWJ1dGVCb251c0xldmVsKCkgKiAyXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRTdHJlbmd0aCgpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEFsbFN0YXRzUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZGVidWZmcy5nZXRBbGxTdGF0c1JlZHVjdGlvbigpXG4gICAgICAgICAgICAgICApLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUgPSBmdW5jdGlvbihoZXJvLCBhYmlsaXR5LCBhdHRyaWJ1dGVOYW1lLCBsZXZlbCkge1xuICAgICAgICBpZiAoYWJpbGl0eSA9PSAnaXRlbV9tYW50YScpIHtcbiAgICAgICAgICAgIHZhciBhYmlsaXR5T2JqID0gbXkucHJvdG90eXBlLml0ZW1EYXRhW2FiaWxpdHldO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGFiaWxpdHlPYmogPSBteS5wcm90b3R5cGUuZmluZFdoZXJlKG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb18nICsgaGVyb10uYWJpbGl0aWVzLCB7bmFtZTogYWJpbGl0eX0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuZmluZFdoZXJlKGFiaWxpdHlPYmouYXR0cmlidXRlcywge25hbWU6IGF0dHJpYnV0ZU5hbWV9KTtcbiAgICAgICAgaWYgKGxldmVsID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGV2ZWwgPiBhdHRyaWJ1dGUubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYXR0cmlidXRlLnZhbHVlW2xldmVsIC0gMV0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHNlbGYuZ2V0SW5jb21pbmdEYW1hZ2VNdWx0aXBsaWVyID0gZnVuY3Rpb24oaWxsdXNpb25UeXBlLCBoYXNTY2VwdGVyLCBhdHRhY2tUeXBlKSB7XG4gICAgICAgIGlmIChpbGx1c2lvblR5cGUgPT0gJ2l0ZW1fbWFudGEnKSB7XG4gICAgICAgICAgICBpZiAoYXR0YWNrVHlwZSA9PSAnRE9UQV9VTklUX0NBUF9NRUxFRV9BVFRBQ0snKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLmlsbHVzaW9uRGF0YVtzZWxmLmlsbHVzaW9uVHlwZSgpXS5oZXJvLCBzZWxmLmlsbHVzaW9uVHlwZSgpLCBteS5wcm90b3R5cGUuaWxsdXNpb25EYXRhW2lsbHVzaW9uVHlwZV0uaW5jb21pbmdfZGFtYWdlX21lbGVlLCBzZWxmLmlsbHVzaW9uQWJpbGl0eUxldmVsKCkpLzEwMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAoMSArIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pbGx1c2lvbkRhdGFbc2VsZi5pbGx1c2lvblR5cGUoKV0uaGVybywgc2VsZi5pbGx1c2lvblR5cGUoKSwgbXkucHJvdG90eXBlLmlsbHVzaW9uRGF0YVtpbGx1c2lvblR5cGVdLmluY29taW5nX2RhbWFnZV9yYW5nZWQsIHNlbGYuaWxsdXNpb25BYmlsaXR5TGV2ZWwoKSkvMTAwKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLmlsbHVzaW9uRGF0YVtzZWxmLmlsbHVzaW9uVHlwZSgpXS5oZXJvLCBzZWxmLmlsbHVzaW9uVHlwZSgpLCBteS5wcm90b3R5cGUuaWxsdXNpb25EYXRhW2lsbHVzaW9uVHlwZV0uaW5jb21pbmdfZGFtYWdlLCBzZWxmLmlsbHVzaW9uQWJpbGl0eUxldmVsKCkpLzEwMClcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZWxmLmdldE91dGdvaW5nRGFtYWdlTXVsdGlwbGllciA9IGZ1bmN0aW9uKGlsbHVzaW9uVHlwZSwgaGFzU2NlcHRlciwgYXR0YWNrVHlwZSkge1xuICAgICAgICBpZiAoaWxsdXNpb25UeXBlID09ICdpdGVtX21hbnRhJykge1xuICAgICAgICAgICAgaWYgKGF0dGFja1R5cGUgPT0gJ0RPVEFfVU5JVF9DQVBfTUVMRUVfQVRUQUNLJykge1xuICAgICAgICAgICAgICAgIHJldHVybiAoMSArIHNlbGYuZ2V0QWJpbGl0eUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pbGx1c2lvbkRhdGFbc2VsZi5pbGx1c2lvblR5cGUoKV0uaGVybywgc2VsZi5pbGx1c2lvblR5cGUoKSwgbXkucHJvdG90eXBlLmlsbHVzaW9uRGF0YVtpbGx1c2lvblR5cGVdLm91dGdvaW5nX2RhbWFnZV9tZWxlZSwgc2VsZi5pbGx1c2lvbkFiaWxpdHlMZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLmlsbHVzaW9uRGF0YVtzZWxmLmlsbHVzaW9uVHlwZSgpXS5oZXJvLCBzZWxmLmlsbHVzaW9uVHlwZSgpLCBteS5wcm90b3R5cGUuaWxsdXNpb25EYXRhW2lsbHVzaW9uVHlwZV0ub3V0Z29pbmdfZGFtYWdlX3JhbmdlZCwgc2VsZi5pbGx1c2lvbkFiaWxpdHlMZXZlbCgpKS8xMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICgxICsgc2VsZi5nZXRBYmlsaXR5QXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLmlsbHVzaW9uRGF0YVtzZWxmLmlsbHVzaW9uVHlwZSgpXS5oZXJvLCBzZWxmLmlsbHVzaW9uVHlwZSgpLCBteS5wcm90b3R5cGUuaWxsdXNpb25EYXRhW2lsbHVzaW9uVHlwZV0ub3V0Z29pbmdfZGFtYWdlLCBzZWxmLmlsbHVzaW9uQWJpbGl0eUxldmVsKCkpLzEwMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZWxmLmJhc2VEYW1hZ2UgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIFtNYXRoLmZsb29yKG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb18nICsgc2VsZi5zZWxlY3RlZEhlcm8oKS5oZXJvTmFtZV0uYXR0YWNrZGFtYWdlbWluICsgc2VsZi50b3RhbEF0dHJpYnV0ZShzZWxmLnByaW1hcnlBdHRyaWJ1dGUoKSkgKyBzZWxmLmFiaWxpdHkoKS5nZXRCYXNlRGFtYWdlKCkudG90YWwpXG4gICAgICAgICAgICAgICAgKiBzZWxmLmdldE91dGdvaW5nRGFtYWdlTXVsdGlwbGllcihzZWxmLmlsbHVzaW9uVHlwZSgpLCBmYWxzZSwgc2VsZi5oZXJvKCkuYXR0YWNrdHlwZSgpKSxcbiAgICAgICAgICAgICAgICBNYXRoLmZsb29yKG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb18nICsgc2VsZi5zZWxlY3RlZEhlcm8oKS5oZXJvTmFtZV0uYXR0YWNrZGFtYWdlbWF4ICsgc2VsZi50b3RhbEF0dHJpYnV0ZShzZWxmLnByaW1hcnlBdHRyaWJ1dGUoKSkgKyBzZWxmLmFiaWxpdHkoKS5nZXRCYXNlRGFtYWdlKCkudG90YWwpXG4gICAgICAgICAgICAgICAgKiBzZWxmLmdldE91dGdvaW5nRGFtYWdlTXVsdGlwbGllcihzZWxmLmlsbHVzaW9uVHlwZSgpLCBmYWxzZSwgc2VsZi5oZXJvKCkuYXR0YWNrdHlwZSgpKV07XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5kYW1hZ2UgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIFtzZWxmLmJhc2VEYW1hZ2UoKVswXSxcbiAgICAgICAgICAgICAgICBzZWxmLmJhc2VEYW1hZ2UoKVsxXV07XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5laHBQaHlzaWNhbCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZWhwID0gKHNlbGYuaGVhbHRoKCkgKiAoMSArIC4wNiAqIHNlbGYudG90YWxBcm1vclBoeXNpY2FsKCkpKSAvICgxIC0gKDEgLSAoc2VsZi5pbnZlbnRvcnkuZ2V0RXZhc2lvbigpICogc2VsZi5hYmlsaXR5KCkuZ2V0RXZhc2lvbigpKSkpXG4gICAgICAgIGVocCAqPSAoc2VsZi5pbnZlbnRvcnkuYWN0aXZlSXRlbXMoKS5zb21lKGZ1bmN0aW9uKGl0ZW0pIHtyZXR1cm4gaXRlbS5pdGVtID09ICdtYXNrX29mX21hZG5lc3MnO30pID8gKDEgLyAxLjMpIDogMSk7XG4gICAgICAgIGVocCAqPSAoMSAvIHNlbGYuZ2V0SW5jb21pbmdEYW1hZ2VNdWx0aXBsaWVyKHNlbGYuaWxsdXNpb25UeXBlKCksIGZhbHNlLCBzZWxmLmhlcm8oKS5hdHRhY2t0eXBlKCkpKTtcbiAgICAgICAgcmV0dXJuIGVocC50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYuZWhwTWFnaWNhbCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZWhwID0gc2VsZi5oZWFsdGgoKSAvIHNlbGYudG90YWxNYWdpY1Jlc2lzdGFuY2VQcm9kdWN0KCk7XG4gICAgICAgIGVocCAqPSAoMSAvIHNlbGYuZ2V0SW5jb21pbmdEYW1hZ2VNdWx0aXBsaWVyKHNlbGYuaWxsdXNpb25UeXBlKCksIGZhbHNlLCBzZWxmLmhlcm8oKS5hdHRhY2t0eXBlKCkpKTtcbiAgICAgICAgcmV0dXJuIGVocC50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYudG90YWxBcm1vclBoeXNpY2FsID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAoc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRBcm1vckJhc2VSZWR1Y3Rpb24oKSAqIHNlbGYuZGVidWZmcy5nZXRBcm1vckJhc2VSZWR1Y3Rpb24oKSAqIChteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fJyArIHNlbGYuc2VsZWN0ZWRIZXJvKCkuaGVyb05hbWVdLmFybW9ycGh5c2ljYWwgKyBzZWxmLnRvdGFsQWdpKCkgKiAuMTQpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRBcm1vcigpICsgc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRBcm1vclJlZHVjdGlvbigpICsgc2VsZi5idWZmcy5nZXRBcm1vcigpICsgc2VsZi5kZWJ1ZmZzLmdldEFybW9yUmVkdWN0aW9uKCkpLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5pYXMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbCA9IHBhcnNlRmxvYXQoc2VsZi50b3RhbEFnaSgpKSBcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldEF0dGFja1NwZWVkKCkgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEF0dGFja1NwZWVkUmVkdWN0aW9uKCkgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmJ1ZmZzLmdldEF0dGFja1NwZWVkKCkgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmRlYnVmZnMuZ2V0QXR0YWNrU3BlZWRSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICsgc2VsZi51bml0KCkuYWJpbGl0eSgpLmdldEF0dGFja1NwZWVkKCk7IFxuICAgICAgICBpZiAodmFsIDwgLTgwKSB7XG4gICAgICAgICAgICByZXR1cm4gLTgwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZhbCA+IDQwMCkge1xuICAgICAgICAgICAgcmV0dXJuIDQwMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIHNlbGY7XG59IiwiJ3VzZSBzdHJpY3QnO1xudmFyIGtvID0gcmVxdWlyZSgnLi9oZXJvY2FsY19rbm9ja291dCcpO1xuXG52YXIgbXkgPSByZXF1aXJlKFwiLi9oZXJvY2FsY19jb3JlXCIpO1xucmVxdWlyZShcIi4vaGVyb2NhbGNfaGVyb19kYW1hZ2VcIik7XG5cbm15LnByb3RvdHlwZS50b3RhbEV4cCA9IFswLCAyMDAsIDUwMCwgOTAwLCAxNDAwLCAyMDAwLCAyNjAwLCAzNDAwLCA0NDAwLCA1NDAwLCA2MDAwLCA4MjAwLCA5MDAwLCAxMDQwMCwgMTE5MDAsIDEzNTAwLCAxNTIwMCwgMTcwMDAsIDE4OTAwLCAyMDkwMCwgMjMwMDAsIDI1MjAwLCAyNzUwMCwgMjk5MDAsIDMyNDAwXTtcbm15LnByb3RvdHlwZS5uZXh0TGV2ZWxFeHAgPSBbMjAwLCAzMDAsIDQwMCwgNTAwLCA2MDAsIDYwMCwgODAwLCAxMDAwLCAxMDAwLCA2MDAsIDIyMDAsIDgwMCwgMTQwMCwgMTUwMCwgMTYwMCwgMTcwMCwgMTgwMCwgMTkwMCwgMjAwMCwgMjEwMCwgMjIwMCwgMjMwMCwgMjQwMCwgMjUwMCwgJyZtZGFzaDsnXTtcbm15LnByb3RvdHlwZS5kaWZmUHJvcGVydGllcyA9IFtcbiAgICAndG90YWxBZ2knLFxuICAgICd0b3RhbEludCcsXG4gICAgJ3RvdGFsU3RyJyxcbiAgICAnaGVhbHRoJyxcbiAgICAnaGVhbHRocmVnZW4nLFxuICAgICdtYW5hJyxcbiAgICAnbWFuYXJlZ2VuJyxcbiAgICAndG90YWxBcm1vclBoeXNpY2FsJyxcbiAgICAndG90YWxBcm1vclBoeXNpY2FsUmVkdWN0aW9uJyxcbiAgICAndG90YWxNb3ZlbWVudFNwZWVkJyxcbiAgICAndG90YWxUdXJuUmF0ZScsXG4gICAgJ2Jhc2VEYW1hZ2UnLFxuICAgICdib251c0RhbWFnZScsXG4gICAgJ2JvbnVzRGFtYWdlUmVkdWN0aW9uJyxcbiAgICAnZGFtYWdlJyxcbiAgICAndG90YWxNYWdpY1Jlc2lzdGFuY2VQcm9kdWN0JyxcbiAgICAndG90YWxNYWdpY1Jlc2lzdGFuY2UnLFxuICAgICdiYXQnLFxuICAgICdpYXMnLFxuICAgICdhdHRhY2tUaW1lJyxcbiAgICAnYXR0YWNrc1BlclNlY29uZCcsXG4gICAgJ2V2YXNpb24nLFxuICAgICdlaHBQaHlzaWNhbCcsXG4gICAgJ2VocE1hZ2ljYWwnLFxuICAgICdiYXNoJyxcbiAgICAnY3JpdENoYW5jZScsXG4gICAgLy8nY3JpdERhbWFnZScsXG4gICAgJ21pc3NDaGFuY2UnLFxuICAgICd0b3RhbGF0dGFja3JhbmdlJyxcbiAgICAndmlzaW9ucmFuZ2VkYXknLFxuICAgICd2aXNpb25yYW5nZW5pZ2h0JyxcbiAgICAnbGlmZXN0ZWFsJ1xuXTtcblxubXkucHJvdG90eXBlLklsbHVzaW9uT3B0aW9uID0gZnVuY3Rpb24gKG5hbWUsIGRpc3BsYXluYW1lLCBiYXNlSGVybykge1xuICAgIHRoaXMuaWxsdXNpb25OYW1lID0gbmFtZTtcbiAgICB0aGlzLmlsbHVzaW9uRGlzcGxheU5hbWUgPSBkaXNwbGF5bmFtZTtcbiAgICB0aGlzLmJhc2VIZXJvID0gYmFzZUhlcm87XG59O1xuXG5teS5wcm90b3R5cGUuY3JlYXRlSWxsdXNpb25PcHRpb25zID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBvcHRpb25zID0gW107XG4gICAgZm9yICh2YXIgaCBpbiBteS5wcm90b3R5cGUuaWxsdXNpb25EYXRhKSB7XG4gICAgICAgIG9wdGlvbnMucHVzaChuZXcgbXkucHJvdG90eXBlLklsbHVzaW9uT3B0aW9uKGgsIG15LnByb3RvdHlwZS5pbGx1c2lvbkRhdGFbaF0uZGlzcGxheU5hbWUsIG15LnByb3RvdHlwZS5pbGx1c2lvbkRhdGFbaF0uaGVybykpO1xuICAgIH1cbiAgICByZXR1cm4gb3B0aW9ucztcbn1cblxubXkucHJvdG90eXBlLkhlcm9Nb2RlbCA9IGZ1bmN0aW9uIChoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHNlbGYuaGVyb0lkID0ga28ub2JzZXJ2YWJsZShoKTtcbiAgICBzZWxmLnNlbGVjdGVkSGVyb0xldmVsID0ga28ub2JzZXJ2YWJsZSgxKTtcbiAgICBzZWxmLmludmVudG9yeSA9IG5ldyBteS5wcm90b3R5cGUuSW52ZW50b3J5Vmlld01vZGVsKHNlbGYpO1xuICAgIHNlbGYuc2VsZWN0ZWRJbnZlbnRvcnkgPSBrby5vYnNlcnZhYmxlKC0xKTtcbiAgICBzZWxmLmJ1ZmZzID0gbmV3IG15LnByb3RvdHlwZS5CdWZmVmlld01vZGVsKCk7XG4gICAgc2VsZi5idWZmcy5oYXNTY2VwdGVyID0gc2VsZi5pbnZlbnRvcnkuaGFzU2NlcHRlcjtcbiAgICBzZWxmLmRlYnVmZnMgPSBuZXcgbXkucHJvdG90eXBlLkJ1ZmZWaWV3TW9kZWwoKTtcbiAgICAvKnNlbGYuaGVybyA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGtvLm1hcHBpbmcuZnJvbUpTKG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb18nICsgc2VsZi5oZXJvSWQoKV0pO1xuICAgIH0pOyovXG4gICAgc2VsZi5oZXJvRGF0YSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBteS5wcm90b3R5cGUuaGVyb0RhdGFbJ25wY19kb3RhX2hlcm9fJyArIHNlbGYuaGVyb0lkKCldO1xuICAgIH0pO1xuICAgIHNlbGYuaGVyb0NvbXBhcmUgPSBrby5vYnNlcnZhYmxlKHNlbGYpO1xuICAgIHNlbGYuZW5lbXkgPSBrby5vYnNlcnZhYmxlKHNlbGYpO1xuICAgIHNlbGYudW5pdCA9IGtvLm9ic2VydmFibGUoc2VsZik7XG4gICAgc2VsZi5jbG9uZSA9IGtvLm9ic2VydmFibGUoc2VsZik7XG4gICAgc2VsZi5pbGx1c2lvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoW10pO1xuICAgIHNlbGYuYXZhaWxhYmxlSWxsdXNpb25zID0ga28ub2JzZXJ2YWJsZUFycmF5KG15LnByb3RvdHlwZS5jcmVhdGVJbGx1c2lvbk9wdGlvbnMoKSk7XG4gICAgc2VsZi5zZWxlY3RlZElsbHVzaW9uID0ga28ub2JzZXJ2YWJsZShzZWxmLmF2YWlsYWJsZUlsbHVzaW9ucygpWzBdKTtcbiAgICBzZWxmLmlsbHVzaW9uQWJpbGl0eUxldmVsID0ga28ub2JzZXJ2YWJsZSgxKTtcbiAgICBzZWxmLmlsbHVzaW9uQWJpbGl0eU1heExldmVsID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbXkucHJvdG90eXBlLmlsbHVzaW9uRGF0YVtzZWxmLnNlbGVjdGVkSWxsdXNpb24oKS5pbGx1c2lvbk5hbWVdLm1heF9sZXZlbDtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLnNraWxsUG9pbnRIaXN0b3J5ID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7XG4gICAgXG4gICAgc2VsZi5hYmlsaXR5ID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYSA9IG5ldyBteS5wcm90b3R5cGUuQWJpbGl0eU1vZGVsKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoc2VsZi5oZXJvRGF0YSgpLmFiaWxpdGllcykpLCBzZWxmKTtcbiAgICAgICAgaWYgKHNlbGYuaGVyb0lkKCkgPT09ICdlYXJ0aF9zcGlyaXQnIHx8IHNlbGYuaGVyb0lkKCkgPT09ICdvZ3JlX21hZ2knKSB7XG4gICAgICAgICAgICBhLmFiaWxpdGllc1szXS5sZXZlbCgxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzZWxmLmhlcm9JZCgpID09PSAnaW52b2tlcicpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSA2OyBpIDwgMTY7IGkrKykge1xuICAgICAgICAgICAgICAgIGEuYWJpbGl0aWVzW2ldLmxldmVsKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNlbGYuc2tpbGxQb2ludEhpc3RvcnkucmVtb3ZlQWxsKCk7XG4gICAgICAgIGEuaGFzU2NlcHRlciA9IHNlbGYuaW52ZW50b3J5Lmhhc1NjZXB0ZXJcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfSk7XG5cbiAgICBzZWxmLmF2YWlsYWJsZVNraWxsUG9pbnRzID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYyA9IHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmFiaWxpdHkoKS5hYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBnZXRJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzd2l0Y2goc2VsZi5hYmlsaXR5KCkuYWJpbGl0aWVzW2ldLmFiaWxpdHl0eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnRE9UQV9BQklMSVRZX1RZUEVfVUxUSU1BVEUnOlxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5oZXJvSWQoKSA9PT0gJ2ludm9rZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKChzZWxmLmFiaWxpdHkoKS5hYmlsaXRpZXNbaV0ubGV2ZWwoKSA9PSAxKSAmJiAocGFyc2VJbnQoc2VsZi5zZWxlY3RlZEhlcm9MZXZlbCgpKSA8IDIpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoc2VsZi5hYmlsaXR5KCkuYWJpbGl0aWVzW2ldLmxldmVsKCkgPT0gMikgJiYgKHBhcnNlSW50KHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKSkgPCA3KSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKHNlbGYuYWJpbGl0eSgpLmFiaWxpdGllc1tpXS5sZXZlbCgpID09IDMpICYmIChwYXJzZUludChzZWxmLnNlbGVjdGVkSGVyb0xldmVsKCkpIDwgMTEpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoc2VsZi5hYmlsaXR5KCkuYWJpbGl0aWVzW2ldLmxldmVsKCkgPT0gNCkgJiYgKHBhcnNlSW50KHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKSkgPCAxNykpXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdHkoKS5sZXZlbERvd25BYmlsaXR5KGdldEluZGV4LCBudWxsLCBudWxsLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzZWxmLmhlcm9JZCgpID09PSAnbWVlcG8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKHNlbGYuYWJpbGl0eSgpLmFiaWxpdGllc1tpXS5sZXZlbCgpLTEpICogNyArIDMgPiBwYXJzZUludChzZWxmLnNlbGVjdGVkSGVyb0xldmVsKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXR5KCkubGV2ZWxEb3duQWJpbGl0eShnZXRJbmRleCwgbnVsbCwgbnVsbCwgc2VsZik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc2VsZi5hYmlsaXR5KCkuYWJpbGl0aWVzW2ldLmxldmVsKCkgKiA1ICsgMSA+IHBhcnNlSW50KHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFiaWxpdHkoKS5sZXZlbERvd25BYmlsaXR5KGdldEluZGV4LCBudWxsLCBudWxsLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChzZWxmLmFiaWxpdHkoKS5hYmlsaXRpZXNbaV0ubGV2ZWwoKSAqIDIgLSAxID4gcGFyc2VJbnQoc2VsZi5zZWxlY3RlZEhlcm9MZXZlbCgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hYmlsaXR5KCkubGV2ZWxEb3duQWJpbGl0eShnZXRJbmRleCwgbnVsbCwgbnVsbCwgc2VsZik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgZ2V0SW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5za2lsbFBvaW50SGlzdG9yeSgpW3NlbGYuc2tpbGxQb2ludEhpc3RvcnkoKS5sZW5ndGgtMV07XG4gICAgICAgIH07XG4gICAgICAgIHdoaWxlIChzZWxmLnNraWxsUG9pbnRIaXN0b3J5KCkubGVuZ3RoID4gYykge1xuICAgICAgICAgICAgc2VsZi5hYmlsaXR5KCkubGV2ZWxEb3duQWJpbGl0eShnZXRJbmRleCwgbnVsbCwgbnVsbCwgc2VsZik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGMtc2VsZi5za2lsbFBvaW50SGlzdG9yeSgpLmxlbmd0aDtcbiAgICB9LCB0aGlzKTtcbiAgICBzZWxmLnByaW1hcnlBdHRyaWJ1dGUgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdiA9IHNlbGYuaGVyb0RhdGEoKS5hdHRyaWJ1dGVwcmltYXJ5O1xuICAgICAgICBpZiAodiA9PT0gJ0RPVEFfQVRUUklCVVRFX0FHSUxJVFknKSByZXR1cm4gJ2FnaSc7XG4gICAgICAgIGlmICh2ID09PSAnRE9UQV9BVFRSSUJVVEVfSU5URUxMRUNUJykgcmV0dXJuICdpbnQnO1xuICAgICAgICBpZiAodiA9PT0gJ0RPVEFfQVRUUklCVVRFX1NUUkVOR1RIJykgcmV0dXJuICdzdHInO1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfSk7XG4gICAgc2VsZi50b3RhbEV4cCA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBteS5wcm90b3R5cGUudG90YWxFeHBbc2VsZi5zZWxlY3RlZEhlcm9MZXZlbCgpIC0gMV07XG4gICAgfSk7XG4gICAgc2VsZi5uZXh0TGV2ZWxFeHAgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbXkucHJvdG90eXBlLm5leHRMZXZlbEV4cFtzZWxmLnNlbGVjdGVkSGVyb0xldmVsKCkgLSAxXTtcbiAgICB9KTtcbiAgICBzZWxmLnN0YXJ0aW5nQXJtb3IgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKHNlbGYuaGVyb0RhdGEoKS5hdHRyaWJ1dGViYXNlYWdpbGl0eSAqIC4xNCArIHNlbGYuaGVyb0RhdGEoKS5hcm1vcnBoeXNpY2FsKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYucmVzcGF3blRpbWUgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gNSArIDMuOCAqIHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKTtcbiAgICB9KTtcbiAgICBzZWxmLnRvdGFsQXR0cmlidXRlID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgaWYgKGEgPT09ICdhZ2knKSByZXR1cm4gcGFyc2VGbG9hdChzZWxmLnRvdGFsQWdpKCkpO1xuICAgICAgICBpZiAoYSA9PT0gJ2ludCcpIHJldHVybiBwYXJzZUZsb2F0KHNlbGYudG90YWxJbnQoKSk7XG4gICAgICAgIGlmIChhID09PSAnc3RyJykgcmV0dXJuIHBhcnNlRmxvYXQoc2VsZi50b3RhbFN0cigpKTtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfTtcbiAgICBzZWxmLnRvdGFsQWdpID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIChzZWxmLmhlcm9EYXRhKCkuYXR0cmlidXRlYmFzZWFnaWxpdHlcbiAgICAgICAgICAgICAgICArIHNlbGYuaGVyb0RhdGEoKS5hdHRyaWJ1dGVhZ2lsaXR5Z2FpbiAqIChzZWxmLnNlbGVjdGVkSGVyb0xldmVsKCkgLSAxKSBcbiAgICAgICAgICAgICAgICArIHNlbGYuaW52ZW50b3J5LmdldEF0dHJpYnV0ZXMoJ2FnaScpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0QXR0cmlidXRlQm9udXNMZXZlbCgpICogMlxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0QWdpbGl0eSgpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEFsbFN0YXRzUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZGVidWZmcy5nZXRBbGxTdGF0c1JlZHVjdGlvbigpXG4gICAgICAgICAgICAgICApLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5pbnRTdG9sZW4gPSBrby5vYnNlcnZhYmxlKDApLmV4dGVuZCh7IG51bWVyaWM6IDAgfSk7XG4gICAgc2VsZi50b3RhbEludCA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoc2VsZi5oZXJvRGF0YSgpLmF0dHJpYnV0ZWJhc2VpbnRlbGxpZ2VuY2UgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmhlcm9EYXRhKCkuYXR0cmlidXRlaW50ZWxsaWdlbmNlZ2FpbiAqIChzZWxmLnNlbGVjdGVkSGVyb0xldmVsKCkgLSAxKSBcbiAgICAgICAgICAgICAgICArIHNlbGYuaW52ZW50b3J5LmdldEF0dHJpYnV0ZXMoJ2ludCcpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0QXR0cmlidXRlQm9udXNMZXZlbCgpICogMlxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0SW50ZWxsaWdlbmNlKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0QWxsU3RhdHNSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICsgc2VsZi5kZWJ1ZmZzLmdldEFsbFN0YXRzUmVkdWN0aW9uKCkgKyBzZWxmLmludFN0b2xlbigpXG4gICAgICAgICAgICAgICApLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi50b3RhbFN0ciA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoc2VsZi5oZXJvRGF0YSgpLmF0dHJpYnV0ZWJhc2VzdHJlbmd0aCBcbiAgICAgICAgICAgICAgICArIHNlbGYuaGVyb0RhdGEoKS5hdHRyaWJ1dGVzdHJlbmd0aGdhaW4gKiAoc2VsZi5zZWxlY3RlZEhlcm9MZXZlbCgpIC0gMSkgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmludmVudG9yeS5nZXRBdHRyaWJ1dGVzKCdzdHInKSBcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldEF0dHJpYnV0ZUJvbnVzTGV2ZWwoKSAqIDJcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldFN0cmVuZ3RoKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0U3RyZW5ndGhSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICsgc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRBbGxTdGF0c1JlZHVjdGlvbigpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmRlYnVmZnMuZ2V0QWxsU3RhdHNSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYuaGVhbHRoID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIChzZWxmLmhlcm9EYXRhKCkuc3RhdHVzaGVhbHRoICsgTWF0aC5mbG9vcihzZWxmLnRvdGFsU3RyKCkpICogMjAgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmludmVudG9yeS5nZXRIZWFsdGgoKVxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0SGVhbHRoKCkpLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5oZWFsdGhyZWdlbiA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBoZWFsdGhSZWdlbkF1cmEgPSBbc2VsZi5pbnZlbnRvcnkuZ2V0SGVhbHRoUmVnZW5BdXJhLCBzZWxmLmJ1ZmZzLml0ZW1CdWZmcy5nZXRIZWFsdGhSZWdlbkF1cmFdLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZm4pIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBmbihtZW1vLmV4Y2x1ZGVMaXN0KTtcbiAgICAgICAgICAgIG9iai52YWx1ZSArPSBtZW1vLnZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSwge3ZhbHVlOiAwLCBleGNsdWRlTGlzdDogW119KTtcbiAgICAgICAgcmV0dXJuIChzZWxmLmhlcm9EYXRhKCkuc3RhdHVzaGVhbHRocmVnZW4gKyBzZWxmLnRvdGFsU3RyKCkgKiAuMDMgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmludmVudG9yeS5nZXRIZWFsdGhSZWdlbigpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0SGVhbHRoUmVnZW4oKVxuICAgICAgICAgICAgICAgICsgc2VsZi5idWZmcy5nZXRIZWFsdGhSZWdlbigpXG4gICAgICAgICAgICAgICAgKyBoZWFsdGhSZWdlbkF1cmEudmFsdWVcbiAgICAgICAgICAgICAgICApLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5tYW5hID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIChzZWxmLmhlcm9EYXRhKCkuc3RhdHVzbWFuYVxuICAgICAgICAgICAgICAgICsgc2VsZi50b3RhbEludCgpICogMTJcbiAgICAgICAgICAgICAgICArIHNlbGYuaW52ZW50b3J5LmdldE1hbmEoKVxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0TWFuYSgpKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYubWFuYXJlZ2VuID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICgoc2VsZi5oZXJvRGF0YSgpLnN0YXR1c21hbmFyZWdlbiBcbiAgICAgICAgICAgICAgICArIHNlbGYudG90YWxJbnQoKSAqIC4wNCBcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldE1hbmFSZWdlbigpKSBcbiAgICAgICAgICAgICAgICAqICgxICsgc2VsZi5pbnZlbnRvcnkuZ2V0TWFuYVJlZ2VuUGVyY2VudCgpKSBcbiAgICAgICAgICAgICAgICArIChzZWxmLmhlcm9JZCgpID09PSAnY3J5c3RhbF9tYWlkZW4nID8gc2VsZi5hYmlsaXR5KCkuZ2V0TWFuYVJlZ2VuQXJjYW5lQXVyYSgpICogMiA6IHNlbGYuYnVmZnMuZ2V0TWFuYVJlZ2VuQXJjYW5lQXVyYSgpKVxuICAgICAgICAgICAgICAgICsgc2VsZi5pbnZlbnRvcnkuZ2V0TWFuYVJlZ2VuQmxvb2RzdG9uZSgpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmludmVudG9yeS5nZXRNYW5hUmVnZW4oKVxuICAgICAgICAgICAgICAgIC0gc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRNYW5hUmVnZW5SZWR1Y3Rpb24oKSkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBzZWxmLnRvdGFsQXJtb3JQaHlzaWNhbCA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcm1vckF1cmEgPSBbc2VsZi5pbnZlbnRvcnkuZ2V0QXJtb3JBdXJhLCBzZWxmLmJ1ZmZzLml0ZW1CdWZmcy5nZXRBcm1vckF1cmFdLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZm4pIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBmbihtZW1vLmF0dHJpYnV0ZXMpO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSwge3ZhbHVlOjAsIGF0dHJpYnV0ZXM6W119KTtcbiAgICAgICAgdmFyIGFybW9yUmVkdWN0aW9uID0gW3NlbGYuZW5lbXkoKS5pbnZlbnRvcnkuZ2V0QXJtb3JSZWR1Y3Rpb24sIHNlbGYuZGVidWZmcy5pdGVtQnVmZnMuZ2V0QXJtb3JSZWR1Y3Rpb25dLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZm4pIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBmbihtZW1vLmV4Y2x1ZGVMaXN0KTtcbiAgICAgICAgICAgIG9iai52YWx1ZSArPSBtZW1vLnZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSwge3ZhbHVlOiAwLCBleGNsdWRlTGlzdDogW119KTtcbiAgICAgICAgcmV0dXJuIChzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEFybW9yQmFzZVJlZHVjdGlvbigpICogc2VsZi5kZWJ1ZmZzLmdldEFybW9yQmFzZVJlZHVjdGlvbigpICogKHNlbGYuaGVyb0RhdGEoKS5hcm1vcnBoeXNpY2FsICsgc2VsZi50b3RhbEFnaSgpICogLjE0KVxuICAgICAgICAgICAgICAgICsgc2VsZi5pbnZlbnRvcnkuZ2V0QXJtb3IoKVxuICAgICAgICAgICAgICAgIC8vKyBzZWxmLmludmVudG9yeS5nZXRBcm1vckF1cmEoKS52YWx1ZVxuICAgICAgICAgICAgICAgIC8vKyBzZWxmLmVuZW15KCkuaW52ZW50b3J5LmdldEFybW9yUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldEFybW9yKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0QXJtb3JSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICsgc2VsZi5idWZmcy5nZXRBcm1vcigpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmJ1ZmZzLml0ZW1CdWZmcy5nZXRBcm1vcigpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmRlYnVmZnMuZ2V0QXJtb3JSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgIC8vKyBzZWxmLmJ1ZmZzLml0ZW1CdWZmcy5nZXRBcm1vckF1cmEoKS52YWx1ZVxuICAgICAgICAgICAgICAgICsgYXJtb3JBdXJhLnZhbHVlXG4gICAgICAgICAgICAgICAgKyBhcm1vclJlZHVjdGlvbi52YWx1ZVxuICAgICAgICAgICAgICAgIC8vKyBzZWxmLmRlYnVmZnMuZ2V0QXJtb3JSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBzZWxmLnRvdGFsQXJtb3JQaHlzaWNhbFJlZHVjdGlvbiA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEFybW9yID0gc2VsZi50b3RhbEFybW9yUGh5c2ljYWwoKTtcbiAgICAgICAgaWYgKHRvdGFsQXJtb3IgPj0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICgoMC4wNiAqIHNlbGYudG90YWxBcm1vclBoeXNpY2FsKCkpIC8gKDEgKyAwLjA2ICogc2VsZi50b3RhbEFybW9yUGh5c2ljYWwoKSkgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gLSgoMC4wNiAqIC1zZWxmLnRvdGFsQXJtb3JQaHlzaWNhbCgpKSAvICgxICsgMC4wNiAqIC1zZWxmLnRvdGFsQXJtb3JQaHlzaWNhbCgpKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYudG90YWxNb3ZlbWVudFNwZWVkID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIE1JTl9NT1ZFU1BFRUQgPSAxMDA7XG4gICAgICAgIHZhciBtcyA9IChzZWxmLmFiaWxpdHkoKS5zZXRNb3ZlbWVudFNwZWVkKCkgPiAwID8gc2VsZi5hYmlsaXR5KCkuc2V0TW92ZW1lbnRTcGVlZCgpIDogc2VsZi5idWZmcy5zZXRNb3ZlbWVudFNwZWVkKCkpO1xuICAgICAgICBpZiAobXMgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbXM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgbW92ZW1lbnRTcGVlZFBlcmNlbnQgPSBbc2VsZi5pbnZlbnRvcnkuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnQsIHNlbGYuYnVmZnMuaXRlbUJ1ZmZzLmdldE1vdmVtZW50U3BlZWRQZXJjZW50XS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGZuKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IGZuKG1lbW8uZXhjbHVkZUxpc3QpO1xuICAgICAgICAgICAgICAgIG9iai52YWx1ZSArPSBtZW1vLnZhbHVlO1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9LCB7dmFsdWU6MCwgZXhjbHVkZUxpc3Q6W119KTtcbiAgICAgICAgICAgIHZhciBtb3ZlbWVudFNwZWVkUGVyY2VudFJlZHVjdGlvbiA9IFtzZWxmLmVuZW15KCkuaW52ZW50b3J5LmdldE1vdmVtZW50U3BlZWRQZXJjZW50UmVkdWN0aW9uLCBzZWxmLmRlYnVmZnMuaXRlbUJ1ZmZzLmdldE1vdmVtZW50U3BlZWRQZXJjZW50UmVkdWN0aW9uXS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGZuKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IGZuKG1lbW8uZXhjbHVkZUxpc3QpO1xuICAgICAgICAgICAgICAgIG9iai52YWx1ZSArPSBtZW1vLnZhbHVlO1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9LCB7dmFsdWU6MCwgZXhjbHVkZUxpc3Q6W119KTtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChcbiAgICAgICAgICAgICAgICBzZWxmLmVuZW15KCkuaW52ZW50b3J5LmlzU2hlZXBlZCgpIHx8IHNlbGYuZGVidWZmcy5pdGVtQnVmZnMuaXNTaGVlcGVkKCkgPyAxNDAgOlxuICAgICAgICAgICAgICAgIChzZWxmLmhlcm9EYXRhKCkubW92ZW1lbnRzcGVlZCArIHNlbGYuaW52ZW50b3J5LmdldE1vdmVtZW50U3BlZWRGbGF0KCkrIHNlbGYuYWJpbGl0eSgpLmdldE1vdmVtZW50U3BlZWRGbGF0KCkpICogXG4gICAgICAgICAgICAgICAgKDEgLy8rIHNlbGYuaW52ZW50b3J5LmdldE1vdmVtZW50U3BlZWRQZXJjZW50KCkgXG4gICAgICAgICAgICAgICAgICAgKyBtb3ZlbWVudFNwZWVkUGVyY2VudC52YWx1ZVxuICAgICAgICAgICAgICAgICAgICsgbW92ZW1lbnRTcGVlZFBlcmNlbnRSZWR1Y3Rpb24udmFsdWVcbiAgICAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldE1vdmVtZW50U3BlZWRQZXJjZW50KCkgXG4gICAgICAgICAgICAgICAgICAgLy8rIHNlbGYuZW5lbXkoKS5pbnZlbnRvcnkuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnRSZWR1Y3Rpb24oKSBcbiAgICAgICAgICAgICAgICAgICArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnRSZWR1Y3Rpb24oKSBcbiAgICAgICAgICAgICAgICAgICArIHNlbGYuYnVmZnMuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnQoKSBcbiAgICAgICAgICAgICAgICAgICArIHNlbGYuZGVidWZmcy5nZXRNb3ZlbWVudFNwZWVkUGVyY2VudFJlZHVjdGlvbigpXG4gICAgICAgICAgICAgICAgICAgKyBzZWxmLnVuaXQoKS5hYmlsaXR5KCkuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnQoKSBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAsIE1JTl9NT1ZFU1BFRUQpLnRvRml4ZWQoMik7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLnRvdGFsVHVyblJhdGUgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKHNlbGYuaGVyb0RhdGEoKS5tb3ZlbWVudHR1cm5yYXRlIFxuICAgICAgICAgICAgICAgICogKDEgKyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldFR1cm5SYXRlUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgICsgc2VsZi5kZWJ1ZmZzLmdldFR1cm5SYXRlUmVkdWN0aW9uKCkpKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYuYmFzZURhbWFnZSA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IHNlbGYudG90YWxBdHRyaWJ1dGUoc2VsZi5wcmltYXJ5QXR0cmlidXRlKCkpLFxuICAgICAgICAgICAgYWJpbGl0eUJhc2VEYW1hZ2UgPSBzZWxmLmFiaWxpdHkoKS5nZXRCYXNlRGFtYWdlKCksXG4gICAgICAgICAgICBtaW5EYW1hZ2UgPSBzZWxmLmhlcm9EYXRhKCkuYXR0YWNrZGFtYWdlbWluLFxuICAgICAgICAgICAgbWF4RGFtYWdlID0gc2VsZi5oZXJvRGF0YSgpLmF0dGFja2RhbWFnZW1heDtcbiAgICAgICAgcmV0dXJuIFtNYXRoLmZsb29yKChtaW5EYW1hZ2UgKyB0b3RhbEF0dHJpYnV0ZSArIGFiaWxpdHlCYXNlRGFtYWdlLnRvdGFsKSAqIHNlbGYuYWJpbGl0eSgpLmdldFNlbGZCYXNlRGFtYWdlUmVkdWN0aW9uUGN0KCkgKiBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKSAqIHNlbGYuZGVidWZmcy5nZXRCYXNlRGFtYWdlUmVkdWN0aW9uUGN0KCkgKiBzZWxmLmRlYnVmZnMuaXRlbUJ1ZmZzLmdldEJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKSAqIGFiaWxpdHlCYXNlRGFtYWdlLm11bHRpcGxpZXIpLFxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoKG1heERhbWFnZSArIHRvdGFsQXR0cmlidXRlICsgYWJpbGl0eUJhc2VEYW1hZ2UudG90YWwpICogc2VsZi5hYmlsaXR5KCkuZ2V0U2VsZkJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKSAqIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0QmFzZURhbWFnZVJlZHVjdGlvblBjdCgpICogc2VsZi5kZWJ1ZmZzLmdldEJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKSAqIHNlbGYuZGVidWZmcy5pdGVtQnVmZnMuZ2V0QmFzZURhbWFnZVJlZHVjdGlvblBjdCgpICogYWJpbGl0eUJhc2VEYW1hZ2UubXVsdGlwbGllcildO1xuICAgIH0pO1xuICAgIHNlbGYuYmFzZURhbWFnZUF2ZyA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoc2VsZi5iYXNlRGFtYWdlKClbMF0gKyBzZWxmLmJhc2VEYW1hZ2UoKVsxXSkgLyAyO1xuICAgIH0pO1xuICAgIHNlbGYuYmFzZURhbWFnZU1pbiA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmJhc2VEYW1hZ2UoKVswXTtcbiAgICB9KTtcbiAgICBzZWxmLmJhc2VEYW1hZ2VNYXggPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5iYXNlRGFtYWdlKClbMV07XG4gICAgfSk7XG4gICAgc2VsZi5ib251c0RhbWFnZSA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoKHNlbGYuaW52ZW50b3J5LmdldEJvbnVzRGFtYWdlKCkudG90YWxcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldEJvbnVzRGFtYWdlKCkudG90YWxcbiAgICAgICAgICAgICAgICArIHNlbGYuYnVmZnMuZ2V0Qm9udXNEYW1hZ2UoKS50b3RhbFxuICAgICAgICAgICAgICAgICsgTWF0aC5mbG9vcigoc2VsZi5iYXNlRGFtYWdlKClbMF0gKyBzZWxmLmJhc2VEYW1hZ2UoKVsxXSkgLyAyIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAoc2VsZi5idWZmcy5pdGVtQnVmZnMuZ2V0Qm9udXNEYW1hZ2VQZXJjZW50KHNlbGYuaW52ZW50b3J5LmdldEJvbnVzRGFtYWdlUGVyY2VudCgpKS50b3RhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRCb251c0RhbWFnZVBlcmNlbnQoKS50b3RhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBzZWxmLmJ1ZmZzLmdldEJvbnVzRGFtYWdlUGVyY2VudCgpLnRvdGFsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKyBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgICAgICAoc2VsZi5oZXJvRGF0YSgpLmF0dGFja3R5cGUgPT0gJ0RPVEFfVU5JVF9DQVBfUkFOR0VEX0FUVEFDSycgXG4gICAgICAgICAgICAgICAgICAgICAgICA/ICgoc2VsZi5oZXJvSWQoKSA9PSAnZHJvd19yYW5nZXInKSA/IHNlbGYuYWJpbGl0eSgpLmdldEJvbnVzRGFtYWdlUHJlY2lzaW9uQXVyYSgpLnRvdGFsWzBdICogc2VsZi50b3RhbEFnaSgpIDogc2VsZi5idWZmcy5nZXRCb251c0RhbWFnZVByZWNpc2lvbkF1cmEoKS50b3RhbFsxXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogMClcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICArIE1hdGguZmxvb3IoXG4gICAgICAgICAgICAgICAgICAgICgoc2VsZi5oZXJvSWQoKSA9PSAncmlraScpID8gc2VsZi5hYmlsaXR5KCkuZ2V0Qm9udXNEYW1hZ2VCYWNrc3RhYigpLnRvdGFsWzBdICogc2VsZi50b3RhbEFnaSgpIDogMClcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApICogc2VsZi5hYmlsaXR5KCkuZ2V0U2VsZkJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKVxuICAgICAgICAgICAgICAgICAgKiBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKVxuICAgICAgICAgICAgICAgICAgKiBzZWxmLmRlYnVmZnMuaXRlbUJ1ZmZzLmdldEJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKSk7XG4gICAgfSk7XG4gICAgc2VsZi5ib251c0RhbWFnZVJlZHVjdGlvbiA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmFicyhzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEJvbnVzRGFtYWdlUmVkdWN0aW9uKCkgKyBzZWxmLmRlYnVmZnMuZ2V0Qm9udXNEYW1hZ2VSZWR1Y3Rpb24oKSk7XG4gICAgfSk7XG4gICAgc2VsZi5kYW1hZ2VBdmcgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKHNlbGYuYmFzZURhbWFnZSgpWzBdICsgc2VsZi5iYXNlRGFtYWdlKClbMV0pIC8gMiArIHNlbGYuYm9udXNEYW1hZ2UoKTtcbiAgICB9KTtcbiAgICBzZWxmLmRhbWFnZU1pbiA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmJhc2VEYW1hZ2UoKVswXSArIHNlbGYuYm9udXNEYW1hZ2UoKTtcbiAgICB9KTtcbiAgICBzZWxmLmRhbWFnZU1heCA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmJhc2VEYW1hZ2UoKVsxXSArIHNlbGYuYm9udXNEYW1hZ2UoKTtcbiAgICB9KTtcbiAgICBzZWxmLmRhbWFnZSA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBbc2VsZi5iYXNlRGFtYWdlKClbMF0gKyBzZWxmLmJvbnVzRGFtYWdlKCksXG4gICAgICAgICAgICAgICAgc2VsZi5iYXNlRGFtYWdlKClbMV0gKyBzZWxmLmJvbnVzRGFtYWdlKCldO1xuICAgIH0pO1xuICAgIHNlbGYudG90YWxNYWdpY1Jlc2lzdGFuY2VQcm9kdWN0ID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICgxIC0gc2VsZi5oZXJvRGF0YSgpLm1hZ2ljYWxyZXNpc3RhbmNlIC8gMTAwKSBcbiAgICAgICAgICAgICAgICAqIHNlbGYuaW52ZW50b3J5LmdldE1hZ2ljUmVzaXN0KClcbiAgICAgICAgICAgICAgICAqIHNlbGYuYWJpbGl0eSgpLmdldE1hZ2ljUmVzaXN0KClcbiAgICAgICAgICAgICAgICAqIHNlbGYuYnVmZnMuZ2V0TWFnaWNSZXNpc3QoKVxuICAgICAgICAgICAgICAgICogc2VsZi5pbnZlbnRvcnkuZ2V0TWFnaWNSZXNpc3RSZWR1Y3Rpb25TZWxmKClcbiAgICAgICAgICAgICAgICAqIHNlbGYuZW5lbXkoKS5pbnZlbnRvcnkuZ2V0TWFnaWNSZXNpc3RSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICogc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRNYWdpY1Jlc2lzdFJlZHVjdGlvbigpXG4gICAgICAgICAgICAgICAgKiBzZWxmLmRlYnVmZnMuZ2V0TWFnaWNSZXNpc3RSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICogc2VsZi5kZWJ1ZmZzLml0ZW1CdWZmcy5nZXRNYWdpY1Jlc2lzdFJlZHVjdGlvbigpO1xuICAgIH0pO1xuICAgIHNlbGYudG90YWxNYWdpY1Jlc2lzdGFuY2UgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKCgxIC0gc2VsZi50b3RhbE1hZ2ljUmVzaXN0YW5jZVByb2R1Y3QoKSkgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5iYXQgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYWJpbGl0eUJBVCA9IHNlbGYuYWJpbGl0eSgpLmdldEJBVCgpO1xuICAgICAgICBpZiAoYWJpbGl0eUJBVCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBhYmlsaXR5QkFUO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxmLmhlcm9EYXRhKCkuYXR0YWNrcmF0ZTtcbiAgICB9KTtcbiAgICBzZWxmLmlhcyA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhdHRhY2tTcGVlZCA9IFtzZWxmLmludmVudG9yeS5nZXRBdHRhY2tTcGVlZCwgc2VsZi5idWZmcy5pdGVtQnVmZnMuZ2V0QXR0YWNrU3BlZWRdLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZm4pIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBmbihtZW1vLmV4Y2x1ZGVMaXN0KTtcbiAgICAgICAgICAgIG9iai52YWx1ZSArPSBtZW1vLnZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSwge3ZhbHVlOjAsIGV4Y2x1ZGVMaXN0OltdfSk7XG4gICAgICAgIHZhciBhdHRhY2tTcGVlZFJlZHVjdGlvbiA9IFtzZWxmLmVuZW15KCkuaW52ZW50b3J5LmdldEF0dGFja1NwZWVkUmVkdWN0aW9uLCBzZWxmLmRlYnVmZnMuaXRlbUJ1ZmZzLmdldEF0dGFja1NwZWVkUmVkdWN0aW9uXS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGZuKSB7XG4gICAgICAgICAgICB2YXIgb2JqID0gZm4obWVtby5leGNsdWRlTGlzdCk7XG4gICAgICAgICAgICBvYmoudmFsdWUgKz0gbWVtby52YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH0sIHt2YWx1ZTowLCBleGNsdWRlTGlzdDogW119KTtcbiAgICAgICAgdmFyIHZhbCA9IHBhcnNlRmxvYXQoc2VsZi50b3RhbEFnaSgpKSBcbiAgICAgICAgICAgICAgICAvLysgc2VsZi5pbnZlbnRvcnkuZ2V0QXR0YWNrU3BlZWQoKSBcbiAgICAgICAgICAgICAgICArIGF0dGFja1NwZWVkLnZhbHVlXG4gICAgICAgICAgICAgICAgKyBhdHRhY2tTcGVlZFJlZHVjdGlvbi52YWx1ZVxuICAgICAgICAgICAgICAgIC8vKyBzZWxmLmVuZW15KCkuaW52ZW50b3J5LmdldEF0dGFja1NwZWVkUmVkdWN0aW9uKCkgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRBdHRhY2tTcGVlZCgpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRBdHRhY2tTcGVlZFJlZHVjdGlvbigpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5idWZmcy5nZXRBdHRhY2tTcGVlZCgpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5kZWJ1ZmZzLmdldEF0dGFja1NwZWVkUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICArIHNlbGYudW5pdCgpLmFiaWxpdHkoKS5nZXRBdHRhY2tTcGVlZCgpOyBcbiAgICAgICAgaWYgKHZhbCA8IC04MCkge1xuICAgICAgICAgICAgcmV0dXJuIC04MDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWwgPiA1MDApIHtcbiAgICAgICAgICAgIHJldHVybiA1MDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbC50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYuYXR0YWNrVGltZSA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoc2VsZi5iYXQoKSAvICgxICsgc2VsZi5pYXMoKSAvIDEwMCkpLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5hdHRhY2tzUGVyU2Vjb25kID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICgoMSArIHNlbGYuaWFzKCkgLyAxMDApIC8gc2VsZi5iYXQoKSkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBzZWxmLmV2YXNpb24gPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoc2VsZi5lbmVteSgpLmludmVudG9yeS5pc1NoZWVwZWQoKSB8fCBzZWxmLmRlYnVmZnMuaXRlbUJ1ZmZzLmlzU2hlZXBlZCgpKSByZXR1cm4gMDtcbiAgICAgICAgdmFyIGUgPSBzZWxmLmFiaWxpdHkoKS5zZXRFdmFzaW9uKCk7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gKGUgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKCgxLShzZWxmLmludmVudG9yeS5nZXRFdmFzaW9uKCkgKiBzZWxmLmFiaWxpdHkoKS5nZXRFdmFzaW9uKCkgKiBzZWxmLmFiaWxpdHkoKS5nZXRFdmFzaW9uQmFja3RyYWNrKCkgKiBzZWxmLmJ1ZmZzLml0ZW1CdWZmcy5nZXRFdmFzaW9uKCkpKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYuZWhwUGh5c2ljYWwgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXZhc2lvbiA9IHNlbGYuZW5lbXkoKS5pbnZlbnRvcnkuaXNTaGVlcGVkKCkgfHwgc2VsZi5kZWJ1ZmZzLml0ZW1CdWZmcy5pc1NoZWVwZWQoKSA/IDEgOiBzZWxmLmludmVudG9yeS5nZXRFdmFzaW9uKCkgKiBzZWxmLmFiaWxpdHkoKS5nZXRFdmFzaW9uKCkgKiBzZWxmLmJ1ZmZzLml0ZW1CdWZmcy5nZXRFdmFzaW9uKCk7XG4gICAgICAgIGlmIChzZWxmLnRvdGFsQXJtb3JQaHlzaWNhbCgpID49IDApIHtcbiAgICAgICAgICAgIHZhciBlaHAgPSBzZWxmLmhlYWx0aCgpICogKDEgKyAuMDYgKiBzZWxmLnRvdGFsQXJtb3JQaHlzaWNhbCgpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBlaHAgPSBzZWxmLmhlYWx0aCgpICogKDEgLSAuMDYgKiBzZWxmLnRvdGFsQXJtb3JQaHlzaWNhbCgpKSAvICgxIC0gLjEyICogc2VsZi50b3RhbEFybW9yUGh5c2ljYWwoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWhwIC89ICgxIC0gKDEgLSAoZXZhc2lvbiAqIHNlbGYuYWJpbGl0eSgpLmdldEV2YXNpb25CYWNrdHJhY2soKSkpKTtcbiAgICAgICAgZWhwIC89ICgxIC0gcGFyc2VGbG9hdChzZWxmLmVuZW15KCkubWlzc0NoYW5jZSgpKSAvIDEwMCk7XG4gICAgICAgIGVocCAqPSAoc2VsZi5pbnZlbnRvcnkuYWN0aXZlSXRlbXMoKS5zb21lKGZ1bmN0aW9uIChpdGVtKSB7cmV0dXJuIGl0ZW0uaXRlbSA9PSAnbWFza19vZl9tYWRuZXNzJzt9KSA/ICgxIC8gMS4zKSA6IDEpO1xuICAgICAgICBlaHAgKj0gKDEgLyBzZWxmLmFiaWxpdHkoKS5nZXREYW1hZ2VSZWR1Y3Rpb24oKSk7XG4gICAgICAgIGVocCAqPSAoMSAvIHNlbGYuYnVmZnMuZ2V0RGFtYWdlUmVkdWN0aW9uKCkpO1xuICAgICAgICBlaHAgKj0gKDEgLyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldERhbWFnZUFtcGxpZmljYXRpb24oKSk7XG4gICAgICAgIGVocCAqPSAoMSAvIHNlbGYuZGVidWZmcy5nZXREYW1hZ2VBbXBsaWZpY2F0aW9uKCkpO1xuICAgICAgICByZXR1cm4gZWhwLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5laHBNYWdpY2FsID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVocCA9IHNlbGYuaGVhbHRoKCkgLyBzZWxmLnRvdGFsTWFnaWNSZXNpc3RhbmNlUHJvZHVjdCgpO1xuICAgICAgICBlaHAgKj0gKHNlbGYuaW52ZW50b3J5LmFjdGl2ZUl0ZW1zKCkuc29tZShmdW5jdGlvbiAoaXRlbSkge3JldHVybiBpdGVtLml0ZW0gPT0gJ21hc2tfb2ZfbWFkbmVzcyc7fSkgPyAoMSAvIDEuMykgOiAxKTtcbiAgICAgICAgZWhwICo9ICgxIC8gc2VsZi5hYmlsaXR5KCkuZ2V0RGFtYWdlUmVkdWN0aW9uKCkpO1xuICAgICAgICBlaHAgKj0gKDEgLyBzZWxmLmJ1ZmZzLmdldERhbWFnZVJlZHVjdGlvbigpKTtcbiAgICAgICAgZWhwICo9ICgxIC8gc2VsZi5hYmlsaXR5KCkuZ2V0RXZhc2lvbkJhY2t0cmFjaygpKTtcbiAgICAgICAgZWhwICo9ICgxIC8gc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXREYW1hZ2VBbXBsaWZpY2F0aW9uKCkpO1xuICAgICAgICBlaHAgKj0gKDEgLyBzZWxmLmRlYnVmZnMuZ2V0RGFtYWdlQW1wbGlmaWNhdGlvbigpKTtcbiAgICAgICAgcmV0dXJuIGVocC50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYuYmFzaCA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhdHRhY2t0eXBlID0gc2VsZi5oZXJvRGF0YSgpLmF0dGFja3R5cGU7XG4gICAgICAgIHJldHVybiAoKDEgLSAoc2VsZi5pbnZlbnRvcnkuZ2V0QmFzaChhdHRhY2t0eXBlKSAqIHNlbGYuYWJpbGl0eSgpLmdldEJhc2goKSkpICogMTAwKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuY3JpdENoYW5jZSA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoKDEgLSAoc2VsZi5pbnZlbnRvcnkuZ2V0Q3JpdENoYW5jZSgpICogc2VsZi5hYmlsaXR5KCkuZ2V0Q3JpdENoYW5jZSgpKSkgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgfSk7XG5cbiAgICBteS5wcm90b3R5cGUuSGVyb0RhbWFnZU1peGluKHNlbGYpO1xuICAgIFxuICAgIC8qc2VsZi5jcml0RGFtYWdlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmNyaXRJbmZvKCk7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH0pOyovXG4gICAgc2VsZi5taXNzQ2hhbmNlID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1pc3NEZWJ1ZmYgPSBbc2VsZi5lbmVteSgpLmludmVudG9yeS5nZXRNaXNzQ2hhbmNlLCBzZWxmLmRlYnVmZnMuaXRlbUJ1ZmZzLmdldE1pc3NDaGFuY2VdLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZm4pIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBmbihtZW1vLmV4Y2x1ZGVMaXN0KTtcbiAgICAgICAgICAgIG9iai52YWx1ZSAqPSBtZW1vLnZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSwge3ZhbHVlOjEsIGV4Y2x1ZGVMaXN0OltdfSk7XG4gICAgICAgIHJldHVybiAoKDEgLSAoc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRNaXNzQ2hhbmNlKCkgKiBzZWxmLmRlYnVmZnMuZ2V0TWlzc0NoYW5jZSgpICogbWlzc0RlYnVmZi52YWx1ZSkpICogMTAwKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYudG90YWxhdHRhY2tyYW5nZSA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhdHRhY2t0eXBlID0gc2VsZi5oZXJvRGF0YSgpLmF0dGFja3R5cGU7XG4gICAgICAgIHJldHVybiBzZWxmLmhlcm9EYXRhKCkuYXR0YWNrcmFuZ2UgKyBzZWxmLmFiaWxpdHkoKS5nZXRBdHRhY2tSYW5nZSgpICsgc2VsZi5pbnZlbnRvcnkuZ2V0QXR0YWNrUmFuZ2UoYXR0YWNrdHlwZSkudmFsdWU7XG4gICAgfSk7XG4gICAgc2VsZi52aXNpb25yYW5nZWRheSA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoc2VsZi5oZXJvRGF0YSgpLnZpc2lvbmRheXRpbWVyYW5nZSkgKiAoMSArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0VmlzaW9uUmFuZ2VQY3RSZWR1Y3Rpb24oKSArIHNlbGYuZGVidWZmcy5nZXRWaXNpb25SYW5nZVBjdFJlZHVjdGlvbigpKTtcbiAgICB9KTtcbiAgICBzZWxmLnZpc2lvbnJhbmdlbmlnaHQgPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKHNlbGYuaGVyb0RhdGEoKS52aXNpb25uaWdodHRpbWVyYW5nZSArIHNlbGYuaW52ZW50b3J5LmdldFZpc2lvblJhbmdlTmlnaHQoKSArIHNlbGYuYWJpbGl0eSgpLmdldFZpc2lvblJhbmdlTmlnaHQoKSkgKiAoMSArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0VmlzaW9uUmFuZ2VQY3RSZWR1Y3Rpb24oKSArIHNlbGYuZGVidWZmcy5nZXRWaXNpb25SYW5nZVBjdFJlZHVjdGlvbigpKTtcbiAgICB9KTtcbiAgICBzZWxmLmxpZmVzdGVhbCA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbCA9IHNlbGYuaW52ZW50b3J5LmdldExpZmVzdGVhbCgpICsgc2VsZi5hYmlsaXR5KCkuZ2V0TGlmZXN0ZWFsKCkgKyBzZWxmLmJ1ZmZzLmdldExpZmVzdGVhbCgpO1xuICAgICAgICBpZiAoc2VsZi5oZXJvRGF0YSgpLmF0dGFja3R5cGUgPT0gJ0RPVEFfVU5JVF9DQVBfTUVMRUVfQVRUQUNLJykge1xuICAgICAgICAgICAgdmFyIGxpZmVzdGVhbEF1cmEgPSBbc2VsZi5pbnZlbnRvcnkuZ2V0TGlmZXN0ZWFsQXVyYSwgc2VsZi5idWZmcy5pdGVtQnVmZnMuZ2V0TGlmZXN0ZWFsQXVyYV0ucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBmbikge1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSBmbihtZW1vLmV4Y2x1ZGVMaXN0KTtcbiAgICAgICAgICAgICAgICBvYmoudmFsdWUgKz0gbWVtby52YWx1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICAgICAgfSwge3ZhbHVlOiAwLCBleGNsdWRlTGlzdDogW119KTtcbiAgICAgICAgICAgIHRvdGFsICs9IGxpZmVzdGVhbEF1cmEudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICh0b3RhbCkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLmFkZElsbHVzaW9uID0gZnVuY3Rpb24gKGRhdGEsIGV2ZW50KSB7XG4gICAgICAgIHNlbGYuaWxsdXNpb25zLnB1c2goa28ub2JzZXJ2YWJsZShuZXcgbXkucHJvdG90eXBlLklsbHVzaW9uVmlld01vZGVsKDAsIHNlbGYsIHNlbGYuaWxsdXNpb25BYmlsaXR5TGV2ZWwoKSkpKTtcbiAgICB9O1xuICAgIFxuICAgIHNlbGYuZGlmZlByb3BlcnRpZXMgPSBteS5wcm90b3R5cGUuZGlmZlByb3BlcnRpZXM7XG4gICAgc2VsZi5kaWZmID0ge307XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuZGlmZlByb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gaTtcbiAgICAgICAgc2VsZi5kaWZmW3NlbGYuZGlmZlByb3BlcnRpZXNbaW5kZXhdXSA9IHNlbGYuZ2V0RGlmZkZ1bmN0aW9uKHNlbGYuZGlmZlByb3BlcnRpZXNbaW5kZXhdKTtcbiAgICB9XG59O1xuXG5teS5wcm90b3R5cGUuSGVyb01vZGVsLnByb3RvdHlwZS5nZXREaWZmRnVuY3Rpb24gPSBmdW5jdGlvbiAocHJvcCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICByZXR1cm4ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAocHJvcCA9PSAnYmFzZURhbWFnZScpIHtcbiAgICAgICAgICAgIHJldHVybiBbc2VsZltwcm9wXSgpWzBdIC0gc2VsZi5oZXJvQ29tcGFyZSgpW3Byb3BdKClbMF0sIHNlbGZbcHJvcF0oKVsxXSAtIHNlbGYuaGVyb0NvbXBhcmUoKVtwcm9wXSgpWzFdXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmW3Byb3BdKCkgLSBzZWxmLmhlcm9Db21wYXJlKClbcHJvcF0oKTtcbiAgICAgICAgfVxuICAgIH0sIHRoaXMsIHsgZGVmZXJFdmFsdWF0aW9uOiB0cnVlIH0pO1xufVxuXG5teS5wcm90b3R5cGUuSGVyb01vZGVsLnByb3RvdHlwZS5nZXRBYmlsaXR5TGV2ZWxNYXggPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIGlmIChkYXRhLmFiaWxpdHl0eXBlID09PSAnRE9UQV9BQklMSVRZX1RZUEVfQVRUUklCVVRFUycpIHtcbiAgICAgICAgcmV0dXJuIDEwO1xuICAgIH1cbiAgICBlbHNlIGlmIChkYXRhLm5hbWUgPT09ICdpbnZva2VyX3F1YXMnIHx8IGRhdGEubmFtZSA9PT0gJ2ludm9rZXJfd2V4JyB8fCBkYXRhLm5hbWUgPT09ICdpbnZva2VyX2V4b3J0Jykge1xuICAgICAgICByZXR1cm4gNztcbiAgICB9XG4gICAgZWxzZSBpZiAoZGF0YS5uYW1lID09PSAnaW52b2tlcl9pbnZva2UnKSB7XG4gICAgICAgIHJldHVybiA0O1xuICAgIH1cbiAgICBlbHNlIGlmIChkYXRhLm5hbWUgPT09ICdlYXJ0aF9zcGlyaXRfc3RvbmVfY2FsbGVyJyB8fCBkYXRhLm5hbWUgPT09ICdvZ3JlX21hZ2lfdW5yZWZpbmVkX2ZpcmVibGFzdCcpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIGVsc2UgaWYgKGRhdGEuYWJpbGl0eXR5cGUgPT09ICdET1RBX0FCSUxJVFlfVFlQRV9VTFRJTUFURScgfHwgZGF0YS5uYW1lID09PSAna2VlcGVyX29mX3RoZV9saWdodF9yZWNhbGwnIHx8XG4gICAgICAgICAgICAgZGF0YS5uYW1lID09PSAna2VlcGVyX29mX3RoZV9saWdodF9ibGluZGluZ19saWdodCcgfHwgZGF0YS5uYW1lID09PSAnZW1iZXJfc3Bpcml0X2FjdGl2YXRlX2ZpcmVfcmVtbmFudCcgfHxcbiAgICAgICAgICAgICBkYXRhLm5hbWUgPT09ICdsb25lX2RydWlkX3RydWVfZm9ybV9iYXR0bGVfY3J5Jykge1xuICAgICAgICByZXR1cm4gMztcbiAgICB9XG4gICAgZWxzZSBpZiAoZGF0YS5uYW1lID09PSAncHVja19ldGhlcmVhbF9qYXVudCcgIHx8IGRhdGEubmFtZSA9PT0gJ3NoYWRvd19kZW1vbl9zaGFkb3dfcG9pc29uX3JlbGVhc2UnIHx8XG4gICAgICAgICAgICAgZGF0YS5uYW1lID09PSAndGVtcGxhcl9hc3Nhc3Npbl90cmFwJyB8fCBkYXRhLm5hbWUgPT09ICdzcGVjdHJlX3JlYWxpdHknKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBlbHNlIGlmIChkYXRhLm5hbWUgPT09ICdpbnZva2VyX2NvbGRfc25hcCcgIHx8IGRhdGEubmFtZSA9PT0gJ2ludm9rZXJfZ2hvc3Rfd2FsaycgfHwgZGF0YS5uYW1lID09PSAnaW52b2tlcl90b3JuYWRvJyB8fCBcbiAgICAgICAgICAgICBkYXRhLm5hbWUgPT09ICdpbnZva2VyX2VtcCcgfHwgZGF0YS5uYW1lID09PSAnaW52b2tlcl9hbGFjcml0eScgfHwgZGF0YS5uYW1lID09PSAnaW52b2tlcl9jaGFvc19tZXRlb3InIHx8IFxuICAgICAgICAgICAgIGRhdGEubmFtZSA9PT0gJ2ludm9rZXJfc3VuX3N0cmlrZScgfHwgZGF0YS5uYW1lID09PSAnaW52b2tlcl9mb3JnZV9zcGlyaXQnIHx8IGRhdGEubmFtZSA9PT0gJ2ludm9rZXJfaWNlX3dhbGwnIHx8IFxuICAgICAgICAgICAgIGRhdGEubmFtZSA9PT0gJ2ludm9rZXJfZGVhZmVuaW5nX2JsYXN0Jykge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoZGF0YS5uYW1lID09PSAndGVjaGllc19taW5lZmllbGRfc2lnbicgfHwgZGF0YS5uYW1lID09PSAndGVjaGllc19mb2N1c2VkX2RldG9uYXRlJykge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiA0O1xuICAgIH1cbn07IiwiJ3VzZSBzdHJpY3QnO1xudmFyIGtvID0gcmVxdWlyZSgnLi9oZXJvY2FsY19rbm9ja291dCcpO1xuXG52YXIgbXkgPSByZXF1aXJlKFwiLi9oZXJvY2FsY19jb3JlXCIpO1xuXG5teS5wcm90b3R5cGUuQ2xvbmVPcHRpb24gPSBmdW5jdGlvbiAobmFtZSwgZGlzcGxheW5hbWUsIGxldmVscywgaW1hZ2UsIGxldmVsKSB7XG4gICAgdGhpcy5oZXJvTmFtZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKGxldmVscyA+IDApID8gbmFtZSArIChsZXZlbCgpIDw9IGxldmVscyA/IGxldmVsKCkgOiAxKSA6IG5hbWU7XG4gICAgfSk7XG4gICAgdGhpcy5oZXJvRGlzcGxheU5hbWUgPSBkaXNwbGF5bmFtZTtcbiAgICB0aGlzLmltYWdlID0gaW1hZ2U7XG4gICAgdGhpcy5sZXZlbHMgPSBsZXZlbHM7XG59O1xuXG5teS5wcm90b3R5cGUuQ2xvbmVWaWV3TW9kZWwgPSBmdW5jdGlvbiAoaCxwKSB7XG4gICAgdmFyIHNlbGYgPSBuZXcgbXkucHJvdG90eXBlLkhlcm9Nb2RlbChoKTtcbiAgICBzZWxmLnBhcmVudCA9IHA7XG4gICAgLypzZWxmLnNlbGVjdGVkSGVybyhteS5wcm90b3R5cGUuZmluZFdoZXJlKHNlbGYuYXZhaWxhYmxlSGVyb2VzKCksIHtoZXJvTmFtZTogJ21lZXBvJ30pKTtcbiAgICBzZWxmLmhlcm8gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGtvLndyYXAuZnJvbUpTKG15LnByb3RvdHlwZS5oZXJvRGF0YVsnbnBjX2RvdGFfaGVyb19tZWVwbyddKTtcbiAgICB9KTsqL1xuICAgIHJldHVybiBzZWxmO1xufSIsIid1c2Ugc3RyaWN0JztcbnZhciBrbyA9IHJlcXVpcmUoJy4vaGVyb2NhbGNfa25vY2tvdXQnKTtcbiAgICBcbnZhciBteSA9IHJlcXVpcmUoXCIuL2hlcm9jYWxjX2NvcmVcIik7XG5cbm15LnByb3RvdHlwZS5EYW1hZ2VUeXBlQ29sb3IgPSB7XG4gICAgJ3BoeXNpY2FsJzogJyM5NzlhYTInLFxuICAgICdwdXJlJzogJ2dvbGRlbnJvZCcsXG4gICAgJ21hZ2ljJzogJyM0MjhiY2EnLFxuICAgICdkZWZhdWx0JzogJyM5NzlhYTInXG59XG5cbm15LnByb3RvdHlwZS5IZXJvRGFtYWdlTWl4aW4gPSBmdW5jdGlvbiAoc2VsZikge1xuICAgIHNlbGYuY3JpdEluZm8gPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3JpdFNvdXJjZXMgPSBzZWxmLmludmVudG9yeS5nZXRDcml0U291cmNlKCk7XG4gICAgICAgIG15LnByb3RvdHlwZS5leHRlbmQoY3JpdFNvdXJjZXMsIHNlbGYuYWJpbGl0eSgpLmdldENyaXRTb3VyY2UoKSk7XG4gICAgICAgIG15LnByb3RvdHlwZS5leHRlbmQoY3JpdFNvdXJjZXMsIHNlbGYuYnVmZnMuZ2V0Q3JpdFNvdXJjZSgpKTtcbiAgICAgICAgdmFyIGNyaXRTb3VyY2VzQXJyYXkgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBjcml0U291cmNlcykge1xuICAgICAgICAgICAgdmFyIGVsID0gY3JpdFNvdXJjZXNbcHJvcF07XG4gICAgICAgICAgICBlbC5uYW1lID0gcHJvcFxuICAgICAgICAgICAgY3JpdFNvdXJjZXNBcnJheS5wdXNoKGVsKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjb21wYXJlQnlNdWx0aXBsaWVyKGEsYikge1xuICAgICAgICAgICAgaWYgKGEubXVsdGlwbGllciA8IGIubXVsdGlwbGllcilcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIGlmIChhLm11bHRpcGxpZXIgPiBiLm11bHRpcGxpZXIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICBjcml0U291cmNlc0FycmF5LnNvcnQoY29tcGFyZUJ5TXVsdGlwbGllcik7XG4gICAgICAgIFxuICAgICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICAgIHZhciBjcml0VG90YWwgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNyaXRTb3VyY2VzQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB0b3RhbCA9IDE7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGk7IGorKykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDxjcml0U291cmNlc0FycmF5W2pdLmNvdW50OyBrKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWwgKj0gKDEgLSBjcml0U291cmNlc0FycmF5W2pdLmNoYW5jZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRvdGFsMiA9IDE7XG4gICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGNyaXRTb3VyY2VzQXJyYXlbaV0uY291bnQ7IGsrKykge1xuICAgICAgICAgICAgICAgIHRvdGFsMiAqPSAoMSAtIGNyaXRTb3VyY2VzQXJyYXlbaV0uY2hhbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRvdGFsICo9ICgxIC0gdG90YWwyKTtcbiAgICAgICAgICAgIGNyaXRUb3RhbCArPSB0b3RhbDtcbiAgICAgICAgICAgIGlmIChjcml0U291cmNlc0FycmF5W2ldLmNvdW50ID4gMSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOmNyaXRTb3VyY2VzQXJyYXlbaV0uZGlzcGxheW5hbWUgKyAnIHgnICsgY3JpdFNvdXJjZXNBcnJheVtpXS5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6Y3JpdFNvdXJjZXNBcnJheVtpXS5jaGFuY2UsXG4gICAgICAgICAgICAgICAgICAgICdtdWx0aXBsaWVyJzpjcml0U291cmNlc0FycmF5W2ldLm11bHRpcGxpZXIsXG4gICAgICAgICAgICAgICAgICAgICdjb3VudCc6Y3JpdFNvdXJjZXNBcnJheVtpXS5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsQ2hhbmNlJzp0b3RhbFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAnbmFtZSc6Y3JpdFNvdXJjZXNBcnJheVtpXS5kaXNwbGF5bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6Y3JpdFNvdXJjZXNBcnJheVtpXS5jaGFuY2UsXG4gICAgICAgICAgICAgICAgICAgICdtdWx0aXBsaWVyJzpjcml0U291cmNlc0FycmF5W2ldLm11bHRpcGxpZXIsXG4gICAgICAgICAgICAgICAgICAgICdjb3VudCc6Y3JpdFNvdXJjZXNBcnJheVtpXS5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsQ2hhbmNlJzp0b3RhbFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHNvdXJjZXM6IHJlc3VsdCwgdG90YWw6IGNyaXRUb3RhbCB9O1xuICAgIH0pO1xuXG4gICAgc2VsZi5jbGVhdmVJbmZvID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNsZWF2ZVNvdXJjZXMgPSBzZWxmLmludmVudG9yeS5nZXRDbGVhdmVTb3VyY2UoKTtcbiAgICAgICAgbXkucHJvdG90eXBlLmV4dGVuZChjbGVhdmVTb3VyY2VzLCBzZWxmLmFiaWxpdHkoKS5nZXRDbGVhdmVTb3VyY2UoKSk7XG4gICAgICAgIG15LnByb3RvdHlwZS5leHRlbmQoY2xlYXZlU291cmNlcywgc2VsZi5idWZmcy5nZXRDbGVhdmVTb3VyY2UoKSk7XG4gICAgICAgIHZhciBjbGVhdmVTb3VyY2VzQXJyYXkgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBjbGVhdmVTb3VyY2VzKSB7XG4gICAgICAgICAgICB2YXIgZWwgPSBjbGVhdmVTb3VyY2VzW3Byb3BdO1xuICAgICAgICAgICAgZWwubmFtZSA9IHByb3BcbiAgICAgICAgICAgIGNsZWF2ZVNvdXJjZXNBcnJheS5wdXNoKGVsKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjb21wYXJlQnlSYWRpdXMoYSxiKSB7XG4gICAgICAgICAgICBpZiAoYS5yYWRpdXMgPCBiLnJhZGl1cylcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIGlmIChhLnJhZGl1cyA+IGIucmFkaXVzKVxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgY2xlYXZlU291cmNlc0FycmF5LnNvcnQoY29tcGFyZUJ5UmFkaXVzKTtcbiAgICAgICAgdmFyIGNsZWF2ZVNvdXJjZXNCeVJhZGl1cyA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNsZWF2ZVNvdXJjZXNBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHRvdGFsID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDxjbGVhdmVTb3VyY2VzQXJyYXkubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoY2xlYXZlU291cmNlc0FycmF5W2pdLnJhZGl1cyA+PSBjbGVhdmVTb3VyY2VzQXJyYXlbaV0ucmFkaXVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IGNsZWF2ZVNvdXJjZXNBcnJheVtqXS5tYWduaXR1ZGUgKiBjbGVhdmVTb3VyY2VzQXJyYXlbal0uY291bnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXZlU291cmNlc0J5UmFkaXVzW2NsZWF2ZVNvdXJjZXNBcnJheVtpXS5yYWRpdXNdID0gdG90YWw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBwcm9wIGluIGNsZWF2ZVNvdXJjZXNCeVJhZGl1cykge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgICAgICdyYWRpdXMnOnByb3AsXG4gICAgICAgICAgICAgICAgJ21hZ25pdHVkZSc6Y2xlYXZlU291cmNlc0J5UmFkaXVzW3Byb3BdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuYmFzaEluZm8gPSBrby5wdXJlQ29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXR0YWNrdHlwZSA9IHNlbGYuaGVyb0RhdGEoKS5hdHRhY2t0eXBlO1xuICAgICAgICB2YXIgYmFzaFNvdXJjZXMgPSBzZWxmLmludmVudG9yeS5nZXRCYXNoU291cmNlKGF0dGFja3R5cGUpO1xuICAgICAgICBteS5wcm90b3R5cGUuZXh0ZW5kKGJhc2hTb3VyY2VzLCBzZWxmLmFiaWxpdHkoKS5nZXRCYXNoU291cmNlKCkpO1xuICAgICAgICB2YXIgYmFzaFNvdXJjZXNBcnJheSA9IFtdO1xuICAgICAgICBmb3IgKHZhciBwcm9wIGluIGJhc2hTb3VyY2VzKSB7XG4gICAgICAgICAgICB2YXIgZWwgPSBiYXNoU291cmNlc1twcm9wXTtcbiAgICAgICAgICAgIGVsLm5hbWUgPSBwcm9wXG4gICAgICAgICAgICBiYXNoU291cmNlc0FycmF5LnB1c2goZWwpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGNvbXBhcmVCeUR1cmF0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgIGlmIChhLmR1cmF0aW9uIDwgYi5kdXJhdGlvbilcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIGlmIChhLmR1cmF0aW9uID4gYi5kdXJhdGlvbilcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vYmFzaFNvdXJjZXNBcnJheS5zb3J0KGNvbXBhcmVCeUR1cmF0aW9uKTtcbiAgICAgICAgXG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgdmFyIGJhc2hUb3RhbCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwO2kgPCBiYXNoU291cmNlc0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgdG90YWwgPSAxO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpOyBqKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGJhc2hTb3VyY2VzQXJyYXlbal0uY291bnQ7IGsrKykge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbCAqPSAoMSAtIGJhc2hTb3VyY2VzQXJyYXlbal0uY2hhbmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdG90YWwyID0gMTtcbiAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgYmFzaFNvdXJjZXNBcnJheVtpXS5jb3VudDsgaysrKSB7XG4gICAgICAgICAgICAgICAgdG90YWwyICo9ICgxIC0gYmFzaFNvdXJjZXNBcnJheVtpXS5jaGFuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG90YWwgKj0gKDEgLSB0b3RhbDIpO1xuICAgICAgICAgICAgYmFzaFRvdGFsICs9IHRvdGFsO1xuICAgICAgICAgICAgaWYgKGJhc2hTb3VyY2VzQXJyYXlbaV0ubmFtZSA9PT0gJ3NwaXJpdF9icmVha2VyX2dyZWF0ZXJfYmFzaCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGJhc2hTb3VyY2VzQXJyYXlbaV0uZGFtYWdlICogc2VsZi50b3RhbE1vdmVtZW50U3BlZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBkID0gYmFzaFNvdXJjZXNBcnJheVtpXS5kYW1hZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYmFzaFNvdXJjZXNBcnJheVtpXS5jb3VudCA+IDEpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICduYW1lJzpiYXNoU291cmNlc0FycmF5W2ldLmRpc3BsYXluYW1lLCAvLyArICcgeCcgKyBiYXNoU291cmNlc0FycmF5W2ldLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzpiYXNoU291cmNlc0FycmF5W2ldLmNoYW5jZSxcbiAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6ZCxcbiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzpiYXNoU291cmNlc0FycmF5W2ldLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6YmFzaFNvdXJjZXNBcnJheVtpXS5kYW1hZ2VUeXBlLFxuICAgICAgICAgICAgICAgICAgICAndG90YWxDaGFuY2UnOnRvdGFsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICduYW1lJzpiYXNoU291cmNlc0FycmF5W2ldLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzpiYXNoU291cmNlc0FycmF5W2ldLmNoYW5jZSxcbiAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6ZCxcbiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzpiYXNoU291cmNlc0FycmF5W2ldLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6YmFzaFNvdXJjZXNBcnJheVtpXS5kYW1hZ2VUeXBlLFxuICAgICAgICAgICAgICAgICAgICAndG90YWxDaGFuY2UnOnRvdGFsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzb3VyY2VzOiByZXN1bHQsIHRvdGFsOiBiYXNoVG90YWwgfTtcbiAgICB9KTtcbiAgICBcbiAgICBzZWxmLm9yYlByb2NJbmZvID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGF0dGFja3R5cGUgPSBzZWxmLmhlcm9EYXRhKCkuYXR0YWNrdHlwZTtcbiAgICAgICAgdmFyIGRhbWFnZVNvdXJjZXMgPSBzZWxmLmludmVudG9yeS5nZXRPcmJQcm9jU291cmNlKCk7XG4gICAgICAgIHZhciBkYW1hZ2VTb3VyY2VzQXJyYXkgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBkYW1hZ2VTb3VyY2VzKSB7XG4gICAgICAgICAgICB2YXIgZWwgPSBkYW1hZ2VTb3VyY2VzW3Byb3BdO1xuICAgICAgICAgICAgZWwubmFtZSA9IHByb3BcbiAgICAgICAgICAgIGRhbWFnZVNvdXJjZXNBcnJheS5wdXNoKGVsKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjb21wYXJlQnlEYW1hZ2UoYSwgYikge1xuICAgICAgICAgICAgaWYgKGEucHJpb3JpdHkgPiBiLnByaW9yaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYS5wcmlvcml0eSA8IGIucHJpb3JpdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYS5kYW1hZ2UgPCBiLmRhbWFnZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIGlmIChhLmRhbWFnZSA+IGIuZGFtYWdlKVxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgZGFtYWdlU291cmNlc0FycmF5LnNvcnQoY29tcGFyZUJ5RGFtYWdlKTtcbiAgICAgICAgXG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgdmFyIGRhbWFnZVRvdGFsID0gMDtcbiAgICAgICAgZm9yICh2YXIgaT0wIDsgaSA8IGRhbWFnZVNvdXJjZXNBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHRvdGFsID0gMTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaTsgaisrKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBkYW1hZ2VTb3VyY2VzQXJyYXlbal0uY291bnQ7IGsrKykge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbCAqPSAoMSAtIGRhbWFnZVNvdXJjZXNBcnJheVtqXS5jaGFuY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB0b3RhbDIgPSAxO1xuICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBkYW1hZ2VTb3VyY2VzQXJyYXlbaV0uY291bnQ7IGsrKykge1xuICAgICAgICAgICAgICAgIHRvdGFsMiAqPSAoMSAtIGRhbWFnZVNvdXJjZXNBcnJheVtpXS5jaGFuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG90YWwgKj0gKDEgLSB0b3RhbDIpO1xuICAgICAgICAgICAgZGFtYWdlVG90YWwgKz0gdG90YWw7XG4gICAgICAgICAgICBpZiAoZGFtYWdlU291cmNlc0FycmF5W2ldLmNvdW50ID4gMSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOmRhbWFnZVNvdXJjZXNBcnJheVtpXS5kaXNwbGF5bmFtZSArICcgeCcgKyBkYW1hZ2VTb3VyY2VzQXJyYXlbaV0uY291bnQsXG4gICAgICAgICAgICAgICAgICAgICdjaGFuY2UnOmRhbWFnZVNvdXJjZXNBcnJheVtpXS5jaGFuY2UsXG4gICAgICAgICAgICAgICAgICAgICdkYW1hZ2UnOmRhbWFnZVNvdXJjZXNBcnJheVtpXS5kYW1hZ2UsXG4gICAgICAgICAgICAgICAgICAgICdjb3VudCc6ZGFtYWdlU291cmNlc0FycmF5W2ldLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6ZGFtYWdlU291cmNlc0FycmF5W2ldLmRhbWFnZVR5cGUsXG4gICAgICAgICAgICAgICAgICAgICd0b3RhbENoYW5jZSc6dG90YWxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOmRhbWFnZVNvdXJjZXNBcnJheVtpXS5kaXNwbGF5bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6ZGFtYWdlU291cmNlc0FycmF5W2ldLmNoYW5jZSxcbiAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6ZGFtYWdlU291cmNlc0FycmF5W2ldLmRhbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzpkYW1hZ2VTb3VyY2VzQXJyYXlbaV0uY291bnQsXG4gICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzpkYW1hZ2VTb3VyY2VzQXJyYXlbaV0uZGFtYWdlVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsQ2hhbmNlJzp0b3RhbFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHNvdXJjZXM6IHJlc3VsdCwgdG90YWw6IGRhbWFnZVRvdGFsIH07XG4gICAgfSk7XG4gICAgXG4gICAgc2VsZi5nZXRSZWR1Y2VkRGFtYWdlID0gZnVuY3Rpb24gKHZhbHVlLCB0eXBlKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB2YWx1ZTtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdwaHlzaWNhbCc6XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWUgKiAoMSAtICgwLjA2ICogc2VsZi5lbmVteSgpLnRvdGFsQXJtb3JQaHlzaWNhbCgpKSAvICgxICsgMC4wNiAqIE1hdGguYWJzKHNlbGYuZW5lbXkoKS50b3RhbEFybW9yUGh5c2ljYWwoKSkpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWFnaWMnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlICogKDEgLSBzZWxmLmVuZW15KCkudG90YWxNYWdpY1Jlc2lzdGFuY2UoKSAvIDEwMCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3B1cmUnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjb21wb3NpdGUnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlICogKDEgLSAoMC4wNiAqIHNlbGYuZW5lbXkoKS50b3RhbEFybW9yUGh5c2ljYWwoKSkgLyAoMSArIDAuMDYgKiBNYXRoLmFicyhzZWxmLmVuZW15KCkudG90YWxBcm1vclBoeXNpY2FsKCkpKSk7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICo9ICgxIC0gc2VsZi5lbmVteSgpLnRvdGFsTWFnaWNSZXNpc3RhbmNlKCkgLyAxMDApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0ICo9IHNlbGYuYWJpbGl0eSgpLmdldERhbWFnZUFtcGxpZmljYXRpb24oKSAqIHNlbGYuZGVidWZmcy5nZXREYW1hZ2VBbXBsaWZpY2F0aW9uKCk7XG4gICAgICAgIHJlc3VsdCAqPSBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldERhbWFnZVJlZHVjdGlvbigpICogc2VsZi5lbmVteSgpLmJ1ZmZzLmdldERhbWFnZVJlZHVjdGlvbigpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBcbiAgICBzZWxmLmRhbWFnZVRvdGFsSW5mbyA9IGtvLnB1cmVDb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBib251c0RhbWFnZUFycmF5ID0gW1xuICAgICAgICAgICAgc2VsZi5hYmlsaXR5KCkuZ2V0Qm9udXNEYW1hZ2UoKS5zb3VyY2VzLFxuICAgICAgICAgICAgc2VsZi5idWZmcy5nZXRCb251c0RhbWFnZSgpLnNvdXJjZXNcbiAgICAgICAgXSxcbiAgICAgICAgYm9udXNEYW1hZ2VQY3RBcnJheSA9IFtcbiAgICAgICAgICAgIHNlbGYuYWJpbGl0eSgpLmdldEJvbnVzRGFtYWdlUGVyY2VudCgpLnNvdXJjZXMsXG4gICAgICAgICAgICBzZWxmLmJ1ZmZzLmdldEJvbnVzRGFtYWdlUGVyY2VudCgpLnNvdXJjZXNcbiAgICAgICAgXSxcbiAgICAgICAgaXRlbUJvbnVzRGFtYWdlID0gc2VsZi5pbnZlbnRvcnkuZ2V0Qm9udXNEYW1hZ2UoKS5zb3VyY2VzLFxuICAgICAgICBpdGVtQm9udXNEYW1hZ2VQY3QgPSBzZWxmLmJ1ZmZzLml0ZW1CdWZmcy5nZXRCb251c0RhbWFnZVBlcmNlbnQoc2VsZi5pbnZlbnRvcnkuZ2V0Qm9udXNEYW1hZ2VQZXJjZW50KCkpLnNvdXJjZXMsXG4gICAgICAgIGNyaXRTb3VyY2VzID0gc2VsZi5jcml0SW5mbygpLFxuICAgICAgICBhYmlsaXR5T3JiU291cmNlcyA9IHNlbGYuYWJpbGl0eSgpLmdldE9yYlNvdXJjZSgpLFxuICAgICAgICBpdGVtT3JiU291cmNlcyA9IHNlbGYuaW52ZW50b3J5LmdldE9yYlNvdXJjZSgpLFxuICAgICAgICBpdGVtUHJvY09yYlNvdXJjZXMgPSBzZWxmLm9yYlByb2NJbmZvKCksXG4gICAgICAgIGJhc2hTb3VyY2VzID0gc2VsZi5iYXNoSW5mbygpLFxuICAgICAgICBcbiAgICAgICAgYXR0YWNrU291cmNlcyA9IFtdO1xuICAgICAgICBcbiAgICAgICAgYXR0YWNrU291cmNlcy5wdXNoKHtcbiAgICAgICAgICAgIG5hbWU6ICdCYXNlIEF0dGFjaycsXG4gICAgICAgICAgICBjb29sZG93bjogMVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIHdlYXZlcl9nZW1pbmF0ZV9hdHRhY2tcbiAgICAgICAgaWYgKHNlbGYuaGVyb0lkKCkgPT09ICd3ZWF2ZXInKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHNlbGYuYWJpbGl0eSgpLmFiaWxpdGllcy5maW5kKGZ1bmN0aW9uIChhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxpdHkubmFtZSA9PT0gJ3dlYXZlcl9nZW1pbmF0ZV9hdHRhY2snO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoYSkge1xuICAgICAgICAgICAgICAgIGlmIChhLmxldmVsKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjZCA9IGEuY29vbGRvd25bYS5sZXZlbCgpIC0gMV07XG4gICAgICAgICAgICAgICAgICAgIGF0dGFja1NvdXJjZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBhLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29vbGRvd246ICgxL2NkKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIGVjaG9fc2FicmVcbiAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLmludmVudG9yeS5pdGVtcygpLmZpbmQoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uaXRlbSA9PT0gXCJlY2hvX3NhYnJlXCIgJiYgby5lbmFibGVkKCk7IH0pO1xuICAgICAgICBpZiAoaXRlbSAmJiBzZWxmLmhlcm9EYXRhKCkuYXR0YWNrdHlwZSA9PT0gJ0RPVEFfVU5JVF9DQVBfTUVMRUVfQVRUQUNLJykge1xuICAgICAgICAgICAgdmFyIGl0ZW1fZWNob19zYWJyZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV9lY2hvX3NhYnJlJ107XG4gICAgICAgICAgICBhdHRhY2tTb3VyY2VzLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6IGl0ZW1fZWNob19zYWJyZS5kaXNwbGF5bmFtZSxcbiAgICAgICAgICAgICAgICBjb29sZG93bjogKDEvaXRlbV9lY2hvX3NhYnJlLmNvb2xkb3duKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYXR0YWNrcyA9IGF0dGFja1NvdXJjZXMubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICB2YXIgYmFzZURhbWFnZSA9IChzZWxmLmJhc2VEYW1hZ2UoKVswXSArIHNlbGYuYmFzZURhbWFnZSgpWzFdKSAvIDIsXG4gICAgICAgICAgICB0b3RhbERhbWFnZSA9IDAsXG4gICAgICAgICAgICB0b3RhbENyaXRhYmxlRGFtYWdlID0gMCxcbiAgICAgICAgICAgIHRvdGFsQ3JpdCA9IDAsXG4gICAgICAgICAgICBnZW1pbmF0ZUF0dGFjayA9IHsgZGFtYWdlOiAwLCBkYW1hZ2VSZWR1Y2VkOiAwLCBjb29sZG93bjogNiwgYWN0aXZlOiBmYWxzZSB9LFxuICAgICAgICAgICAgZWNob1NhYnJlQXR0YWNrID0geyBkYW1hZ2U6IDAsIGRhbWFnZVJlZHVjZWQ6IDAsIGNvb2xkb3duOiBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fZWNob19zYWJyZSddLmNvb2xkb3duWzBdLCBhY3RpdmU6IGZhbHNlIH0sXG4gICAgICAgICAgICBkYW1hZ2UgPSB7XG4gICAgICAgICAgICAgICAgcHVyZTogMCxcbiAgICAgICAgICAgICAgICBwaHlzaWNhbDogMCxcbiAgICAgICAgICAgICAgICBtYWdpYzogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc3VsdCA9IFtdLFxuICAgICAgICAgICAgY3JpdHMgPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gYmFzZSBkYW1hZ2VcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnQmFzZSBEYW1hZ2UnLFxuICAgICAgICAgICAgICAgIGRhbWFnZTogYmFzZURhbWFnZSxcbiAgICAgICAgICAgICAgICBkYW1hZ2VUeXBlOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgIGRhbWFnZVJlZHVjZWQ6IHNlbGYuZ2V0UmVkdWNlZERhbWFnZShiYXNlRGFtYWdlLCAncGh5c2ljYWwnKSxcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRvdGFsRGFtYWdlICs9IGJhc2VEYW1hZ2U7XG4gICAgICAgICAgICB0b3RhbENyaXRhYmxlRGFtYWdlICs9IGJhc2VEYW1hZ2U7XG4gICAgICAgICAgICBkYW1hZ2UucGh5c2ljYWwgKz0gYmFzZURhbWFnZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gYm9udXMgZGFtYWdlIGZyb20gaXRlbXNcbiAgICAgICAgICAgIGZvciAoaSBpbiBpdGVtQm9udXNEYW1hZ2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGl0ZW1Cb251c0RhbWFnZVtpXS5kYW1hZ2UqaXRlbUJvbnVzRGFtYWdlW2ldLmNvdW50ICogc2VsZi5hYmlsaXR5KCkuZ2V0U2VsZkJhc2VEYW1hZ2VSZWR1Y3Rpb25QY3QoKSAqIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0QmFzZURhbWFnZVJlZHVjdGlvblBjdCgpICogc2VsZi5kZWJ1ZmZzLml0ZW1CdWZmcy5nZXRCYXNlRGFtYWdlUmVkdWN0aW9uUGN0KCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBpdGVtQm9udXNEYW1hZ2VbaV0uZGlzcGxheW5hbWUgKyAoaXRlbUJvbnVzRGFtYWdlW2ldLmNvdW50ID4gMSA/ICcgeCcgKyBpdGVtQm9udXNEYW1hZ2VbaV0uY291bnQgOiAnJyksXG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZTogZCxcbiAgICAgICAgICAgICAgICAgICAgZGFtYWdlVHlwZTogaXRlbUJvbnVzRGFtYWdlW2ldLmRhbWFnZVR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVJlZHVjZWQ6IHNlbGYuZ2V0UmVkdWNlZERhbWFnZShkLCBpdGVtQm9udXNEYW1hZ2VbaV0uZGFtYWdlVHlwZSksXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0b3RhbERhbWFnZSArPSBkO1xuICAgICAgICAgICAgICAgIHRvdGFsQ3JpdGFibGVEYW1hZ2UgKz0gZDtcbiAgICAgICAgICAgICAgICBkYW1hZ2VbaXRlbUJvbnVzRGFtYWdlW2ldLmRhbWFnZVR5cGVdICs9IGQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGJvbnVzIGRhbWFnZSBwZXJjZW50IGZyb20gaXRlbXNcbiAgICAgICAgICAgIGZvciAoaSBpbiBpdGVtQm9udXNEYW1hZ2VQY3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGJhc2VEYW1hZ2UgKiBpdGVtQm9udXNEYW1hZ2VQY3RbaV0uZGFtYWdlO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbUJvbnVzRGFtYWdlUGN0W2ldLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2U6IGQsXG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVR5cGU6IGl0ZW1Cb251c0RhbWFnZVBjdFtpXS5kYW1hZ2VUeXBlLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2VSZWR1Y2VkOiBzZWxmLmdldFJlZHVjZWREYW1hZ2UoZCwgaXRlbUJvbnVzRGFtYWdlUGN0W2ldLmRhbWFnZVR5cGUpLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdG90YWxEYW1hZ2UgKz0gZDtcbiAgICAgICAgICAgICAgICB0b3RhbENyaXRhYmxlRGFtYWdlICs9IGQ7XG4gICAgICAgICAgICAgICAgZGFtYWdlW2l0ZW1Cb251c0RhbWFnZVBjdFtpXS5kYW1hZ2VUeXBlXSArPSBkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBib251cyBkYW1hZ2UgZnJvbSBhYmlsaXRpZXMgYW5kIGJ1ZmZzXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJvbnVzRGFtYWdlQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKGogaW4gYm9udXNEYW1hZ2VBcnJheVtpXSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGJvbnVzRGFtYWdlQXJyYXlbaV1bal0uZGFtYWdlO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBib251c0RhbWFnZUFycmF5W2ldW2pdLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlOiBkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlVHlwZTogYm9udXNEYW1hZ2VBcnJheVtpXVtqXS5kYW1hZ2VUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlUmVkdWNlZDogc2VsZi5nZXRSZWR1Y2VkRGFtYWdlKGQsIGJvbnVzRGFtYWdlQXJyYXlbaV1bal0uZGFtYWdlVHlwZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbERhbWFnZSArPSBkO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbENyaXRhYmxlRGFtYWdlICs9IGQ7XG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVtib251c0RhbWFnZUFycmF5W2ldW2pdLmRhbWFnZVR5cGVdICs9IGQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBib251cyBkYW1hZ2UgcGVyY2VudCBmcm9tIGFiaWxpdGllcyBhbmQgYnVmZnNcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm9udXNEYW1hZ2VQY3RBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGZvciAoaiBpbiBib251c0RhbWFnZVBjdEFycmF5W2ldKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gYmFzZURhbWFnZSAqIGJvbnVzRGFtYWdlUGN0QXJyYXlbaV1bal0uZGFtYWdlO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBib251c0RhbWFnZVBjdEFycmF5W2ldW2pdLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlOiBkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlVHlwZTogYm9udXNEYW1hZ2VQY3RBcnJheVtpXVtqXS5kYW1hZ2VUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlUmVkdWNlZDogc2VsZi5nZXRSZWR1Y2VkRGFtYWdlKGQsIGJvbnVzRGFtYWdlUGN0QXJyYXlbaV1bal0uZGFtYWdlVHlwZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbERhbWFnZSArPSBkO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbENyaXRhYmxlRGFtYWdlICs9IGQ7XG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVtib251c0RhbWFnZVBjdEFycmF5W2ldW2pdLmRhbWFnZVR5cGVdICs9IGQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZHJvd19yYW5nZXJfdHJ1ZXNob3RcbiAgICAgICAgICAgIGlmIChzZWxmLmhlcm9EYXRhKCkuYXR0YWNrdHlwZSA9PT0gJ0RPVEFfVU5JVF9DQVBfUkFOR0VEX0FUVEFDSycpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5oZXJvSWQoKSA9PT0gJ2Ryb3dfcmFuZ2VyJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IHNlbGYuYWJpbGl0eSgpLmdldEJvbnVzRGFtYWdlUHJlY2lzaW9uQXVyYSgpLnNvdXJjZXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IHNlbGYuYnVmZnMuZ2V0Qm9udXNEYW1hZ2VQcmVjaXNpb25BdXJhKCkuc291cmNlcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNbaW5kZXhdICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5oZXJvSWQoKSA9PT0gJ2Ryb3dfcmFuZ2VyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBzW2luZGV4XS5kYW1hZ2UgKiBzZWxmLnRvdGFsQWdpKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHNbaW5kZXhdLmRhbWFnZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzW2luZGV4XS5kaXNwbGF5bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZTogZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZVR5cGU6ICdwaHlzaWNhbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYW1hZ2VSZWR1Y2VkOiBzZWxmLmdldFJlZHVjZWREYW1hZ2UoZCwgJ3BoeXNpY2FsJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbERhbWFnZSArPSBkO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbENyaXRhYmxlRGFtYWdlICs9IGQ7XG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZS5waHlzaWNhbCArPSBkOyAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyByaWtpX2JhY2tzdGFiXG4gICAgICAgICAgICBpZiAoc2VsZi5oZXJvSWQoKSA9PT0gJ3Jpa2knKSB7XG4gICAgICAgICAgICAgICAgdmFyIHMgPSBzZWxmLmFiaWxpdHkoKS5nZXRCb251c0RhbWFnZUJhY2tzdGFiKCkuc291cmNlcztcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHMgPSBzZWxmLmJ1ZmZzLmdldEJvbnVzRGFtYWdlQmFja3N0YWIoKS5zb3VyY2VzO1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc1tpbmRleF0gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuaGVyb0lkKCkgPT09ICdyaWtpJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHNbaW5kZXhdLmRhbWFnZSAqIHNlbGYudG90YWxBZ2koKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gc1tpbmRleF0uZGFtYWdlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHNbaW5kZXhdLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2U6IGQsXG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVR5cGU6ICdwaHlzaWNhbCcsXG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVJlZHVjZWQ6IHNlbGYuZ2V0UmVkdWNlZERhbWFnZShkLCAncGh5c2ljYWwnKSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDoga28ub2JzZXJ2YWJsZSh0cnVlKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRvdGFsRGFtYWdlICs9IGQ7XG4gICAgICAgICAgICAgICAgLy90b3RhbENyaXRhYmxlRGFtYWdlICs9IGQ7XG4gICAgICAgICAgICAgICAgZGFtYWdlLnBoeXNpY2FsICs9IGQ7ICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYmFzaCBkYW1hZ2VcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmFzaFNvdXJjZXMuc291cmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBvID0gYmFzaFNvdXJjZXMuc291cmNlc1tpXTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGJhc2hTb3VyY2VzLnNvdXJjZXNbaV0uZGFtYWdlO1xuICAgICAgICAgICAgICAgIHZhciBjZCA9IHNlbGYuYXR0YWNrc1BlclNlY29uZCgpO1xuICAgICAgICAgICAgICAgIGlmIChvLmNvb2xkb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIGNkID0gTWF0aC5tYXgoMS9vLmNvb2xkb3duLCBjZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYmFzaFNvdXJjZXMuc291cmNlc1tpXS5jb3VudDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGJhc2hTb3VyY2VzLnNvdXJjZXNbaV0ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZTogZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZVR5cGU6IGJhc2hTb3VyY2VzLnNvdXJjZXNbaV0uZGFtYWdlVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZVJlZHVjZWQ6IHNlbGYuZ2V0UmVkdWNlZERhbWFnZShkLCBiYXNoU291cmNlcy5zb3VyY2VzW2ldLmRhbWFnZVR5cGUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHBzOiBkICogY2QgKiBiYXNoU291cmNlcy5zb3VyY2VzW2ldLmNoYW5jZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRwc1JlZHVjZWQ6IHNlbGYuZ2V0UmVkdWNlZERhbWFnZShkLCBiYXNoU291cmNlcy5zb3VyY2VzW2ldLmRhbWFnZVR5cGUpICogY2QgKiBiYXNoU291cmNlcy5zb3VyY2VzW2ldLmNoYW5jZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsRGFtYWdlICs9IGQ7XG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVtiYXNoU291cmNlcy5zb3VyY2VzW2ldLmRhbWFnZVR5cGVdICs9IGQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vICUtYmFzZWQgb3Jic1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtUHJvY09yYlNvdXJjZXMuc291cmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gaXRlbVByb2NPcmJTb3VyY2VzLnNvdXJjZXNbaV0uZGFtYWdlICogKDEgLSBNYXRoLnBvdygxIC0gaXRlbVByb2NPcmJTb3VyY2VzLnNvdXJjZXNbaV0uY2hhbmNlLCBpdGVtUHJvY09yYlNvdXJjZXMuc291cmNlc1tpXS5jb3VudCkpO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbVByb2NPcmJTb3VyY2VzLnNvdXJjZXNbaV0ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGFtYWdlOiBkLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2VUeXBlOiBpdGVtUHJvY09yYlNvdXJjZXMuc291cmNlc1tpXS5kYW1hZ2VUeXBlLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2VSZWR1Y2VkOiBzZWxmLmdldFJlZHVjZWREYW1hZ2UoZCwgaXRlbVByb2NPcmJTb3VyY2VzLnNvdXJjZXNbaV0uZGFtYWdlVHlwZSksXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0b3RhbERhbWFnZSArPSBkO1xuICAgICAgICAgICAgICAgIGRhbWFnZVtpdGVtUHJvY09yYlNvdXJjZXMuc291cmNlc1tpXS5kYW1hZ2VUeXBlXSArPSBkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBhYmlsaXR5IG9yYnNcbiAgICAgICAgICAgIGZvciAodmFyIG9yYiBpbiBhYmlsaXR5T3JiU291cmNlcykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gYWJpbGl0eU9yYlNvdXJjZXNbb3JiXS5kYW1hZ2UgKiAoMSAtIGl0ZW1Qcm9jT3JiU291cmNlcy50b3RhbCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBhYmlsaXR5T3JiU291cmNlc1tvcmJdLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2U6IGQsXG4gICAgICAgICAgICAgICAgICAgIGRhbWFnZVR5cGU6IGFiaWxpdHlPcmJTb3VyY2VzW29yYl0uZGFtYWdlVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGFtYWdlUmVkdWNlZDogc2VsZi5nZXRSZWR1Y2VkRGFtYWdlKGQsIGFiaWxpdHlPcmJTb3VyY2VzW29yYl0uZGFtYWdlVHlwZSksXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0b3RhbERhbWFnZSArPSBkO1xuICAgICAgICAgICAgICAgIGRhbWFnZVthYmlsaXR5T3JiU291cmNlc1tvcmJdLmRhbWFnZVR5cGVdICs9IGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGl0ZW0gb3Jic1xuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGFiaWxpdHlPcmJTb3VyY2VzKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBvcmIgaW4gaXRlbU9yYlNvdXJjZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBpdGVtT3JiU291cmNlc1tvcmJdLmRhbWFnZSAqICgxIC0gaXRlbVByb2NPcmJTb3VyY2VzLnRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbU9yYlNvdXJjZXNbb3JiXS5kaXNwbGF5bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZTogZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZVR5cGU6IGl0ZW1PcmJTb3VyY2VzW29yYl0uZGFtYWdlVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZVJlZHVjZWQ6IHNlbGYuZ2V0UmVkdWNlZERhbWFnZShkLCBpdGVtT3JiU291cmNlc1tvcmJdLmRhbWFnZVR5cGUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDoga28ub2JzZXJ2YWJsZSh0cnVlKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxEYW1hZ2UgKz0gZDtcbiAgICAgICAgICAgICAgICAgICAgZGFtYWdlW2l0ZW1PcmJTb3VyY2VzW29yYl0uZGFtYWdlVHlwZV0gKz0gZDtcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGNyaXQgZGFtYWdlXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNyaXRTb3VyY2VzLnNvdXJjZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IHRvdGFsQ3JpdGFibGVEYW1hZ2UgKiAoY3JpdFNvdXJjZXMuc291cmNlc1tpXS5tdWx0aXBsaWVyIC0gMSk7Ly8gKiBjcml0U291cmNlcy5zb3VyY2VzW2ldLnRvdGFsQ2hhbmNlO1xuICAgICAgICAgICAgICAgIGNyaXRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBjcml0U291cmNlcy5zb3VyY2VzW2ldLm5hbWUgKyAnLCAnICsgY3JpdFNvdXJjZXMuc291cmNlc1tpXS5tdWx0aXBsaWVyICsgJ3gsICcgKyAoY3JpdFNvdXJjZXMuc291cmNlc1tpXS50b3RhbENoYW5jZSAqIDEwMCkudG9GaXhlZCgxKSArICclJyxcbiAgICAgICAgICAgICAgICAgICAgZGFtYWdlOiBkLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2VUeXBlOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICBkYW1hZ2VSZWR1Y2VkOiBzZWxmLmdldFJlZHVjZWREYW1hZ2UoZCwgJ3BoeXNpY2FsJyksXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSksXG4gICAgICAgICAgICAgICAgICAgIGNoYW5jZTogY3JpdFNvdXJjZXMuc291cmNlc1tpXS50b3RhbENoYW5jZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRvdGFsQ3JpdCArPSBkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdG90YWxSZWR1Y2VkID0gc2VsZi5nZXRSZWR1Y2VkRGFtYWdlKGRhbWFnZS5wdXJlLCAncHVyZScpIFxuICAgICAgICAgICAgICAgICAgICArIHNlbGYuZ2V0UmVkdWNlZERhbWFnZShkYW1hZ2UucGh5c2ljYWwsICdwaHlzaWNhbCcpXG4gICAgICAgICAgICAgICAgICAgICsgc2VsZi5nZXRSZWR1Y2VkRGFtYWdlKGRhbWFnZS5tYWdpYywgJ21hZ2ljJyksXG4gICAgICAgICAgICAgICAgdG90YWxDcml0UmVkdWNlZCA9IHNlbGYuZ2V0UmVkdWNlZERhbWFnZSh0b3RhbENyaXQsICdwaHlzaWNhbCcpLFxuICAgICAgICAgICAgICAgIGRwcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZTogdG90YWxEYW1hZ2UgKiBzZWxmLmF0dGFja3NQZXJTZWNvbmQoKSxcbiAgICAgICAgICAgICAgICAgICAgY3JpdDogdG90YWxDcml0ICogc2VsZi5hdHRhY2tzUGVyU2Vjb25kKCksXG4gICAgICAgICAgICAgICAgICAgIGdlbWluYXRlQXR0YWNrOiBnZW1pbmF0ZUF0dGFjay5hY3RpdmUgPyBnZW1pbmF0ZUF0dGFjay5kYW1hZ2UgLyBnZW1pbmF0ZUF0dGFjay5jb29sZG93biA6IDAsXG4gICAgICAgICAgICAgICAgICAgIHJlZHVjZWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U6IHRvdGFsUmVkdWNlZCAqIHNlbGYuYXR0YWNrc1BlclNlY29uZCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JpdDogdG90YWxDcml0UmVkdWNlZCAqIHNlbGYuYXR0YWNrc1BlclNlY29uZCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2VtaW5hdGVBdHRhY2s6IGdlbWluYXRlQXR0YWNrLmFjdGl2ZSA/IHNlbGYuZ2V0UmVkdWNlZERhbWFnZShnZW1pbmF0ZUF0dGFjay5kYW1hZ2UsICdwaHlzaWNhbCcpIC8gZ2VtaW5hdGVBdHRhY2suY29vbGRvd24gOiAwLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgY3JpdHMuZm9yRWFjaChmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgIGlmICghby5kcHMpIHtcbiAgICAgICAgICAgICAgICAgICAgby5kcHMgPSBvLmRhbWFnZSAqIChvLmNvb2xkb3duIHx8IHNlbGYuYXR0YWNrc1BlclNlY29uZCgpKSAqIG8uY2hhbmNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIW8uZHBzUmVkdWNlZCkge1xuICAgICAgICAgICAgICAgICAgICBvLmRwc1JlZHVjZWQgPSBvLmRhbWFnZVJlZHVjZWQgKiAoby5jb29sZG93biB8fCBzZWxmLmF0dGFja3NQZXJTZWNvbmQoKSkgKiBvLmNoYW5jZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc3VsdC5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFvLmRwcykge1xuICAgICAgICAgICAgICAgICAgICBvLmRwcyA9IG8uZGFtYWdlICogKG8uY29vbGRvd24gfHwgc2VsZi5hdHRhY2tzUGVyU2Vjb25kKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIW8uZHBzUmVkdWNlZCkge1xuICAgICAgICAgICAgICAgICAgICBvLmRwc1JlZHVjZWQgPSBvLmRhbWFnZVJlZHVjZWQgKiAoby5jb29sZG93biB8fCBzZWxmLmF0dGFja3NQZXJTZWNvbmQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciB0b3RhbENyaXRDaGFuY2UgPSBjcml0cy5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLmNoYW5jZSB9LCAwKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciB0MUNyaXQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBjcml0cy5maW5kKGZ1bmN0aW9uIChvKSB7IHJldHVybiBvLmVuYWJsZWQoKTsgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMgPyBjLmRhbWFnZSA6IDA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciB0MkNyaXQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBjcml0cy5maW5kKGZ1bmN0aW9uIChvKSB7IHJldHVybiBvLmVuYWJsZWQoKTsgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMgPyBjLmRhbWFnZVJlZHVjZWQgOiAwO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgdDNDcml0ID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjcml0cy5maWx0ZXIoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uZW5hYmxlZCgpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLmRwcyB9LCAwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHQ0Q3JpdCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JpdHMuZmlsdGVyKGZ1bmN0aW9uIChvKSB7IHJldHVybiBvLmVuYWJsZWQoKTsgfSkucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBvKSB7IHJldHVybiBtZW1vICsgby5kcHNSZWR1Y2VkIH0sIDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgdDEgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5maWx0ZXIoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uZW5hYmxlZCgpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLmRhbWFnZSB9LCAwKSArIHQxQ3JpdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgdDIgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5maWx0ZXIoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uZW5hYmxlZCgpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLmRhbWFnZVJlZHVjZWQgfSwgMCkgKyB0MkNyaXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHQzID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAocmVzdWx0LmZpbHRlcihmdW5jdGlvbiAobykgeyByZXR1cm4gby5lbmFibGVkKCk7IH0pLnJlZHVjZShmdW5jdGlvbiAobWVtbywgbykgeyByZXR1cm4gbWVtbyArIG8uZHBzIH0sIDApICsgdDNDcml0KCkpICogYS5jb29sZG93bjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHQ0ID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAocmVzdWx0LmZpbHRlcihmdW5jdGlvbiAobykgeyByZXR1cm4gby5lbmFibGVkKCk7IH0pLnJlZHVjZShmdW5jdGlvbiAobWVtbywgbykgeyByZXR1cm4gbWVtbyArIG8uZHBzUmVkdWNlZCB9LCAwKSArIHQ0Q3JpdCgpKSAqIGEuY29vbGRvd247XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHRvdGFsQ3JpdFJvdyA9IFt0MUNyaXQsIHQyQ3JpdCwgdDNDcml0LCB0NENyaXRdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgdG90YWxSb3cgPSBbdDEsIHQyLCB0MywgdDRdO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IGEubmFtZSArICcgU3VidG90YWwnLFxuICAgICAgICAgICAgICAgIGNvb2xkb3duOiBhLmNvb2xkb3duLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSksXG4gICAgICAgICAgICAgICAgdmlzaWJsZToga28ub2JzZXJ2YWJsZSh0cnVlKSxcbiAgICAgICAgICAgICAgICB0b3RhbENyaXRDaGFuY2U6IHRvdGFsQ3JpdENoYW5jZSxcbiAgICAgICAgICAgICAgICB0b3RhbENyaXRSb3c6IHRvdGFsQ3JpdFJvdyxcbiAgICAgICAgICAgICAgICB0b3RhbFJvdzogdG90YWxSb3csXG4gICAgICAgICAgICAgICAgc291cmNlczogcmVzdWx0LFxuICAgICAgICAgICAgICAgIHNvdXJjZXNDcml0OiBjcml0cyxcbiAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxEYW1hZ2UsXG4gICAgICAgICAgICAgICAgdG90YWxDcml0OiB0b3RhbENyaXQsXG4gICAgICAgICAgICAgICAgdG90YWxHZW1pbmF0ZUF0dGFjazogdG90YWxEYW1hZ2UgKyBnZW1pbmF0ZUF0dGFjay5kYW1hZ2UsXG4gICAgICAgICAgICAgICAgdG90YWxHZW1pbmF0ZUF0dGFja1JlZHVjZWQ6IHRvdGFsUmVkdWNlZCArIGdlbWluYXRlQXR0YWNrLmRhbWFnZVJlZHVjZWQsXG4gICAgICAgICAgICAgICAgZ2VtaW5hdGVBdHRhY2s6IGdlbWluYXRlQXR0YWNrLFxuICAgICAgICAgICAgICAgIHRvdGFsQ3JpdFJlZHVjZWQ6IHRvdGFsQ3JpdFJlZHVjZWQsXG4gICAgICAgICAgICAgICAgdG90YWxSZWR1Y2VkOiB0b3RhbFJlZHVjZWQsXG4gICAgICAgICAgICAgICAgc3VtVG90YWw6IHRvdGFsRGFtYWdlICsgdG90YWxDcml0LFxuICAgICAgICAgICAgICAgIHN1bVRvdGFsUmVkdWNlZDogdG90YWxSZWR1Y2VkICsgdG90YWxDcml0UmVkdWNlZCxcbiAgICAgICAgICAgICAgICBkcHM6IHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZTogZHBzLmJhc2UsXG4gICAgICAgICAgICAgICAgICAgIGNyaXQ6IGRwcy5iYXNlICsgZHBzLmNyaXQsXG4gICAgICAgICAgICAgICAgICAgIGdlbWluYXRlQXR0YWNrOiBkcHMuYmFzZSArIGRwcy5nZW1pbmF0ZUF0dGFjayxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IGRwcy5iYXNlICsgZHBzLmNyaXQgKyBkcHMuZ2VtaW5hdGVBdHRhY2ssXG4gICAgICAgICAgICAgICAgICAgIHJlZHVjZWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U6IGRwcy5yZWR1Y2VkLmJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjcml0OiBkcHMucmVkdWNlZC5iYXNlICsgZHBzLnJlZHVjZWQuY3JpdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlbWluYXRlQXR0YWNrOiBkcHMucmVkdWNlZC5iYXNlICsgZHBzLnJlZHVjZWQuZ2VtaW5hdGVBdHRhY2ssXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZHBzLnJlZHVjZWQuYmFzZSArIGRwcy5yZWR1Y2VkLmNyaXQgKyBkcHMucmVkdWNlZC5nZW1pbmF0ZUF0dGFja1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgdDEgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXR0YWNrcy5maWx0ZXIoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uZW5hYmxlZCgpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLnRvdGFsUm93WzBdKCkgfSwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdDIgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXR0YWNrcy5maWx0ZXIoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uZW5hYmxlZCgpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLnRvdGFsUm93WzFdKCkgfSwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdDMgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXR0YWNrcy5maWx0ZXIoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uZW5hYmxlZCgpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLnRvdGFsUm93WzJdKCkgfSwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdDQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXR0YWNrcy5maWx0ZXIoZnVuY3Rpb24gKG8pIHsgcmV0dXJuIG8uZW5hYmxlZCgpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIG8pIHsgcmV0dXJuIG1lbW8gKyBvLnRvdGFsUm93WzNdKCkgfSwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhdHRhY2tzOiBhdHRhY2tzLFxuICAgICAgICAgICAgdG90YWxSb3c6IFt0MSwgdDIsIHQzLCB0NF1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0RGFtYWdlVHlwZUNvbG9yID0gZnVuY3Rpb24gKGRhbWFnZVR5cGUpIHtcbiAgICAgICAgcmV0dXJuIG15LnByb3RvdHlwZS5EYW1hZ2VUeXBlQ29sb3JbZGFtYWdlVHlwZV0gfHwgbXkucHJvdG90eXBlLkRhbWFnZVR5cGVDb2xvclsnZGVmYXVsdCddO1xuICAgIH1cbiAgICBcbn0iLCIndXNlIHN0cmljdCc7XG52YXIga28gPSByZXF1aXJlKCcuL2hlcm9jYWxjX2tub2Nrb3V0Jyk7XG52YXIgbXkgPSByZXF1aXJlKFwiLi9oZXJvY2FsY19jb3JlXCIpO1xuXG5teS5wcm90b3R5cGUuc3RhY2thYmxlSXRlbXMgPSBbJ2NsYXJpdHknLCdmbGFzaycsJ2R1c3QnLCd3YXJkX29ic2VydmVyJywnd2FyZF9zZW50cnknLCd0YW5nbycsJ3Rwc2Nyb2xsJywnc21va2Vfb2ZfZGVjZWl0J10sXG5teS5wcm90b3R5cGUubGV2ZWxpdGVtcyA9IFsnbmVjcm9ub21pY29uJywnZGFnb24nLCdkaWZmdXNhbF9ibGFkZScsJ3RyYXZlbF9ib290cyddLFxubXkucHJvdG90eXBlLnZhbGlkSXRlbXMgPSBbXCJhYnlzc2FsX2JsYWRlXCIsXCJ1bHRpbWF0ZV9zY2VwdGVyXCIsXCJjb3VyaWVyXCIsXCJhcmNhbmVfYm9vdHNcIixcImFybWxldFwiLFwiYXNzYXVsdFwiLFwiYm9vdHNfb2ZfZWx2ZXNcIixcImJmdXJ5XCIsXCJiZWx0X29mX3N0cmVuZ3RoXCIsXCJibGFja19raW5nX2JhclwiLFwiYmxhZGVfbWFpbFwiLFwiYmxhZGVfb2ZfYWxhY3JpdHlcIixcImJsYWRlc19vZl9hdHRhY2tcIixcImJsaW5rXCIsXCJibG9vZHN0b25lXCIsXCJib290c1wiLFwidHJhdmVsX2Jvb3RzXCIsXCJib3R0bGVcIixcImJyYWNlclwiLFwiYnJvYWRzd29yZFwiLFwiYnVja2xlclwiLFwiYnV0dGVyZmx5XCIsXCJjaGFpbm1haWxcIixcImNpcmNsZXRcIixcImNsYXJpdHlcIixcImNsYXltb3JlXCIsXCJjbG9ha1wiLFwibGVzc2VyX2NyaXRcIixcImdyZWF0ZXJfY3JpdFwiLFwiZGFnb25cIixcImRlbW9uX2VkZ2VcIixcImRlc29sYXRvclwiLFwiZGlmZnVzYWxfYmxhZGVcIixcInJhcGllclwiLFwiYW5jaWVudF9qYW5nZ29cIixcImR1c3RcIixcImVhZ2xlXCIsXCJlbmVyZ3lfYm9vc3RlclwiLFwiZXRoZXJlYWxfYmxhZGVcIixcImN5Y2xvbmVcIixcInNrYWRpXCIsXCJmbHlpbmdfY291cmllclwiLFwiZm9yY2Vfc3RhZmZcIixcImdhdW50bGV0c1wiLFwiZ2VtXCIsXCJnaG9zdFwiLFwiZ2xvdmVzXCIsXCJoYW5kX29mX21pZGFzXCIsXCJoZWFkZHJlc3NcIixcImZsYXNrXCIsXCJoZWFydFwiLFwiaGVhdmVuc19oYWxiZXJkXCIsXCJoZWxtX29mX2lyb25fd2lsbFwiLFwiaGVsbV9vZl90aGVfZG9taW5hdG9yXCIsXCJob29kX29mX2RlZmlhbmNlXCIsXCJoeXBlcnN0b25lXCIsXCJicmFuY2hlc1wiLFwiamF2ZWxpblwiLFwic3BoZXJlXCIsXCJtYWVsc3Ryb21cIixcIm1hZ2ljX3N0aWNrXCIsXCJtYWdpY193YW5kXCIsXCJtYW50YVwiLFwibWFudGxlXCIsXCJtYXNrX29mX21hZG5lc3NcIixcIm1lZGFsbGlvbl9vZl9jb3VyYWdlXCIsXCJtZWthbnNtXCIsXCJtaXRocmlsX2hhbW1lclwiLFwibWpvbGxuaXJcIixcIm1vbmtleV9raW5nX2JhclwiLFwibGlmZXN0ZWFsXCIsXCJteXN0aWNfc3RhZmZcIixcIm5lY3Jvbm9taWNvblwiLFwibnVsbF90YWxpc21hblwiLFwib2JsaXZpb25fc3RhZmZcIixcIndhcmRfb2JzZXJ2ZXJcIixcIm9ncmVfYXhlXCIsXCJvcmJfb2ZfdmVub21cIixcIm9yY2hpZFwiLFwicGVyc1wiLFwicGhhc2VfYm9vdHNcIixcInBpcGVcIixcInBsYXRlbWFpbFwiLFwicG9pbnRfYm9vc3RlclwiLFwicG9vcl9tYW5zX3NoaWVsZFwiLFwicG93ZXJfdHJlYWRzXCIsXCJxdWFydGVyc3RhZmZcIixcInF1ZWxsaW5nX2JsYWRlXCIsXCJyYWRpYW5jZVwiLFwicmVhdmVyXCIsXCJyZWZyZXNoZXJcIixcInJpbmdfb2ZfYXF1aWxhXCIsXCJyaW5nX29mX2Jhc2lsaXVzXCIsXCJyaW5nX29mX2hlYWx0aFwiLFwicmluZ19vZl9wcm90ZWN0aW9uXCIsXCJyaW5nX29mX3JlZ2VuXCIsXCJyb2JlXCIsXCJyb2Rfb2ZfYXRvc1wiLFwicmVsaWNcIixcInNvYmlfbWFza1wiLFwic2FuZ2VcIixcInNhbmdlX2FuZF95YXNoYVwiLFwic2F0YW5pY1wiLFwic2hlZXBzdGlja1wiLFwid2FyZF9zZW50cnlcIixcInNoYWRvd19hbXVsZXRcIixcImludmlzX3N3b3JkXCIsXCJzaGl2YXNfZ3VhcmRcIixcImJhc2hlclwiLFwic2xpcHBlcnNcIixcInNtb2tlX29mX2RlY2VpdFwiLFwic291bF9ib29zdGVyXCIsXCJzb3VsX3JpbmdcIixcInN0YWZmX29mX3dpemFyZHJ5XCIsXCJzdG91dF9zaGllbGRcIixcInRhbGlzbWFuX29mX2V2YXNpb25cIixcInRhbmdvXCIsXCJ0cHNjcm9sbFwiLFwidHJhbnF1aWxfYm9vdHNcIixcInVsdGltYXRlX29yYlwiLFwidXJuX29mX3NoYWRvd3NcIixcInZhbmd1YXJkXCIsXCJ2ZWlsX29mX2Rpc2NvcmRcIixcInZpdGFsaXR5X2Jvb3N0ZXJcIixcInZsYWRtaXJcIixcInZvaWRfc3RvbmVcIixcIndyYWl0aF9iYW5kXCIsXCJ5YXNoYVwiLFwiY3JpbXNvbl9ndWFyZFwiLFwiZW5jaGFudGVkX21hbmdvXCIsXCJsb3R1c19vcmJcIixcImdsaW1tZXJfY2FwZVwiLFwiZ3VhcmRpYW5fZ3JlYXZlc1wiLFwibW9vbl9zaGFyZFwiLFwic2lsdmVyX2VkZ2VcIixcInNvbGFyX2NyZXN0XCIsXCJvY3RhcmluZV9jb3JlXCIsXCJhZXRoZXJfbGVuc1wiLFwiZmFlcmllX2ZpcmVcIixcImlyb25fdGFsb25cIixcImRyYWdvbl9sYW5jZVwiLFwiZWNob19zYWJyZVwiLFwiaW5mdXNlZF9yYWluZHJvcFwiLFwiYmxpZ2h0X3N0b25lXCIsXCJ3aW5kX2xhY2VcIixcInRvbWVfb2Zfa25vd2xlZGdlXCIsXCJibG9vZHRob3JuXCIsXCJodXJyaWNhbmVfcGlrZVwiXSxcbm15LnByb3RvdHlwZS5pdGVtc1dpdGhBY3RpdmUgPSBbJ2hlYXJ0Jywnc21va2Vfb2ZfZGVjZWl0JywnZHVzdCcsJ2dob3N0JywndHJhbnF1aWxfYm9vdHMnLCdwaGFzZV9ib290cycsJ3Bvd2VyX3RyZWFkcycsJ2J1Y2tsZXInLCdtZWRhbGxpb25fb2ZfY291cmFnZScsJ2FuY2llbnRfamFuZ2dvJywnbWVrYW5zbScsJ3BpcGUnLCd2ZWlsX29mX2Rpc2NvcmQnLCdyb2Rfb2ZfYXRvcycsJ29yY2hpZCcsJ3NoZWVwc3RpY2snLCdhcm1sZXQnLCdpbnZpc19zd29yZCcsJ2V0aGVyZWFsX2JsYWRlJywnc2hpdmFzX2d1YXJkJywnbWFudGEnLCdtYXNrX29mX21hZG5lc3MnLCdkaWZmdXNhbF9ibGFkZScsJ21qb2xsbmlyJywnc2F0YW5pYycsJ3Jpbmdfb2ZfYmFzaWxpdXMnLCdyaW5nX29mX2FxdWlsYScsICdidXR0ZXJmbHknLCAnbW9vbl9zaGFyZCcsICdzaWx2ZXJfZWRnZScsJ2Jsb29kdGhvcm4nXTtcblxubXkucHJvdG90eXBlLkl0ZW1JbnB1dCA9IGZ1bmN0aW9uICh2YWx1ZSwgbmFtZSwgZGVidWZmKSB7XG4gICAgaWYgKG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgdmFsdWVdLkl0ZW1BbGlhc2VzIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgdmFyIGl0ZW1BbGlhcyA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgdmFsdWVdLkl0ZW1BbGlhc2VzLmpvaW4oJyAnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBpdGVtQWxpYXMgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIHZhbHVlXS5JdGVtQWxpYXNlcztcbiAgICB9XG4gICAgdGhpcy52YWx1ZSA9IGtvLm9ic2VydmFibGUodmFsdWUpO1xuICAgIHRoaXMuZGVidWZmID0ga28ub2JzZXJ2YWJsZShkZWJ1ZmYpO1xuICAgIGlmICh0aGlzLmRlYnVmZigpKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBrby5vYnNlcnZhYmxlKHZhbHVlICsgJ3wnICsgZGVidWZmLmlkKTtcbiAgICAgICAgdGhpcy5uYW1lID0ga28ub2JzZXJ2YWJsZShuYW1lICsgJyAoJyArIGRlYnVmZi5uYW1lICsgJyknKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5bmFtZSA9IGtvLm9ic2VydmFibGUobmFtZSArICcgKCcgKyBkZWJ1ZmYubmFtZSArICcpIDxzcGFuIHN0eWxlPVwiZGlzcGxheTpub25lXCI+JyArICc7JyArIGl0ZW1BbGlhcyArICc8L3NwYW4+Jyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnZhbHVlID0ga28ub2JzZXJ2YWJsZSh2YWx1ZSk7XG4gICAgICAgIHRoaXMubmFtZSA9IGtvLm9ic2VydmFibGUobmFtZSk7XG4gICAgICAgIHRoaXMuZGlzcGxheW5hbWUgPSBrby5vYnNlcnZhYmxlKG5hbWUgKyAnIDxzcGFuIHN0eWxlPVwiZGlzcGxheTpub25lXCI+JyArICc7JyArIGl0ZW1BbGlhcyArICc8L3NwYW4+Jyk7XG4gICAgfVxufTtcblxubXkucHJvdG90eXBlLkJhc2ljSW52ZW50b3J5Vmlld01vZGVsID0gZnVuY3Rpb24gKGgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5pdGVtcyA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7XG4gICAgc2VsZi5hY3RpdmVJdGVtcyA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7XG4gICAgc2VsZi5hZGRJdGVtID0gZnVuY3Rpb24gKGRhdGEsIGV2ZW50KSB7XG4gICAgICAgIGlmIChkYXRhLnNlbGVjdGVkSXRlbSgpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdmFyIG5ld19pdGVtID0ge1xuICAgICAgICAgICAgICAgIGl0ZW06IGRhdGEuc2VsZWN0ZWRJdGVtKCkuc3BsaXQoJ3wnKVswXSxcbiAgICAgICAgICAgICAgICBzdGF0ZToga28ub2JzZXJ2YWJsZSgwKSxcbiAgICAgICAgICAgICAgICBzaXplOiBkYXRhLml0ZW1JbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgZW5hYmxlZDoga28ub2JzZXJ2YWJsZSh0cnVlKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3dpdGNoIChuZXdfaXRlbS5pdGVtKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGFnb24nOlxuICAgICAgICAgICAgICAgICAgICBuZXdfaXRlbS5zaXplID0gTWF0aC5taW4obmV3X2l0ZW0uc2l6ZSwgNSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAndHJhdmVsX2Jvb3RzJzpcbiAgICAgICAgICAgICAgICBjYXNlICdkaWZmdXNhbF9ibGFkZSc6XG4gICAgICAgICAgICAgICAgICAgIG5ld19pdGVtLnNpemUgPSBNYXRoLm1pbihuZXdfaXRlbS5zaXplLCAyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICduZWNyb25vbWljb24nOlxuICAgICAgICAgICAgICAgICAgICBuZXdfaXRlbS5zaXplID0gTWF0aC5taW4obmV3X2l0ZW0uc2l6ZSwgMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLml0ZW1zLnB1c2gobmV3X2l0ZW0pO1xuICAgICAgICAgICAgaWYgKGRhdGEuc2VsZWN0ZWRJdGVtKCkgPT09ICdyaW5nX29mX2FxdWlsYScgfHwgZGF0YS5zZWxlY3RlZEl0ZW0oKSA9PT0gJ3Jpbmdfb2ZfYmFzaWxpdXMnIHx8IGRhdGEuc2VsZWN0ZWRJdGVtKCkgPT09ICdoZWFydCcpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnRvZ2dsZUl0ZW0odW5kZWZpbmVkLCBuZXdfaXRlbSwgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgc2VsZi50b2dnbGVJdGVtID0gZnVuY3Rpb24gKGluZGV4LCBkYXRhLCBldmVudCkge1xuICAgICAgICBpZiAobXkucHJvdG90eXBlLml0ZW1zV2l0aEFjdGl2ZS5pbmRleE9mKGRhdGEuaXRlbSkgPj0gMCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihkYXRhKSA8IDApIHtcbiAgICAgICAgICAgICAgICBzZWxmLmFjdGl2ZUl0ZW1zLnB1c2goZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxmLmFjdGl2ZUl0ZW1zLnJlbW92ZShkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAoZGF0YS5pdGVtKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAncG93ZXJfdHJlYWRzJzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdGUoKSA8IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdGUoZGF0YS5zdGF0ZSgpICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXRlKDApO1xuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXRlKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0ZSgxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdGUoMCk7XG4gICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LmJpbmQodGhpcyk7XG4gICAgc2VsZi5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgc2VsZi5hY3RpdmVJdGVtcy5yZW1vdmUoaXRlbSk7XG4gICAgICAgIHNlbGYuaXRlbXMucmVtb3ZlKGl0ZW0pO1xuICAgIH0uYmluZCh0aGlzKTtcbiAgICBzZWxmLnRvZ2dsZU11dGVJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgaXRlbS5lbmFibGVkKCFpdGVtLmVuYWJsZWQoKSk7XG4gICAgfS5iaW5kKHRoaXMpOyAgICAgIFxuICAgIHNlbGYucmVtb3ZlQWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmFjdGl2ZUl0ZW1zLnJlbW92ZUFsbCgpO1xuICAgICAgICBzZWxmLml0ZW1zLnJlbW92ZUFsbCgpO1xuICAgIH0uYmluZCh0aGlzKTtcbn1cbm15LnByb3RvdHlwZS5CYXNpY0ludmVudG9yeVZpZXdNb2RlbC5wcm90b3R5cGUuZ2V0SXRlbUltYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB2YXIgc3RhdGUgPSBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKGRhdGEuc3RhdGUpO1xuICAgIHN3aXRjaCAoZGF0YS5pdGVtKSB7XG4gICAgICAgIGNhc2UgJ3Bvd2VyX3RyZWFkcyc6XG4gICAgICAgICAgICBpZiAoc3RhdGUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnL21lZGlhL2ltYWdlcy9pdGVtcy8nICsgZGF0YS5pdGVtICsgJ19zdHIucG5nJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHN0YXRlID09IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJy9tZWRpYS9pbWFnZXMvaXRlbXMvJyArIGRhdGEuaXRlbSArICdfaW50LnBuZyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJy9tZWRpYS9pbWFnZXMvaXRlbXMvJyArIGRhdGEuaXRlbSArICdfYWdpLnBuZyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd0cmFucXVpbF9ib290cyc6XG4gICAgICAgIGNhc2UgJ3Jpbmdfb2ZfYmFzaWxpdXMnOlxuICAgICAgICAgICAgaWYgKHN0YXRlID09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJy9tZWRpYS9pbWFnZXMvaXRlbXMvJyArIGRhdGEuaXRlbSArICcucG5nJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAnL21lZGlhL2ltYWdlcy9pdGVtcy8nICsgZGF0YS5pdGVtICsgJ19hY3RpdmUucG5nJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2FybWxldCc6XG4gICAgICAgICAgICBpZiAoc3RhdGUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnL21lZGlhL2ltYWdlcy9pdGVtcy8nICsgZGF0YS5pdGVtICsgJy5wbmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcvbWVkaWEvaW1hZ2VzL2l0ZW1zLycgKyBkYXRhLml0ZW0gKyAnX2FjdGl2ZS5wbmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncmluZ19vZl9hcXVpbGEnOlxuICAgICAgICAgICAgaWYgKHN0YXRlID09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJy9tZWRpYS9pbWFnZXMvaXRlbXMvJyArIGRhdGEuaXRlbSArICdfYWN0aXZlLnBuZyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJy9tZWRpYS9pbWFnZXMvaXRlbXMvJyArIGRhdGEuaXRlbSArICcucG5nJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2RhZ29uJzpcbiAgICAgICAgY2FzZSAnZGlmZnVzYWxfYmxhZGUnOlxuICAgICAgICBjYXNlICd0cmF2ZWxfYm9vdHMnOlxuICAgICAgICBjYXNlICduZWNyb25vbWljb24nOlxuICAgICAgICAgICAgaWYgKGRhdGEuc2l6ZSA+IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJy9tZWRpYS9pbWFnZXMvaXRlbXMvJyArIGRhdGEuaXRlbSArICdfJyArIGRhdGEuc2l6ZSArICcucG5nJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAnL21lZGlhL2ltYWdlcy9pdGVtcy8nICsgZGF0YS5pdGVtICsgJy5wbmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAnL21lZGlhL2ltYWdlcy9pdGVtcy8nICsgZGF0YS5pdGVtICsgJy5wbmcnOyAgICAgICAgICAgIFxuICAgICAgICBicmVhaztcbiAgICB9XG59O1xubXkucHJvdG90eXBlLkJhc2ljSW52ZW50b3J5Vmlld01vZGVsLnByb3RvdHlwZS5nZXRJdGVtU2l6ZUxhYmVsID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBpZiAobXkucHJvdG90eXBlLnN0YWNrYWJsZUl0ZW1zLmluZGV4T2YoZGF0YS5pdGVtKSAhPSAtMSkge1xuICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPVwiZm9udC1zaXplOjEwcHhcIj5RdHk6IDwvc3Bhbj4nICsgZGF0YS5zaXplO1xuICAgIH1cbiAgICBlbHNlIGlmIChteS5wcm90b3R5cGUubGV2ZWxpdGVtcy5pbmRleE9mKGRhdGEuaXRlbSkgIT0gLTEpIHtcbiAgICAgICAgcmV0dXJuICc8c3BhbiBzdHlsZT1cImZvbnQtc2l6ZToxMHB4XCI+THZsOiA8L3NwYW4+JyArIGRhdGEuc2l6ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZGF0YS5pdGVtID09ICdibG9vZHN0b25lJykge1xuICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPVwiZm9udC1zaXplOjEwcHhcIj5DaGFyZ2VzOiA8L3NwYW4+JyArIGRhdGEuc2l6ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG59O1xubXkucHJvdG90eXBlLkJhc2ljSW52ZW50b3J5Vmlld01vZGVsLnByb3RvdHlwZS5nZXRBY3RpdmVCb3JkZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHN3aXRjaCAoZGF0YS5pdGVtKSB7XG4gICAgICAgIGNhc2UgJ3Bvd2VyX3RyZWFkcyc6XG4gICAgICAgIGNhc2UgJ3RyYW5xdWlsX2Jvb3RzJzpcbiAgICAgICAgY2FzZSAncmluZ19vZl9iYXNpbGl1cyc6XG4gICAgICAgIGNhc2UgJ3Jpbmdfb2ZfYXF1aWxhJzpcbiAgICAgICAgY2FzZSAnYXJtbGV0JzpcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKGRhdGEuc3RhdGUpOyAgICBcbiAgICAgICAgYnJlYWs7XG4gICAgfVxufVxubXkucHJvdG90eXBlLkJhc2ljSW52ZW50b3J5Vmlld01vZGVsLnByb3RvdHlwZS5nZXRJdGVtQXR0cmlidXRlVmFsdWUgPSBmdW5jdGlvbiAoYXR0cmlidXRlcywgYXR0cmlidXRlTmFtZSwgbGV2ZWwpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZXNbaV0ubmFtZSA9PSBhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICBpZiAobGV2ZWwgPT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGF0dHJpYnV0ZXNbaV0udmFsdWVbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobGV2ZWwgPiBhdHRyaWJ1dGVzW2ldLnZhbHVlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGF0dHJpYnV0ZXNbaV0udmFsdWVbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYXR0cmlidXRlc1tpXS52YWx1ZVtsZXZlbCAtIDFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxubXkucHJvdG90eXBlLkludmVudG9yeVZpZXdNb2RlbCA9IGZ1bmN0aW9uIChoKSB7XG4gICAgdmFyIHNlbGYgPSBuZXcgbXkucHJvdG90eXBlLkJhc2ljSW52ZW50b3J5Vmlld01vZGVsKCk7XG4gICAgc2VsZi5oZXJvID0gaDtcbiAgICBzZWxmLmhhc0ludmVudG9yeSA9IGtvLm9ic2VydmFibGUodHJ1ZSk7XG4gICAgc2VsZi5pdGVtcyA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7XG4gICAgc2VsZi5hY3RpdmVJdGVtcyA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7XG4gICAgc2VsZi5oYXNTY2VwdGVyID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIGlmIChpdGVtID09PSAndWx0aW1hdGVfc2NlcHRlcicgJiYgc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sIHRoaXMpO1xuICAgIHNlbGYuaXNFdGhlcmVhbCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKChpdGVtID09PSAnZ2hvc3QnIHx8IGl0ZW0gPT09ICdldGhlcmVhbF9ibGFkZScpICYmIHNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkgJiYgaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSwgdGhpcyk7XG4gICAgc2VsZi5pc1NoZWVwZWQgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmIChpdGVtID09PSAnc2hlZXBzdGljaycgJiYgc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSAmJiBpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LCB0aGlzKTtcbiAgICBzZWxmLnRvdGFsQ29zdCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGMgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBpZiAobXkucHJvdG90eXBlLnN0YWNrYWJsZUl0ZW1zLmluZGV4T2YoaXRlbSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICBjICs9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uaXRlbWNvc3QgKiBzZWxmLml0ZW1zKClbaV0uc2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG15LnByb3RvdHlwZS5sZXZlbGl0ZW1zLmluZGV4T2YoaXRlbSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2goaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdkaWZmdXNhbF9ibGFkZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBjICs9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uaXRlbWNvc3QgKyAoc2VsZi5pdGVtcygpW2ldLnNpemUgLSAxKSAqIDcwMDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25lY3Jvbm9taWNvbic6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RhZ29uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5pdGVtY29zdCArIChzZWxmLml0ZW1zKClbaV0uc2l6ZSAtIDEpICogMTI1MDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBjICs9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uaXRlbWNvc3Q7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGMgKz0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5pdGVtY29zdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjO1xuICAgIH0sIHRoaXMpO1xuICAgIHNlbGYuYWRkSXRlbUJ1ZmYgPSBmdW5jdGlvbiAoZGF0YSwgZXZlbnQpIHtcbiAgICAgICAgaWYgKHNlbGYuaGFzSW52ZW50b3J5KCkgJiYgc2VsZi5zZWxlY3RlZEl0ZW1CdWZmKCkgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YXIgbmV3X2l0ZW0gPSB7XG4gICAgICAgICAgICAgICAgaXRlbTogc2VsZi5zZWxlY3RlZEl0ZW1CdWZmKCksXG4gICAgICAgICAgICAgICAgc3RhdGU6IGtvLm9ic2VydmFibGUoMCksXG4gICAgICAgICAgICAgICAgc2l6ZTogMSxcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLml0ZW1zLnB1c2gobmV3X2l0ZW0pO1xuICAgICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWRJdGVtQnVmZigpID09PSAncmluZ19vZl9hcXVpbGEnIHx8IHNlbGYuc2VsZWN0ZWRJdGVtQnVmZigpID09PSAncmluZ19vZl9iYXNpbGl1cycpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnRvZ2dsZUl0ZW0odW5kZWZpbmVkLCBuZXdfaXRlbSwgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgc2VsZi5hZGRJdGVtRGVidWZmID0gZnVuY3Rpb24gKGRhdGEsIGV2ZW50KSB7XG4gICAgICAgIGlmIChzZWxmLmhhc0ludmVudG9yeSgpICYmIHNlbGYuc2VsZWN0ZWRJdGVtRGVidWZmKCkgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YXIgbmV3X2l0ZW0gPSB7XG4gICAgICAgICAgICAgICAgaXRlbTogc2VsZi5zZWxlY3RlZEl0ZW1EZWJ1ZmYoKS5zcGxpdCgnfCcpWzBdLFxuICAgICAgICAgICAgICAgIHN0YXRlOiBrby5vYnNlcnZhYmxlKDApLFxuICAgICAgICAgICAgICAgIHNpemU6IDEsXG4gICAgICAgICAgICAgICAgZW5hYmxlZDoga28ub2JzZXJ2YWJsZSh0cnVlKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWRJdGVtRGVidWZmKCkuc3BsaXQoJ3wnKS5sZW5ndGggPT0gMikge1xuICAgICAgICAgICAgICAgIG5ld19pdGVtLmRlYnVmZiA9IHNlbGYuc2VsZWN0ZWRJdGVtRGVidWZmKCkuc3BsaXQoJ3wnKVsxXVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VsZi5pdGVtcy5wdXNoKG5ld19pdGVtKTtcbiAgICAgICAgICAgIGlmIChzZWxmLnNlbGVjdGVkSXRlbURlYnVmZigpID09PSAncmluZ19vZl9hcXVpbGEnIHx8IHNlbGYuc2VsZWN0ZWRJdGVtRGVidWZmKCkgPT09ICdyaW5nX29mX2Jhc2lsaXVzJykge1xuICAgICAgICAgICAgICAgIHNlbGYudG9nZ2xlSXRlbSh1bmRlZmluZWQsIG5ld19pdGVtLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldEF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoYXR0cmlidXRldHlwZSkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgdmFyIHNpemUgPSBzZWxmLml0ZW1zKClbaV0uc2l6ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfYWxsX3N0YXRzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19zdGF0cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZXR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWdpJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUubmFtZSA9PSAnYm9udXNfYWdpbGl0eScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnZGlmZnVzYWxfYmxhZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVtzaXplLTFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5uYW1lID09ICdib251c19zdGF0JyAmJiBzZWxmLml0ZW1zKClbaV0uc3RhdGUoKSA9PSAyKSB7dG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5uYW1lID09ICdib251c19hZ2knKSB7dG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTt9O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW50JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUubmFtZSA9PSAnYm9udXNfaW50ZWxsZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtID09ICduZWNyb25vbWljb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVtzaXplLTFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbSA9PSAnZGlmZnVzYWxfYmxhZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVtzaXplLTFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbSA9PSAnZGFnb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVtzaXplLTFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5uYW1lID09ICdib251c19pbnRlbGxpZ2VuY2UnKSB7dG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5uYW1lID09ICdib251c19pbnQnKSB7dG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5uYW1lID09ICdib251c19zdGF0JyAmJiBzZWxmLml0ZW1zKClbaV0uc3RhdGUoKSA9PSAxKSB7dG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTt9O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3RyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUubmFtZSA9PSAnYm9udXNfc3RyZW5ndGgnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gPT0gJ25lY3Jvbm9taWNvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlW3NpemUtMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlLm5hbWUgPT0gJ2JvbnVzX3N0YXQnICYmIHNlbGYuaXRlbXMoKVtpXS5zdGF0ZSgpID09IDApIHt0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO307XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlLm5hbWUgPT0gJ2JvbnVzX3N0cicpIHt0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO307XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlLm5hbWUgPT0gJ3VuaG9seV9ib251c19zdHJlbmd0aCcgJiYgaXNBY3RpdmUpIHt0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO307XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfTtcbiAgICBzZWxmLmdldEJhc2ggPSBmdW5jdGlvbiAoYXR0YWNrdHlwZSkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jhc2hfY2hhbmNlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKSAvIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdiYXNoX2NoYW5jZV9tZWxlZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0YWNrdHlwZSA9PSAnRE9UQV9VTklUX0NBUF9NRUxFRV9BVFRBQ0snKSB7IHRvdGFsQXR0cmlidXRlICo9ICgxIC0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKSAvIDEwMCk7IH07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdiYXNoX2NoYW5jZV9yYW5nZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja3R5cGUgPT0gJ0RPVEFfVU5JVF9DQVBfUkFOR0VEX0FUVEFDSycpIHsgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pIC8gMTAwKTsgfTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9O1xuICAgIFxuICAgIHNlbGYuZ2V0Q3JpdENoYW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3JpdF9jaGFuY2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pIC8gMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9O1xuICAgIFxuICAgIHNlbGYuZ2V0Q3JpdFNvdXJjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNvdXJjZXMgPSB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIHN3aXRjaCAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2xlc3Nlcl9jcml0JzpcbiAgICAgICAgICAgICAgICBjYXNlICdncmVhdGVyX2NyaXQnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jsb29kdGhvcm4nOlxuICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1tpdGVtXSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbaXRlbV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6IHNlbGYuZ2V0SXRlbUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcywgJ2NyaXRfY2hhbmNlJywgMCkgLyAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ211bHRpcGxpZXInOiBzZWxmLmdldEl0ZW1BdHRyaWJ1dGVWYWx1ZShteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMsICdjcml0X211bHRpcGxpZXInLCAwKSAvIDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbaXRlbV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGl0ZW0gPT09ICdibG9vZHRob3JuJyAmJiBpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzWydzb3VsX3JlbmQnXSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlc1snc291bF9yZW5kJ10gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdtdWx0aXBsaWVyJzogc2VsZi5nZXRJdGVtQXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLCAndGFyZ2V0X2NyaXRfbXVsdGlwbGllcicsIDApIC8gMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6ICdTb3VsIFJlbmQnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbJ3NvdWxfcmVuZCddLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzb3VyY2VzO1xuICAgIH07XG5cbiAgICBzZWxmLmdldENsZWF2ZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNvdXJjZXMgPSB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIHN3aXRjaCAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2JmdXJ5JzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbaXRlbV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2l0ZW1dID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyYWRpdXMnOiBzZWxmLmdldEl0ZW1BdHRyaWJ1dGVWYWx1ZShteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMsICdjbGVhdmVfcmFkaXVzJywgMCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21hZ25pdHVkZSc6IHNlbGYuZ2V0SXRlbUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcywgJ2NsZWF2ZV9kYW1hZ2VfcGVyY2VudCcsIDApIC8gMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1tpdGVtXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc291cmNlcztcbiAgICB9O1xuICAgIFxuICAgIHNlbGYuZ2V0QmFzaFNvdXJjZSA9IGZ1bmN0aW9uIChhdHRhY2t0eXBlKSB7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBzd2l0Y2ggKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBjYXNlICdqYXZlbGluJzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbaXRlbV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2l0ZW1dID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2UnOiBzZWxmLmdldEl0ZW1BdHRyaWJ1dGVWYWx1ZShteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMsICdib251c19jaGFuY2VfZGFtYWdlJywgMSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAnbWFnaWMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6IHNlbGYuZ2V0SXRlbUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcywgJ2JvbnVzX2NoYW5jZScsIDEpIC8gMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uZGlzcGxheW5hbWUgKyAnIFBpZXJjZSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbaXRlbV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ21vbmtleV9raW5nX2Jhcic6XG4gICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2l0ZW1dID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1tpdGVtXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXRlbSc6IGl0ZW0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5jZSc6IHNlbGYuZ2V0SXRlbUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcywgJ2Jhc2hfY2hhbmNlJywgMCkgLyAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHNlbGYuZ2V0SXRlbUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcywgJ2Jhc2hfZGFtYWdlJywgMCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2R1cmF0aW9uJzogc2VsZi5nZXRJdGVtQXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLCAnYmFzaF9zdHVuJywgMCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6ICdtYWdpYycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogJ01pbmktQmFzaCcgLy9teS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2l0ZW1dLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdhYnlzc2FsX2JsYWRlJzpcbiAgICAgICAgICAgICAgICBjYXNlICdiYXNoZXInOlxuICAgICAgICAgICAgICAgICAgICBpZiAoIXNvdXJjZXMuaGFzT3duUHJvcGVydHkoJ2Jhc2gnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1snYmFzaCddID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpdGVtJzogaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogc2VsZi5nZXRJdGVtQXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLCAoYXR0YWNrdHlwZSA9PSAnRE9UQV9VTklUX0NBUF9NRUxFRV9BVFRBQ0snKSA/J2Jhc2hfY2hhbmNlX21lbGVlJyA6ICdiYXNoX2NoYW5jZV9yYW5nZWQnLCAwKSAvIDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRJdGVtQXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLCAnYm9udXNfY2hhbmNlX2RhbWFnZScsIDApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkdXJhdGlvbic6IHNlbGYuZ2V0SXRlbUF0dHJpYnV0ZVZhbHVlKG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcywgJ2Jhc2hfZHVyYXRpb24nLCAwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiAnQmFzaCcgLy9teS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3NvdXJjZXNbaXRlbV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNvdXJjZXM7XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldE9yYlByb2NTb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBzd2l0Y2ggKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBjYXNlICdtYWVsc3Ryb20nOlxuICAgICAgICAgICAgICAgIGNhc2UgJ21qb2xsbmlyJzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbaXRlbV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2l0ZW1dID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuY2UnOiBzZWxmLmdldEl0ZW1BdHRyaWJ1dGVWYWx1ZShteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMsICdjaGFpbl9jaGFuY2UnLCAwKSAvIDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRJdGVtQXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLCAnY2hhaW5fZGFtYWdlJywgMCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlVHlwZSc6ICdtYWdpYycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5kaXNwbGF5bmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1tpdGVtXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc291cmNlcztcbiAgICB9O1xuXG4gICAgc2VsZi5nZXRPcmJTb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBzd2l0Y2ggKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBjYXNlICdkaWZmdXNhbF9ibGFkZSc6XG4gICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VzW2l0ZW1dID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1tpdGVtXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmNlJzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogc2VsZi5nZXRJdGVtQXR0cmlidXRlVmFsdWUobXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLCAnZmVlZGJhY2tfbWFuYV9idXJuJywgc2VsZi5pdGVtcygpW2ldLnNpemUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3VudCc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbaXRlbV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNvdXJjZXM7XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldEhlYWx0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19oZWFsdGgnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9O1xuICAgIHNlbGYuZ2V0SGVhbHRoUmVnZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2hlYWx0aF9yZWdlbic6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX3JlZ2VuJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19oZWFsdGhfcmVnZW4nOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gPT0gJ3RyYW5xdWlsX2Jvb3RzJyAmJiAhaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbSAhPSAndHJhbnF1aWxfYm9vdHMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2hwX3JlZ2VuJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdoZWFsdGhfcmVnZW5fcmF0ZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnaGVhcnQnICYmIGlzQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gKHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSkgLyAxMDApICogc2VsZi5oZXJvLmhlYWx0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH07XG4gICAgc2VsZi5nZXRIZWFsdGhSZWdlbkF1cmEgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwLFxuICAgICAgICAgICAgZXhjbHVkZUxpc3QgPSBlIHx8IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIGlmIChleGNsdWRlTGlzdC5pbmRleE9mKGl0ZW0gKyBhdHRyaWJ1dGUubmFtZSkgPiAtMSkgY29udGludWU7XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F1cmFfaGVhbHRoX3JlZ2VuJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGl0ZW0gKyBhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge3ZhbHVlOiB0b3RhbEF0dHJpYnV0ZSwgZXhjbHVkZUxpc3Q6IGV4Y2x1ZGVMaXN0fTtcbiAgICB9O1xuICAgIFxuICAgIHNlbGYuZ2V0TWFuYSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tYW5hJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldE1hbmFSZWdlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdhdXJhX21hbmFfcmVnZW4nOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdtYW5hX3JlZ2VuX2F1cmEnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VGbG9hdChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFuYV9yZWdlbic6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnaW5mdXNlZF9yYWluZHJvcCcpIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlRmxvYXQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTsgICAgXG4gICAgfTtcbiAgICBzZWxmLmdldE1hbmFSZWdlblBlcmNlbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbWFuYV9yZWdlbic6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbmFfcmVnZW4nOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tYW5hX3JlZ2VuX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSAhPSAnaW5mdXNlZF9yYWluZHJvcCcpIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlRmxvYXQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZSAvIDEwMDsgICAgXG4gICAgfTtcbiAgICBzZWxmLmdldE1hbmFSZWdlbkJsb29kc3RvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGlmIChpdGVtLmluZGV4T2YoJ2Jsb29kc3RvbmUnKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChzZWxmLml0ZW1zKClbaV0uc2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldEFybW9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19hcm1vcic6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQWN0aXZlIHx8IGl0ZW0gIT0gJ21lZGFsbGlvbl9vZl9jb3VyYWdlJykgeyB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pOyB9O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndW5ob2x5X2JvbnVzX2FybW9yJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0FjdGl2ZSAmJiBpdGVtID09ICdhcm1sZXQnKSB7IHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7IH07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldEFybW9yQXVyYSA9IGZ1bmN0aW9uIChhTGlzdCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwLFxuICAgICAgICAgICAgYXR0cmlidXRlTGlzdCA9IGFMaXN0IHx8IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7aiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZUxpc3QuZmluZChmdW5jdGlvbiAoYSkgeyByZXR1cm4gYXR0cmlidXRlLm5hbWUgPT0gYS5uYW1lOyB9KSkgY29udGludWU7XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGJ1Y2tsZXJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfYW9lX2FybW9yJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUxpc3QucHVzaCh7J25hbWUnOmF0dHJpYnV0ZS5uYW1lLCAndmFsdWUnOiBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAvLyBhc3NhdWx0XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F1cmFfcG9zaXRpdmVfYXJtb3InOlxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlTGlzdC5wdXNoKHsnbmFtZSc6YXR0cmlidXRlLm5hbWUsICd2YWx1ZSc6IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSl9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJpbmdfb2ZfYXF1aWxhLHJpbmdfb2ZfYmFzaWxpdXNcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXVyYV9ib251c19hcm1vcic6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVMaXN0LnB1c2goeyduYW1lJzphdHRyaWJ1dGUubmFtZSwgJ3ZhbHVlJzogcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgLy8gdmxhZG1pclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhcm1vcl9hdXJhJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUxpc3QucHVzaCh7J25hbWUnOmF0dHJpYnV0ZS5uYW1lLCAndmFsdWUnOiBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAvLyBtZWthbnNtXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2hlYWxfYm9udXNfYXJtb3InOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlTGlzdC5wdXNoKHsnbmFtZSc6YXR0cmlidXRlLm5hbWUsICd2YWx1ZSc6IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHJlbW92ZSBidWNrbGVyIGlmIHRoZXJlIGlzIGEgbWVrYW5zbVxuICAgICAgICBpZiAoYXR0cmlidXRlTGlzdC5maW5kKGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHsgcmV0dXJuIGF0dHJpYnV0ZS5uYW1lID09ICdoZWFsX2JvbnVzX2FybW9yJzsgfSkpIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZUxpc3QgPSBhdHRyaWJ1dGVMaXN0LmZpbHRlcihmdW5jdGlvbiAoYXR0cmlidXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5uYW1lICE9PSAnYm9udXNfYW9lX2FybW9yJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJlbW92ZSByaW5nX29mX2FxdWlsYSxyaW5nX29mX2Jhc2lsaXVzIGlmIHRoZXJlIGlzIGEgdmxhZG1pclxuICAgICAgICBpZiAoYXR0cmlidXRlTGlzdC5maW5kKGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHsgcmV0dXJuIGF0dHJpYnV0ZS5uYW1lID09ICdhcm1vcl9hdXJhJzsgfSkpIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZUxpc3QgPSBhdHRyaWJ1dGVMaXN0LmZpbHRlcihmdW5jdGlvbiAoYXR0cmlidXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5uYW1lICE9PSAnYXVyYV9ib251c19hcm1vcic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdG90YWxBdHRyaWJ1dGUgPSBhdHRyaWJ1dGVMaXN0LnJlZHVjZShmdW5jdGlvbiAobWVtbywgYXR0cmlidXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVtbyArPSBhdHRyaWJ1dGUudmFsdWU7XG4gICAgICAgIH0sIDApO1xuICAgICAgICByZXR1cm4ge3ZhbHVlOiB0b3RhbEF0dHJpYnV0ZSwgYXR0cmlidXRlczogYXR0cmlidXRlTGlzdH07XG4gICAgfTtcbiAgICBzZWxmLmdldEFybW9yUmVkdWN0aW9uID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMCxcbiAgICAgICAgICAgIGV4Y2x1ZGVMaXN0ID0gZSB8fCBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAoZXhjbHVkZUxpc3QuaW5kZXhPZihhdHRyaWJ1dGUubmFtZSkgPiAtMSB8fCBleGNsdWRlTGlzdC5pbmRleE9mKGl0ZW0gKyAnXycgKyBhdHRyaWJ1dGUubmFtZSkgPiAtMSkgY29udGludWU7XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FybW9yX3JlZHVjdGlvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZUxpc3QucHVzaChpdGVtICsgJ18nICsgYXR0cmlidXRlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXVyYV9uZWdhdGl2ZV9hcm1vcic6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZUxpc3QucHVzaChhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdjb3JydXB0aW9uX2FybW9yJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7dmFsdWU6IHRvdGFsQXR0cmlidXRlLCBleGNsdWRlTGlzdDogZXhjbHVkZUxpc3R9O1xuICAgIH07XG4gICAgc2VsZi5nZXRFdmFzaW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19ldmFzaW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtICE9ICdidXR0ZXJmbHknIHx8ICFpc0FjdGl2ZSkgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pIC8gMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9O1xuICAgIHNlbGYuZ2V0TW92ZW1lbnRTcGVlZEZsYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDAsXG4gICAgICAgIGhhc0Jvb3RzID0gZmFsc2UsXG4gICAgICAgIGhhc0V1bHMgPSBmYWxzZSxcbiAgICAgICAgaGFzV2luZExhY2UgPSBmYWxzZSxcbiAgICAgICAgYm9vdEl0ZW1zID0gWydib290cycsJ3BoYXNlX2Jvb3RzJywnYXJjYW5lX2Jvb3RzJywndHJhdmVsX2Jvb3RzJywncG93ZXJfdHJlYWRzJywndHJhbnF1aWxfYm9vdHMnLCdndWFyZGlhbl9ncmVhdmVzJ107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX21vdmVtZW50X3NwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGFzQm9vdHMgJiYgYm9vdEl0ZW1zLmluZGV4T2YoaXRlbSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtICE9ICd0cmFucXVpbF9ib290cycgfHwgKGl0ZW0gPT0gJ3RyYW5xdWlsX2Jvb3RzJyAmJiAhaXNBY3RpdmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0Jvb3RzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2Vsc2UgaWYgKCFoYXNFdWxzICYmIGl0ZW0gPT0gJ2N5Y2xvbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpdGVtID09ICdjeWNsb25lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzRXVscyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdicm9rZW5fbW92ZW1lbnRfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNCb290cyAmJiBib290SXRlbXMuaW5kZXhPZihpdGVtKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gPT0gJ3RyYW5xdWlsX2Jvb3RzJyAmJiBpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNCb290cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbW92ZW1lbnQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNCb290cyAmJiBib290SXRlbXMuaW5kZXhPZihpdGVtKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNCb290cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3ZlbWVudF9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1dpbmRMYWNlICYmIGl0ZW0gPT0gJ3dpbmRfbGFjZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1dpbmRMYWNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9O1xuICAgIHNlbGYuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwLFxuICAgICAgICAgICAgZXhjbHVkZUxpc3QgPSBlIHx8IFtdLFxuICAgICAgICAgICAgaGFzWWFzaGEgPSBmYWxzZSxcbiAgICAgICAgICAgIGhhc0RydW1zID0gZmFsc2UsXG4gICAgICAgICAgICBoYXNEcnVtc0FjdGl2ZSA9IGZhbHNlLFxuICAgICAgICAgICAgaGFzUGhhc2VBY3RpdmUgPSBmYWxzZSxcbiAgICAgICAgICAgIGhhc1NoYWRvd0JsYWRlQWN0aXZlID0gZmFsc2UsXG4gICAgICAgICAgICBoYXNCdXR0ZXJmbHlBY3RpdmUgPSBmYWxzZSxcbiAgICAgICAgICAgIGhhc01vTUFjdGl2ZSA9IGZhbHNlLFxuICAgICAgICAgICAgeWFzaGFJdGVtcyA9IFsnbWFudGEnLCd5YXNoYScsJ3NhbmdlX2FuZF95YXNoYSddO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIGlmIChleGNsdWRlTGlzdC5pbmRleE9mKGF0dHJpYnV0ZS5uYW1lKSA+IC0xKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbW92ZW1lbnRfc3BlZWRfcGVyY2VudF9ib251cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1lhc2hhICYmIHlhc2hhSXRlbXMuaW5kZXhPZihpdGVtKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNZYXNoYSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19hdXJhX21vdmVtZW50X3NwZWVkX3BjdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc0RydW1zICYmIGl0ZW0gPT0gJ2FuY2llbnRfamFuZ2dvJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzRHJ1bXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVMaXN0LnB1c2goYXR0cmlidXRlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncGhhc2VfbW92ZW1lbnRfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQWN0aXZlICYmICFoYXNQaGFzZUFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzUGhhc2VBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbW92ZW1lbnRfc3BlZWRfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0FjdGl2ZSAmJiAhaGFzRHJ1bXNBY3RpdmUgJiYgaXRlbSA9PSAnYW5jaWVudF9qYW5nZ28nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNEcnVtc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZUxpc3QucHVzaChhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd3aW5kd2Fsa19tb3ZlbWVudF9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUgJiYgIWhhc1NoYWRvd0JsYWRlQWN0aXZlICYmIChpdGVtID09ICdpbnZpc19zd29yZCcgfHwgaXRlbSA9PSAnc2lsdmVyX2VkZ2UnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzU2hhZG93QmxhZGVBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmVyc2Vya19ib251c19tb3ZlbWVudF9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUgJiYgIWhhc01vTUFjdGl2ZSAmJiBpdGVtID09ICdtYXNrX29mX21hZG5lc3MnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNNb01BY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbW92ZW1lbnRfc3BlZWQnOiAvL21hbnRhXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1lhc2hhICYmIGl0ZW0gPT0gJ21hbnRhJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzWWFzaGEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbSA9PSAnc21va2Vfb2ZfZGVjZWl0JyAmJiBpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib251c19tb3ZlX3NwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0FjdGl2ZSAmJiAhaGFzQnV0dGVyZmx5QWN0aXZlICYmIGl0ZW0gPT0gJ2J1dHRlcmZseScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0J1dHRlcmZseUFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge3ZhbHVlOiB0b3RhbEF0dHJpYnV0ZS8xMDAsIGV4Y2x1ZGVMaXN0OiBleGNsdWRlTGlzdH07XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldE1vdmVtZW50U3BlZWRQZXJjZW50UmVkdWN0aW9uID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMCxcbiAgICAgICAgICAgIGV4Y2x1ZGVMaXN0ID0gZSB8fCBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAoZXhjbHVkZUxpc3QuaW5kZXhPZihhdHRyaWJ1dGUubmFtZSkgPiAtMSkgY29udGludWU7XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdmVzcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnZHVzdCcgJiYgaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlICdibGFzdF9tb3ZlbWVudF9zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnc2hpdmFzX2d1YXJkJyAmJiBpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZUxpc3QucHVzaChhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NvbGRfbW92ZW1lbnRfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gPT0gJ3NrYWRpJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdtYWltX21vdmVtZW50X3NwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLml0ZW1zKClbaV0uZGVidWZmICYmIHNlbGYuaXRlbXMoKVtpXS5kZWJ1ZmYgPT0gJ21haW0nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7dmFsdWU6IHRvdGFsQXR0cmlidXRlLzEwMCwgZXhjbHVkZUxpc3Q6IGV4Y2x1ZGVMaXN0fTtcbiAgICB9O1xuICAgIFxuICAgIHNlbGYuZ2V0Qm9udXNEYW1hZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIHZhciBzb3VyY2VzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2RhbWFnZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbaXRlbV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1tpdGVtXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZSc6IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2VUeXBlJzogJ3BoeXNpY2FsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzoxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnOiBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmRpc3BsYXluYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZXNbaXRlbV0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VuaG9seV9ib251c19kYW1hZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlc1tpdGVtICsgJ19hY3RpdmUnXSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1tpdGVtICsgJ19hY3RpdmUnXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYW1hZ2UnOiBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzoxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXluYW1lJzogbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5kaXNwbGF5bmFtZSArICcgVW5ob2x5IFN0cmVuZ3RoJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlc1tpdGVtXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHNvdXJjZXM6IHNvdXJjZXMsIHRvdGFsOiB0b3RhbEF0dHJpYnV0ZSB9O1xuICAgIH07XG4gICAgc2VsZi5nZXRCb251c0RhbWFnZVBlcmNlbnQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICBzID0gcyB8fCB7c291cmNlczp7fSx0b3RhbDowfTtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gcy50b3RhbCB8fCAwO1xuICAgICAgICB2YXIgc291cmNlcyA9IHMuc291cmNlcyB8fCB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGFtYWdlX2F1cmEnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbaXRlbV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKSAvIDEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2l0ZW1dID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGFtYWdlJzogcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKSAvIDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhbWFnZVR5cGUnOiAncGh5c2ljYWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnOjEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5bmFtZSc6IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uZGlzcGxheW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzb3VyY2VzW2l0ZW1dLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzb3VyY2VzOiBzb3VyY2VzLCB0b3RhbDogdG90YWxBdHRyaWJ1dGUgfTtcbiAgICB9O1xuICAgIHNlbGYuZ2V0QXR0YWNrU3BlZWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwLFxuICAgICAgICAgICAgaGFzUG93ZXJUcmVhZHMgPSBmYWxzZSxcbiAgICAgICAgICAgIGV4Y2x1ZGVMaXN0ID0gZSB8fCBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAoZXhjbHVkZUxpc3QuaW5kZXhPZihhdHRyaWJ1dGUubmFtZSkgPiAtMSkgY29udGludWU7XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2F0dGFja19zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAncG93ZXJfdHJlYWRzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGFzUG93ZXJUcmVhZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzUG93ZXJUcmVhZHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0gPT0gJ21vb25fc2hhcmQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdjb25zdW1lZF9ib251cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnbW9vbl9zaGFyZCcgJiYgaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX3NwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdhdXJhX2F0dGFja19zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSAhPSAnc2hpdmFzX2d1YXJkJykgeyB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pOyB9O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgLy8gYW5jaWVudF9qYW5nZ29cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfYXVyYV9hdHRhY2tfc3BlZWRfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFuY2llbnRfamFuZ2dvXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX2F0dGFja19zcGVlZF9wY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VuaG9seV9ib251c19hdHRhY2tfc3BlZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQWN0aXZlKSB7IHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7IH07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdiZXJzZXJrX2JvbnVzX2F0dGFja19zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHsgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTsgfTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7dmFsdWU6IHRvdGFsQXR0cmlidXRlLCBleGNsdWRlTGlzdDogZXhjbHVkZUxpc3R9O1xuICAgIH07XG4gICAgc2VsZi5nZXRBdHRhY2tTcGVlZFJlZHVjdGlvbiA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDAsXG4gICAgICAgICAgICBleGNsdWRlTGlzdCA9IGUgfHwgW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgaWYgKGV4Y2x1ZGVMaXN0LmluZGV4T2YoYXR0cmlidXRlLm5hbWUpID4gLTEpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdhdXJhX2F0dGFja19zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnc2hpdmFzX2d1YXJkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICs9IHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZUxpc3QucHVzaChhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdjb2xkX2F0dGFja19zcGVlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnc2thZGknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ21haW1fYXR0YWNrX3NwZWVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLml0ZW1zKClbaV0uZGVidWZmICYmIHNlbGYuaXRlbXMoKVtpXS5kZWJ1ZmYgPT0gJ21haW0nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKz0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7dmFsdWU6IHRvdGFsQXR0cmlidXRlLCBleGNsdWRlTGlzdDogZXhjbHVkZUxpc3R9O1xuICAgIH07XG4gICAgc2VsZi5nZXRMaWZlc3RlYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xpZmVzdGVhbF9wZXJjZW50JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtID09ICdzYXRhbmljJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNBY3RpdmUpIHsgcmV0dXJuIHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7IH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VuaG9seV9saWZlc3RlYWxfcGVyY2VudCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHsgcmV0dXJuIHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSk7IH07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfTtcbiAgICBzZWxmLmdldExpZmVzdGVhbEF1cmEgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAwLFxuICAgICAgICAgICAgZXhjbHVkZUxpc3QgPSBlIHx8IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIGlmIChleGNsdWRlTGlzdC5pbmRleE9mKGF0dHJpYnV0ZS5uYW1lKSA+IC0xKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndmFtcGlyaWNfYXVyYSc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZUxpc3QucHVzaChhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge3ZhbHVlOiB0b3RhbEF0dHJpYnV0ZSwgZXhjbHVkZUxpc3Q6IGV4Y2x1ZGVMaXN0fTtcbiAgICB9O1xuICAgIHNlbGYuZ2V0TWFnaWNSZXNpc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX21hZ2ljYWxfYXJtb3InOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pIC8gMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JvbnVzX3NwZWxsX3Jlc2lzdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSAtIHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSkgLyAxMDApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFnaWNfcmVzaXN0YW5jZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSAtIHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSkgLyAxMDApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH07XG4gICAgc2VsZi5nZXRNYWdpY1Jlc2lzdFJlZHVjdGlvblNlbGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b3RhbEF0dHJpYnV0ZSA9IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5pdGVtcygpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXMoKVtpXS5pdGVtO1xuICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gc2VsZi5hY3RpdmVJdGVtcy5pbmRleE9mKHNlbGYuaXRlbXMoKVtpXSkgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc2VsZi5pdGVtcygpW2ldLmVuYWJsZWQoKSkgY29udGludWU7XG4gICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2V4dHJhX3NwZWxsX2RhbWFnZV9wZXJjZW50JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2V0aGVyZWFsX2RhbWFnZV9ib251cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgxIC0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKSAvIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG90YWxBdHRyaWJ1dGU7XG4gICAgfTsgICBcbiAgICBzZWxmLmdldE1hZ2ljUmVzaXN0UmVkdWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgaWYgKGlzQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGF0dHJpYnV0ZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdldGhlcmVhbF9kYW1hZ2VfYm9udXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VsZi5pc0V0aGVyZWFsKCkpIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKSAvIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdyZXNpc3RfZGVidWZmJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSAqPSAoMSAtIHBhcnNlSW50KGF0dHJpYnV0ZS52YWx1ZVswXSkgLyAxMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH07ICAgICAgICBcblxuICAgIHNlbGYuZ2V0VmlzaW9uUmFuZ2VOaWdodCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IG15LnByb3RvdHlwZS5pdGVtRGF0YVsnaXRlbV8nICsgaXRlbV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9udXNfbmlnaHRfdmlzaW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtICE9ICdtb29uX3NoYXJkJyB8fCAhaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF0dHJpYnV0ZSArPSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsQXR0cmlidXRlO1xuICAgIH0pO1xuICAgIFxuICAgIHNlbGYuZ2V0QXR0YWNrUmFuZ2UgPSBmdW5jdGlvbiAoYXR0YWNrdHlwZSwgYUxpc3QpIHtcbiAgICAgICAgdmFyIHRvdGFsQXR0cmlidXRlID0gMCxcbiAgICAgICAgICAgIGF0dHJpYnV0ZUxpc3QgPSBhTGlzdCB8fCBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLml0ZW1zKCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5pdGVtcygpW2ldLml0ZW07XG4gICAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBzZWxmLmFjdGl2ZUl0ZW1zLmluZGV4T2Yoc2VsZi5pdGVtcygpW2ldKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFzZWxmLml0ZW1zKClbaV0uZW5hYmxlZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwO2ogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVMaXN0LmZpbmQoZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGF0dHJpYnV0ZS5uYW1lID09IGEubmFtZTsgfSkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBkcmFnb25fbGFuY2VcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmFzZV9hdHRhY2tfcmFuZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja3R5cGUgPT0gJ0RPVEFfVU5JVF9DQVBfUkFOR0VEX0FUVEFDSycpIGF0dHJpYnV0ZUxpc3QucHVzaCh7J25hbWUnOmF0dHJpYnV0ZS5uYW1lLCAndmFsdWUnOiBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdG90YWxBdHRyaWJ1dGUgPSBhdHRyaWJ1dGVMaXN0LnJlZHVjZShmdW5jdGlvbiAobWVtbywgYXR0cmlidXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVtbyArPSBhdHRyaWJ1dGUudmFsdWU7XG4gICAgICAgIH0sIDApO1xuICAgICAgICByZXR1cm4ge3ZhbHVlOiB0b3RhbEF0dHJpYnV0ZSwgYXR0cmlidXRlczogYXR0cmlidXRlTGlzdH07XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmdldE1pc3NDaGFuY2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxLFxuICAgICAgICAgICAgZXhjbHVkZUxpc3QgPSBlIHx8IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIGlmIChleGNsdWRlTGlzdC5pbmRleE9mKGF0dHJpYnV0ZS5uYW1lKSA+IC0xKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goYXR0cmlidXRlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWlzc19jaGFuY2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgLSBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pIC8gMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVMaXN0LnB1c2goYXR0cmlidXRlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmxpbmRfcGN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXR0cmlidXRlICo9ICgxIC0gcGFyc2VJbnQoYXR0cmlidXRlLnZhbHVlWzBdKSAvIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlTGlzdC5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7dmFsdWU6IHRvdGFsQXR0cmlidXRlLCBleGNsdWRlTGlzdDogZXhjbHVkZUxpc3R9O1xuICAgIH07XG4gICAgXG4gICAgc2VsZi5nZXRCYXNlRGFtYWdlUmVkdWN0aW9uUGN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdiYWNrc3RhYl9yZWR1Y3Rpb24nOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuaXRlbXMoKVtpXS5kZWJ1ZmYgJiYgc2VsZi5pdGVtcygpW2ldLmRlYnVmZiA9PSAnc2hhZG93X3dhbGsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgKyBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pIC8gMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9OyAgICBcbiAgICBzZWxmLmdldEJvbnVzRGFtYWdlUmVkdWN0aW9uUGN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG90YWxBdHRyaWJ1dGUgPSAxO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuaXRlbXMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zKClbaV0uaXRlbTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IHNlbGYuYWN0aXZlSXRlbXMuaW5kZXhPZihzZWxmLml0ZW1zKClbaV0pID49IDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXRlbXMoKVtpXS5lbmFibGVkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBteS5wcm90b3R5cGUuaXRlbURhdGFbJ2l0ZW1fJyArIGl0ZW1dLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbXkucHJvdG90eXBlLml0ZW1EYXRhWydpdGVtXycgKyBpdGVtXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgIHN3aXRjaChhdHRyaWJ1dGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdiYWNrc3RhYl9yZWR1Y3Rpb24nOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuaXRlbXMoKVtpXS5kZWJ1ZmYgJiYgc2VsZi5pdGVtcygpW2ldLmRlYnVmZiA9PSAnc2hhZG93X3dhbGsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBdHRyaWJ1dGUgKj0gKDEgKyBwYXJzZUludChhdHRyaWJ1dGUudmFsdWVbMF0pIC8gMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0b3RhbEF0dHJpYnV0ZTtcbiAgICB9OyAgICBcbiAgICBcbiAgICBzZWxmLml0ZW1PcHRpb25zID0ga28ub2JzZXJ2YWJsZUFycmF5KG15LnByb3RvdHlwZS5pdGVtT3B0aW9uc0Fycik7XG4gICAgXG4gICAgc2VsZi5pdGVtQnVmZk9wdGlvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkobXkucHJvdG90eXBlLml0ZW1CdWZmT3B0aW9ucyk7XG4gICAgc2VsZi5zZWxlY3RlZEl0ZW1CdWZmID0ga28ub2JzZXJ2YWJsZSgnYXNzYXVsdCcpO1xuXG4gICAgc2VsZi5pdGVtRGVidWZmT3B0aW9ucyA9IGtvLm9ic2VydmFibGVBcnJheShteS5wcm90b3R5cGUuaXRlbURlYnVmZk9wdGlvbnMpO1xuICAgIHNlbGYuc2VsZWN0ZWRJdGVtRGVidWZmID0ga28ub2JzZXJ2YWJsZSgnYXNzYXVsdCcpO1xuICAgIFxuICAgIHJldHVybiBzZWxmO1xufTsiLCIndXNlIHN0cmljdCc7XG52YXIga28gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1sna28nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2tvJ10gOiBudWxsKTtcblxua28ubWFwcGluZyA9IHJlcXVpcmUoJy4uL2xpYi9rbm9ja291dC5tYXBwaW5nJyk7XG5rby53cmFwID0gcmVxdWlyZSgnLi4vbGliL2tub2Nrb3V0LndyYXAnKTtcblxua28uZXh0ZW5kZXJzLm51bWVyaWMgPSBmdW5jdGlvbih0YXJnZXQsIHByZWNpc2lvbikge1xuICAgIC8vY3JlYXRlIGEgd3JpdGVhYmxlIGNvbXB1dGVkIG9ic2VydmFibGUgdG8gaW50ZXJjZXB0IHdyaXRlcyB0byBvdXIgb2JzZXJ2YWJsZVxuICAgIHZhciByZXN1bHQgPSBrby5jb21wdXRlZCh7XG4gICAgICAgIHJlYWQ6IHRhcmdldCwgIC8vYWx3YXlzIHJldHVybiB0aGUgb3JpZ2luYWwgb2JzZXJ2YWJsZXMgdmFsdWVcbiAgICAgICAgd3JpdGU6IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudCA9IHRhcmdldCgpLFxuICAgICAgICAgICAgICAgIHJvdW5kaW5nTXVsdGlwbGllciA9IE1hdGgucG93KDEwLCBwcmVjaXNpb24pLFxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlQXNOdW0gPSBpc05hTihuZXdWYWx1ZSkgPyAwIDogcGFyc2VGbG9hdCgrbmV3VmFsdWUpLFxuICAgICAgICAgICAgICAgIHZhbHVlVG9Xcml0ZSA9IE1hdGgucm91bmQobmV3VmFsdWVBc051bSAqIHJvdW5kaW5nTXVsdGlwbGllcikgLyByb3VuZGluZ011bHRpcGxpZXI7XG4gXG4gICAgICAgICAgICAvL29ubHkgd3JpdGUgaWYgaXQgY2hhbmdlZFxuICAgICAgICAgICAgaWYgKHZhbHVlVG9Xcml0ZSAhPT0gY3VycmVudCkge1xuICAgICAgICAgICAgICAgIHRhcmdldCh2YWx1ZVRvV3JpdGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL2lmIHRoZSByb3VuZGVkIHZhbHVlIGlzIHRoZSBzYW1lLCBidXQgYSBkaWZmZXJlbnQgdmFsdWUgd2FzIHdyaXR0ZW4sIGZvcmNlIGEgbm90aWZpY2F0aW9uIGZvciB0aGUgY3VycmVudCBmaWVsZFxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQubm90aWZ5U3Vic2NyaWJlcnModmFsdWVUb1dyaXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KS5leHRlbmQoeyBub3RpZnk6ICdhbHdheXMnIH0pO1xuIFxuICAgIC8vaW5pdGlhbGl6ZSB3aXRoIGN1cnJlbnQgdmFsdWUgdG8gbWFrZSBzdXJlIGl0IGlzIHJvdW5kZWQgYXBwcm9wcmlhdGVseVxuICAgIHJlc3VsdCh0YXJnZXQoKSk7XG4gXG4gICAgLy9yZXR1cm4gdGhlIG5ldyBjb21wdXRlZCBvYnNlcnZhYmxlXG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ga287IiwiJ3VzZSBzdHJpY3QnO1xudmFyIGtvID0gcmVxdWlyZSgnLi9oZXJvY2FsY19rbm9ja291dCcpO1xuICAgIFxudmFyIG15ID0gcmVxdWlyZShcIi4vaGVyb2NhbGNfY29yZVwiKTtcblxubXkucHJvdG90eXBlLlVuaXRPcHRpb24gPSBmdW5jdGlvbiAobmFtZSwgZGlzcGxheW5hbWUsIGxldmVscywgaW1hZ2UsIGxldmVsKSB7XG4gICAgdGhpcy5oZXJvTmFtZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKGxldmVscyA+IDApID8gbmFtZSArIChsZXZlbCgpIDw9IGxldmVscyA/IGxldmVsKCkgOiAxKSA6IG5hbWU7XG4gICAgfSk7XG4gICAgdGhpcy5oZXJvRGlzcGxheU5hbWUgPSBkaXNwbGF5bmFtZTtcbiAgICB0aGlzLmltYWdlID0gaW1hZ2U7XG4gICAgdGhpcy5sZXZlbHMgPSBsZXZlbHM7XG59O1xuXG5teS5wcm90b3R5cGUuVW5pdFZpZXdNb2RlbCA9IGZ1bmN0aW9uIChoLHApIHtcbiAgICB2YXIgc2VsZiA9IG5ldyBteS5wcm90b3R5cGUuSGVyb01vZGVsKGgpO1xuICAgIHNlbGYucGFyZW50ID0gcDtcbiAgICBzZWxmLnNlbGVjdGVkVW5pdExldmVsID0ga28ub2JzZXJ2YWJsZSgxKTtcbiAgICBzZWxmLmF2YWlsYWJsZVVuaXRzID0ga28ub2JzZXJ2YWJsZUFycmF5KFtcbiAgICAgICAgbmV3IG15LnByb3RvdHlwZS5Vbml0T3B0aW9uKCducGNfZG90YV9sb25lX2RydWlkX2JlYXInLCAnTG9uZSBEcnVpZCBTcGlyaXQgQmVhcicsNCwnL21lZGlhL2ltYWdlcy91bml0cy9zcGlyaXRfYmVhci5wbmcnLCBzZWxmLnNlbGVjdGVkVW5pdExldmVsKSxcbiAgICAgICAgbmV3IG15LnByb3RvdHlwZS5Vbml0T3B0aW9uKCducGNfZG90YV9icmV3bWFzdGVyX2VhcnRoXycsJ0JyZXdtYXN0ZXIgRWFydGggV2FycmlvcicsMywnL21lZGlhL2ltYWdlcy91bml0cy9ucGNfZG90YV9icmV3bWFzdGVyX2VhcnRoLnBuZycsIHNlbGYuc2VsZWN0ZWRVbml0TGV2ZWwpLFxuICAgICAgICBuZXcgbXkucHJvdG90eXBlLlVuaXRPcHRpb24oJ25wY19kb3RhX2JyZXdtYXN0ZXJfZmlyZV8nLCdCcmV3bWFzdGVyIEZpcmUgV2FycmlvcicsMywnL21lZGlhL2ltYWdlcy91bml0cy9ucGNfZG90YV9icmV3bWFzdGVyX2ZpcmUucG5nJywgc2VsZi5zZWxlY3RlZFVuaXRMZXZlbCksXG4gICAgICAgIG5ldyBteS5wcm90b3R5cGUuVW5pdE9wdGlvbignbnBjX2RvdGFfYnJld21hc3Rlcl9zdG9ybV8nLCdCcmV3bWFzdGVyIFN0b3JtIFdhcnJpb3InLDMsJy9tZWRpYS9pbWFnZXMvdW5pdHMvbnBjX2RvdGFfYnJld21hc3Rlcl9zdG9ybS5wbmcnLCBzZWxmLnNlbGVjdGVkVW5pdExldmVsKSxcbiAgICAgICAgbmV3IG15LnByb3RvdHlwZS5Vbml0T3B0aW9uKCducGNfZG90YV9uZWNyb25vbWljb25fYXJjaGVyXycsJ05lY3Jvbm9taWNvbiBBcmNoZXInLDMsJy9tZWRpYS9pbWFnZXMvdW5pdHMvbnBjX2RvdGFfbmVjcm9ub21pY29uX2FyY2hlci5wbmcnLCBzZWxmLnNlbGVjdGVkVW5pdExldmVsKSxcbiAgICAgICAgbmV3IG15LnByb3RvdHlwZS5Vbml0T3B0aW9uKCducGNfZG90YV9uZWNyb25vbWljb25fd2Fycmlvcl8nLCdOZWNyb25vbWljb24gV2FycmlvcicsMywnL21lZGlhL2ltYWdlcy91bml0cy9ucGNfZG90YV9uZWNyb25vbWljb25fd2Fycmlvci5wbmcnLCBzZWxmLnNlbGVjdGVkVW5pdExldmVsKSxcbiAgICAgICAgbmV3IG15LnByb3RvdHlwZS5Vbml0T3B0aW9uKCducGNfZG90YV9seWNhbl93b2xmJywnTHljYW4gV29sZicsNCwnL21lZGlhL2ltYWdlcy91bml0cy9ucGNfZG90YV9seWNhbl93b2xmLnBuZycsIHNlbGYuc2VsZWN0ZWRVbml0TGV2ZWwpLFxuICAgICAgICBuZXcgbXkucHJvdG90eXBlLlVuaXRPcHRpb24oJ25wY19kb3RhX3Zpc2FnZV9mYW1pbGlhcicsJ1Zpc2FnZSBGYW1pbGlhcicsMywnL21lZGlhL2ltYWdlcy91bml0cy9ucGNfZG90YV92aXNhZ2VfZmFtaWxpYXIucG5nJywgc2VsZi5zZWxlY3RlZFVuaXRMZXZlbClcbiAgICBdKTtcbiAgICBzZWxmLnNlbGVjdGVkVW5pdCA9IGtvLm9ic2VydmFibGUoc2VsZi5hdmFpbGFibGVVbml0cygpWzBdKTtcbiAgICBzZWxmLnNlbGVjdGVkVW5pdC5zdWJzY3JpYmUoZnVuY3Rpb24obmV3VmFsdWUpIHtcbiAgICAgICAgaWYgKG5ld1ZhbHVlLmhlcm9OYW1lKCkuaW5kZXhPZignbnBjX2RvdGFfbG9uZV9kcnVpZF9iZWFyJykgIT0gLTEpIHtcbiAgICAgICAgICAgIHNlbGYuaW52ZW50b3J5Lmhhc0ludmVudG9yeSh0cnVlKTtcbiAgICAgICAgICAgIHNlbGYuaW52ZW50b3J5Lml0ZW1zLnJlbW92ZUFsbCgpO1xuICAgICAgICAgICAgc2VsZi5pbnZlbnRvcnkuYWN0aXZlSXRlbXMucmVtb3ZlQWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZWxmLmludmVudG9yeS5oYXNJbnZlbnRvcnkoZmFsc2UpO1xuICAgICAgICAgICAgc2VsZi5pbnZlbnRvcnkuaXRlbXMucmVtb3ZlQWxsKCk7XG4gICAgICAgICAgICBzZWxmLmludmVudG9yeS5hY3RpdmVJdGVtcy5yZW1vdmVBbGwoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYuaGVybyA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ga28ud3JhcC5mcm9tSlMobXkucHJvdG90eXBlLnVuaXREYXRhW3NlbGYuc2VsZWN0ZWRVbml0KCkuaGVyb05hbWUoKV0pO1xuICAgIH0pO1xuICAgIHNlbGYuaGVyb0RhdGEgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldO1xuICAgIH0pO1xuICAgIHNlbGYuZ2V0QWJpbGl0eUxldmVsTWF4ID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBpZiAoZGF0YS5hYmlsaXR5dHlwZSA9PSAnRE9UQV9BQklMSVRZX1RZUEVfQVRUUklCVVRFUycpIHtcbiAgICAgICAgICAgIHJldHVybiAxMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkYXRhLm5hbWUgPT0gJ25lY3Jvbm9taWNvbl9hcmNoZXJfbWFuYV9idXJuJyB8fCBkYXRhLm5hbWUgPT0gJ25lY3Jvbm9taWNvbl9hcmNoZXJfYW9lJ1xuICAgICAgICAgICAgfHwgZGF0YS5uYW1lID09ICduZWNyb25vbWljb25fd2Fycmlvcl9tYW5hX2J1cm4nIHx8IGRhdGEubmFtZSA9PSAnbmVjcm9ub21pY29uX3dhcnJpb3JfbGFzdF93aWxsJykge1xuICAgICAgICAgICAgcmV0dXJuIDM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGF0YS5uYW1lID09ICduZWNyb25vbWljb25fd2Fycmlvcl9zaWdodCcpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDQ7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHNlbGYuYWJpbGl0eSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYSA9IG5ldyBteS5wcm90b3R5cGUuQWJpbGl0eU1vZGVsKGtvLm1hcHBpbmcuZnJvbUpTKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLmFiaWxpdGllcykpO1xuICAgICAgICBhLmhhc1NjZXB0ZXIgPSBzZWxmLmludmVudG9yeS5oYXNTY2VwdGVyXG4gICAgICAgIHN3aXRjaCAoc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpKSB7XG4gICAgICAgICAgICBjYXNlICducGNfZG90YV9uZWNyb25vbWljb25fYXJjaGVyXzEnOlxuICAgICAgICAgICAgY2FzZSAnbnBjX2RvdGFfbmVjcm9ub21pY29uX3dhcnJpb3JfMSc6XG4gICAgICAgICAgICAgICAgYS5hYmlsaXRpZXNbMF0ubGV2ZWwoMSk7XG4gICAgICAgICAgICAgICAgYS5hYmlsaXRpZXNbMV0ubGV2ZWwoMSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ25wY19kb3RhX25lY3Jvbm9taWNvbl9hcmNoZXJfMic6XG4gICAgICAgICAgICBjYXNlICducGNfZG90YV9uZWNyb25vbWljb25fd2Fycmlvcl8yJzpcbiAgICAgICAgICAgICAgICBhLmFiaWxpdGllc1swXS5sZXZlbCgyKTtcbiAgICAgICAgICAgICAgICBhLmFiaWxpdGllc1sxXS5sZXZlbCgyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbnBjX2RvdGFfbmVjcm9ub21pY29uX2FyY2hlcl8zJzpcbiAgICAgICAgICAgICAgICBhLmFiaWxpdGllc1swXS5sZXZlbCgzKTtcbiAgICAgICAgICAgICAgICBhLmFiaWxpdGllc1sxXS5sZXZlbCgzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbnBjX2RvdGFfbmVjcm9ub21pY29uX3dhcnJpb3JfMyc6XG4gICAgICAgICAgICAgICAgYS5hYmlsaXRpZXNbMF0ubGV2ZWwoMyk7XG4gICAgICAgICAgICAgICAgYS5hYmlsaXRpZXNbMV0ubGV2ZWwoMyk7XG4gICAgICAgICAgICAgICAgYS5hYmlsaXRpZXNbMl0ubGV2ZWwoMSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBhLmxldmVsVXBBYmlsaXR5ID0gZnVuY3Rpb24oaW5kZXgsIGRhdGEsIGV2ZW50LCBoZXJvKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGEuYWJpbGl0aWVzW2luZGV4KCldLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICduZWNyb25vbWljb25fYXJjaGVyX21hbmFfYnVybic6XG4gICAgICAgICAgICAgICAgY2FzZSAnbmVjcm9ub21pY29uX2FyY2hlcl9hb2UnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ25lY3Jvbm9taWNvbl93YXJyaW9yX21hbmFfYnVybic6XG4gICAgICAgICAgICAgICAgY2FzZSAnbmVjcm9ub21pY29uX3dhcnJpb3JfbGFzdF93aWxsJzpcbiAgICAgICAgICAgICAgICBjYXNlICduZWNyb25vbWljb25fd2Fycmlvcl9zaWdodCc6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCkgPCBoZXJvLmdldEFiaWxpdHlMZXZlbE1heChkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYS5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoYS5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKSsxKTtcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcbiAgICAgICAgYS5sZXZlbERvd25BYmlsaXR5ID0gZnVuY3Rpb24oaW5kZXgsIGRhdGEsIGV2ZW50LCBoZXJvKSB7ICAgICAgICAgICAgXG4gICAgICAgICAgICBzd2l0Y2ggKGEuYWJpbGl0aWVzW2luZGV4KCldLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICduZWNyb25vbWljb25fYXJjaGVyX21hbmFfYnVybic6XG4gICAgICAgICAgICAgICAgY2FzZSAnbmVjcm9ub21pY29uX2FyY2hlcl9hb2UnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ25lY3Jvbm9taWNvbl93YXJyaW9yX21hbmFfYnVybic6XG4gICAgICAgICAgICAgICAgY2FzZSAnbmVjcm9ub21pY29uX3dhcnJpb3JfbGFzdF93aWxsJzpcbiAgICAgICAgICAgICAgICBjYXNlICduZWNyb25vbWljb25fd2Fycmlvcl9zaWdodCc6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuYWJpbGl0aWVzW2luZGV4KCldLmxldmVsKCk+MCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYS5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoYS5hYmlsaXRpZXNbaW5kZXgoKV0ubGV2ZWwoKS0xKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9KTsgICAgICAgIFxuICAgIHNlbGYucHJpbWFyeUF0dHJpYnV0ZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICAvL3ZhciB2ID0gbXkucHJvdG90eXBlLnVuaXREYXRhW3NlbGYuc2VsZWN0ZWRVbml0KCkuaGVyb05hbWUoKV0uYXR0cmlidXRlcHJpbWFyeTtcbiAgICAgICAgdmFyIHYgPSAwO1xuICAgICAgICBpZiAodiA9PSAnRE9UQV9BVFRSSUJVVEVfQUdJTElUWScpIHtcbiAgICAgICAgICAgIHJldHVybiAnYWdpJ1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHYgPT0gJ0RPVEFfQVRUUklCVVRFX0lOVEVMTEVDVCcpIHtcbiAgICAgICAgICAgIHJldHVybiAnaW50J1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHYgPT0gJ0RPVEFfQVRUUklCVVRFX1NUUkVOR1RIJykge1xuICAgICAgICAgICAgcmV0dXJuICdzdHInXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJydcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYudG90YWxBdHRyaWJ1dGUgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgIGlmIChhID09ICdhZ2knKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzZWxmLnRvdGFsQWdpKCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhID09ICdpbnQnKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzZWxmLnRvdGFsSW50KCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhID09ICdzdHInKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzZWxmLnRvdGFsU3RyKCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH07XG4gICAgc2VsZi50b3RhbEFnaSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLmF0dHJpYnV0ZWJhc2VhZ2lsaXR5XG4gICAgICAgICAgICAgICAgKyBteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5hdHRyaWJ1dGVhZ2lsaXR5Z2FpbiAqIChzZWxmLnNlbGVjdGVkSGVyb0xldmVsKCkgLSAxKSBcbiAgICAgICAgICAgICAgICAvLysgc2VsZi5pbnZlbnRvcnkuZ2V0QXR0cmlidXRlcygnYWdpJykgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRBdHRyaWJ1dGVCb251c0xldmVsKCkqMlxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0QWdpbGl0eSgpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEFsbFN0YXRzUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZGVidWZmcy5nZXRBbGxTdGF0c1JlZHVjdGlvbigpXG4gICAgICAgICAgICAgICApLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi50b3RhbEludCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLmF0dHJpYnV0ZWJhc2VpbnRlbGxpZ2VuY2UgXG4gICAgICAgICAgICAgICAgKyBteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5hdHRyaWJ1dGVpbnRlbGxpZ2VuY2VnYWluICogKHNlbGYuc2VsZWN0ZWRIZXJvTGV2ZWwoKSAtIDEpIFxuICAgICAgICAgICAgICAgIC8vKyBzZWxmLmludmVudG9yeS5nZXRBdHRyaWJ1dGVzKCdpbnQnKSBcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldEF0dHJpYnV0ZUJvbnVzTGV2ZWwoKSoyXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRJbnRlbGxpZ2VuY2UoKVxuICAgICAgICAgICAgICAgICsgc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRBbGxTdGF0c1JlZHVjdGlvbigpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmRlYnVmZnMuZ2V0QWxsU3RhdHNSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYudG90YWxTdHIgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIChteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5hdHRyaWJ1dGViYXNlc3RyZW5ndGggXG4gICAgICAgICAgICAgICAgKyBteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5hdHRyaWJ1dGVzdHJlbmd0aGdhaW4gKiAoc2VsZi5zZWxlY3RlZEhlcm9MZXZlbCgpIC0gMSkgXG4gICAgICAgICAgICAgICAgLy8rIHNlbGYuaW52ZW50b3J5LmdldEF0dHJpYnV0ZXMoJ3N0cicpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0QXR0cmlidXRlQm9udXNMZXZlbCgpKjJcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldFN0cmVuZ3RoKClcbiAgICAgICAgICAgICAgICArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0QWxsU3RhdHNSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICsgc2VsZi5kZWJ1ZmZzLmdldEFsbFN0YXRzUmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICAvKnNlbGYuaGVhbHRoID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAobXkucHJvdG90eXBlLnVuaXREYXRhW3NlbGYuc2VsZWN0ZWRVbml0KCkuaGVyb05hbWUoKV0uc3RhdHVzaGVhbHRoICsgc2VsZi50b3RhbFN0cigpKjE5IFxuICAgICAgICAgICAgICAgICsgc2VsZi5pbnZlbnRvcnkuZ2V0SGVhbHRoKClcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldEhlYWx0aCgpKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYuaGVhbHRocmVnZW4gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIChteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5zdGF0dXNoZWFsdGhyZWdlbiArIHNlbGYudG90YWxTdHIoKSouMDMgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmludmVudG9yeS5nZXRIZWFsdGhSZWdlbigpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5hYmlsaXR5KCkuZ2V0SGVhbHRoUmVnZW4oKVxuICAgICAgICAgICAgICAgICsgc2VsZi5idWZmcy5nZXRIZWFsdGhSZWdlbigpKS50b0ZpeGVkKDIpO1xuICAgIH0pO1xuICAgIHNlbGYubWFuYSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLnN0YXR1c21hbmEgKyBzZWxmLnRvdGFsSW50KCkqMTMgKyBzZWxmLmludmVudG9yeS5nZXRNYW5hKCkpLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5tYW5hcmVnZW4gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICgobXkucHJvdG90eXBlLnVuaXREYXRhW3NlbGYuc2VsZWN0ZWRVbml0KCkuaGVyb05hbWUoKV0uc3RhdHVzbWFuYXJlZ2VuIFxuICAgICAgICAgICAgICAgICsgc2VsZi50b3RhbEludCgpKi4wNCBcbiAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldE1hbmFSZWdlbigpKSBcbiAgICAgICAgICAgICAgICAqICgxICsgc2VsZi5pbnZlbnRvcnkuZ2V0TWFuYVJlZ2VuUGVyY2VudCgpKSBcbiAgICAgICAgICAgICAgICArIChzZWxmLnNlbGVjdGVkSGVybygpLmhlcm9OYW1lID09ICdjcnlzdGFsX21haWRlbicgPyBzZWxmLmFiaWxpdHkoKS5nZXRNYW5hUmVnZW5BcmNhbmVBdXJhKCkgKiAyIDogc2VsZi5idWZmcy5nZXRNYW5hUmVnZW5BcmNhbmVBdXJhKCkpXG4gICAgICAgICAgICAgICAgKyBzZWxmLmludmVudG9yeS5nZXRNYW5hUmVnZW5CbG9vZHN0b25lKClcbiAgICAgICAgICAgICAgICAtIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0TWFuYVJlZ2VuUmVkdWN0aW9uKCkpLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi50b3RhbEFybW9yUGh5c2ljYWwgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIChzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEFybW9yQmFzZVJlZHVjdGlvbigpICogc2VsZi5kZWJ1ZmZzLmdldEFybW9yQmFzZVJlZHVjdGlvbigpICogKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLmFybW9ycGh5c2ljYWwgKyBzZWxmLnRvdGFsQWdpKCkqLjE0KVxuICAgICAgICAgICAgICAgICsgc2VsZi5pbnZlbnRvcnkuZ2V0QXJtb3IoKSArIHNlbGYuYWJpbGl0eSgpLmdldEFybW9yKCkgKyBzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEFybW9yUmVkdWN0aW9uKCkgKyBzZWxmLmJ1ZmZzLmdldEFybW9yKCkgKyBzZWxmLmRlYnVmZnMuZ2V0QXJtb3JSZWR1Y3Rpb24oKSkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBzZWxmLnRvdGFsQXJtb3JQaHlzaWNhbFJlZHVjdGlvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKCgwLjA2ICogc2VsZi50b3RhbEFybW9yUGh5c2ljYWwoKSkgLyAoMSArIDAuMDYgKiBzZWxmLnRvdGFsQXJtb3JQaHlzaWNhbCgpKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBzZWxmLnRvdGFsTW92ZW1lbnRTcGVlZCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoc2VsZi5wYXJlbnQuYWJpbGl0eSgpLmlzU2hhcGVTaGlmdEFjdGl2ZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gNTIyO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtcyA9IChzZWxmLmFiaWxpdHkoKS5zZXRNb3ZlbWVudFNwZWVkKCkgPiAwID8gc2VsZi5hYmlsaXR5KCkuc2V0TW92ZW1lbnRTcGVlZCgpIDogc2VsZi5idWZmcy5zZXRNb3ZlbWVudFNwZWVkKCkpO1xuICAgICAgICBpZiAobXMgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbXM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKChteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5tb3ZlbWVudHNwZWVkICsgc2VsZi5pbnZlbnRvcnkuZ2V0TW92ZW1lbnRTcGVlZEZsYXQoKSsgc2VsZi5hYmlsaXR5KCkuZ2V0TW92ZW1lbnRTcGVlZEZsYXQoKSkgKiBcbiAgICAgICAgICAgICAgICAgICAgKDEgKyBzZWxmLmludmVudG9yeS5nZXRNb3ZlbWVudFNwZWVkUGVyY2VudCgpIFxuICAgICAgICAgICAgICAgICAgICAgICArIHNlbGYuYWJpbGl0eSgpLmdldE1vdmVtZW50U3BlZWRQZXJjZW50KCkgXG4gICAgICAgICAgICAgICAgICAgICAgICsgc2VsZi5lbmVteSgpLmludmVudG9yeS5nZXRNb3ZlbWVudFNwZWVkUGVyY2VudFJlZHVjdGlvbigpIFxuICAgICAgICAgICAgICAgICAgICAgICArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0TW92ZW1lbnRTcGVlZFBlcmNlbnRSZWR1Y3Rpb24oKSBcbiAgICAgICAgICAgICAgICAgICAgICAgKyBzZWxmLmJ1ZmZzLmdldE1vdmVtZW50U3BlZWRQZXJjZW50KCkgXG4gICAgICAgICAgICAgICAgICAgICAgICsgc2VsZi5kZWJ1ZmZzLmdldE1vdmVtZW50U3BlZWRQZXJjZW50UmVkdWN0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgKSkudG9GaXhlZCgyKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYudG90YWxUdXJuUmF0ZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLm1vdmVtZW50dHVybnJhdGUgXG4gICAgICAgICAgICAgICAgKiAoMSArIHNlbGYuZW5lbXkoKS5hYmlsaXR5KCkuZ2V0VHVyblJhdGVSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICAgICAgKyBzZWxmLmRlYnVmZnMuZ2V0VHVyblJhdGVSZWR1Y3Rpb24oKSkpLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgKi9cbiAgICBzZWxmLmJhc2VEYW1hZ2UgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIFtNYXRoLmZsb29yKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLmF0dGFja2RhbWFnZW1pbiArIHNlbGYudG90YWxBdHRyaWJ1dGUoc2VsZi5wcmltYXJ5QXR0cmlidXRlKCkpICsgc2VsZi5hYmlsaXR5KCkuZ2V0QmFzZURhbWFnZSgpLnRvdGFsKSxcbiAgICAgICAgICAgICAgICBNYXRoLmZsb29yKG15LnByb3RvdHlwZS51bml0RGF0YVtzZWxmLnNlbGVjdGVkVW5pdCgpLmhlcm9OYW1lKCldLmF0dGFja2RhbWFnZW1heCArIHNlbGYudG90YWxBdHRyaWJ1dGUoc2VsZi5wcmltYXJ5QXR0cmlidXRlKCkpICsgc2VsZi5hYmlsaXR5KCkuZ2V0QmFzZURhbWFnZSgpLnRvdGFsKV07XG4gICAgfSk7XG4gICAgLypzZWxmLmJvbnVzRGFtYWdlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmludmVudG9yeS5nZXRCb251c0RhbWFnZSgpLnRvdGFsXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRCb251c0RhbWFnZSgpLnRvdGFsXG4gICAgICAgICAgICAgICAgKyBzZWxmLmJ1ZmZzLmdldEJvbnVzRGFtYWdlKCkudG90YWxcbiAgICAgICAgICAgICAgICArIE1hdGguZmxvb3IoKHNlbGYuYmFzZURhbWFnZSgpWzBdICsgc2VsZi5iYXNlRGFtYWdlKClbMV0pLzIgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIChzZWxmLmludmVudG9yeS5nZXRCb251c0RhbWFnZVBlcmNlbnQoKS50b3RhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRCb251c0RhbWFnZVBlcmNlbnQoKS50b3RhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBzZWxmLmJ1ZmZzLmdldEJvbnVzRGFtYWdlUGVyY2VudCgpLnRvdGFsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKyBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgICAgICAoc2VsZi5oZXJvKCkuYXR0YWNrdHlwZSgpID09ICdET1RBX1VOSVRfQ0FQX1JBTkdFRF9BVFRBQ0snIFxuICAgICAgICAgICAgICAgICAgICAgICAgPyAoKHNlbGYuc2VsZWN0ZWRIZXJvKCkuaGVyb05hbWUgPT0gJ2Ryb3dfcmFuZ2VyJykgPyBzZWxmLmFiaWxpdHkoKS5nZXRCb251c0RhbWFnZVByZWNpc2lvbkF1cmEoKS50b3RhbFswXSAqIHNlbGYudG90YWxBZ2koKSA6IHNlbGYuYnVmZnMuZ2V0Qm9udXNEYW1hZ2VQcmVjaXNpb25BdXJhKCkudG90YWxbMV0pXG4gICAgICAgICAgICAgICAgICAgICAgICA6IDApXG4gICAgICAgICAgICAgICAgICApO1xuICAgIH0pOyovXG4gICAgLypzZWxmLmJvbnVzRGFtYWdlUmVkdWN0aW9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmFicyhzZWxmLmVuZW15KCkuYWJpbGl0eSgpLmdldEJvbnVzRGFtYWdlUmVkdWN0aW9uKCkgKyBzZWxmLmRlYnVmZnMuZ2V0Qm9udXNEYW1hZ2VSZWR1Y3Rpb24oKSk7XG4gICAgfSk7XG4gICAgc2VsZi5kYW1hZ2UgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIFtzZWxmLmJhc2VEYW1hZ2UoKVswXSArIHNlbGYuYm9udXNEYW1hZ2UoKVswXSxcbiAgICAgICAgICAgICAgICBzZWxmLmJhc2VEYW1hZ2UoKVsxXSArIHNlbGYuYm9udXNEYW1hZ2UoKVsxXV07XG4gICAgfSk7Ki9cbiAgICBzZWxmLnRvdGFsTWFnaWNSZXNpc3RhbmNlUHJvZHVjdCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKDEgLSBteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5tYWdpY2FscmVzaXN0YW5jZSAvIDEwMCkgXG4gICAgICAgICAgICAgICAgICAgKiAoMSAtIHNlbGYuaW52ZW50b3J5LmdldE1hZ2ljUmVzaXN0KCkgLyAxMDApIFxuICAgICAgICAgICAgICAgICAgICogKDEgLSBzZWxmLmFiaWxpdHkoKS5nZXRNYWdpY1Jlc2lzdCgpIC8gMTAwKSBcbiAgICAgICAgICAgICAgICAgICAqICgxIC0gc2VsZi5idWZmcy5nZXRNYWdpY1Jlc2lzdCgpIC8gMTAwKSBcbiAgICAgICAgICAgICAgICAgICAqIHNlbGYuZW5lbXkoKS5pbnZlbnRvcnkuZ2V0TWFnaWNSZXNpc3RSZWR1Y3Rpb24oKVxuICAgICAgICAgICAgICAgICAgICogc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRNYWdpY1Jlc2lzdFJlZHVjdGlvbigpIFxuICAgICAgICAgICAgICAgICAgICogc2VsZi5kZWJ1ZmZzLmdldE1hZ2ljUmVzaXN0UmVkdWN0aW9uKCk7XG4gICAgfSk7XG4gICAgc2VsZi50b3RhbE1hZ2ljUmVzaXN0YW5jZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKDEgLSBzZWxmLnRvdGFsTWFnaWNSZXNpc3RhbmNlUHJvZHVjdCgpKTtcbiAgICB9KTtcbiAgICBzZWxmLmJhdCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYWJpbGl0eUJBVCA9IHNlbGYuYWJpbGl0eSgpLmdldEJBVCgpO1xuICAgICAgICBpZiAoYWJpbGl0eUJBVCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBhYmlsaXR5QkFUO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBteS5wcm90b3R5cGUudW5pdERhdGFbc2VsZi5zZWxlY3RlZFVuaXQoKS5oZXJvTmFtZSgpXS5hdHRhY2tyYXRlO1xuICAgIH0pO1xuICAgIC8qXG4gICAgc2VsZi5pYXMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbCA9IHBhcnNlRmxvYXQoc2VsZi50b3RhbEFnaSgpKSBcbiAgICAgICAgICAgICAgICArIHNlbGYuaW52ZW50b3J5LmdldEF0dGFja1NwZWVkKCkgXG4gICAgICAgICAgICAgICAgKyBzZWxmLmFiaWxpdHkoKS5nZXRBdHRhY2tTcGVlZCgpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5lbmVteSgpLmFiaWxpdHkoKS5nZXRBdHRhY2tTcGVlZFJlZHVjdGlvbigpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5idWZmcy5nZXRBdHRhY2tTcGVlZCgpIFxuICAgICAgICAgICAgICAgICsgc2VsZi5kZWJ1ZmZzLmdldEF0dGFja1NwZWVkUmVkdWN0aW9uKCk7XG4gICAgICAgIGlmICh2YWwgPCAtODApIHtcbiAgICAgICAgICAgIHJldHVybiAtODA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsID4gNDAwKSB7XG4gICAgICAgICAgICByZXR1cm4gNDAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAodmFsKS50b0ZpeGVkKDIpO1xuICAgIH0pOyovXG4gICAgc2VsZi5hdHRhY2tUaW1lID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAoc2VsZi5iYXQoKSAvICgxICsgc2VsZi5pYXMoKSAvIDEwMCkpLnRvRml4ZWQoMik7XG4gICAgfSk7XG4gICAgc2VsZi5hdHRhY2tzUGVyU2Vjb25kID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAoMSArIHNlbGYuaWFzKCkgLyAxMDApIC8gc2VsZi5iYXQoKTtcbiAgICB9KTtcbiAgICBzZWxmLmV2YXNpb24gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGUgPSBzZWxmLmFiaWxpdHkoKS5zZXRFdmFzaW9uKCk7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gKGUgKiAxMDApLnRvRml4ZWQoMikgKyAnJSc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKCgxLShzZWxmLmludmVudG9yeS5nZXRFdmFzaW9uKCkgKiBzZWxmLmFiaWxpdHkoKS5nZXRFdmFzaW9uKCkpKSAqIDEwMCkudG9GaXhlZCgyKSArICclJztcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYuZWhwUGh5c2ljYWwgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICgoc2VsZi5oZWFsdGgoKSAqICgxICsgLjA2ICogc2VsZi50b3RhbEFybW9yUGh5c2ljYWwoKSkpIC8gKDEtKDEtKHNlbGYuaW52ZW50b3J5LmdldEV2YXNpb24oKSAqIHNlbGYuYWJpbGl0eSgpLmdldEV2YXNpb24oKSkpKSkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBzZWxmLmVocE1hZ2ljYWwgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIChzZWxmLmhlYWx0aCgpIC8gc2VsZi50b3RhbE1hZ2ljUmVzaXN0YW5jZVByb2R1Y3QoKSkudG9GaXhlZCgyKTtcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gc2VsZjtcbn0iLCIndXNlIHN0cmljdCc7XG5cbnZhciBjb3JlID0gcmVxdWlyZShcIi4vaGVyb2NhbGNfY29yZVwiKTtcbnJlcXVpcmUoXCIuL2hlcm9jYWxjX2ludmVudG9yeVwiKTtcbnJlcXVpcmUoXCIuL2hlcm9jYWxjX2FiaWxpdHlkYXRhXCIpO1xucmVxdWlyZShcIi4vaGVyb2NhbGNfYWJpbGl0aWVzXCIpO1xucmVxdWlyZShcIi4vaGVyb2NhbGNfYnVmZnNcIik7XG5yZXF1aXJlKFwiLi9oZXJvY2FsY19oZXJvXCIpO1xucmVxdWlyZShcIi4vaGVyb2NhbGNfaGVyby5pbGx1c2lvblwiKTtcbnJlcXVpcmUoXCIuL2hlcm9jYWxjX2hlcm8ubWVlcG9cIik7XG5yZXF1aXJlKFwiLi9oZXJvY2FsY191bml0XCIpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNvcmU7IiwiaWYgKCFBcnJheS5wcm90b3R5cGUuZmluZCkge1xuICBBcnJheS5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAodGhpcyA9PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheS5wcm90b3R5cGUuZmluZCBjYWxsZWQgb24gbnVsbCBvciB1bmRlZmluZWQnKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3ByZWRpY2F0ZSBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICB9XG4gICAgdmFyIGxpc3QgPSBPYmplY3QodGhpcyk7XG4gICAgdmFyIGxlbmd0aCA9IGxpc3QubGVuZ3RoID4+PiAwO1xuICAgIHZhciB0aGlzQXJnID0gYXJndW1lbnRzWzFdO1xuICAgIHZhciB2YWx1ZTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhbHVlID0gbGlzdFtpXTtcbiAgICAgIGlmIChwcmVkaWNhdGUuY2FsbCh0aGlzQXJnLCB2YWx1ZSwgaSwgbGlzdCkpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xufSIsIihmdW5jdGlvbiAoZmFjdG9yeSkge1xuXHQvLyBNb2R1bGUgc3lzdGVtcyBtYWdpYyBkYW5jZS5cblxuXHRpZiAodHlwZW9mIHJlcXVpcmUgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgZXhwb3J0cyA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09PSBcIm9iamVjdFwiKSB7XG5cdFx0Ly8gQ29tbW9uSlMgb3IgTm9kZTogaGFyZC1jb2RlZCBkZXBlbmRlbmN5IG9uIFwia25vY2tvdXRcIlxuXHRcdGZhY3RvcnkoKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2tvJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydrbyddIDogbnVsbCksIGV4cG9ydHMpO1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmVbXCJhbWRcIl0pIHtcblx0XHQvLyBBTUQgYW5vbnltb3VzIG1vZHVsZSB3aXRoIGhhcmQtY29kZWQgZGVwZW5kZW5jeSBvbiBcImtub2Nrb3V0XCJcblx0XHRkZWZpbmUoW1wia25vY2tvdXRcIiwgXCJleHBvcnRzXCJdLCBmYWN0b3J5KTtcblx0fSBlbHNlIHtcblx0XHQvLyA8c2NyaXB0PiB0YWc6IHVzZSB0aGUgZ2xvYmFsIGBrb2Agb2JqZWN0LCBhdHRhY2hpbmcgYSBgbWFwcGluZ2AgcHJvcGVydHlcblx0XHRmYWN0b3J5KGtvLCBrby5tYXBwaW5nID0ge30pO1xuXHR9XG59KGZ1bmN0aW9uIChrbywgZXhwb3J0cykge1xuXHR2YXIgREVCVUc9dHJ1ZTtcblx0dmFyIG1hcHBpbmdQcm9wZXJ0eSA9IFwiX19rb19tYXBwaW5nX19cIjtcblx0dmFyIHJlYWxLb0RlcGVuZGVudE9ic2VydmFibGUgPSBrby5kZXBlbmRlbnRPYnNlcnZhYmxlO1xuXHR2YXIgbWFwcGluZ05lc3RpbmcgPSAwO1xuXHR2YXIgZGVwZW5kZW50T2JzZXJ2YWJsZXM7XG5cdHZhciB2aXNpdGVkT2JqZWN0cztcblx0dmFyIHJlY29nbml6ZWRSb290UHJvcGVydGllcyA9IFtcImNyZWF0ZVwiLCBcInVwZGF0ZVwiLCBcImtleVwiLCBcImFycmF5Q2hhbmdlZFwiXTtcblx0dmFyIGVtcHR5UmV0dXJuID0ge307XG5cblx0dmFyIF9kZWZhdWx0T3B0aW9ucyA9IHtcblx0XHRpbmNsdWRlOiBbXCJfZGVzdHJveVwiXSxcblx0XHRpZ25vcmU6IFtdLFxuXHRcdGNvcHk6IFtdLFxuXHRcdG9ic2VydmU6IFtdXG5cdH07XG5cdHZhciBkZWZhdWx0T3B0aW9ucyA9IF9kZWZhdWx0T3B0aW9ucztcblxuXHQvLyBBdXRob3I6IEtlbm55VE0gQCBTdGFja092ZXJmbG93XG5cdGZ1bmN0aW9uIHVuaW9uQXJyYXlzICh4LCB5KSB7XG5cdFx0dmFyIG9iaiA9IHt9O1xuXHRcdGZvciAodmFyIGkgPSB4Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS0gaSkgb2JqW3hbaV1dID0geFtpXTtcblx0XHRmb3IgKHZhciBpID0geS5sZW5ndGggLSAxOyBpID49IDA7IC0tIGkpIG9ialt5W2ldXSA9IHlbaV07XG5cdFx0dmFyIHJlcyA9IFtdO1xuXG5cdFx0Zm9yICh2YXIgayBpbiBvYmopIHtcblx0XHRcdHJlcy5wdXNoKG9ialtrXSk7XG5cdFx0fTtcblxuXHRcdHJldHVybiByZXM7XG5cdH1cblxuXHRmdW5jdGlvbiBleHRlbmRPYmplY3QoZGVzdGluYXRpb24sIHNvdXJjZSkge1xuXHRcdHZhciBkZXN0VHlwZTtcblxuXHRcdGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHtcblx0XHRcdGlmIChzb3VyY2UuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBzb3VyY2Vba2V5XSkge1xuXHRcdFx0XHRkZXN0VHlwZSA9IGV4cG9ydHMuZ2V0VHlwZShkZXN0aW5hdGlvbltrZXldKTtcblx0XHRcdFx0aWYgKGtleSAmJiBkZXN0aW5hdGlvbltrZXldICYmIGRlc3RUeXBlICE9PSBcImFycmF5XCIgJiYgZGVzdFR5cGUgIT09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0XHRleHRlbmRPYmplY3QoZGVzdGluYXRpb25ba2V5XSwgc291cmNlW2tleV0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHZhciBib3RoQXJyYXlzID0gZXhwb3J0cy5nZXRUeXBlKGRlc3RpbmF0aW9uW2tleV0pID09PSBcImFycmF5XCIgJiYgZXhwb3J0cy5nZXRUeXBlKHNvdXJjZVtrZXldKSA9PT0gXCJhcnJheVwiO1xuXHRcdFx0XHRcdGlmIChib3RoQXJyYXlzKSB7XG5cdFx0XHRcdFx0XHRkZXN0aW5hdGlvbltrZXldID0gdW5pb25BcnJheXMoZGVzdGluYXRpb25ba2V5XSwgc291cmNlW2tleV0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRkZXN0aW5hdGlvbltrZXldID0gc291cmNlW2tleV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gbWVyZ2Uob2JqMSwgb2JqMikge1xuXHRcdHZhciBtZXJnZWQgPSB7fTtcblx0XHRleHRlbmRPYmplY3QobWVyZ2VkLCBvYmoxKTtcblx0XHRleHRlbmRPYmplY3QobWVyZ2VkLCBvYmoyKTtcblxuXHRcdHJldHVybiBtZXJnZWQ7XG5cdH1cblxuXHRleHBvcnRzLmlzTWFwcGVkID0gZnVuY3Rpb24gKHZpZXdNb2RlbCkge1xuXHRcdHZhciB1bndyYXBwZWQgPSBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKHZpZXdNb2RlbCk7XG5cdFx0cmV0dXJuIHVud3JhcHBlZCAmJiB1bndyYXBwZWRbbWFwcGluZ1Byb3BlcnR5XTtcblx0fVxuXG5cdGV4cG9ydHMuZnJvbUpTID0gZnVuY3Rpb24gKGpzT2JqZWN0IC8qLCBpbnB1dE9wdGlvbnMsIHRhcmdldCovICkge1xuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09IDApIHRocm93IG5ldyBFcnJvcihcIldoZW4gY2FsbGluZyBrby5mcm9tSlMsIHBhc3MgdGhlIG9iamVjdCB5b3Ugd2FudCB0byBjb252ZXJ0LlwiKTtcblxuXHRcdHRyeSB7XG5cdFx0XHRpZiAoIW1hcHBpbmdOZXN0aW5nKyspIHtcblx0XHRcdFx0ZGVwZW5kZW50T2JzZXJ2YWJsZXMgPSBbXTtcblx0XHRcdFx0dmlzaXRlZE9iamVjdHMgPSBuZXcgb2JqZWN0TG9va3VwKCk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBvcHRpb25zO1xuXHRcdFx0dmFyIHRhcmdldDtcblxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikge1xuXHRcdFx0XHRpZiAoYXJndW1lbnRzWzFdW21hcHBpbmdQcm9wZXJ0eV0pIHtcblx0XHRcdFx0XHR0YXJnZXQgPSBhcmd1bWVudHNbMV07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b3B0aW9ucyA9IGFyZ3VtZW50c1sxXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykge1xuXHRcdFx0XHRvcHRpb25zID0gYXJndW1lbnRzWzFdO1xuXHRcdFx0XHR0YXJnZXQgPSBhcmd1bWVudHNbMl07XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0YXJnZXQpIHtcblx0XHRcdFx0b3B0aW9ucyA9IG1lcmdlKG9wdGlvbnMsIHRhcmdldFttYXBwaW5nUHJvcGVydHldKTtcblx0XHRcdH1cblx0XHRcdG9wdGlvbnMgPSBmaWxsT3B0aW9ucyhvcHRpb25zKTtcblxuXHRcdFx0dmFyIHJlc3VsdCA9IHVwZGF0ZVZpZXdNb2RlbCh0YXJnZXQsIGpzT2JqZWN0LCBvcHRpb25zKTtcblx0XHRcdGlmICh0YXJnZXQpIHtcblx0XHRcdFx0cmVzdWx0ID0gdGFyZ2V0O1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBFdmFsdWF0ZSBhbnkgZGVwZW5kZW50IG9ic2VydmFibGVzIHRoYXQgd2VyZSBwcm94aWVkLlxuXHRcdFx0Ly8gRG8gdGhpcyBhZnRlciB0aGUgbW9kZWwncyBvYnNlcnZhYmxlcyBoYXZlIGJlZW4gY3JlYXRlZFxuXHRcdFx0aWYgKCEtLW1hcHBpbmdOZXN0aW5nKSB7XG5cdFx0XHRcdHdoaWxlIChkZXBlbmRlbnRPYnNlcnZhYmxlcy5sZW5ndGgpIHtcblx0XHRcdFx0XHR2YXIgRE8gPSBkZXBlbmRlbnRPYnNlcnZhYmxlcy5wb3AoKTtcblx0XHRcdFx0XHRpZiAoRE8pIHtcblx0XHRcdFx0XHRcdERPKCk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdC8vIE1vdmUgdGhpcyBtYWdpYyBwcm9wZXJ0eSB0byB0aGUgdW5kZXJseWluZyBkZXBlbmRlbnQgb2JzZXJ2YWJsZVxuXHRcdFx0XHRcdFx0RE8uX19ET1tcInRocm90dGxlRXZhbHVhdGlvblwiXSA9IERPW1widGhyb3R0bGVFdmFsdWF0aW9uXCJdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBTYXZlIGFueSBuZXcgbWFwcGluZyBvcHRpb25zIGluIHRoZSB2aWV3IG1vZGVsLCBzbyB0aGF0IHVwZGF0ZUZyb21KUyBjYW4gdXNlIHRoZW0gbGF0ZXIuXG5cdFx0XHRyZXN1bHRbbWFwcGluZ1Byb3BlcnR5XSA9IG1lcmdlKHJlc3VsdFttYXBwaW5nUHJvcGVydHldLCBvcHRpb25zKTtcblxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9IGNhdGNoKGUpIHtcblx0XHRcdG1hcHBpbmdOZXN0aW5nID0gMDtcblx0XHRcdHRocm93IGU7XG5cdFx0fVxuXHR9O1xuXG5cdGV4cG9ydHMuZnJvbUpTT04gPSBmdW5jdGlvbiAoanNvblN0cmluZyAvKiwgb3B0aW9ucywgdGFyZ2V0Ki8gKSB7XG5cdFx0dmFyIHBhcnNlZCA9IGtvLnV0aWxzLnBhcnNlSnNvbihqc29uU3RyaW5nKTtcblx0XHRhcmd1bWVudHNbMF0gPSBwYXJzZWQ7XG5cdFx0cmV0dXJuIGV4cG9ydHMuZnJvbUpTLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdH07XG5cblx0ZXhwb3J0cy51cGRhdGVGcm9tSlMgPSBmdW5jdGlvbiAodmlld01vZGVsKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKFwia28ubWFwcGluZy51cGRhdGVGcm9tSlMsIHVzZSBrby5tYXBwaW5nLmZyb21KUyBpbnN0ZWFkLiBQbGVhc2Ugbm90ZSB0aGF0IHRoZSBvcmRlciBvZiBwYXJhbWV0ZXJzIGlzIGRpZmZlcmVudCFcIik7XG5cdH07XG5cblx0ZXhwb3J0cy51cGRhdGVGcm9tSlNPTiA9IGZ1bmN0aW9uICh2aWV3TW9kZWwpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJrby5tYXBwaW5nLnVwZGF0ZUZyb21KU09OLCB1c2Uga28ubWFwcGluZy5mcm9tSlNPTiBpbnN0ZWFkLiBQbGVhc2Ugbm90ZSB0aGF0IHRoZSBvcmRlciBvZiBwYXJhbWV0ZXJzIGlzIGRpZmZlcmVudCFcIik7XG5cdH07XG5cblx0ZXhwb3J0cy50b0pTID0gZnVuY3Rpb24gKHJvb3RPYmplY3QsIG9wdGlvbnMpIHtcblx0XHRpZiAoIWRlZmF1bHRPcHRpb25zKSBleHBvcnRzLnJlc2V0RGVmYXVsdE9wdGlvbnMoKTtcblxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09IDApIHRocm93IG5ldyBFcnJvcihcIldoZW4gY2FsbGluZyBrby5tYXBwaW5nLnRvSlMsIHBhc3MgdGhlIG9iamVjdCB5b3Ugd2FudCB0byBjb252ZXJ0LlwiKTtcblx0XHRpZiAoZXhwb3J0cy5nZXRUeXBlKGRlZmF1bHRPcHRpb25zLmlnbm9yZSkgIT09IFwiYXJyYXlcIikgdGhyb3cgbmV3IEVycm9yKFwia28ubWFwcGluZy5kZWZhdWx0T3B0aW9ucygpLmlnbm9yZSBzaG91bGQgYmUgYW4gYXJyYXkuXCIpO1xuXHRcdGlmIChleHBvcnRzLmdldFR5cGUoZGVmYXVsdE9wdGlvbnMuaW5jbHVkZSkgIT09IFwiYXJyYXlcIikgdGhyb3cgbmV3IEVycm9yKFwia28ubWFwcGluZy5kZWZhdWx0T3B0aW9ucygpLmluY2x1ZGUgc2hvdWxkIGJlIGFuIGFycmF5LlwiKTtcblx0XHRpZiAoZXhwb3J0cy5nZXRUeXBlKGRlZmF1bHRPcHRpb25zLmNvcHkpICE9PSBcImFycmF5XCIpIHRocm93IG5ldyBFcnJvcihcImtvLm1hcHBpbmcuZGVmYXVsdE9wdGlvbnMoKS5jb3B5IHNob3VsZCBiZSBhbiBhcnJheS5cIik7XG5cblx0XHQvLyBNZXJnZSBpbiB0aGUgb3B0aW9ucyB1c2VkIGluIGZyb21KU1xuXHRcdG9wdGlvbnMgPSBmaWxsT3B0aW9ucyhvcHRpb25zLCByb290T2JqZWN0W21hcHBpbmdQcm9wZXJ0eV0pO1xuXG5cdFx0Ly8gV2UganVzdCB1bndyYXAgZXZlcnl0aGluZyBhdCBldmVyeSBsZXZlbCBpbiB0aGUgb2JqZWN0IGdyYXBoXG5cdFx0cmV0dXJuIGV4cG9ydHMudmlzaXRNb2RlbChyb290T2JqZWN0LCBmdW5jdGlvbiAoeCkge1xuXHRcdFx0cmV0dXJuIGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUoeClcblx0XHR9LCBvcHRpb25zKTtcblx0fTtcblxuXHRleHBvcnRzLnRvSlNPTiA9IGZ1bmN0aW9uIChyb290T2JqZWN0LCBvcHRpb25zKSB7XG5cdFx0dmFyIHBsYWluSmF2YVNjcmlwdE9iamVjdCA9IGV4cG9ydHMudG9KUyhyb290T2JqZWN0LCBvcHRpb25zKTtcblx0XHRyZXR1cm4ga28udXRpbHMuc3RyaW5naWZ5SnNvbihwbGFpbkphdmFTY3JpcHRPYmplY3QpO1xuXHR9O1xuXG5cdGV4cG9ydHMuZGVmYXVsdE9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwKSB7XG5cdFx0XHRkZWZhdWx0T3B0aW9ucyA9IGFyZ3VtZW50c1swXTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGRlZmF1bHRPcHRpb25zO1xuXHRcdH1cblx0fTtcblxuXHRleHBvcnRzLnJlc2V0RGVmYXVsdE9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0ZGVmYXVsdE9wdGlvbnMgPSB7XG5cdFx0XHRpbmNsdWRlOiBfZGVmYXVsdE9wdGlvbnMuaW5jbHVkZS5zbGljZSgwKSxcblx0XHRcdGlnbm9yZTogX2RlZmF1bHRPcHRpb25zLmlnbm9yZS5zbGljZSgwKSxcblx0XHRcdGNvcHk6IF9kZWZhdWx0T3B0aW9ucy5jb3B5LnNsaWNlKDApXG5cdFx0fTtcblx0fTtcblxuXHRleHBvcnRzLmdldFR5cGUgPSBmdW5jdGlvbih4KSB7XG5cdFx0aWYgKCh4KSAmJiAodHlwZW9mICh4KSA9PT0gXCJvYmplY3RcIikpIHtcblx0XHRcdGlmICh4LmNvbnN0cnVjdG9yID09PSBEYXRlKSByZXR1cm4gXCJkYXRlXCI7XG5cdFx0XHRpZiAoeC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHJldHVybiBcImFycmF5XCI7XG5cdFx0fVxuXHRcdHJldHVybiB0eXBlb2YgeDtcblx0fVxuXG5cdGZ1bmN0aW9uIGZpbGxPcHRpb25zKHJhd09wdGlvbnMsIG90aGVyT3B0aW9ucykge1xuXHRcdHZhciBvcHRpb25zID0gbWVyZ2Uoe30sIHJhd09wdGlvbnMpO1xuXG5cdFx0Ly8gTW92ZSByZWNvZ25pemVkIHJvb3QtbGV2ZWwgcHJvcGVydGllcyBpbnRvIGEgcm9vdCBuYW1lc3BhY2Vcblx0XHRmb3IgKHZhciBpID0gcmVjb2duaXplZFJvb3RQcm9wZXJ0aWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHR2YXIgcHJvcGVydHkgPSByZWNvZ25pemVkUm9vdFByb3BlcnRpZXNbaV07XG5cdFx0XHRcblx0XHRcdC8vIENhcnJ5IG9uLCB1bmxlc3MgdGhpcyBwcm9wZXJ0eSBpcyBwcmVzZW50XG5cdFx0XHRpZiAoIW9wdGlvbnNbcHJvcGVydHldKSBjb250aW51ZTtcblx0XHRcdFxuXHRcdFx0Ly8gTW92ZSB0aGUgcHJvcGVydHkgaW50byB0aGUgcm9vdCBuYW1lc3BhY2Vcblx0XHRcdGlmICghKG9wdGlvbnNbXCJcIl0gaW5zdGFuY2VvZiBPYmplY3QpKSBvcHRpb25zW1wiXCJdID0ge307XG5cdFx0XHRvcHRpb25zW1wiXCJdW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xuXHRcdFx0ZGVsZXRlIG9wdGlvbnNbcHJvcGVydHldO1xuXHRcdH1cblxuXHRcdGlmIChvdGhlck9wdGlvbnMpIHtcblx0XHRcdG9wdGlvbnMuaWdub3JlID0gbWVyZ2VBcnJheXMob3RoZXJPcHRpb25zLmlnbm9yZSwgb3B0aW9ucy5pZ25vcmUpO1xuXHRcdFx0b3B0aW9ucy5pbmNsdWRlID0gbWVyZ2VBcnJheXMob3RoZXJPcHRpb25zLmluY2x1ZGUsIG9wdGlvbnMuaW5jbHVkZSk7XG5cdFx0XHRvcHRpb25zLmNvcHkgPSBtZXJnZUFycmF5cyhvdGhlck9wdGlvbnMuY29weSwgb3B0aW9ucy5jb3B5KTtcblx0XHRcdG9wdGlvbnMub2JzZXJ2ZSA9IG1lcmdlQXJyYXlzKG90aGVyT3B0aW9ucy5vYnNlcnZlLCBvcHRpb25zLm9ic2VydmUpO1xuXHRcdH1cblx0XHRvcHRpb25zLmlnbm9yZSA9IG1lcmdlQXJyYXlzKG9wdGlvbnMuaWdub3JlLCBkZWZhdWx0T3B0aW9ucy5pZ25vcmUpO1xuXHRcdG9wdGlvbnMuaW5jbHVkZSA9IG1lcmdlQXJyYXlzKG9wdGlvbnMuaW5jbHVkZSwgZGVmYXVsdE9wdGlvbnMuaW5jbHVkZSk7XG5cdFx0b3B0aW9ucy5jb3B5ID0gbWVyZ2VBcnJheXMob3B0aW9ucy5jb3B5LCBkZWZhdWx0T3B0aW9ucy5jb3B5KTtcblx0XHRvcHRpb25zLm9ic2VydmUgPSBtZXJnZUFycmF5cyhvcHRpb25zLm9ic2VydmUsIGRlZmF1bHRPcHRpb25zLm9ic2VydmUpO1xuXG5cdFx0b3B0aW9ucy5tYXBwZWRQcm9wZXJ0aWVzID0gb3B0aW9ucy5tYXBwZWRQcm9wZXJ0aWVzIHx8IHt9O1xuXHRcdG9wdGlvbnMuY29waWVkUHJvcGVydGllcyA9IG9wdGlvbnMuY29waWVkUHJvcGVydGllcyB8fCB7fTtcblx0XHRyZXR1cm4gb3B0aW9ucztcblx0fVxuXG5cdGZ1bmN0aW9uIG1lcmdlQXJyYXlzKGEsIGIpIHtcblx0XHRpZiAoZXhwb3J0cy5nZXRUeXBlKGEpICE9PSBcImFycmF5XCIpIHtcblx0XHRcdGlmIChleHBvcnRzLmdldFR5cGUoYSkgPT09IFwidW5kZWZpbmVkXCIpIGEgPSBbXTtcblx0XHRcdGVsc2UgYSA9IFthXTtcblx0XHR9XG5cdFx0aWYgKGV4cG9ydHMuZ2V0VHlwZShiKSAhPT0gXCJhcnJheVwiKSB7XG5cdFx0XHRpZiAoZXhwb3J0cy5nZXRUeXBlKGIpID09PSBcInVuZGVmaW5lZFwiKSBiID0gW107XG5cdFx0XHRlbHNlIGIgPSBbYl07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGtvLnV0aWxzLmFycmF5R2V0RGlzdGluY3RWYWx1ZXMoYS5jb25jYXQoYikpO1xuXHR9XG5cblx0Ly8gV2hlbiB1c2luZyBhICdjcmVhdGUnIGNhbGxiYWNrLCB3ZSBwcm94eSB0aGUgZGVwZW5kZW50IG9ic2VydmFibGUgc28gdGhhdCBpdCBkb2Vzbid0IGltbWVkaWF0ZWx5IGV2YWx1YXRlIG9uIGNyZWF0aW9uLlxuXHQvLyBUaGUgcmVhc29uIGlzIHRoYXQgdGhlIGRlcGVuZGVudCBvYnNlcnZhYmxlcyBpbiB0aGUgdXNlci1zcGVjaWZpZWQgY2FsbGJhY2sgbWF5IGNvbnRhaW4gcmVmZXJlbmNlcyB0byBwcm9wZXJ0aWVzIHRoYXQgaGF2ZSBub3QgYmVlbiBtYXBwZWQgeWV0LlxuXHRmdW5jdGlvbiB3aXRoUHJveHlEZXBlbmRlbnRPYnNlcnZhYmxlKGRlcGVuZGVudE9ic2VydmFibGVzLCBjYWxsYmFjaykge1xuXHRcdHZhciBsb2NhbERPID0ga28uZGVwZW5kZW50T2JzZXJ2YWJsZTtcblx0XHRrby5kZXBlbmRlbnRPYnNlcnZhYmxlID0gZnVuY3Rpb24gKHJlYWQsIG93bmVyLCBvcHRpb25zKSB7XG5cdFx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXHRcdFx0aWYgKHJlYWQgJiYgdHlwZW9mIHJlYWQgPT0gXCJvYmplY3RcIikgeyAvLyBtaXJyb3JzIGNvbmRpdGlvbiBpbiBrbm9ja291dCBpbXBsZW1lbnRhdGlvbiBvZiBETydzXG5cdFx0XHRcdG9wdGlvbnMgPSByZWFkO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgcmVhbERlZmVyRXZhbHVhdGlvbiA9IG9wdGlvbnMuZGVmZXJFdmFsdWF0aW9uO1xuXG5cdFx0XHR2YXIgaXNSZW1vdmVkID0gZmFsc2U7XG5cblx0XHRcdC8vIFdlIHdyYXAgdGhlIG9yaWdpbmFsIGRlcGVuZGVudCBvYnNlcnZhYmxlIHNvIHRoYXQgd2UgY2FuIHJlbW92ZSBpdCBmcm9tIHRoZSAnZGVwZW5kZW50T2JzZXJ2YWJsZXMnIGxpc3Qgd2UgbmVlZCB0byBldmFsdWF0ZSBhZnRlciBtYXBwaW5nIGhhc1xuXHRcdFx0Ly8gY29tcGxldGVkIGlmIHRoZSB1c2VyIGFscmVhZHkgZXZhbHVhdGVkIHRoZSBETyB0aGVtc2VsdmVzIGluIHRoZSBtZWFudGltZS5cblx0XHRcdHZhciB3cmFwID0gZnVuY3Rpb24gKERPKSB7XG5cdFx0XHRcdC8vIFRlbXBvcmFyaWx5IHJldmVydCBrby5kZXBlbmRlbnRPYnNlcnZhYmxlLCBzaW5jZSBpdCBpcyB1c2VkIGluIGtvLmlzV3JpdGVhYmxlT2JzZXJ2YWJsZVxuXHRcdFx0XHR2YXIgdG1wID0ga28uZGVwZW5kZW50T2JzZXJ2YWJsZTtcblx0XHRcdFx0a28uZGVwZW5kZW50T2JzZXJ2YWJsZSA9IHJlYWxLb0RlcGVuZGVudE9ic2VydmFibGU7XG5cdFx0XHRcdHZhciBpc1dyaXRlYWJsZSA9IGtvLmlzV3JpdGVhYmxlT2JzZXJ2YWJsZShETyk7XG5cdFx0XHRcdGtvLmRlcGVuZGVudE9ic2VydmFibGUgPSB0bXA7XG5cblx0XHRcdFx0dmFyIHdyYXBwZWQgPSByZWFsS29EZXBlbmRlbnRPYnNlcnZhYmxlKHtcblx0XHRcdFx0XHRyZWFkOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRpZiAoIWlzUmVtb3ZlZCkge1xuXHRcdFx0XHRcdFx0XHRrby51dGlscy5hcnJheVJlbW92ZUl0ZW0oZGVwZW5kZW50T2JzZXJ2YWJsZXMsIERPKTtcblx0XHRcdFx0XHRcdFx0aXNSZW1vdmVkID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiBETy5hcHBseShETywgYXJndW1lbnRzKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHdyaXRlOiBpc1dyaXRlYWJsZSAmJiBmdW5jdGlvbiAodmFsKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gRE8odmFsKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGRlZmVyRXZhbHVhdGlvbjogdHJ1ZVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0aWYgKERFQlVHKSB3cmFwcGVkLl93cmFwcGVyID0gdHJ1ZTtcblx0XHRcdFx0d3JhcHBlZC5fX0RPID0gRE87XG5cdFx0XHRcdHJldHVybiB3cmFwcGVkO1xuXHRcdFx0fTtcblx0XHRcdFxuXHRcdFx0b3B0aW9ucy5kZWZlckV2YWx1YXRpb24gPSB0cnVlOyAvLyB3aWxsIGVpdGhlciBzZXQgZm9yIGp1c3Qgb3B0aW9ucywgb3IgYm90aCByZWFkL29wdGlvbnMuXG5cdFx0XHR2YXIgcmVhbERlcGVuZGVudE9ic2VydmFibGUgPSBuZXcgcmVhbEtvRGVwZW5kZW50T2JzZXJ2YWJsZShyZWFkLCBvd25lciwgb3B0aW9ucyk7XG5cblx0XHRcdGlmICghcmVhbERlZmVyRXZhbHVhdGlvbikge1xuXHRcdFx0XHRyZWFsRGVwZW5kZW50T2JzZXJ2YWJsZSA9IHdyYXAocmVhbERlcGVuZGVudE9ic2VydmFibGUpO1xuXHRcdFx0XHRkZXBlbmRlbnRPYnNlcnZhYmxlcy5wdXNoKHJlYWxEZXBlbmRlbnRPYnNlcnZhYmxlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJlYWxEZXBlbmRlbnRPYnNlcnZhYmxlO1xuXHRcdH1cblx0XHRrby5kZXBlbmRlbnRPYnNlcnZhYmxlLmZuID0gcmVhbEtvRGVwZW5kZW50T2JzZXJ2YWJsZS5mbjtcblx0XHRrby5jb21wdXRlZCA9IGtvLmRlcGVuZGVudE9ic2VydmFibGU7XG5cdFx0dmFyIHJlc3VsdCA9IGNhbGxiYWNrKCk7XG5cdFx0a28uZGVwZW5kZW50T2JzZXJ2YWJsZSA9IGxvY2FsRE87XG5cdFx0a28uY29tcHV0ZWQgPSBrby5kZXBlbmRlbnRPYnNlcnZhYmxlO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cblxuXHRmdW5jdGlvbiB1cGRhdGVWaWV3TW9kZWwobWFwcGVkUm9vdE9iamVjdCwgcm9vdE9iamVjdCwgb3B0aW9ucywgcGFyZW50TmFtZSwgcGFyZW50LCBwYXJlbnRQcm9wZXJ0eU5hbWUsIG1hcHBlZFBhcmVudCkge1xuXHRcdHZhciBpc0FycmF5ID0gZXhwb3J0cy5nZXRUeXBlKGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUocm9vdE9iamVjdCkpID09PSBcImFycmF5XCI7XG5cblx0XHRwYXJlbnRQcm9wZXJ0eU5hbWUgPSBwYXJlbnRQcm9wZXJ0eU5hbWUgfHwgXCJcIjtcblxuXHRcdC8vIElmIHRoaXMgb2JqZWN0IHdhcyBhbHJlYWR5IG1hcHBlZCBwcmV2aW91c2x5LCB0YWtlIHRoZSBvcHRpb25zIGZyb20gdGhlcmUgYW5kIG1lcmdlIHRoZW0gd2l0aCBvdXIgZXhpc3Rpbmcgb25lcy5cblx0XHRpZiAoZXhwb3J0cy5pc01hcHBlZChtYXBwZWRSb290T2JqZWN0KSkge1xuXHRcdFx0dmFyIHByZXZpb3VzTWFwcGluZyA9IGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUobWFwcGVkUm9vdE9iamVjdClbbWFwcGluZ1Byb3BlcnR5XTtcblx0XHRcdG9wdGlvbnMgPSBtZXJnZShwcmV2aW91c01hcHBpbmcsIG9wdGlvbnMpO1xuXHRcdH1cblxuXHRcdHZhciBjYWxsYmFja1BhcmFtcyA9IHtcblx0XHRcdGRhdGE6IHJvb3RPYmplY3QsXG5cdFx0XHRwYXJlbnQ6IG1hcHBlZFBhcmVudCB8fCBwYXJlbnRcblx0XHR9O1xuXG5cdFx0dmFyIGhhc0NyZWF0ZUNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIG9wdGlvbnNbcGFyZW50TmFtZV0gJiYgb3B0aW9uc1twYXJlbnROYW1lXS5jcmVhdGUgaW5zdGFuY2VvZiBGdW5jdGlvbjtcblx0XHR9O1xuXG5cdFx0dmFyIGNyZWF0ZUNhbGxiYWNrID0gZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdHJldHVybiB3aXRoUHJveHlEZXBlbmRlbnRPYnNlcnZhYmxlKGRlcGVuZGVudE9ic2VydmFibGVzLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZiAoa28udXRpbHMudW53cmFwT2JzZXJ2YWJsZShwYXJlbnQpIGluc3RhbmNlb2YgQXJyYXkpIHtcblx0XHRcdFx0XHRyZXR1cm4gb3B0aW9uc1twYXJlbnROYW1lXS5jcmVhdGUoe1xuXHRcdFx0XHRcdFx0ZGF0YTogZGF0YSB8fCBjYWxsYmFja1BhcmFtcy5kYXRhLFxuXHRcdFx0XHRcdFx0cGFyZW50OiBjYWxsYmFja1BhcmFtcy5wYXJlbnQsXG5cdFx0XHRcdFx0XHRza2lwOiBlbXB0eVJldHVyblxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiBvcHRpb25zW3BhcmVudE5hbWVdLmNyZWF0ZSh7XG5cdFx0XHRcdFx0XHRkYXRhOiBkYXRhIHx8IGNhbGxiYWNrUGFyYW1zLmRhdGEsXG5cdFx0XHRcdFx0XHRwYXJlbnQ6IGNhbGxiYWNrUGFyYW1zLnBhcmVudFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XHRcdFx0XHRcblx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHR2YXIgaGFzVXBkYXRlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gb3B0aW9uc1twYXJlbnROYW1lXSAmJiBvcHRpb25zW3BhcmVudE5hbWVdLnVwZGF0ZSBpbnN0YW5jZW9mIEZ1bmN0aW9uO1xuXHRcdH07XG5cblx0XHR2YXIgdXBkYXRlQ2FsbGJhY2sgPSBmdW5jdGlvbiAob2JqLCBkYXRhKSB7XG5cdFx0XHR2YXIgcGFyYW1zID0ge1xuXHRcdFx0XHRkYXRhOiBkYXRhIHx8IGNhbGxiYWNrUGFyYW1zLmRhdGEsXG5cdFx0XHRcdHBhcmVudDogY2FsbGJhY2tQYXJhbXMucGFyZW50LFxuXHRcdFx0XHR0YXJnZXQ6IGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUob2JqKVxuXHRcdFx0fTtcblxuXHRcdFx0aWYgKGtvLmlzV3JpdGVhYmxlT2JzZXJ2YWJsZShvYmopKSB7XG5cdFx0XHRcdHBhcmFtcy5vYnNlcnZhYmxlID0gb2JqO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3B0aW9uc1twYXJlbnROYW1lXS51cGRhdGUocGFyYW1zKTtcblx0XHR9XG5cblx0XHR2YXIgYWxyZWFkeU1hcHBlZCA9IHZpc2l0ZWRPYmplY3RzLmdldChyb290T2JqZWN0KTtcblx0XHRpZiAoYWxyZWFkeU1hcHBlZCkge1xuXHRcdFx0cmV0dXJuIGFscmVhZHlNYXBwZWQ7XG5cdFx0fVxuXG5cdFx0cGFyZW50TmFtZSA9IHBhcmVudE5hbWUgfHwgXCJcIjtcblxuXHRcdGlmICghaXNBcnJheSkge1xuXHRcdFx0Ly8gRm9yIGF0b21pYyB0eXBlcywgZG8gYSBkaXJlY3QgdXBkYXRlIG9uIHRoZSBvYnNlcnZhYmxlXG5cdFx0XHRpZiAoIWNhbkhhdmVQcm9wZXJ0aWVzKHJvb3RPYmplY3QpKSB7XG5cdFx0XHRcdHN3aXRjaCAoZXhwb3J0cy5nZXRUeXBlKHJvb3RPYmplY3QpKSB7XG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdGlmIChoYXNVcGRhdGVDYWxsYmFjaygpKSB7XG5cdFx0XHRcdFx0XHRpZiAoa28uaXNXcml0ZWFibGVPYnNlcnZhYmxlKHJvb3RPYmplY3QpKSB7XG5cdFx0XHRcdFx0XHRcdHJvb3RPYmplY3QodXBkYXRlQ2FsbGJhY2socm9vdE9iamVjdCkpO1xuXHRcdFx0XHRcdFx0XHRtYXBwZWRSb290T2JqZWN0ID0gcm9vdE9iamVjdDtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QgPSB1cGRhdGVDYWxsYmFjayhyb290T2JqZWN0KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bWFwcGVkUm9vdE9iamVjdCA9IHJvb3RPYmplY3Q7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdGlmIChrby5pc1dyaXRlYWJsZU9ic2VydmFibGUobWFwcGVkUm9vdE9iamVjdCkpIHtcblx0XHRcdFx0XHRcdGlmIChoYXNVcGRhdGVDYWxsYmFjaygpKSB7XG5cdFx0XHRcdFx0XHRcdHZhciB2YWx1ZVRvV3JpdGUgPSB1cGRhdGVDYWxsYmFjayhtYXBwZWRSb290T2JqZWN0KTtcblx0XHRcdFx0XHRcdFx0bWFwcGVkUm9vdE9iamVjdCh2YWx1ZVRvV3JpdGUpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWVUb1dyaXRlO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dmFyIHZhbHVlVG9Xcml0ZSA9IGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUocm9vdE9iamVjdCk7XG5cdFx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QodmFsdWVUb1dyaXRlKTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlVG9Xcml0ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dmFyIGhhc0NyZWF0ZU9yVXBkYXRlQ2FsbGJhY2sgPSBoYXNDcmVhdGVDYWxsYmFjaygpIHx8IGhhc1VwZGF0ZUNhbGxiYWNrKCk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmIChoYXNDcmVhdGVDYWxsYmFjaygpKSB7XG5cdFx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QgPSBjcmVhdGVDYWxsYmFjaygpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0bWFwcGVkUm9vdE9iamVjdCA9IGtvLm9ic2VydmFibGUoa28udXRpbHMudW53cmFwT2JzZXJ2YWJsZShyb290T2JqZWN0KSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChoYXNVcGRhdGVDYWxsYmFjaygpKSB7XG5cdFx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QodXBkYXRlQ2FsbGJhY2sobWFwcGVkUm9vdE9iamVjdCkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZiAoaGFzQ3JlYXRlT3JVcGRhdGVDYWxsYmFjaykgcmV0dXJuIG1hcHBlZFJvb3RPYmplY3Q7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QgPSBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKG1hcHBlZFJvb3RPYmplY3QpO1xuXHRcdFx0XHRpZiAoIW1hcHBlZFJvb3RPYmplY3QpIHtcblx0XHRcdFx0XHRpZiAoaGFzQ3JlYXRlQ2FsbGJhY2soKSkge1xuXHRcdFx0XHRcdFx0dmFyIHJlc3VsdCA9IGNyZWF0ZUNhbGxiYWNrKCk7XG5cblx0XHRcdFx0XHRcdGlmIChoYXNVcGRhdGVDYWxsYmFjaygpKSB7XG5cdFx0XHRcdFx0XHRcdHJlc3VsdCA9IHVwZGF0ZUNhbGxiYWNrKHJlc3VsdCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmIChoYXNVcGRhdGVDYWxsYmFjaygpKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiB1cGRhdGVDYWxsYmFjayhyZXN1bHQpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRtYXBwZWRSb290T2JqZWN0ID0ge307XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGhhc1VwZGF0ZUNhbGxiYWNrKCkpIHtcblx0XHRcdFx0XHRtYXBwZWRSb290T2JqZWN0ID0gdXBkYXRlQ2FsbGJhY2sobWFwcGVkUm9vdE9iamVjdCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2aXNpdGVkT2JqZWN0cy5zYXZlKHJvb3RPYmplY3QsIG1hcHBlZFJvb3RPYmplY3QpO1xuXHRcdFx0XHRpZiAoaGFzVXBkYXRlQ2FsbGJhY2soKSkgcmV0dXJuIG1hcHBlZFJvb3RPYmplY3Q7XG5cblx0XHRcdFx0Ly8gRm9yIG5vbi1hdG9taWMgdHlwZXMsIHZpc2l0IGFsbCBwcm9wZXJ0aWVzIGFuZCB1cGRhdGUgcmVjdXJzaXZlbHlcblx0XHRcdFx0dmlzaXRQcm9wZXJ0aWVzT3JBcnJheUVudHJpZXMocm9vdE9iamVjdCwgZnVuY3Rpb24gKGluZGV4ZXIpIHtcblx0XHRcdFx0XHR2YXIgZnVsbFByb3BlcnR5TmFtZSA9IHBhcmVudFByb3BlcnR5TmFtZS5sZW5ndGggPyBwYXJlbnRQcm9wZXJ0eU5hbWUgKyBcIi5cIiArIGluZGV4ZXIgOiBpbmRleGVyO1xuXG5cdFx0XHRcdFx0aWYgKGtvLnV0aWxzLmFycmF5SW5kZXhPZihvcHRpb25zLmlnbm9yZSwgZnVsbFByb3BlcnR5TmFtZSkgIT0gLTEpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoa28udXRpbHMuYXJyYXlJbmRleE9mKG9wdGlvbnMuY29weSwgZnVsbFByb3BlcnR5TmFtZSkgIT0gLTEpIHtcblx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3RbaW5kZXhlcl0gPSByb290T2JqZWN0W2luZGV4ZXJdO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmKHR5cGVvZiByb290T2JqZWN0W2luZGV4ZXJdICE9IFwib2JqZWN0XCIgJiYgdHlwZW9mIHJvb3RPYmplY3RbaW5kZXhlcl0gIT0gXCJhcnJheVwiICYmIG9wdGlvbnMub2JzZXJ2ZS5sZW5ndGggPiAwICYmIGtvLnV0aWxzLmFycmF5SW5kZXhPZihvcHRpb25zLm9ic2VydmUsIGZ1bGxQcm9wZXJ0eU5hbWUpID09IC0xKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3RbaW5kZXhlcl0gPSByb290T2JqZWN0W2luZGV4ZXJdO1xuXHRcdFx0XHRcdFx0b3B0aW9ucy5jb3BpZWRQcm9wZXJ0aWVzW2Z1bGxQcm9wZXJ0eU5hbWVdID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Ly8gSW4gY2FzZSB3ZSBhcmUgYWRkaW5nIGFuIGFscmVhZHkgbWFwcGVkIHByb3BlcnR5LCBmaWxsIGl0IHdpdGggdGhlIHByZXZpb3VzbHkgbWFwcGVkIHByb3BlcnR5IHZhbHVlIHRvIHByZXZlbnQgcmVjdXJzaW9uLlxuXHRcdFx0XHRcdC8vIElmIHRoaXMgaXMgYSBwcm9wZXJ0eSB0aGF0IHdhcyBnZW5lcmF0ZWQgYnkgZnJvbUpTLCB3ZSBzaG91bGQgdXNlIHRoZSBvcHRpb25zIHNwZWNpZmllZCB0aGVyZVxuXHRcdFx0XHRcdHZhciBwcmV2TWFwcGVkUHJvcGVydHkgPSB2aXNpdGVkT2JqZWN0cy5nZXQocm9vdE9iamVjdFtpbmRleGVyXSk7XG5cdFx0XHRcdFx0dmFyIHJldHZhbCA9IHVwZGF0ZVZpZXdNb2RlbChtYXBwZWRSb290T2JqZWN0W2luZGV4ZXJdLCByb290T2JqZWN0W2luZGV4ZXJdLCBvcHRpb25zLCBpbmRleGVyLCBtYXBwZWRSb290T2JqZWN0LCBmdWxsUHJvcGVydHlOYW1lLCBtYXBwZWRSb290T2JqZWN0KTtcblx0XHRcdFx0XHR2YXIgdmFsdWUgPSBwcmV2TWFwcGVkUHJvcGVydHkgfHwgcmV0dmFsO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKG9wdGlvbnMub2JzZXJ2ZS5sZW5ndGggPiAwICYmIGtvLnV0aWxzLmFycmF5SW5kZXhPZihvcHRpb25zLm9ic2VydmUsIGZ1bGxQcm9wZXJ0eU5hbWUpID09IC0xKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3RbaW5kZXhlcl0gPSB2YWx1ZSgpO1xuXHRcdFx0XHRcdFx0b3B0aW9ucy5jb3BpZWRQcm9wZXJ0aWVzW2Z1bGxQcm9wZXJ0eU5hbWVdID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYgKGtvLmlzV3JpdGVhYmxlT2JzZXJ2YWJsZShtYXBwZWRSb290T2JqZWN0W2luZGV4ZXJdKSkge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKHZhbHVlKTtcblx0XHRcdFx0XHRcdGlmIChtYXBwZWRSb290T2JqZWN0W2luZGV4ZXJdKCkgIT09IHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3RbaW5kZXhlcl0odmFsdWUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IG1hcHBlZFJvb3RPYmplY3RbaW5kZXhlcl0gPT09IHVuZGVmaW5lZCA/IHZhbHVlIDoga28udXRpbHMudW53cmFwT2JzZXJ2YWJsZSh2YWx1ZSk7XG5cdFx0XHRcdFx0XHRtYXBwZWRSb290T2JqZWN0W2luZGV4ZXJdID0gdmFsdWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0b3B0aW9ucy5tYXBwZWRQcm9wZXJ0aWVzW2Z1bGxQcm9wZXJ0eU5hbWVdID0gdHJ1ZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHsgLy9tYXBwZWRSb290T2JqZWN0IGlzIGFuIGFycmF5XG5cdFx0XHR2YXIgY2hhbmdlcyA9IFtdO1xuXG5cdFx0XHR2YXIgaGFzS2V5Q2FsbGJhY2sgPSBmYWxzZTtcblx0XHRcdHZhciBrZXlDYWxsYmFjayA9IGZ1bmN0aW9uICh4KSB7XG5cdFx0XHRcdHJldHVybiB4O1xuXHRcdFx0fVxuXHRcdFx0aWYgKG9wdGlvbnNbcGFyZW50TmFtZV0gJiYgb3B0aW9uc1twYXJlbnROYW1lXS5rZXkpIHtcblx0XHRcdFx0a2V5Q2FsbGJhY2sgPSBvcHRpb25zW3BhcmVudE5hbWVdLmtleTtcblx0XHRcdFx0aGFzS2V5Q2FsbGJhY2sgPSB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIWtvLmlzT2JzZXJ2YWJsZShtYXBwZWRSb290T2JqZWN0KSkge1xuXHRcdFx0XHQvLyBXaGVuIGNyZWF0aW5nIHRoZSBuZXcgb2JzZXJ2YWJsZSBhcnJheSwgYWxzbyBhZGQgYSBidW5jaCBvZiB1dGlsaXR5IGZ1bmN0aW9ucyB0aGF0IHRha2UgdGhlICdrZXknIG9mIHRoZSBhcnJheSBpdGVtcyBpbnRvIGFjY291bnQuXG5cdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QgPSBrby5vYnNlcnZhYmxlQXJyYXkoW10pO1xuXG5cdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QubWFwcGVkUmVtb3ZlID0gZnVuY3Rpb24gKHZhbHVlT3JQcmVkaWNhdGUpIHtcblx0XHRcdFx0XHR2YXIgcHJlZGljYXRlID0gdHlwZW9mIHZhbHVlT3JQcmVkaWNhdGUgPT0gXCJmdW5jdGlvblwiID8gdmFsdWVPclByZWRpY2F0ZSA6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUgPT09IGtleUNhbGxiYWNrKHZhbHVlT3JQcmVkaWNhdGUpO1xuXHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRyZXR1cm4gbWFwcGVkUm9vdE9iamVjdC5yZW1vdmUoZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHRcdHJldHVybiBwcmVkaWNhdGUoa2V5Q2FsbGJhY2soaXRlbSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bWFwcGVkUm9vdE9iamVjdC5tYXBwZWRSZW1vdmVBbGwgPSBmdW5jdGlvbiAoYXJyYXlPZlZhbHVlcykge1xuXHRcdFx0XHRcdHZhciBhcnJheU9mS2V5cyA9IGZpbHRlckFycmF5QnlLZXkoYXJyYXlPZlZhbHVlcywga2V5Q2FsbGJhY2spO1xuXHRcdFx0XHRcdHJldHVybiBtYXBwZWRSb290T2JqZWN0LnJlbW92ZShmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGtvLnV0aWxzLmFycmF5SW5kZXhPZihhcnJheU9mS2V5cywga2V5Q2FsbGJhY2soaXRlbSkpICE9IC0xO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bWFwcGVkUm9vdE9iamVjdC5tYXBwZWREZXN0cm95ID0gZnVuY3Rpb24gKHZhbHVlT3JQcmVkaWNhdGUpIHtcblx0XHRcdFx0XHR2YXIgcHJlZGljYXRlID0gdHlwZW9mIHZhbHVlT3JQcmVkaWNhdGUgPT0gXCJmdW5jdGlvblwiID8gdmFsdWVPclByZWRpY2F0ZSA6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUgPT09IGtleUNhbGxiYWNrKHZhbHVlT3JQcmVkaWNhdGUpO1xuXHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRyZXR1cm4gbWFwcGVkUm9vdE9iamVjdC5kZXN0cm95KGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcHJlZGljYXRlKGtleUNhbGxiYWNrKGl0ZW0pKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QubWFwcGVkRGVzdHJveUFsbCA9IGZ1bmN0aW9uIChhcnJheU9mVmFsdWVzKSB7XG5cdFx0XHRcdFx0dmFyIGFycmF5T2ZLZXlzID0gZmlsdGVyQXJyYXlCeUtleShhcnJheU9mVmFsdWVzLCBrZXlDYWxsYmFjayk7XG5cdFx0XHRcdFx0cmV0dXJuIG1hcHBlZFJvb3RPYmplY3QuZGVzdHJveShmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGtvLnV0aWxzLmFycmF5SW5kZXhPZihhcnJheU9mS2V5cywga2V5Q2FsbGJhY2soaXRlbSkpICE9IC0xO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bWFwcGVkUm9vdE9iamVjdC5tYXBwZWRJbmRleE9mID0gZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHR2YXIga2V5cyA9IGZpbHRlckFycmF5QnlLZXkobWFwcGVkUm9vdE9iamVjdCgpLCBrZXlDYWxsYmFjayk7XG5cdFx0XHRcdFx0dmFyIGtleSA9IGtleUNhbGxiYWNrKGl0ZW0pO1xuXHRcdFx0XHRcdHJldHVybiBrby51dGlscy5hcnJheUluZGV4T2Yoa2V5cywga2V5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QubWFwcGVkR2V0ID0gZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHRyZXR1cm4gbWFwcGVkUm9vdE9iamVjdCgpW21hcHBlZFJvb3RPYmplY3QubWFwcGVkSW5kZXhPZihpdGVtKV07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRtYXBwZWRSb290T2JqZWN0Lm1hcHBlZENyZWF0ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdGlmIChtYXBwZWRSb290T2JqZWN0Lm1hcHBlZEluZGV4T2YodmFsdWUpICE9PSAtMSkge1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVGhlcmUgYWxyZWFkeSBpcyBhbiBvYmplY3Qgd2l0aCB0aGUga2V5IHRoYXQgeW91IHNwZWNpZmllZC5cIik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dmFyIGl0ZW0gPSBoYXNDcmVhdGVDYWxsYmFjaygpID8gY3JlYXRlQ2FsbGJhY2sodmFsdWUpIDogdmFsdWU7XG5cdFx0XHRcdFx0aWYgKGhhc1VwZGF0ZUNhbGxiYWNrKCkpIHtcblx0XHRcdFx0XHRcdHZhciBuZXdWYWx1ZSA9IHVwZGF0ZUNhbGxiYWNrKGl0ZW0sIHZhbHVlKTtcblx0XHRcdFx0XHRcdGlmIChrby5pc1dyaXRlYWJsZU9ic2VydmFibGUoaXRlbSkpIHtcblx0XHRcdFx0XHRcdFx0aXRlbShuZXdWYWx1ZSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpdGVtID0gbmV3VmFsdWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdG1hcHBlZFJvb3RPYmplY3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHRyZXR1cm4gaXRlbTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR2YXIgY3VycmVudEFycmF5S2V5cyA9IGZpbHRlckFycmF5QnlLZXkoa28udXRpbHMudW53cmFwT2JzZXJ2YWJsZShtYXBwZWRSb290T2JqZWN0KSwga2V5Q2FsbGJhY2spLnNvcnQoKTtcblx0XHRcdHZhciBuZXdBcnJheUtleXMgPSBmaWx0ZXJBcnJheUJ5S2V5KHJvb3RPYmplY3QsIGtleUNhbGxiYWNrKTtcblx0XHRcdGlmIChoYXNLZXlDYWxsYmFjaykgbmV3QXJyYXlLZXlzLnNvcnQoKTtcblx0XHRcdHZhciBlZGl0U2NyaXB0ID0ga28udXRpbHMuY29tcGFyZUFycmF5cyhjdXJyZW50QXJyYXlLZXlzLCBuZXdBcnJheUtleXMpO1xuXG5cdFx0XHR2YXIgaWdub3JlSW5kZXhPZiA9IHt9O1xuXHRcdFx0XG5cdFx0XHR2YXIgaSwgajtcblxuXHRcdFx0dmFyIHVud3JhcHBlZFJvb3RPYmplY3QgPSBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKHJvb3RPYmplY3QpO1xuXHRcdFx0dmFyIGl0ZW1zQnlLZXkgPSB7fTtcblx0XHRcdHZhciBvcHRpbWl6ZWRLZXlzID0gdHJ1ZTtcblx0XHRcdGZvciAoaSA9IDAsIGogPSB1bndyYXBwZWRSb290T2JqZWN0Lmxlbmd0aDsgaSA8IGo7IGkrKykge1xuXHRcdFx0XHR2YXIga2V5ID0ga2V5Q2FsbGJhY2sodW53cmFwcGVkUm9vdE9iamVjdFtpXSk7XG5cdFx0XHRcdGlmIChrZXkgPT09IHVuZGVmaW5lZCB8fCBrZXkgaW5zdGFuY2VvZiBPYmplY3QpIHtcblx0XHRcdFx0XHRvcHRpbWl6ZWRLZXlzID0gZmFsc2U7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdFx0aXRlbXNCeUtleVtrZXldID0gdW53cmFwcGVkUm9vdE9iamVjdFtpXTtcblx0XHRcdH1cblxuXHRcdFx0dmFyIG5ld0NvbnRlbnRzID0gW107XG5cdFx0XHR2YXIgcGFzc2VkT3ZlciA9IDA7XG5cdFx0XHRmb3IgKGkgPSAwLCBqID0gZWRpdFNjcmlwdC5sZW5ndGg7IGkgPCBqOyBpKyspIHtcblx0XHRcdFx0dmFyIGtleSA9IGVkaXRTY3JpcHRbaV07XG5cdFx0XHRcdHZhciBtYXBwZWRJdGVtO1xuXHRcdFx0XHR2YXIgZnVsbFByb3BlcnR5TmFtZSA9IHBhcmVudFByb3BlcnR5TmFtZSArIFwiW1wiICsgaSArIFwiXVwiO1xuXHRcdFx0XHRzd2l0Y2ggKGtleS5zdGF0dXMpIHtcblx0XHRcdFx0Y2FzZSBcImFkZGVkXCI6XG5cdFx0XHRcdFx0dmFyIGl0ZW0gPSBvcHRpbWl6ZWRLZXlzID8gaXRlbXNCeUtleVtrZXkudmFsdWVdIDogZ2V0SXRlbUJ5S2V5KGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUocm9vdE9iamVjdCksIGtleS52YWx1ZSwga2V5Q2FsbGJhY2spO1xuXHRcdFx0XHRcdG1hcHBlZEl0ZW0gPSB1cGRhdGVWaWV3TW9kZWwodW5kZWZpbmVkLCBpdGVtLCBvcHRpb25zLCBwYXJlbnROYW1lLCBtYXBwZWRSb290T2JqZWN0LCBmdWxsUHJvcGVydHlOYW1lLCBwYXJlbnQpO1xuXHRcdFx0XHRcdGlmKCFoYXNDcmVhdGVDYWxsYmFjaygpKSB7XG5cdFx0XHRcdFx0XHRtYXBwZWRJdGVtID0ga28udXRpbHMudW53cmFwT2JzZXJ2YWJsZShtYXBwZWRJdGVtKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR2YXIgaW5kZXggPSBpZ25vcmFibGVJbmRleE9mKGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUocm9vdE9iamVjdCksIGl0ZW0sIGlnbm9yZUluZGV4T2YpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmIChtYXBwZWRJdGVtID09PSBlbXB0eVJldHVybikge1xuXHRcdFx0XHRcdFx0cGFzc2VkT3ZlcisrO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRuZXdDb250ZW50c1tpbmRleCAtIHBhc3NlZE92ZXJdID0gbWFwcGVkSXRlbTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZ25vcmVJbmRleE9mW2luZGV4XSA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJyZXRhaW5lZFwiOlxuXHRcdFx0XHRcdHZhciBpdGVtID0gb3B0aW1pemVkS2V5cyA/IGl0ZW1zQnlLZXlba2V5LnZhbHVlXSA6IGdldEl0ZW1CeUtleShrby51dGlscy51bndyYXBPYnNlcnZhYmxlKHJvb3RPYmplY3QpLCBrZXkudmFsdWUsIGtleUNhbGxiYWNrKTtcblx0XHRcdFx0XHRtYXBwZWRJdGVtID0gZ2V0SXRlbUJ5S2V5KG1hcHBlZFJvb3RPYmplY3QsIGtleS52YWx1ZSwga2V5Q2FsbGJhY2spO1xuXHRcdFx0XHRcdHVwZGF0ZVZpZXdNb2RlbChtYXBwZWRJdGVtLCBpdGVtLCBvcHRpb25zLCBwYXJlbnROYW1lLCBtYXBwZWRSb290T2JqZWN0LCBmdWxsUHJvcGVydHlOYW1lLCBwYXJlbnQpO1xuXG5cdFx0XHRcdFx0dmFyIGluZGV4ID0gaWdub3JhYmxlSW5kZXhPZihrby51dGlscy51bndyYXBPYnNlcnZhYmxlKHJvb3RPYmplY3QpLCBpdGVtLCBpZ25vcmVJbmRleE9mKTtcblx0XHRcdFx0XHRuZXdDb250ZW50c1tpbmRleF0gPSBtYXBwZWRJdGVtO1xuXHRcdFx0XHRcdGlnbm9yZUluZGV4T2ZbaW5kZXhdID0gdHJ1ZTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcImRlbGV0ZWRcIjpcblx0XHRcdFx0XHRtYXBwZWRJdGVtID0gZ2V0SXRlbUJ5S2V5KG1hcHBlZFJvb3RPYmplY3QsIGtleS52YWx1ZSwga2V5Q2FsbGJhY2spO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y2hhbmdlcy5wdXNoKHtcblx0XHRcdFx0XHRldmVudDoga2V5LnN0YXR1cyxcblx0XHRcdFx0XHRpdGVtOiBtYXBwZWRJdGVtXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRtYXBwZWRSb290T2JqZWN0KG5ld0NvbnRlbnRzKTtcblxuXHRcdFx0aWYgKG9wdGlvbnNbcGFyZW50TmFtZV0gJiYgb3B0aW9uc1twYXJlbnROYW1lXS5hcnJheUNoYW5nZWQpIHtcblx0XHRcdFx0a28udXRpbHMuYXJyYXlGb3JFYWNoKGNoYW5nZXMsIGZ1bmN0aW9uIChjaGFuZ2UpIHtcblx0XHRcdFx0XHRvcHRpb25zW3BhcmVudE5hbWVdLmFycmF5Q2hhbmdlZChjaGFuZ2UuZXZlbnQsIGNoYW5nZS5pdGVtKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcHBlZFJvb3RPYmplY3Q7XG5cdH1cblxuXHRmdW5jdGlvbiBpZ25vcmFibGVJbmRleE9mKGFycmF5LCBpdGVtLCBpZ25vcmVJbmRpY2VzKSB7XG5cdFx0Zm9yICh2YXIgaSA9IDAsIGogPSBhcnJheS5sZW5ndGg7IGkgPCBqOyBpKyspIHtcblx0XHRcdGlmIChpZ25vcmVJbmRpY2VzW2ldID09PSB0cnVlKSBjb250aW51ZTtcblx0XHRcdGlmIChhcnJheVtpXSA9PT0gaXRlbSkgcmV0dXJuIGk7XG5cdFx0fVxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0ZnVuY3Rpb24gbWFwS2V5KGl0ZW0sIGNhbGxiYWNrKSB7XG5cdFx0dmFyIG1hcHBlZEl0ZW07XG5cdFx0aWYgKGNhbGxiYWNrKSBtYXBwZWRJdGVtID0gY2FsbGJhY2soaXRlbSk7XG5cdFx0aWYgKGV4cG9ydHMuZ2V0VHlwZShtYXBwZWRJdGVtKSA9PT0gXCJ1bmRlZmluZWRcIikgbWFwcGVkSXRlbSA9IGl0ZW07XG5cblx0XHRyZXR1cm4ga28udXRpbHMudW53cmFwT2JzZXJ2YWJsZShtYXBwZWRJdGVtKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGdldEl0ZW1CeUtleShhcnJheSwga2V5LCBjYWxsYmFjaykge1xuXHRcdGFycmF5ID0ga28udXRpbHMudW53cmFwT2JzZXJ2YWJsZShhcnJheSk7XG5cdFx0Zm9yICh2YXIgaSA9IDAsIGogPSBhcnJheS5sZW5ndGg7IGkgPCBqOyBpKyspIHtcblx0XHRcdHZhciBpdGVtID0gYXJyYXlbaV07XG5cdFx0XHRpZiAobWFwS2V5KGl0ZW0sIGNhbGxiYWNrKSA9PT0ga2V5KSByZXR1cm4gaXRlbTtcblx0XHR9XG5cblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJXaGVuIGNhbGxpbmcga28udXBkYXRlKiwgdGhlIGtleSAnXCIgKyBrZXkgKyBcIicgd2FzIG5vdCBmb3VuZCFcIik7XG5cdH1cblxuXHRmdW5jdGlvbiBmaWx0ZXJBcnJheUJ5S2V5KGFycmF5LCBjYWxsYmFjaykge1xuXHRcdHJldHVybiBrby51dGlscy5hcnJheU1hcChrby51dGlscy51bndyYXBPYnNlcnZhYmxlKGFycmF5KSwgZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdGlmIChjYWxsYmFjaykge1xuXHRcdFx0XHRyZXR1cm4gbWFwS2V5KGl0ZW0sIGNhbGxiYWNrKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiBpdGVtO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gdmlzaXRQcm9wZXJ0aWVzT3JBcnJheUVudHJpZXMocm9vdE9iamVjdCwgdmlzaXRvckNhbGxiYWNrKSB7XG5cdFx0aWYgKGV4cG9ydHMuZ2V0VHlwZShyb290T2JqZWN0KSA9PT0gXCJhcnJheVwiKSB7XG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJvb3RPYmplY3QubGVuZ3RoOyBpKyspXG5cdFx0XHR2aXNpdG9yQ2FsbGJhY2soaSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvciAodmFyIHByb3BlcnR5TmFtZSBpbiByb290T2JqZWN0KVxuXHRcdFx0dmlzaXRvckNhbGxiYWNrKHByb3BlcnR5TmFtZSk7XG5cdFx0fVxuXHR9O1xuXG5cdGZ1bmN0aW9uIGNhbkhhdmVQcm9wZXJ0aWVzKG9iamVjdCkge1xuXHRcdHZhciB0eXBlID0gZXhwb3J0cy5nZXRUeXBlKG9iamVjdCk7XG5cdFx0cmV0dXJuICgodHlwZSA9PT0gXCJvYmplY3RcIikgfHwgKHR5cGUgPT09IFwiYXJyYXlcIikpICYmIChvYmplY3QgIT09IG51bGwpO1xuXHR9XG5cblx0Ly8gQmFzZWQgb24gdGhlIHBhcmVudE5hbWUsIHRoaXMgY3JlYXRlcyBhIGZ1bGx5IGNsYXNzaWZpZWQgbmFtZSBvZiBhIHByb3BlcnR5XG5cblx0ZnVuY3Rpb24gZ2V0UHJvcGVydHlOYW1lKHBhcmVudE5hbWUsIHBhcmVudCwgaW5kZXhlcikge1xuXHRcdHZhciBwcm9wZXJ0eU5hbWUgPSBwYXJlbnROYW1lIHx8IFwiXCI7XG5cdFx0aWYgKGV4cG9ydHMuZ2V0VHlwZShwYXJlbnQpID09PSBcImFycmF5XCIpIHtcblx0XHRcdGlmIChwYXJlbnROYW1lKSB7XG5cdFx0XHRcdHByb3BlcnR5TmFtZSArPSBcIltcIiArIGluZGV4ZXIgKyBcIl1cIjtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKHBhcmVudE5hbWUpIHtcblx0XHRcdFx0cHJvcGVydHlOYW1lICs9IFwiLlwiO1xuXHRcdFx0fVxuXHRcdFx0cHJvcGVydHlOYW1lICs9IGluZGV4ZXI7XG5cdFx0fVxuXHRcdHJldHVybiBwcm9wZXJ0eU5hbWU7XG5cdH1cblxuXHRleHBvcnRzLnZpc2l0TW9kZWwgPSBmdW5jdGlvbiAocm9vdE9iamVjdCwgY2FsbGJhY2ssIG9wdGlvbnMpIHtcblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblx0XHRvcHRpb25zLnZpc2l0ZWRPYmplY3RzID0gb3B0aW9ucy52aXNpdGVkT2JqZWN0cyB8fCBuZXcgb2JqZWN0TG9va3VwKCk7XG5cblx0XHR2YXIgbWFwcGVkUm9vdE9iamVjdDtcblx0XHR2YXIgdW53cmFwcGVkUm9vdE9iamVjdCA9IGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUocm9vdE9iamVjdCk7XG5cblx0XHRpZiAoIWNhbkhhdmVQcm9wZXJ0aWVzKHVud3JhcHBlZFJvb3RPYmplY3QpKSB7XG5cdFx0XHRyZXR1cm4gY2FsbGJhY2socm9vdE9iamVjdCwgb3B0aW9ucy5wYXJlbnROYW1lKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0b3B0aW9ucyA9IGZpbGxPcHRpb25zKG9wdGlvbnMsIHVud3JhcHBlZFJvb3RPYmplY3RbbWFwcGluZ1Byb3BlcnR5XSk7XG5cblx0XHRcdC8vIE9ubHkgZG8gYSBjYWxsYmFjaywgYnV0IGlnbm9yZSB0aGUgcmVzdWx0c1xuXHRcdFx0Y2FsbGJhY2socm9vdE9iamVjdCwgb3B0aW9ucy5wYXJlbnROYW1lKTtcblx0XHRcdG1hcHBlZFJvb3RPYmplY3QgPSBleHBvcnRzLmdldFR5cGUodW53cmFwcGVkUm9vdE9iamVjdCkgPT09IFwiYXJyYXlcIiA/IFtdIDoge307XG5cdFx0fVxuXG5cdFx0b3B0aW9ucy52aXNpdGVkT2JqZWN0cy5zYXZlKHJvb3RPYmplY3QsIG1hcHBlZFJvb3RPYmplY3QpO1xuXG5cdFx0dmFyIHBhcmVudE5hbWUgPSBvcHRpb25zLnBhcmVudE5hbWU7XG5cdFx0dmlzaXRQcm9wZXJ0aWVzT3JBcnJheUVudHJpZXModW53cmFwcGVkUm9vdE9iamVjdCwgZnVuY3Rpb24gKGluZGV4ZXIpIHtcblx0XHRcdGlmIChvcHRpb25zLmlnbm9yZSAmJiBrby51dGlscy5hcnJheUluZGV4T2Yob3B0aW9ucy5pZ25vcmUsIGluZGV4ZXIpICE9IC0xKSByZXR1cm47XG5cblx0XHRcdHZhciBwcm9wZXJ0eVZhbHVlID0gdW53cmFwcGVkUm9vdE9iamVjdFtpbmRleGVyXTtcblx0XHRcdG9wdGlvbnMucGFyZW50TmFtZSA9IGdldFByb3BlcnR5TmFtZShwYXJlbnROYW1lLCB1bndyYXBwZWRSb290T2JqZWN0LCBpbmRleGVyKTtcblxuXHRcdFx0Ly8gSWYgd2UgZG9uJ3Qgd2FudCB0byBleHBsaWNpdGx5IGNvcHkgdGhlIHVubWFwcGVkIHByb3BlcnR5Li4uXG5cdFx0XHRpZiAoa28udXRpbHMuYXJyYXlJbmRleE9mKG9wdGlvbnMuY29weSwgaW5kZXhlcikgPT09IC0xKSB7XG5cdFx0XHRcdC8vIC4uLmZpbmQgb3V0IGlmIGl0J3MgYSBwcm9wZXJ0eSB3ZSB3YW50IHRvIGV4cGxpY2l0bHkgaW5jbHVkZVxuXHRcdFx0XHRpZiAoa28udXRpbHMuYXJyYXlJbmRleE9mKG9wdGlvbnMuaW5jbHVkZSwgaW5kZXhlcikgPT09IC0xKSB7XG5cdFx0XHRcdFx0Ly8gVGhlIG1hcHBlZCBwcm9wZXJ0aWVzIG9iamVjdCBjb250YWlucyBhbGwgdGhlIHByb3BlcnRpZXMgdGhhdCB3ZXJlIHBhcnQgb2YgdGhlIG9yaWdpbmFsIG9iamVjdC5cblx0XHRcdFx0XHQvLyBJZiBhIHByb3BlcnR5IGRvZXMgbm90IGV4aXN0LCBhbmQgaXQgaXMgbm90IGJlY2F1c2UgaXQgaXMgcGFydCBvZiBhbiBhcnJheSAoZS5nLiBcIm15UHJvcFszXVwiKSwgdGhlbiBpdCBzaG91bGQgbm90IGJlIHVubWFwcGVkLlxuXHRcdFx0XHQgICAgaWYgKHVud3JhcHBlZFJvb3RPYmplY3RbbWFwcGluZ1Byb3BlcnR5XVxuXHRcdFx0XHQgICAgICAgICYmIHVud3JhcHBlZFJvb3RPYmplY3RbbWFwcGluZ1Byb3BlcnR5XS5tYXBwZWRQcm9wZXJ0aWVzICYmICF1bndyYXBwZWRSb290T2JqZWN0W21hcHBpbmdQcm9wZXJ0eV0ubWFwcGVkUHJvcGVydGllc1tpbmRleGVyXVxuXHRcdFx0XHQgICAgICAgICYmIHVud3JhcHBlZFJvb3RPYmplY3RbbWFwcGluZ1Byb3BlcnR5XS5jb3BpZWRQcm9wZXJ0aWVzICYmICF1bndyYXBwZWRSb290T2JqZWN0W21hcHBpbmdQcm9wZXJ0eV0uY29waWVkUHJvcGVydGllc1tpbmRleGVyXVxuXHRcdFx0XHQgICAgICAgICYmICEoZXhwb3J0cy5nZXRUeXBlKHVud3JhcHBlZFJvb3RPYmplY3QpID09PSBcImFycmF5XCIpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHZhciBvdXRwdXRQcm9wZXJ0eTtcblx0XHRcdHN3aXRjaCAoZXhwb3J0cy5nZXRUeXBlKGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUocHJvcGVydHlWYWx1ZSkpKSB7XG5cdFx0XHRjYXNlIFwib2JqZWN0XCI6XG5cdFx0XHRjYXNlIFwiYXJyYXlcIjpcblx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0dmFyIHByZXZpb3VzbHlNYXBwZWRWYWx1ZSA9IG9wdGlvbnMudmlzaXRlZE9iamVjdHMuZ2V0KHByb3BlcnR5VmFsdWUpO1xuXHRcdFx0XHRtYXBwZWRSb290T2JqZWN0W2luZGV4ZXJdID0gKGV4cG9ydHMuZ2V0VHlwZShwcmV2aW91c2x5TWFwcGVkVmFsdWUpICE9PSBcInVuZGVmaW5lZFwiKSA/IHByZXZpb3VzbHlNYXBwZWRWYWx1ZSA6IGV4cG9ydHMudmlzaXRNb2RlbChwcm9wZXJ0eVZhbHVlLCBjYWxsYmFjaywgb3B0aW9ucyk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0bWFwcGVkUm9vdE9iamVjdFtpbmRleGVyXSA9IGNhbGxiYWNrKHByb3BlcnR5VmFsdWUsIG9wdGlvbnMucGFyZW50TmFtZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gbWFwcGVkUm9vdE9iamVjdDtcblx0fVxuXG5cdGZ1bmN0aW9uIHNpbXBsZU9iamVjdExvb2t1cCgpIHtcblx0XHR2YXIga2V5cyA9IFtdO1xuXHRcdHZhciB2YWx1ZXMgPSBbXTtcblx0XHR0aGlzLnNhdmUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuXHRcdFx0dmFyIGV4aXN0aW5nSW5kZXggPSBrby51dGlscy5hcnJheUluZGV4T2Yoa2V5cywga2V5KTtcblx0XHRcdGlmIChleGlzdGluZ0luZGV4ID49IDApIHZhbHVlc1tleGlzdGluZ0luZGV4XSA9IHZhbHVlO1xuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGtleXMucHVzaChrZXkpO1xuXHRcdFx0XHR2YWx1ZXMucHVzaCh2YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fTtcblx0XHR0aGlzLmdldCA9IGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdHZhciBleGlzdGluZ0luZGV4ID0ga28udXRpbHMuYXJyYXlJbmRleE9mKGtleXMsIGtleSk7XG5cdFx0XHR2YXIgdmFsdWUgPSAoZXhpc3RpbmdJbmRleCA+PSAwKSA/IHZhbHVlc1tleGlzdGluZ0luZGV4XSA6IHVuZGVmaW5lZDtcblx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHR9O1xuXHR9O1xuXHRcblx0ZnVuY3Rpb24gb2JqZWN0TG9va3VwKCkge1xuXHRcdHZhciBidWNrZXRzID0ge307XG5cdFx0XG5cdFx0dmFyIGZpbmRCdWNrZXQgPSBmdW5jdGlvbihrZXkpIHtcblx0XHRcdHZhciBidWNrZXRLZXk7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRidWNrZXRLZXkgPSBrZXk7Ly9KU09OLnN0cmluZ2lmeShrZXkpO1xuXHRcdFx0fVxuXHRcdFx0Y2F0Y2ggKGUpIHtcblx0XHRcdFx0YnVja2V0S2V5ID0gXCIkJCRcIjtcblx0XHRcdH1cblxuXHRcdFx0dmFyIGJ1Y2tldCA9IGJ1Y2tldHNbYnVja2V0S2V5XTtcblx0XHRcdGlmIChidWNrZXQgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRidWNrZXQgPSBuZXcgc2ltcGxlT2JqZWN0TG9va3VwKCk7XG5cdFx0XHRcdGJ1Y2tldHNbYnVja2V0S2V5XSA9IGJ1Y2tldDtcblx0XHRcdH1cblx0XHRcdHJldHVybiBidWNrZXQ7XG5cdFx0fTtcblx0XHRcblx0XHR0aGlzLnNhdmUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuXHRcdFx0ZmluZEJ1Y2tldChrZXkpLnNhdmUoa2V5LCB2YWx1ZSk7XG5cdFx0fTtcblx0XHR0aGlzLmdldCA9IGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdHJldHVybiBmaW5kQnVja2V0KGtleSkuZ2V0KGtleSk7XG5cdFx0fTtcblx0fTtcbn0pKTsiLCIvLyBLbm9ja291dCBGYXN0IE1hcHBpbmcgdjAuMVxuLy8gTGljZW5zZTogTUlUIChodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocClcblxuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XG5cdC8vIE1vZHVsZSBzeXN0ZW1zIG1hZ2ljIGRhbmNlLlxuXG5cdGlmICh0eXBlb2YgcmVxdWlyZSA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBleHBvcnRzID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUgPT09IFwib2JqZWN0XCIpIHtcblx0XHQvLyBDb21tb25KUyBvciBOb2RlOiBoYXJkLWNvZGVkIGRlcGVuZGVuY3kgb24gXCJrbm9ja291dFwiXG5cdFx0ZmFjdG9yeSgodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1sna28nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2tvJ10gOiBudWxsKSwgZXhwb3J0cyk7XG5cdH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZVtcImFtZFwiXSkge1xuXHRcdC8vIEFNRCBhbm9ueW1vdXMgbW9kdWxlIHdpdGggaGFyZC1jb2RlZCBkZXBlbmRlbmN5IG9uIFwia25vY2tvdXRcIlxuXHRcdGRlZmluZShbXCJrbm9ja291dFwiLCBcImV4cG9ydHNcIl0sIGZhY3RvcnkpO1xuXHR9IGVsc2Uge1xuXHRcdC8vIDxzY3JpcHQ+IHRhZzogdXNlIHRoZSBnbG9iYWwgYGtvYCBvYmplY3QsIGF0dGFjaGluZyBhIGB3cmFwYCBwcm9wZXJ0eVxuXHRcdGZhY3Rvcnkoa28sIGtvLndyYXAgPSB7fSk7XG5cdH1cbn0oZnVuY3Rpb24gKGtvLCBleHBvcnRzKSB7XG4gICAgXG4gICAgLy8gdGhpcyBmdW5jdGlvbiBtaW1pY3Mga28ubWFwcGluZ1xuICAgIGV4cG9ydHMuZnJvbUpTID0gZnVuY3Rpb24oanNPYmplY3QsIGNvbXB1dGVkRnVuY3Rpb25zKVxuICAgIHtcbiAgICAgICAgcmVzZXQoKTtcblx0cmV0dXJuIHdyYXAoanNPYmplY3QsIGNvbXB1dGVkRnVuY3Rpb25zKTtcbiAgICB9XG5cbiAgICAvLyB0aGlzIGZ1bmN0aW9uIHVud3JhcHMgdGhlIG91dGVyIGZvciBhc3NpZ25pbmcgdGhlIHJlc3VsdCB0byBhbiBvYnNlcnZhYmxlXG4gICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9TdGV2ZVNhbmRlcnNvbi9rbm9ja291dC9pc3N1ZXMvNTE3XG4gICAgZXhwb3J0cy51cGRhdGVGcm9tSlMgPSBmdW5jdGlvbihvYnNlcnZhYmxlLCBqc09iamVjdCwgY29tcHV0ZWRGdW5jdGlvbnMpXG4gICAge1xuICAgICAgICByZXNldCgpO1xuXHRyZXR1cm4gb2JzZXJ2YWJsZShrby51dGlscy51bndyYXBPYnNlcnZhYmxlKHdyYXAoanNPYmplY3QsIGNvbXB1dGVkRnVuY3Rpb25zKSkpO1xuICAgIH1cblxuICAgIGV4cG9ydHMuZnJvbUpTT04gPSBmdW5jdGlvbiAoanNvblN0cmluZywgY29tcHV0ZWRGdW5jdGlvbnMpIHtcblx0dmFyIHBhcnNlZCA9IGtvLnV0aWxzLnBhcnNlSnNvbihqc29uU3RyaW5nKTtcblx0YXJndW1lbnRzWzBdID0gcGFyc2VkO1xuXHRyZXR1cm4gZXhwb3J0cy5mcm9tSlMuYXBwbHkodGhpcywgY29tcHV0ZWRGdW5jdGlvbnMpO1xuICAgIH07XG4gICAgXG4gICAgZXhwb3J0cy50b0pTID0gZnVuY3Rpb24gKG9ic2VydmFibGUpIHtcblx0cmV0dXJuIHVud3JhcChvYnNlcnZhYmxlKTtcbiAgICB9XG5cbiAgICBleHBvcnRzLnRvSlNPTiA9IGZ1bmN0aW9uIChvYnNlcnZhYmxlKSB7XG5cdHZhciBwbGFpbkphdmFTY3JpcHRPYmplY3QgPSBleHBvcnRzLnRvSlMob2JzZXJ2YWJsZSk7XG5cdHJldHVybiBrby51dGlscy5zdHJpbmdpZnlKc29uKHBsYWluSmF2YVNjcmlwdE9iamVjdCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHR5cGVPZih2YWx1ZSkge1xuXHR2YXIgcyA9IHR5cGVvZiB2YWx1ZTtcblx0aWYgKHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuY29uc3RydWN0b3IgPT0gRGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgcyA9ICdkYXRlJztcblx0XHRlbHNlIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpID09ICdbb2JqZWN0IEFycmF5XScpXG4gICAgICAgICAgICAgICAgICAgIHMgPSAnYXJyYXknO1xuICAgICAgICAgICAgfSBlbHNlIHtcblx0XHRzID0gJ251bGwnO1xuICAgICAgICAgICAgfVxuXHR9XG5cdHJldHVybiBzO1xuICAgIH1cblxuICAgIC8vIHVud3JhcHBpbmdcbiAgICBmdW5jdGlvbiB1bndyYXBPYmplY3QobylcbiAgICB7XG5cdHZhciB0ID0ge307XG5cblx0Zm9yICh2YXIgayBpbiBvKVxuXHR7XG5cdCAgICB2YXIgdiA9IG9ba107XG5cblx0ICAgIGlmIChrby5pc0NvbXB1dGVkKHYpKVxuXHRcdGNvbnRpbnVlO1xuXG5cdCAgICB0W2tdID0gdW53cmFwKHYpO1xuXHR9XG5cblx0cmV0dXJuIHQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdW53cmFwQXJyYXkoYSlcbiAgICB7XG5cdHZhciByID0gW107XG5cblx0aWYgKCFhIHx8IGEubGVuZ3RoID09IDApXG5cdCAgICByZXR1cm4gcjtcblx0XG5cdGZvciAodmFyIGkgPSAwLCBsID0gYS5sZW5ndGg7IGkgPCBsOyArK2kpXG5cdCAgICByLnB1c2godW53cmFwKGFbaV0pKTtcblxuXHRyZXR1cm4gcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1bndyYXAodilcbiAgICB7XG5cdHZhciBpc09ic2VydmFibGUgPSBrby5pc09ic2VydmFibGUodik7XG5cblx0aWYgKGlzT2JzZXJ2YWJsZSlcblx0e1xuXHQgICAgdmFyIHZhbCA9IHYoKTtcblxuXHQgICAgcmV0dXJuIHVud3JhcCh2YWwpO1xuXHR9XG5cdGVsc2Vcblx0e1xuXHQgICAgaWYgKHR5cGVPZih2KSA9PSBcImFycmF5XCIpXG5cdCAgICB7XG5cdFx0cmV0dXJuIHVud3JhcEFycmF5KHYpO1xuXHQgICAgfVxuXHQgICAgZWxzZSBpZiAodHlwZU9mKHYpID09IFwib2JqZWN0XCIpXG5cdCAgICB7XG5cdFx0cmV0dXJuIHVud3JhcE9iamVjdCh2KTtcblx0ICAgIH1cblx0ICAgIGVsc2Vcblx0ICAgIHtcblx0XHRyZXR1cm4gdjtcblx0ICAgIH1cblx0fVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlc2V0KClcbiAgICB7XG4gICAgICAgIHBhcmVudHMgPSBbe29iajogbnVsbCwgd3JhcHBlZDogbnVsbCwgbHZsOiBcIlwifV07XG4gICAgfSAgICBcbiAgICBcbiAgICAvLyB3cmFwcGluZ1xuXG4gICAgZnVuY3Rpb24gd3JhcE9iamVjdChvLCBjb21wdXRlZEZ1bmN0aW9ucylcbiAgICB7XG4gICAgICAgIC8vIGNoZWNrIGZvciBpbmZpbml0ZSByZWN1cnNpb25cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJlbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAocGFyZW50c1tpXS5vYmogPT09IG8pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50c1tpXS53cmFwcGVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cblx0dmFyIHQgPSB7fTtcblxuXHRmb3IgKHZhciBrIGluIG8pXG5cdHtcblx0ICAgIHZhciB2ID0gb1trXTtcblxuICAgICAgICAgICAgcGFyZW50cy5wdXNoKHtvYmo6IG8sIHdyYXBwZWQ6IHQsIGx2bDogY3VycmVudEx2bCgpICsgXCIvXCIgKyBrfSk7XG5cblx0ICAgIHRba10gPSB3cmFwKHYsIGNvbXB1dGVkRnVuY3Rpb25zKTtcblxuICAgICAgICAgICAgcGFyZW50cy5wb3AoKTtcblx0fVxuXG5cdGlmIChjb21wdXRlZEZ1bmN0aW9ucyAmJiBjb21wdXRlZEZ1bmN0aW9uc1tjdXJyZW50THZsKCldKVxuXHQgICAgdCA9IGNvbXB1dGVkRnVuY3Rpb25zW2N1cnJlbnRMdmwoKV0odCk7XG5cbiAgICAgICAgaWYgKGhhc0VTNVBsdWdpbigpKVxuICAgICAgICAgICAga28udHJhY2sodCk7XG5cblx0cmV0dXJuIHQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gd3JhcEFycmF5KGEsIGNvbXB1dGVkRnVuY3Rpb25zKVxuICAgIHtcblx0dmFyIHIgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcblxuXHRpZiAoIWEgfHwgYS5sZW5ndGggPT0gMClcblx0ICAgIHJldHVybiByO1xuXG5cdGZvciAodmFyIGkgPSAwLCBsID0gYS5sZW5ndGg7IGkgPCBsOyArK2kpXG5cdCAgICByLnB1c2god3JhcChhW2ldLCBjb21wdXRlZEZ1bmN0aW9ucykpO1xuXG5cdHJldHVybiByO1xuICAgIH1cblxuICAgIC8vIGEgc3RhY2ssIHVzZWQgZm9yIHR3byBwdXJwb3NlczpcbiAgICAvLyAgLSBjaXJjdWxhciByZWZlcmVuY2UgY2hlY2tpbmdcbiAgICAvLyAgLSBjb21wdXRlZCBmdW5jdGlvbnNcbiAgICB2YXIgcGFyZW50cztcblxuICAgIGZ1bmN0aW9uIGN1cnJlbnRMdmwoKVxuICAgIHtcblx0cmV0dXJuIHBhcmVudHNbcGFyZW50cy5sZW5ndGgtMV0ubHZsO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHdyYXAodiwgY29tcHV0ZWRGdW5jdGlvbnMpXG4gICAge1xuXHRpZiAodHlwZU9mKHYpID09IFwiYXJyYXlcIilcblx0e1xuXHQgICAgcmV0dXJuIHdyYXBBcnJheSh2LCBjb21wdXRlZEZ1bmN0aW9ucyk7XG5cdH1cblx0ZWxzZSBpZiAodHlwZU9mKHYpID09IFwib2JqZWN0XCIpXG5cdHtcblx0ICAgIHJldHVybiB3cmFwT2JqZWN0KHYsIGNvbXB1dGVkRnVuY3Rpb25zKTtcblx0fVxuXHRlbHNlXG5cdHtcbiAgICAgICAgICAgIGlmICghaGFzRVM1UGx1Z2luKCkgJiYgdHlwZW9mIHYgIT09ICdmdW5jdGlvbicpXG4gICAgICAgICAgICB7XG5cdCAgICAgICAgdmFyIHQgPSBrby5vYnNlcnZhYmxlKCk7XG5cdCAgICAgICAgdCh2KTtcblx0ICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB2O1xuXHR9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGFzRVM1UGx1Z2luKClcbiAgICB7XG4gICAgICAgIHJldHVybiBrby50cmFjayAhPSBudWxsO1xuICAgIH1cbn0pKTsiXX0=
